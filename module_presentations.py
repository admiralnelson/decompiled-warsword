# -*- coding: UTF-8 -*-
####################################################################################################################
# Generated by Warband Module Decompiler
# All rights of the module belong to their respective owners
####################################################################################################################

from header_common import *
from header_presentations import *
from header_mission_templates import *
from ID_meshes import *
from header_operations import *
from header_triggers import *
from module_constants import *
import string

####################################################################################################################
#  Each presentation record contains the following fields:
#  1) Presentation id: used for referencing presentations in other files. The prefix prsnt_ is automatically added before each presentation id.
#  2) Presentation flags. See header_presentations.py for a list of available flags
#  3) Presentation background mesh: See module_meshes.py for a list of available background meshes
#  4) Triggers: Simple triggers that are associated with the presentation
####################################################################################################################

presentations = [
  ("game_start", prsntf_read_only, mesh_pic_bandits,
  [
    (ti_on_presentation_load,
    [
      (presentation_set_duration, 999999),
      (set_fixed_point_multiplier, 1000),
      (assign, ":var0", 1011),
      (assign, ":var1", 4),
      (store_div, reg1, ":var0", 1000),
      (store_mod, reg2, ":var0", 1000),
      (try_begin),
        (eq, reg2, 0),
        (str_store_string, s1, "@{reg1}.0"),
      (else_try),
        (lt, reg2, 1),
        (str_store_string, s1, "@{reg1}.00{reg2}"),
      (else_try),
        (lt, reg2, 1),
        (try_begin),
          (store_mod, ":var2", reg2, 1),
          (eq, ":var2", 0),
          (val_div, reg2, 1),
        (try_end),
        (str_store_string, s1, "@{reg1}.0{reg2}"),
      (else_try),
        (try_begin),
          (store_mod, ":var2", reg2, 1),
          (eq, ":var2", 0),
          (val_div, reg2, 1),
        (else_try),
          (store_mod, ":var2", reg2, 1),
          (eq, ":var2", 0),
          (val_div, reg2, 1),
        (try_end),
        (str_store_string, s1, "@{reg1}.{reg2}"),
      (try_end),
      (create_text_overlay, "$g_presentation_credits_obj_1", "@Warsword Conquest Winds of Magic Beta", tf_center_justify|tf_double_space|tf_vertical_align_center),
      (create_text_overlay, "$g_presentation_credits_obj_2", "@Warsword Conquest Winds of Magic Beta", tf_center_justify|tf_double_space|tf_vertical_align_center),
      (create_text_overlay, "$g_presentation_credits_obj_3", "@Warsword Conquest Winds of Magic Beta", tf_center_justify|tf_double_space|tf_vertical_align_center),
      (overlay_set_color, "$g_presentation_credits_obj_1", 0x000000),
      (overlay_set_color, "$g_presentation_credits_obj_2", 0x000000),
      (overlay_set_color, "$g_presentation_credits_obj_3", 0xFF0000),
      (position_set_x, pos1, -300),
      (position_set_y, pos1, 600),
      (overlay_set_position, "$g_presentation_credits_obj_1", pos1),
      (position_set_x, pos1, 450),
      (position_set_y, pos1, 600),
      (overlay_animate_to_position, "$g_presentation_credits_obj_1", 600, pos1),
      (position_set_x, pos1, -299),
      (position_set_y, pos1, 601),
      (overlay_set_position, "$g_presentation_credits_obj_2", pos1),
      (position_set_x, pos1, 451),
      (position_set_y, pos1, 601),
      (overlay_animate_to_position, "$g_presentation_credits_obj_2", 600, pos1),
      (position_set_x, pos1, 1300),
      (position_set_y, pos1, 602),
      (overlay_set_position, "$g_presentation_credits_obj_3", pos1),
      (position_set_x, pos1, 452),
      (position_set_y, pos1, 602),
      (overlay_animate_to_position, "$g_presentation_credits_obj_3", 600, pos1),
    ]),
  ]),

  ("game_credits", prsntf_read_only, mesh_load_window,
  [
    (ti_on_presentation_load,
    [
      (assign, "$g_presentation_credits_obj_1", -1),
      (assign, "$g_presentation_credits_obj_2", -1),
      (assign, "$g_presentation_credits_obj_3", -1),
      (assign, "$g_presentation_credits_obj_4", -1),
      (assign, "$g_presentation_credits_obj_5", -1),
      (assign, "$g_presentation_credits_obj_6", -1),
      (assign, "$g_presentation_credits_obj_7", -1),
      (assign, "$g_presentation_credits_obj_8", -1),
      (assign, "$g_presentation_credits_obj_9", -1),
      (assign, "$g_presentation_credits_obj_10", -1),
      (assign, "$g_presentation_credits_obj_11", -1),
      (assign, "$g_presentation_credits_obj_12", -1),
      (assign, "$g_presentation_credits_obj_1_alpha", 0),
      (assign, "$g_presentation_credits_obj_2_alpha", 0),
      (assign, "$g_presentation_credits_obj_3_alpha", 0),
      (assign, "$g_presentation_credits_obj_4_alpha", 0),
      (assign, "$g_presentation_credits_obj_5_alpha", 0),
      (assign, "$g_presentation_credits_obj_6_alpha", 0),
      (assign, "$g_presentation_credits_obj_7_alpha", 0),
      (assign, "$g_presentation_credits_obj_8_alpha", 0),
      (assign, "$g_presentation_credits_obj_9_alpha", 0),
    ]),
    (ti_on_presentation_run,
    [
      (store_trigger_param_1, ":var0"),
      (set_fixed_point_multiplier, 1000),
      (presentation_set_duration, 1000000),
      (try_begin),
        (this_or_next|key_clicked, key_space),
        (this_or_next|key_clicked, key_enter),
        (this_or_next|key_clicked, key_escape),
        (this_or_next|key_clicked, key_back_space),
        (this_or_next|key_clicked, key_left_mouse_button),
        (this_or_next|key_clicked, key_right_mouse_button),
        (this_or_next|key_clicked, key_xbox_ltrigger),
        (key_clicked, key_xbox_rtrigger),
        (presentation_set_duration, 0),
      (try_end),
      (try_begin),
        (lt, "$g_presentation_credits_obj_1", 0),
        (str_store_string, s1, "str_credits_1"),
        (create_text_overlay, "$g_presentation_credits_obj_1", s1, tf_center_justify|tf_double_space|tf_vertical_align_center),
        (overlay_set_color, "$g_presentation_credits_obj_1", 0x000000),
        (overlay_set_alpha, "$g_presentation_credits_obj_1", 0x00),
        (position_set_x, pos1, 1500),
        (position_set_y, pos1, 1500),
        (overlay_set_size, "$g_presentation_credits_obj_1", pos1),
        (position_set_x, pos1, 500),
        (position_set_y, pos1, 375),
        (overlay_set_position, "$g_presentation_credits_obj_1", pos1),
        (overlay_animate_to_alpha, "$g_presentation_credits_obj_1", 1000, 0x0000FF),
      (else_try),
        (gt, ":var0", 2000),
        (eq, "$g_presentation_credits_obj_1_alpha", 0),
        (assign, "$g_presentation_credits_obj_1_alpha", 1),
        (overlay_animate_to_alpha, "$g_presentation_credits_obj_1", 1000, 0x000000),
      (else_try),
        (gt, ":var0", 3500),
        (lt, "$g_presentation_credits_obj_2", 0),
        (str_store_string, s1, "str_credits_2"),
        (create_text_overlay, "$g_presentation_credits_obj_2", s1, tf_center_justify|tf_double_space|tf_vertical_align_center),
        (overlay_set_color, "$g_presentation_credits_obj_2", 0x000000),
        (overlay_set_alpha, "$g_presentation_credits_obj_2", 0x00),
        (position_set_x, pos1, 1750),
        (position_set_y, pos1, 1750),
        (overlay_set_size, "$g_presentation_credits_obj_2", pos1),
        (position_set_x, pos1, 500),
        (position_set_y, pos1, 375),
        (overlay_set_position, "$g_presentation_credits_obj_2", pos1),
        (overlay_animate_to_alpha, "$g_presentation_credits_obj_2", 1000, 0x0000FF),
      (else_try),
        (gt, ":var0", 5500),
        (eq, "$g_presentation_credits_obj_2_alpha", 0),
        (assign, "$g_presentation_credits_obj_2_alpha", 1),
        (overlay_animate_to_alpha, "$g_presentation_credits_obj_2", 1000, 0x000000),
      (else_try),
        (gt, ":var0", 7000),
        (lt, "$g_presentation_credits_obj_3", 0),
        (str_store_string, s1, "str_credits_3"),
        (create_text_overlay, "$g_presentation_credits_obj_3", s1, tf_center_justify|tf_double_space|tf_vertical_align_center),
        (overlay_set_color, "$g_presentation_credits_obj_3", 0x000000),
        (overlay_set_alpha, "$g_presentation_credits_obj_3", 0x00),
        (position_set_x, pos1, 1750),
        (position_set_y, pos1, 1750),
        (overlay_set_size, "$g_presentation_credits_obj_3", pos1),
        (position_set_x, pos1, 500),
        (position_set_y, pos1, 375),
        (overlay_set_position, "$g_presentation_credits_obj_3", pos1),
        (overlay_animate_to_alpha, "$g_presentation_credits_obj_3", 1000, 0x0000FF),
      (else_try),
        (gt, ":var0", 9000),
        (eq, "$g_presentation_credits_obj_3_alpha", 0),
        (assign, "$g_presentation_credits_obj_3_alpha", 1),
        (overlay_animate_to_alpha, "$g_presentation_credits_obj_3", 1000, 0x000000),
      (else_try),
        (gt, ":var0", 10500),
        (lt, "$g_presentation_credits_obj_4", 0),
        (str_store_string, s1, "str_credits_4"),
        (create_text_overlay, "$g_presentation_credits_obj_4", s1, tf_center_justify|tf_double_space|tf_vertical_align_center),
        (overlay_set_color, "$g_presentation_credits_obj_4", 0x000000),
        (overlay_set_alpha, "$g_presentation_credits_obj_4", 0x00),
        (position_set_x, pos1, 1750),
        (position_set_y, pos1, 1750),
        (overlay_set_size, "$g_presentation_credits_obj_4", pos1),
        (position_set_x, pos1, 500),
        (position_set_y, pos1, 375),
        (overlay_set_position, "$g_presentation_credits_obj_4", pos1),
        (overlay_animate_to_alpha, "$g_presentation_credits_obj_4", 1000, 0x0000FF),
      (else_try),
        (gt, ":var0", 12500),
        (eq, "$g_presentation_credits_obj_4_alpha", 0),
        (assign, "$g_presentation_credits_obj_4_alpha", 1),
        (overlay_animate_to_alpha, "$g_presentation_credits_obj_4", 1000, 0x000000),
      (else_try),
        (gt, ":var0", 14000),
        (lt, "$g_presentation_credits_obj_5", 0),
        (str_store_string, s1, "str_credits_5"),
        (create_text_overlay, "$g_presentation_credits_obj_5", s1, tf_center_justify|tf_double_space|tf_vertical_align_center),
        (overlay_set_color, "$g_presentation_credits_obj_5", 0x000000),
        (overlay_set_alpha, "$g_presentation_credits_obj_5", 0x00),
        (position_set_x, pos1, 1750),
        (position_set_y, pos1, 1750),
        (overlay_set_size, "$g_presentation_credits_obj_5", pos1),
        (position_set_x, pos1, 500),
        (position_set_y, pos1, 375),
        (overlay_set_position, "$g_presentation_credits_obj_5", pos1),
        (overlay_animate_to_alpha, "$g_presentation_credits_obj_5", 1000, 0x0000FF),
      (else_try),
        (gt, ":var0", 16000),
        (eq, "$g_presentation_credits_obj_5_alpha", 0),
        (assign, "$g_presentation_credits_obj_5_alpha", 1),
        (overlay_animate_to_alpha, "$g_presentation_credits_obj_5", 1000, 0x000000),
      (else_try),
        (gt, ":var0", 17500),
        (lt, "$g_presentation_credits_obj_6", 0),
        (str_store_string, s1, "str_credits_6"),
        (create_text_overlay, "$g_presentation_credits_obj_6", s1, tf_center_justify|tf_double_space|tf_vertical_align_center),
        (overlay_set_color, "$g_presentation_credits_obj_6", 0x000000),
        (overlay_set_alpha, "$g_presentation_credits_obj_6", 0x00),
        (position_set_x, pos1, 1750),
        (position_set_y, pos1, 1750),
        (overlay_set_size, "$g_presentation_credits_obj_6", pos1),
        (position_set_x, pos1, 500),
        (position_set_y, pos1, 375),
        (overlay_set_position, "$g_presentation_credits_obj_6", pos1),
        (overlay_animate_to_alpha, "$g_presentation_credits_obj_6", 1000, 0x0000FF),
      (else_try),
        (gt, ":var0", 19500),
        (eq, "$g_presentation_credits_obj_6_alpha", 0),
        (assign, "$g_presentation_credits_obj_6_alpha", 1),
        (overlay_animate_to_alpha, "$g_presentation_credits_obj_6", 1000, 0x000000),
      (else_try),
        (gt, ":var0", 21000),
        (lt, "$g_presentation_credits_obj_7", 0),
        (str_store_string, s1, "str_credits_7"),
        (create_text_overlay, "$g_presentation_credits_obj_7", s1, tf_center_justify|tf_double_space|tf_vertical_align_center),
        (overlay_set_color, "$g_presentation_credits_obj_7", 0x000000),
        (overlay_set_alpha, "$g_presentation_credits_obj_7", 0x00),
        (position_set_x, pos1, 1750),
        (position_set_y, pos1, 1750),
        (overlay_set_size, "$g_presentation_credits_obj_7", pos1),
        (position_set_x, pos1, 500),
        (position_set_y, pos1, 375),
        (overlay_set_position, "$g_presentation_credits_obj_7", pos1),
        (overlay_animate_to_alpha, "$g_presentation_credits_obj_7", 1000, 0x0000FF),
      (else_try),
        (gt, ":var0", 23000),
        (eq, "$g_presentation_credits_obj_7_alpha", 0),
        (assign, "$g_presentation_credits_obj_7_alpha", 1),
        (overlay_animate_to_alpha, "$g_presentation_credits_obj_7", 1000, 0x000000),
      (else_try),
        (gt, ":var0", 24500),
        (lt, "$g_presentation_credits_obj_8", 0),
        (str_store_string, s1, "str_credits_8"),
        (create_text_overlay, "$g_presentation_credits_obj_8", s1, tf_center_justify|tf_double_space|tf_vertical_align_center),
        (overlay_set_color, "$g_presentation_credits_obj_8", 0x000000),
        (overlay_set_alpha, "$g_presentation_credits_obj_8", 0x00),
        (position_set_x, pos1, 1750),
        (position_set_y, pos1, 1750),
        (overlay_set_size, "$g_presentation_credits_obj_8", pos1),
        (position_set_x, pos1, 500),
        (position_set_y, pos1, 375),
        (overlay_set_position, "$g_presentation_credits_obj_8", pos1),
        (overlay_animate_to_alpha, "$g_presentation_credits_obj_8", 1000, 0x0000FF),
      (else_try),
        (gt, ":var0", 26500),
        (eq, "$g_presentation_credits_obj_8_alpha", 0),
        (assign, "$g_presentation_credits_obj_8_alpha", 1),
        (overlay_animate_to_alpha, "$g_presentation_credits_obj_8", 1000, 0x000000),
      (else_try),
        (gt, ":var0", 28000),
        (lt, "$g_presentation_credits_obj_9", 0),
        (str_store_string, s1, "str_credits_10"),
        (create_text_overlay, "$g_presentation_credits_obj_9", s1, tf_center_justify|tf_double_space|tf_vertical_align_center),
        (overlay_set_color, "$g_presentation_credits_obj_9", 0x000000),
        (overlay_set_alpha, "$g_presentation_credits_obj_9", 0x00),
        (position_set_x, pos1, 750),
        (position_set_y, pos1, 750),
        (overlay_set_size, "$g_presentation_credits_obj_9", pos1),
        (position_set_x, pos1, 250),
        (position_set_y, pos1, 485),
        (overlay_set_position, "$g_presentation_credits_obj_9", pos1),
        (overlay_animate_to_alpha, "$g_presentation_credits_obj_9", 1000, 0x0000FF),
        (str_store_string, s1, "str_credits_11"),
        (create_text_overlay, "$g_presentation_credits_obj_10", s1, tf_center_justify|tf_double_space|tf_vertical_align_center),
        (overlay_set_color, "$g_presentation_credits_obj_10", 0x000000),
        (overlay_set_alpha, "$g_presentation_credits_obj_10", 0x00),
        (position_set_x, pos1, 750),
        (position_set_y, pos1, 750),
        (overlay_set_size, "$g_presentation_credits_obj_10", pos1),
        (position_set_x, pos1, 750),
        (position_set_y, pos1, 470),
        (overlay_set_position, "$g_presentation_credits_obj_10", pos1),
        (overlay_animate_to_alpha, "$g_presentation_credits_obj_10", 1000, 0x0000FF),
        (str_store_string, s1, "str_credits_12"),
        (create_text_overlay, "$g_presentation_credits_obj_11", s1, tf_center_justify|tf_double_space|tf_vertical_align_center),
        (overlay_set_color, "$g_presentation_credits_obj_11", 0x000000),
        (overlay_set_alpha, "$g_presentation_credits_obj_11", 0x00),
        (position_set_x, pos1, 750),
        (position_set_y, pos1, 750),
        (overlay_set_size, "$g_presentation_credits_obj_11", pos1),
        (position_set_x, pos1, 500),
        (position_set_y, pos1, 105),
        (overlay_set_position, "$g_presentation_credits_obj_11", pos1),
        (overlay_animate_to_alpha, "$g_presentation_credits_obj_11", 1000, 0x0000FF),
      (else_try),
        (gt, ":var0", 34000),
        (eq, "$g_presentation_credits_obj_9_alpha", 0),
        (assign, "$g_presentation_credits_obj_9_alpha", 1),
        (overlay_animate_to_alpha, "$g_presentation_credits_obj_9", 1000, 0x000000),
        (overlay_animate_to_alpha, "$g_presentation_credits_obj_10", 1000, 0x000000),
        (overlay_animate_to_alpha, "$g_presentation_credits_obj_11", 1000, 0x000000),
      (else_try),
        (gt, ":var0", 35500),
        (lt, "$g_presentation_credits_obj_12", 0),
        (str_store_string, s1, "str_credits_9"),
        (create_text_overlay, "$g_presentation_credits_obj_12", s1, tf_center_justify|tf_double_space),
        (overlay_set_color, "$g_presentation_credits_obj_12", 0x000000),
        (overlay_set_alpha, "$g_presentation_credits_obj_12", 0xFF),
        (position_set_x, pos1, 1000),
        (position_set_y, pos1, 1000),
        (overlay_set_size, "$g_presentation_credits_obj_12", pos1),
        (position_set_x, pos1, 500),
        (position_set_y, pos1, -4800),
        (overlay_set_position, "$g_presentation_credits_obj_12", pos1),
        (position_set_x, pos1, 500),
        (position_set_y, pos1, 760),
        (overlay_animate_to_position, "$g_presentation_credits_obj_12", 70000, pos1),
      (else_try),
        (gt, ":var0", 105500),
        (presentation_set_duration, 0),
      (try_end),
    ]),
  ]),

  ("game_profile_banner_selection", 0, mesh_load_window,
  [
    (ti_on_presentation_load,
    [
      (set_fixed_point_multiplier, 1000),
      (str_store_string, s1, "str_profile_banner_selection_text"),
      (create_text_overlay, reg1, s1, tf_center_justify),
      (position_set_x, pos1, 500),
      (position_set_y, pos1, 600),
      (overlay_set_position, reg1, pos1),
      (overlay_set_text, reg1, s1),
      (create_button_overlay, "$g_presentation_obj_profile_banner_selection_1", "@Next Page", tf_center_justify),
      (position_set_x, pos1, 700),
      (position_set_y, pos1, 50),
      (overlay_set_position, "$g_presentation_obj_profile_banner_selection_1", pos1),
      (create_button_overlay, "$g_presentation_obj_profile_banner_selection_2", "str_use_default_banner", tf_center_justify),
      (position_set_x, pos1, 300),
      (position_set_y, pos1, 50),
      (overlay_set_position, "$g_presentation_obj_profile_banner_selection_2", pos1),
      (assign, ":var0", 150),
      (assign, ":var1", 575),
      (store_mul, ":var2", 16, "$g_presentation_page_no"),
      (store_add, ":var3", ":var2", 16),
      (store_add, "$g_presentation_banner_start", "$g_presentation_obj_profile_banner_selection_2", 1),
      (assign, ":var4", 0),
      (try_for_range, ":var5", "mesh_banner_a01", "mesh_banner_f21"),
        (assign, ":var6", 0),
        (try_for_range, ":var7", "fac_kingdom_1", "fac_kingdoms_end"),
          (faction_slot_eq, ":var7", 15, ":var5"),
          (assign, ":var6", 1),
        (try_end),
        (eq, ":var6", 0),
        (val_add, ":var4", 1),
        (gt, ":var4", ":var2"),
        (le, ":var4", ":var3"),
        (create_image_button_overlay, reg1, ":var5", ":var5"),
        (position_set_x, pos1, ":var0"),
        (position_set_y, pos1, ":var1"),
        (overlay_set_position, reg1, pos1),
        (position_set_x, pos1, 100),
        (position_set_y, pos1, 100),
        (overlay_set_size, reg1, pos1),
        (val_add, ":var0", 100),
        (ge, ":var0", 900),
        (assign, ":var0", 150),
        (val_sub, ":var1", 250),
      (try_end),
      (presentation_set_duration, 999999),
    ]),
    (ti_on_presentation_event_state_change,
    [
      (store_trigger_param_1, ":var0"),
      (try_begin),
        (eq, ":var0", "$g_presentation_obj_profile_banner_selection_1"),
        (val_add, "$g_presentation_page_no", 1),
        (val_mod, "$g_presentation_page_no", 21),
        (presentation_set_duration, 0),
        (start_presentation, "prsnt_game_profile_banner_selection"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_profile_banner_selection_2"),
        (profile_set_banner_id, -1),
        (presentation_set_duration, 0),
      (else_try),
        (store_sub, ":var1", ":var0", "$g_presentation_banner_start"),
        (store_mul, ":var2", 16, "$g_presentation_page_no"),
        (val_add, ":var1", ":var2"),
        (assign, ":var3", 0),
        (assign, ":var4", "mesh_banner_f21"),
        (try_for_range, ":var5", "mesh_banner_a01", ":var4"),
          (assign, ":var6", 0),
          (try_for_range, ":var7", "fac_kingdom_1", "fac_kingdoms_end"),
            (faction_slot_eq, ":var7", 15, ":var5"),
            (assign, ":var6", 1),
          (try_end),
          (eq, ":var6", 0),
          (try_begin),
            (eq, ":var1", ":var3"),
            (store_sub, ":var8", ":var5", "mesh_banner_a01"),
            (profile_set_banner_id, ":var8"),
            (assign, ":var4", 0),
          (try_end),
          (val_add, ":var3", 1),
        (try_end),
        (presentation_set_duration, 0),
      (try_end),
    ]),
  ]),

  ("game_custom_battle_designer", prsntf_manual_end_only, mesh_cb_ui_main,
  [
    (ti_on_presentation_load,
    [
      (set_fixed_point_multiplier, 1000),
      (create_text_overlay, reg0, "str_player", tf_center_justify|tf_single_line|tf_with_outline),
      (overlay_set_color, reg0, 0xFFFFFFFF),
      (position_set_x, pos1, 1500),
      (position_set_y, pos1, 1500),
      (overlay_set_size, reg0, pos1),
      (position_set_x, pos1, 175),
      (position_set_y, pos1, 700),
      (overlay_set_position, reg0, pos1),
      (create_text_overlay, reg0, "str_enemy", tf_center_justify|tf_single_line|tf_with_outline),
      (overlay_set_color, reg0, 0xFFFFFFFF),
      (position_set_x, pos1, 1500),
      (position_set_y, pos1, 1500),
      (overlay_set_size, reg0, pos1),
      (position_set_x, pos1, 820),
      (position_set_y, pos1, 700),
      (overlay_set_position, reg0, pos1),
      (create_text_overlay, reg0, "str_character", tf_center_justify),
      (position_set_x, pos1, 175),
      (position_set_y, pos1, 670),
      (overlay_set_position, reg0, pos1),
      (create_combo_label_overlay, "$g_presentation_obj_custom_battle_designer_18"),
      (position_set_x, pos1, 800),
      (position_set_y, pos1, 800),
      (overlay_set_size, "$g_presentation_obj_custom_battle_designer_18", pos1),
      (position_set_x, pos1, 175),
      (position_set_y, pos1, 635),
      (overlay_set_position, "$g_presentation_obj_custom_battle_designer_18", pos1),
      (try_for_range, ":var0", "trp_quick_battle_troop_1", "trp_quick_battle_troops_end"),
        (str_store_troop_name, s0, ":var0"),
        (overlay_add_item, "$g_presentation_obj_custom_battle_designer_18", s0),
      (try_end),
      (store_sub, ":var0", "$g_quick_battle_troop", "trp_quick_battle_troop_1"),
      (overlay_set_val, "$g_presentation_obj_custom_battle_designer_18", ":var0"),
      (store_mul, ":var0", "$g_quick_battle_troop", 2),
      (create_mesh_overlay_with_tableau_material, reg0, -1, "tableau_game_party_window", ":var0"),
      (position_set_x, pos1, 25),
      (position_set_y, pos1, 370),
      (overlay_set_position, reg0, pos1),
      (try_begin),
        (eq, "$g_quick_battle_team_2_faction", "fac_kingdom_1"),
        (assign, ":var0", "trp_swadian_knight"),
      (else_try),
        (eq, "$g_quick_battle_team_2_faction", "fac_kingdom_2"),
        (assign, ":var0", "trp_vaegir_knight"),
      (else_try),
        (eq, "$g_quick_battle_team_2_faction", "fac_kingdom_3"),
        (assign, ":var0", "trp_khergit_veteran_horse_archer"),
      (else_try),
        (eq, "$g_quick_battle_team_2_faction", "fac_kingdom_4"),
        (assign, ":var0", "trp_nord_champion"),
      (else_try),
        (eq, "$g_quick_battle_team_2_faction", "fac_kingdom_5"),
        (assign, ":var0", "trp_rhodok_sergeant"),
      (else_try),
        (eq, "$g_quick_battle_team_2_faction", "fac_kingdom_6"),
        (assign, ":var0", "trp_sarranid_mamluke"),
      (else_try),
        (assign, ":var0", "trp_taiga_bandit"),
      (try_end),
      (val_mul, ":var0", 2),
      (create_mesh_overlay_with_tableau_material, reg0, -1, "tableau_game_party_window", ":var0"),
      (position_set_x, pos1, 670),
      (position_set_y, pos1, 370),
      (overlay_set_position, reg0, pos1),
      (create_text_overlay, reg0, "str_biography", tf_center_justify),
      (position_set_x, pos1, 500),
      (position_set_y, pos1, 700),
      (overlay_set_position, reg0, pos1),
      (store_sub, ":var1", "$g_quick_battle_troop", "trp_quick_battle_troop_1"),
      (val_add, ":var1", "str_quick_battle_troop_1"),
      (create_text_overlay, reg0, ":var1", tf_scrollable),
      (position_set_x, pos1, 850),
      (position_set_y, pos1, 850),
      (overlay_set_size, reg0, pos1),
      (position_set_x, pos1, 320),
      (position_set_y, pos1, 560),
      (overlay_set_position, reg0, pos1),
      (position_set_x, pos1, 360),
      (position_set_y, pos1, 130),
      (overlay_set_area_size, reg0, pos1),
      (create_text_overlay, reg0, "str_map_basic", tf_center_justify),
      (overlay_set_color, reg0, 0xFFFFFF),
      (position_set_x, pos1, 1500),
      (position_set_y, pos1, 1500),
      (overlay_set_size, reg0, pos1),
      (position_set_x, pos1, 500),
      (position_set_y, pos1, 450),
      (overlay_set_position, reg0, pos1),
      (create_combo_label_overlay, "$g_presentation_obj_custom_battle_designer_1"),
      (position_set_x, pos1, 700),
      (position_set_y, pos1, 700),
      (overlay_set_size, "$g_presentation_obj_custom_battle_designer_1", pos1),
      (position_set_x, pos1, 500),
      (position_set_y, pos1, 415),
      (overlay_set_position, "$g_presentation_obj_custom_battle_designer_1", pos1),
      (try_begin),
        (eq, "$g_quick_battle_game_type", 0),
        (try_for_range, ":var2", "scn_quick_battle_scene_1", "scn_quick_battle_scene_4"),
          (store_sub, ":var3", ":var2", "scn_quick_battle_scene_1"),
          (val_add, ":var3", "str_quick_battle_scene_1"),
          (overlay_add_item, "$g_presentation_obj_custom_battle_designer_1", ":var3"),
        (try_end),
        (try_begin),
          (is_between, "$g_quick_battle_map", "scn_quick_battle_scene_1", "scn_quick_battle_scene_4"),
          (store_sub, ":var4", "$g_quick_battle_map", "scn_quick_battle_scene_1"),
          (overlay_set_val, "$g_presentation_obj_custom_battle_designer_1", ":var4"),
        (else_try),
          (overlay_set_val, "$g_presentation_obj_custom_battle_designer_1", 0),
          (assign, "$g_quick_battle_map", "scn_quick_battle_scene_1"),
        (try_end),
      (else_try),
        (try_for_range, ":var2", "scn_quick_battle_scene_4", "scn_quick_battle_maps_end"),
          (store_sub, ":var3", ":var2", "scn_quick_battle_scene_1"),
          (val_add, ":var3", "str_quick_battle_scene_1"),
          (overlay_add_item, "$g_presentation_obj_custom_battle_designer_1", ":var3"),
        (try_end),
        (try_begin),
          (is_between, "$g_quick_battle_map", "scn_quick_battle_scene_4", "scn_quick_battle_maps_end"),
          (store_sub, ":var4", "$g_quick_battle_map", "scn_quick_battle_scene_4"),
          (overlay_set_val, "$g_presentation_obj_custom_battle_designer_1", ":var4"),
        (else_try),
          (overlay_set_val, "$g_presentation_obj_custom_battle_designer_1", 0),
          (assign, "$g_quick_battle_map", "scn_quick_battle_scene_4"),
        (try_end),
      (try_end),
      (store_sub, ":var5", "$g_quick_battle_map", "scn_quick_battle_scene_1"),
      (val_add, ":var5", "mesh_cb_ui_maps_scene_01"),
      (create_mesh_overlay, reg0, ":var5"),
      (position_set_x, pos1, 700),
      (position_set_y, pos1, 700),
      (overlay_set_size, reg0, pos1),
      (position_set_x, pos1, 380),
      (position_set_y, pos1, 220),
      (overlay_set_position, reg0, pos1),
      (create_text_overlay, reg0, "str_game_type_basic", tf_center_justify),
      (overlay_set_color, reg0, 0xFFFFFF),
      (position_set_x, pos1, 1500),
      (position_set_y, pos1, 1500),
      (overlay_set_size, reg0, pos1),
      (position_set_x, pos1, 500),
      (position_set_y, pos1, 180),
      (overlay_set_position, reg0, pos1),
      (create_combo_label_overlay, "$g_presentation_obj_custom_battle_designer_23"),
      (position_set_x, pos1, 700),
      (position_set_y, pos1, 700),
      (overlay_set_size, "$g_presentation_obj_custom_battle_designer_23", pos1),
      (position_set_x, pos1, 500),
      (position_set_y, pos1, 150),
      (overlay_set_position, "$g_presentation_obj_custom_battle_designer_23", pos1),
      (overlay_add_item, "$g_presentation_obj_custom_battle_designer_23", "str_battle"),
      (overlay_add_item, "$g_presentation_obj_custom_battle_designer_23", "str_siege_offense"),
      (overlay_add_item, "$g_presentation_obj_custom_battle_designer_23", "str_siege_defense"),
      (overlay_set_val, "$g_presentation_obj_custom_battle_designer_23", "$g_quick_battle_game_type"),
      (create_game_button_overlay, "$g_presentation_obj_custom_battle_designer_24", "str_randomize"),
      (position_set_x, pos1, 500),
      (position_set_y, pos1, 60),
      (overlay_set_position, "$g_presentation_obj_custom_battle_designer_24", pos1),
      (assign, ":var6", 330),
      (assign, ":var6", 350),
      (assign, ":var7", 40),
      (create_text_overlay, reg0, "str_faction", tf_center_justify),
      (position_set_x, pos1, 175),
      (position_set_y, pos1, ":var6"),
      (overlay_set_position, reg0, pos1),
      (create_text_overlay, reg0, "str_faction", tf_center_justify),
      (position_set_x, pos1, 820),
      (position_set_y, pos1, ":var6"),
      (overlay_set_position, reg0, pos1),
      (val_sub, ":var6", ":var7"),
      (create_combo_label_overlay, "$g_presentation_obj_custom_battle_designer_4"),
      (position_set_x, pos1, 175),
      (position_set_y, pos1, ":var6"),
      (overlay_set_position, "$g_presentation_obj_custom_battle_designer_4", pos1),
      (try_begin),
        (is_trial_version),
        (str_store_faction_name, s0, "fac_kingdom_1"),
        (overlay_add_item, "$g_presentation_obj_custom_battle_designer_4", s0),
        (store_add, ":var8", "fac_kingdom_1", 1),
        (str_store_faction_name, s0, ":var8"),
        (overlay_add_item, "$g_presentation_obj_custom_battle_designer_4", s0),
      (else_try),
        (try_for_range, ":var8", "fac_kingdom_1", "fac_kingdoms_end"),
          (str_store_faction_name, s0, ":var8"),
          (overlay_add_item, "$g_presentation_obj_custom_battle_designer_4", s0),
        (try_end),
        (str_store_faction_name, s0, "fac_outlaws"),
        (overlay_add_item, "$g_presentation_obj_custom_battle_designer_4", s0),
      (try_end),
      (try_begin),
        (eq, "$g_quick_battle_team_1_faction", "fac_outlaws"),
        (store_sub, ":var9", "fac_kingdoms_end", "fac_kingdom_1"),
        (overlay_set_val, "$g_presentation_obj_custom_battle_designer_4", ":var9"),
      (else_try),
        (store_sub, ":var10", "$g_quick_battle_team_1_faction", "fac_kingdom_1"),
        (overlay_set_val, "$g_presentation_obj_custom_battle_designer_4", ":var10"),
      (try_end),
      (create_combo_label_overlay, "$g_presentation_obj_custom_battle_designer_5"),
      (position_set_x, pos1, 820),
      (position_set_y, pos1, ":var6"),
      (overlay_set_position, "$g_presentation_obj_custom_battle_designer_5", pos1),
      (try_begin),
        (is_trial_version),
        (str_store_faction_name, s0, "fac_kingdom_1"),
        (overlay_add_item, "$g_presentation_obj_custom_battle_designer_5", s0),
        (store_add, ":var8", "fac_kingdom_1", 1),
        (str_store_faction_name, s0, ":var8"),
        (overlay_add_item, "$g_presentation_obj_custom_battle_designer_5", s0),
      (else_try),
        (try_for_range, ":var8", "fac_kingdom_1", "fac_kingdoms_end"),
          (str_store_faction_name, s0, ":var8"),
          (overlay_add_item, "$g_presentation_obj_custom_battle_designer_5", s0),
        (try_end),
        (str_store_faction_name, s0, "fac_outlaws"),
        (overlay_add_item, "$g_presentation_obj_custom_battle_designer_5", s0),
      (try_end),
      (try_begin),
        (eq, "$g_quick_battle_team_2_faction", "fac_outlaws"),
        (store_sub, ":var9", "fac_kingdoms_end", "fac_kingdom_1"),
        (overlay_set_val, "$g_presentation_obj_custom_battle_designer_5", ":var9"),
      (else_try),
        (store_sub, ":var11", "$g_quick_battle_team_2_faction", "fac_kingdom_1"),
        (overlay_set_val, "$g_presentation_obj_custom_battle_designer_5", ":var11"),
      (try_end),
      (val_sub, ":var6", ":var7"),
      (create_text_overlay, reg0, "str_army_composition", tf_center_justify),
      (position_set_x, pos1, 175),
      (position_set_y, pos1, ":var6"),
      (overlay_set_position, reg0, pos1),
      (create_text_overlay, reg0, "str_army_composition", tf_center_justify),
      (position_set_x, pos1, 820),
      (position_set_y, pos1, ":var6"),
      (overlay_set_position, reg0, pos1),
      (val_sub, ":var6", ":var7"),
      (try_begin),
        (eq, "$g_presentation_obj_custom_battle_designer_6_last_value", 0),
        (eq, "$g_presentation_obj_custom_battle_designer_7_last_value", 0),
        (eq, "$g_presentation_obj_custom_battle_designer_8_last_value", 0),
        (eq, "$g_presentation_obj_custom_battle_designer_9_last_value", 0),
        (eq, "$g_presentation_obj_custom_battle_designer_10_last_value", 0),
        (eq, "$g_presentation_obj_custom_battle_designer_11_last_value", 0),
        (assign, "$g_presentation_obj_custom_battle_designer_6_last_value", 34),
        (assign, "$g_presentation_obj_custom_battle_designer_7_last_value", 33),
        (assign, "$g_presentation_obj_custom_battle_designer_8_last_value", 33),
        (assign, "$g_presentation_obj_custom_battle_designer_9_last_value", 34),
        (assign, "$g_presentation_obj_custom_battle_designer_10_last_value", 33),
        (assign, "$g_presentation_obj_custom_battle_designer_11_last_value", 33),
        (assign, "$g_presentation_obj_custom_battle_designer_6_locked", 0),
        (assign, "$g_presentation_obj_custom_battle_designer_7_locked", 0),
        (assign, "$g_presentation_obj_custom_battle_designer_8_locked", 0),
        (assign, "$g_presentation_obj_custom_battle_designer_9_locked", 0),
        (assign, "$g_presentation_obj_custom_battle_designer_10_locked", 0),
        (assign, "$g_presentation_obj_custom_battle_designer_11_locked", 0),
      (try_end),
      (create_mesh_overlay, reg0, "mesh_cb_ui_icon_infantry"),
      (position_set_x, pos1, 5),
      (position_set_y, pos1, ":var6"),
      (overlay_set_position, reg0, pos1),
      (position_set_x, pos1, 400),
      (position_set_y, pos1, 400),
      (overlay_set_size, reg0, pos1),
      (create_mesh_overlay, reg0, "mesh_cb_ui_icon_infantry"),
      (position_set_x, pos1, 650),
      (position_set_y, pos1, ":var6"),
      (overlay_set_position, reg0, pos1),
      (position_set_x, pos1, 400),
      (position_set_y, pos1, 400),
      (overlay_set_size, reg0, pos1),
      (create_slider_overlay, "$g_presentation_obj_custom_battle_designer_6", 0, 100),
      (overlay_set_val, "$g_presentation_obj_custom_battle_designer_6", "$g_presentation_obj_custom_battle_designer_6_last_value"),
      (position_set_x, pos1, 900),
      (position_set_y, pos1, 1000),
      (overlay_set_size, "$g_presentation_obj_custom_battle_designer_6", pos1),
      (position_set_x, pos1, 175),
      (position_set_y, pos1, ":var6"),
      (overlay_set_position, "$g_presentation_obj_custom_battle_designer_6", pos1),
      (assign, reg0, "$g_presentation_obj_custom_battle_designer_6_last_value"),
      (create_text_overlay, "$g_presentation_obj_custom_battle_designer_12", "str_reg0_percent", 0),
      (position_set_x, pos1, 295),
      (position_set_y, pos1, ":var6"),
      (overlay_set_position, "$g_presentation_obj_custom_battle_designer_12", pos1),
      (create_slider_overlay, "$g_presentation_obj_custom_battle_designer_9", 0, 100),
      (overlay_set_val, "$g_presentation_obj_custom_battle_designer_9", "$g_presentation_obj_custom_battle_designer_9_last_value"),
      (position_set_x, pos1, 900),
      (position_set_y, pos1, 1000),
      (overlay_set_size, "$g_presentation_obj_custom_battle_designer_9", pos1),
      (position_set_x, pos1, 820),
      (position_set_y, pos1, ":var6"),
      (overlay_set_position, "$g_presentation_obj_custom_battle_designer_9", pos1),
      (assign, reg0, "$g_presentation_obj_custom_battle_designer_9_last_value"),
      (create_text_overlay, "$g_presentation_obj_custom_battle_designer_15", "str_reg0_percent", 0),
      (position_set_x, pos1, 940),
      (position_set_y, pos1, ":var6"),
      (overlay_set_position, "$g_presentation_obj_custom_battle_designer_15", pos1),
      (val_sub, ":var6", ":var7"),
      (create_mesh_overlay, reg0, "mesh_cb_ui_icon_archer"),
      (position_set_x, pos1, 15),
      (position_set_y, pos1, ":var6"),
      (overlay_set_position, reg0, pos1),
      (position_set_x, pos1, 400),
      (position_set_y, pos1, 400),
      (overlay_set_size, reg0, pos1),
      (create_mesh_overlay, reg0, "mesh_cb_ui_icon_archer"),
      (position_set_x, pos1, 660),
      (position_set_y, pos1, ":var6"),
      (overlay_set_position, reg0, pos1),
      (position_set_x, pos1, 400),
      (position_set_y, pos1, 400),
      (overlay_set_size, reg0, pos1),
      (create_slider_overlay, "$g_presentation_obj_custom_battle_designer_7", 0, 100),
      (overlay_set_val, "$g_presentation_obj_custom_battle_designer_7", "$g_presentation_obj_custom_battle_designer_7_last_value"),
      (position_set_x, pos1, 900),
      (position_set_y, pos1, 1000),
      (overlay_set_size, "$g_presentation_obj_custom_battle_designer_7", pos1),
      (position_set_x, pos1, 175),
      (position_set_y, pos1, ":var6"),
      (overlay_set_position, "$g_presentation_obj_custom_battle_designer_7", pos1),
      (assign, reg0, "$g_presentation_obj_custom_battle_designer_7_last_value"),
      (create_text_overlay, "$g_presentation_obj_custom_battle_designer_13", "str_reg0_percent", 0),
      (position_set_x, pos1, 295),
      (position_set_y, pos1, ":var6"),
      (overlay_set_position, "$g_presentation_obj_custom_battle_designer_13", pos1),
      (create_slider_overlay, "$g_presentation_obj_custom_battle_designer_10", 0, 100),
      (overlay_set_val, "$g_presentation_obj_custom_battle_designer_10", "$g_presentation_obj_custom_battle_designer_10_last_value"),
      (position_set_x, pos1, 900),
      (position_set_y, pos1, 1000),
      (overlay_set_size, "$g_presentation_obj_custom_battle_designer_10", pos1),
      (position_set_x, pos1, 820),
      (position_set_y, pos1, ":var6"),
      (overlay_set_position, "$g_presentation_obj_custom_battle_designer_10", pos1),
      (assign, reg0, "$g_presentation_obj_custom_battle_designer_10_last_value"),
      (create_text_overlay, "$g_presentation_obj_custom_battle_designer_16", "str_reg0_percent", 0),
      (position_set_x, pos1, 940),
      (position_set_y, pos1, ":var6"),
      (overlay_set_position, "$g_presentation_obj_custom_battle_designer_16", pos1),
      (val_sub, ":var6", ":var7"),
      (create_mesh_overlay, reg0, "mesh_cb_ui_icon_horseman"),
      (position_set_x, pos1, 10),
      (position_set_y, pos1, ":var6"),
      (overlay_set_position, reg0, pos1),
      (position_set_x, pos1, 400),
      (position_set_y, pos1, 400),
      (overlay_set_size, reg0, pos1),
      (create_mesh_overlay, reg0, "mesh_cb_ui_icon_horseman"),
      (position_set_x, pos1, 655),
      (position_set_y, pos1, ":var6"),
      (overlay_set_position, reg0, pos1),
      (position_set_x, pos1, 400),
      (position_set_y, pos1, 400),
      (overlay_set_size, reg0, pos1),
      (create_slider_overlay, "$g_presentation_obj_custom_battle_designer_8", 0, 100),
      (overlay_set_val, "$g_presentation_obj_custom_battle_designer_8", "$g_presentation_obj_custom_battle_designer_8_last_value"),
      (position_set_x, pos1, 900),
      (position_set_y, pos1, 1000),
      (overlay_set_size, "$g_presentation_obj_custom_battle_designer_8", pos1),
      (position_set_x, pos1, 175),
      (position_set_y, pos1, ":var6"),
      (overlay_set_position, "$g_presentation_obj_custom_battle_designer_8", pos1),
      (assign, reg0, "$g_presentation_obj_custom_battle_designer_8_last_value"),
      (create_text_overlay, "$g_presentation_obj_custom_battle_designer_14", "str_reg0_percent", 0),
      (position_set_x, pos1, 295),
      (position_set_y, pos1, ":var6"),
      (overlay_set_position, "$g_presentation_obj_custom_battle_designer_14", pos1),
      (create_slider_overlay, "$g_presentation_obj_custom_battle_designer_11", 0, 100),
      (overlay_set_val, "$g_presentation_obj_custom_battle_designer_11", "$g_presentation_obj_custom_battle_designer_11_last_value"),
      (position_set_x, pos1, 900),
      (position_set_y, pos1, 1000),
      (overlay_set_size, "$g_presentation_obj_custom_battle_designer_11", pos1),
      (position_set_x, pos1, 820),
      (position_set_y, pos1, ":var6"),
      (overlay_set_position, "$g_presentation_obj_custom_battle_designer_11", pos1),
      (assign, reg0, "$g_presentation_obj_custom_battle_designer_11_last_value"),
      (create_text_overlay, "$g_presentation_obj_custom_battle_designer_17", "str_reg0_percent", 0),
      (position_set_x, pos1, 940),
      (position_set_y, pos1, ":var6"),
      (overlay_set_position, "$g_presentation_obj_custom_battle_designer_17", pos1),
      (val_sub, ":var6", ":var7"),
      (create_text_overlay, reg0, "str_army_size", tf_center_justify),
      (position_set_x, pos1, 175),
      (position_set_y, pos1, ":var6"),
      (overlay_set_position, reg0, pos1),
      (create_text_overlay, reg0, "str_army_size", tf_center_justify),
      (position_set_x, pos1, 820),
      (position_set_y, pos1, ":var6"),
      (overlay_set_position, reg0, pos1),
      (val_sub, ":var6", ":var7"),
      (try_begin),
        (is_trial_version),
        (val_min, "$g_quick_battle_army_1_size", 25),
        (val_min, "$g_quick_battle_army_2_size", 25),
      (try_end),
      (create_slider_overlay, "$g_presentation_obj_custom_battle_designer_2", 0, 100),
      (overlay_set_boundaries, "$g_presentation_obj_custom_battle_designer_2", 1000, 75000),
      (overlay_set_val, "$g_presentation_obj_custom_battle_designer_2", "$g_quick_battle_army_1_size"),
      (position_set_x, pos1, 900),
      (position_set_y, pos1, 1000),
      (overlay_set_size, "$g_presentation_obj_custom_battle_designer_2", pos1),
      (position_set_x, pos1, 135),
      (position_set_y, pos1, ":var6"),
      (overlay_set_position, "$g_presentation_obj_custom_battle_designer_2", pos1),
      (call_script, "script_get_army_size_from_slider_value", "$g_quick_battle_army_1_size"),
      (create_text_overlay, "$g_presentation_obj_custom_battle_designer_21", "str_reg0_men", 0),
      (position_set_x, pos1, 255),
      (position_set_y, pos1, ":var6"),
      (overlay_set_position, "$g_presentation_obj_custom_battle_designer_21", pos1),
      (create_slider_overlay, "$g_presentation_obj_custom_battle_designer_3", 200),
      (overlay_set_boundaries, "$g_presentation_obj_custom_battle_designer_3", 1000, 75000),
      (overlay_set_val, "$g_presentation_obj_custom_battle_designer_3", "$g_quick_battle_army_2_size"),
      (position_set_x, pos1, 900),
      (position_set_y, pos1, 1000),
      (overlay_set_size, "$g_presentation_obj_custom_battle_designer_3", pos1),
      (position_set_x, pos1, 780),
      (position_set_y, pos1, ":var6"),
      (overlay_set_position, "$g_presentation_obj_custom_battle_designer_3", pos1),
      (call_script, "script_get_army_size_from_slider_value", "$g_quick_battle_army_2_size"),
      (create_text_overlay, "$g_presentation_obj_custom_battle_designer_22", "str_reg0_men", 0),
      (position_set_x, pos1, 900),
      (position_set_y, pos1, ":var6"),
      (overlay_set_position, "$g_presentation_obj_custom_battle_designer_22", pos1),
      (create_game_button_overlay, "$g_presentation_obj_custom_battle_designer_19", "str_start", 0),
      (position_set_x, pos1, 415),
      (position_set_y, pos1, 10),
      (overlay_set_position, "$g_presentation_obj_custom_battle_designer_19", pos1),
      (create_game_button_overlay, "$g_presentation_obj_custom_battle_designer_20", "str_back", 0),
      (position_set_x, pos1, 585),
      (position_set_y, pos1, 10),
      (overlay_set_position, "$g_presentation_obj_custom_battle_designer_20", pos1),
      (presentation_set_duration, 999999),
    ]),
    (ti_on_presentation_event_state_change,
    [
      (store_trigger_param_1, ":var0"),
      (store_trigger_param_2, ":var1"),
      (try_begin),
        (eq, ":var0", "$g_presentation_obj_custom_battle_designer_1"),
        (try_begin),
          (eq, "$g_quick_battle_game_type", 0),
          (store_add, "$g_quick_battle_map", ":var1", "scn_quick_battle_scene_1"),
        (else_try),
          (store_add, "$g_quick_battle_map", ":var1", "scn_quick_battle_scene_4"),
        (try_end),
        (presentation_set_duration, 0),
        (start_presentation, "prsnt_game_custom_battle_designer"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_custom_battle_designer_23"),
        (assign, "$g_quick_battle_game_type", ":var1"),
        (presentation_set_duration, 0),
        (start_presentation, "prsnt_game_custom_battle_designer"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_custom_battle_designer_24"),
        (store_random_in_range, "$g_quick_battle_game_type", 0, 3),
        (store_random_in_range, "$g_quick_battle_troop", "trp_quick_battle_troop_1", "trp_quick_battle_troops_end"),
        (try_begin),
          (is_trial_version),
          (store_random_in_range, "$g_quick_battle_team_1_faction", 0, 2),
          (try_begin),
            (eq, "$g_quick_battle_team_1_faction", 0),
            (assign, "$g_quick_battle_team_2_faction", 1),
          (else_try),
            (assign, "$g_quick_battle_team_2_faction", 0),
          (try_end),
          (val_add, "$g_quick_battle_team_1_faction", "fac_kingdom_1"),
          (val_add, "$g_quick_battle_team_2_faction", "fac_kingdom_1"),
          (store_random_in_range, "$g_quick_battle_army_1_size", 10, 16),
          (store_random_in_range, ":var2", 0, 6),
          (val_add, "$g_quick_battle_army_1_size", ":var2"),
          (store_random_in_range, ":var2", 0, 6),
          (val_add, "$g_quick_battle_army_1_size", ":var2"),
        (else_try),
          (store_sub, ":var3", "fac_kingdoms_end", "fac_kingdom_1"),
          (val_add, ":var3", 1),
          (store_random_in_range, "$g_quick_battle_team_1_faction", 0, ":var3"),
          (try_begin),
            (eq, "$g_quick_battle_team_1_faction", 0),
            (assign, "$g_quick_battle_team_1_faction", "fac_outlaws"),
          (else_try),
            (val_add, "$g_quick_battle_team_1_faction", "fac_kingdom_1"),
            (val_sub, "$g_quick_battle_team_1_faction", 1),
          (try_end),
          (assign, ":var4", 1000),
          (try_for_range, ":var5", 0, ":var4"),
            (store_random_in_range, "$g_quick_battle_team_2_faction", 0, ":var3"),
            (try_begin),
              (eq, "$g_quick_battle_team_2_faction", 0),
              (assign, "$g_quick_battle_team_2_faction", "fac_outlaws"),
            (else_try),
              (val_add, "$g_quick_battle_team_2_faction", "fac_kingdom_1"),
              (val_sub, "$g_quick_battle_team_2_faction", 1),
            (try_end),
            (neq, "$g_quick_battle_team_1_faction", "$g_quick_battle_team_2_faction"),
            (assign, ":var4", 0),
          (try_end),
          (store_random_in_range, "$g_quick_battle_army_1_size", 10, 21),
          (store_random_in_range, ":var2", 0, 11),
          (val_add, "$g_quick_battle_army_1_size", ":var2"),
          (store_random_in_range, ":var2", 0, 11),
          (val_add, "$g_quick_battle_army_1_size", ":var2"),
        (try_end),
        (assign, "$g_quick_battle_army_2_size", "$g_quick_battle_army_1_size"),
        (try_begin),
          (eq, "$g_quick_battle_game_type", 0),
          (store_random_in_range, "$g_quick_battle_map", "scn_quick_battle_scene_1", "scn_quick_battle_scene_4"),
          (store_random_in_range, ":var6", 0, 3),
          (store_random_in_range, ":var7", 0, 2),
          (store_random_in_range, ":var8", 0, 100),
          (store_sub, ":var9", 100, ":var8"),
          (store_random_in_range, ":var10", 0, ":var9"),
          (store_sub, ":var11", ":var9", ":var10"),
          (try_begin),
            (eq, ":var6", 0),
            (assign, "$g_presentation_obj_custom_battle_designer_6_last_value", ":var8"),
            (try_begin),
              (eq, ":var7", 0),
              (assign, "$g_presentation_obj_custom_battle_designer_7_last_value", ":var10"),
              (assign, "$g_presentation_obj_custom_battle_designer_8_last_value", ":var11"),
            (else_try),
              (assign, "$g_presentation_obj_custom_battle_designer_8_last_value", ":var10"),
              (assign, "$g_presentation_obj_custom_battle_designer_7_last_value", ":var11"),
            (try_end),
          (else_try),
            (eq, ":var6", 1),
            (assign, "$g_presentation_obj_custom_battle_designer_7_last_value", ":var8"),
            (try_begin),
              (eq, ":var7", 0),
              (assign, "$g_presentation_obj_custom_battle_designer_6_last_value", ":var10"),
              (assign, "$g_presentation_obj_custom_battle_designer_8_last_value", ":var11"),
            (else_try),
              (assign, "$g_presentation_obj_custom_battle_designer_8_last_value", ":var10"),
              (assign, "$g_presentation_obj_custom_battle_designer_6_last_value", ":var11"),
            (try_end),
          (else_try),
            (assign, "$g_presentation_obj_custom_battle_designer_8_last_value", ":var8"),
            (try_begin),
              (eq, ":var7", 0),
              (assign, "$g_presentation_obj_custom_battle_designer_6_last_value", ":var10"),
              (assign, "$g_presentation_obj_custom_battle_designer_7_last_value", ":var11"),
            (else_try),
              (assign, "$g_presentation_obj_custom_battle_designer_7_last_value", ":var10"),
              (assign, "$g_presentation_obj_custom_battle_designer_6_last_value", ":var11"),
            (try_end),
          (try_end),
          (store_random_in_range, ":var6", 0, 3),
          (store_random_in_range, ":var7", 0, 2),
          (store_random_in_range, ":var8", 0, 100),
          (store_sub, ":var9", 100, ":var8"),
          (store_random_in_range, ":var10", 0, ":var9"),
          (store_sub, ":var11", ":var9", ":var10"),
          (try_begin),
            (eq, ":var6", 0),
            (assign, "$g_presentation_obj_custom_battle_designer_9_last_value", ":var8"),
            (try_begin),
              (eq, ":var7", 0),
              (assign, "$g_presentation_obj_custom_battle_designer_10_last_value", ":var10"),
              (assign, "$g_presentation_obj_custom_battle_designer_11_last_value", ":var11"),
            (else_try),
              (assign, "$g_presentation_obj_custom_battle_designer_11_last_value", ":var10"),
              (assign, "$g_presentation_obj_custom_battle_designer_10_last_value", ":var11"),
            (try_end),
          (else_try),
            (eq, ":var6", 1),
            (assign, "$g_presentation_obj_custom_battle_designer_10_last_value", ":var8"),
            (try_begin),
              (eq, ":var7", 0),
              (assign, "$g_presentation_obj_custom_battle_designer_9_last_value", ":var10"),
              (assign, "$g_presentation_obj_custom_battle_designer_11_last_value", ":var11"),
            (else_try),
              (assign, "$g_presentation_obj_custom_battle_designer_11_last_value", ":var10"),
              (assign, "$g_presentation_obj_custom_battle_designer_9_last_value", ":var11"),
            (try_end),
          (else_try),
            (assign, "$g_presentation_obj_custom_battle_designer_11_last_value", ":var8"),
            (try_begin),
              (eq, ":var7", 0),
              (assign, "$g_presentation_obj_custom_battle_designer_9_last_value", ":var10"),
              (assign, "$g_presentation_obj_custom_battle_designer_10_last_value", ":var11"),
            (else_try),
              (assign, "$g_presentation_obj_custom_battle_designer_10_last_value", ":var10"),
              (assign, "$g_presentation_obj_custom_battle_designer_9_last_value", ":var11"),
            (try_end),
          (try_end),
        (else_try),
          (eq, "$g_quick_battle_game_type", 1),
          (store_random_in_range, "$g_quick_battle_map", "scn_quick_battle_scene_4", "scn_quick_battle_maps_end"),
          (store_random_in_range, "$g_presentation_obj_custom_battle_designer_10_last_value", 30, 100),
          (store_sub, "$g_presentation_obj_custom_battle_designer_9_last_value", 100, "$g_presentation_obj_custom_battle_designer_10_last_value"),
          (assign, "$g_presentation_obj_custom_battle_designer_11_last_value", 0),
          (store_random_in_range, "$g_presentation_obj_custom_battle_designer_6_last_value", 20, 100),
          (store_sub, "$g_presentation_obj_custom_battle_designer_7_last_value", 100, "$g_presentation_obj_custom_battle_designer_6_last_value"),
          (assign, "$g_presentation_obj_custom_battle_designer_8_last_value", 0),
        (else_try),
          (store_random_in_range, "$g_quick_battle_map", "scn_quick_battle_scene_4", "scn_quick_battle_maps_end"),
          (store_random_in_range, "$g_presentation_obj_custom_battle_designer_7_last_value", 30, 100),
          (store_sub, "$g_presentation_obj_custom_battle_designer_6_last_value", 100, "$g_presentation_obj_custom_battle_designer_7_last_value"),
          (assign, "$g_presentation_obj_custom_battle_designer_8_last_value", 0),
          (store_random_in_range, "$g_presentation_obj_custom_battle_designer_9_last_value", 20, 100),
          (store_sub, "$g_presentation_obj_custom_battle_designer_10_last_value", 100, "$g_presentation_obj_custom_battle_designer_9_last_value"),
          (assign, "$g_presentation_obj_custom_battle_designer_11_last_value", 0),
        (try_end),
        (presentation_set_duration, 0),
        (start_presentation, "prsnt_game_custom_battle_designer"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_custom_battle_designer_2"),
        (assign, "$g_quick_battle_army_1_size", ":var1"),
        (try_begin),
          (is_trial_version),
          (gt, "$g_quick_battle_army_1_size", 25),
          (assign, "$g_quick_battle_army_1_size", 25),
          (overlay_set_val, "$g_presentation_obj_custom_battle_designer_2", 25),
        (try_end),
        (call_script, "script_get_army_size_from_slider_value", "$g_quick_battle_army_1_size"),
        (overlay_set_text, "$g_presentation_obj_custom_battle_designer_21", "str_reg0_men"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_custom_battle_designer_3"),
        (assign, "$g_quick_battle_army_2_size", ":var1"),
        (try_begin),
          (is_trial_version),
          (gt, "$g_quick_battle_army_2_size", 25),
          (assign, "$g_quick_battle_army_2_size", 25),
          (overlay_set_val, "$g_presentation_obj_custom_battle_designer_3", 25),
        (try_end),
        (call_script, "script_get_army_size_from_slider_value", "$g_quick_battle_army_2_size"),
        (overlay_set_text, "$g_presentation_obj_custom_battle_designer_22", "str_reg0_men"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_custom_battle_designer_4"),
        (try_begin),
          (store_sub, ":var12", "fac_kingdoms_end", "fac_kingdom_1"),
          (eq, ":var1", ":var12"),
          (assign, "$g_quick_battle_team_1_faction", "fac_outlaws"),
        (else_try),
          (store_add, "$g_quick_battle_team_1_faction", ":var1", "fac_kingdom_1"),
        (try_end),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_custom_battle_designer_5"),
        (try_begin),
          (store_sub, ":var12", "fac_kingdoms_end", "fac_kingdom_1"),
          (eq, ":var1", ":var12"),
          (assign, "$g_quick_battle_team_2_faction", "fac_outlaws"),
        (else_try),
          (store_add, "$g_quick_battle_team_2_faction", ":var1", "fac_kingdom_1"),
        (try_end),
        (presentation_set_duration, 0),
        (start_presentation, "prsnt_game_custom_battle_designer"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_custom_battle_designer_18"),
        (store_add, "$g_quick_battle_troop", ":var1", "trp_quick_battle_troop_1"),
        (presentation_set_duration, 0),
        (start_presentation, "prsnt_game_custom_battle_designer"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_custom_battle_designer_6"),
        (try_begin),
          (eq, "$g_presentation_obj_custom_battle_designer_6_locked", 1),
          (neq, ":var1", "$g_presentation_obj_custom_battle_designer_6_last_value"),
          (overlay_set_val, "$g_presentation_obj_custom_battle_designer_6", "$g_presentation_obj_custom_battle_designer_6_last_value"),
        (else_try),
          (try_begin),
            (lt, ":var1", "$g_presentation_obj_custom_battle_designer_6_last_value"),
            (store_sub, ":var13", "$g_presentation_obj_custom_battle_designer_6_last_value", ":var1"),
            (try_begin),
              (eq, "$g_presentation_obj_custom_battle_designer_7_locked", 1),
              (assign, ":var14", 0),
              (assign, ":var15", ":var13"),
            (else_try),
              (eq, "$g_presentation_obj_custom_battle_designer_8_locked", 1),
              (assign, ":var14", ":var13"),
              (assign, ":var15", 0),
            (else_try),
              (store_div, ":var14", ":var13", 2),
              (store_sub, ":var15", ":var13", ":var14"),
              (try_begin),
                (neq, ":var14", ":var15"),
                (store_random_in_range, ":var16", 0, 2),
                (eq, ":var16", 0),
                (val_sub, ":var15", 1),
                (val_add, ":var14", 1),
              (try_end),
            (try_end),
            (assign, "$g_presentation_obj_custom_battle_designer_6_last_value", ":var1"),
            (val_add, "$g_presentation_obj_custom_battle_designer_7_last_value", ":var14"),
            (val_add, "$g_presentation_obj_custom_battle_designer_8_last_value", ":var15"),
            (try_begin),
              (gt, "$g_presentation_obj_custom_battle_designer_7_last_value", 100),
              (store_sub, ":var13", "$g_presentation_obj_custom_battle_designer_7_last_value", 100),
              (val_add, "$g_presentation_obj_custom_battle_designer_8_last_value", ":var13"),
              (assign, "$g_presentation_obj_custom_battle_designer_7_last_value", 100),
            (else_try),
              (gt, "$g_presentation_obj_custom_battle_designer_8_last_value", 100),
              (store_sub, ":var13", "$g_presentation_obj_custom_battle_designer_8_last_value", 100),
              (val_add, "$g_presentation_obj_custom_battle_designer_7_last_value", ":var13"),
              (assign, "$g_presentation_obj_custom_battle_designer_8_last_value", 100),
            (try_end),
            (overlay_set_val, "$g_presentation_obj_custom_battle_designer_7", "$g_presentation_obj_custom_battle_designer_7_last_value"),
            (overlay_set_val, "$g_presentation_obj_custom_battle_designer_8", "$g_presentation_obj_custom_battle_designer_8_last_value"),
          (else_try),
            (gt, ":var1", "$g_presentation_obj_custom_battle_designer_6_last_value"),
            (store_sub, ":var13", ":var1", "$g_presentation_obj_custom_battle_designer_6_last_value"),
            (try_begin),
              (eq, "$g_presentation_obj_custom_battle_designer_7_locked", 1),
              (assign, ":var14", 0),
              (assign, ":var15", ":var13"),
            (else_try),
              (eq, "$g_presentation_obj_custom_battle_designer_8_locked", 1),
              (assign, ":var14", ":var13"),
              (assign, ":var15", 0),
            (else_try),
              (store_div, ":var14", ":var13", 2),
              (store_sub, ":var15", ":var13", ":var14"),
              (try_begin),
                (neq, ":var14", ":var15"),
                (store_random_in_range, ":var16", 0, 2),
                (eq, ":var16", 0),
                (val_sub, ":var15", 1),
                (val_add, ":var14", 1),
              (try_end),
            (try_end),
            (assign, "$g_presentation_obj_custom_battle_designer_6_last_value", ":var1"),
            (val_sub, "$g_presentation_obj_custom_battle_designer_7_last_value", ":var14"),
            (val_sub, "$g_presentation_obj_custom_battle_designer_8_last_value", ":var15"),
            (try_begin),
              (lt, "$g_presentation_obj_custom_battle_designer_7_last_value", 0),
              (val_add, "$g_presentation_obj_custom_battle_designer_8_last_value", "$g_presentation_obj_custom_battle_designer_7_last_value"),
              (assign, "$g_presentation_obj_custom_battle_designer_7_last_value", 0),
            (else_try),
              (lt, "$g_presentation_obj_custom_battle_designer_8_last_value", 0),
              (val_add, "$g_presentation_obj_custom_battle_designer_7_last_value", "$g_presentation_obj_custom_battle_designer_8_last_value"),
              (assign, "$g_presentation_obj_custom_battle_designer_8_last_value", 0),
            (try_end),
            (overlay_set_val, "$g_presentation_obj_custom_battle_designer_7", "$g_presentation_obj_custom_battle_designer_7_last_value"),
            (overlay_set_val, "$g_presentation_obj_custom_battle_designer_8", "$g_presentation_obj_custom_battle_designer_8_last_value"),
          (try_end),
          (assign, reg0, "$g_presentation_obj_custom_battle_designer_6_last_value"),
          (overlay_set_text, "$g_presentation_obj_custom_battle_designer_12", "str_reg0_percent"),
          (assign, reg0, "$g_presentation_obj_custom_battle_designer_7_last_value"),
          (overlay_set_text, "$g_presentation_obj_custom_battle_designer_13", "str_reg0_percent"),
          (assign, reg0, "$g_presentation_obj_custom_battle_designer_8_last_value"),
          (overlay_set_text, "$g_presentation_obj_custom_battle_designer_14", "str_reg0_percent"),
        (try_end),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_custom_battle_designer_7"),
        (try_begin),
          (eq, "$g_presentation_obj_custom_battle_designer_7_locked", 1),
          (neq, ":var1", "$g_presentation_obj_custom_battle_designer_7_last_value"),
          (overlay_set_val, "$g_presentation_obj_custom_battle_designer_7", "$g_presentation_obj_custom_battle_designer_7_last_value"),
        (else_try),
          (try_begin),
            (lt, ":var1", "$g_presentation_obj_custom_battle_designer_7_last_value"),
            (store_sub, ":var13", "$g_presentation_obj_custom_battle_designer_7_last_value", ":var1"),
            (try_begin),
              (eq, "$g_presentation_obj_custom_battle_designer_6_locked", 1),
              (assign, ":var14", 0),
              (assign, ":var15", ":var13"),
            (else_try),
              (eq, "$g_presentation_obj_custom_battle_designer_8_locked", 1),
              (assign, ":var14", ":var13"),
              (assign, ":var15", 0),
            (else_try),
              (store_div, ":var14", ":var13", 2),
              (store_sub, ":var15", ":var13", ":var14"),
              (try_begin),
                (neq, ":var14", ":var15"),
                (store_random_in_range, ":var16", 0, 2),
                (eq, ":var16", 0),
                (val_sub, ":var15", 1),
                (val_add, ":var14", 1),
              (try_end),
            (try_end),
            (assign, "$g_presentation_obj_custom_battle_designer_7_last_value", ":var1"),
            (val_add, "$g_presentation_obj_custom_battle_designer_6_last_value", ":var14"),
            (val_add, "$g_presentation_obj_custom_battle_designer_8_last_value", ":var15"),
            (try_begin),
              (gt, "$g_presentation_obj_custom_battle_designer_6_last_value", 100),
              (store_sub, ":var13", "$g_presentation_obj_custom_battle_designer_6_last_value", 100),
              (val_add, "$g_presentation_obj_custom_battle_designer_8_last_value", ":var13"),
              (assign, "$g_presentation_obj_custom_battle_designer_6_last_value", 100),
            (else_try),
              (gt, "$g_presentation_obj_custom_battle_designer_8_last_value", 100),
              (store_sub, ":var13", "$g_presentation_obj_custom_battle_designer_8_last_value", 100),
              (val_add, "$g_presentation_obj_custom_battle_designer_6_last_value", ":var13"),
              (assign, "$g_presentation_obj_custom_battle_designer_8_last_value", 100),
            (try_end),
            (overlay_set_val, "$g_presentation_obj_custom_battle_designer_6", "$g_presentation_obj_custom_battle_designer_6_last_value"),
            (overlay_set_val, "$g_presentation_obj_custom_battle_designer_8", "$g_presentation_obj_custom_battle_designer_8_last_value"),
          (else_try),
            (gt, ":var1", "$g_presentation_obj_custom_battle_designer_7_last_value"),
            (store_sub, ":var13", ":var1", "$g_presentation_obj_custom_battle_designer_7_last_value"),
            (try_begin),
              (eq, "$g_presentation_obj_custom_battle_designer_6_locked", 1),
              (assign, ":var14", 0),
              (assign, ":var15", ":var13"),
            (else_try),
              (eq, "$g_presentation_obj_custom_battle_designer_8_locked", 1),
              (assign, ":var14", ":var13"),
              (assign, ":var15", 0),
            (else_try),
              (store_div, ":var14", ":var13", 2),
              (store_sub, ":var15", ":var13", ":var14"),
              (try_begin),
                (neq, ":var14", ":var15"),
                (store_random_in_range, ":var16", 0, 2),
                (eq, ":var16", 0),
                (val_sub, ":var15", 1),
                (val_add, ":var14", 1),
              (try_end),
            (try_end),
            (assign, "$g_presentation_obj_custom_battle_designer_7_last_value", ":var1"),
            (val_sub, "$g_presentation_obj_custom_battle_designer_6_last_value", ":var14"),
            (val_sub, "$g_presentation_obj_custom_battle_designer_8_last_value", ":var15"),
            (try_begin),
              (lt, "$g_presentation_obj_custom_battle_designer_6_last_value", 0),
              (val_add, "$g_presentation_obj_custom_battle_designer_8_last_value", "$g_presentation_obj_custom_battle_designer_6_last_value"),
              (assign, "$g_presentation_obj_custom_battle_designer_6_last_value", 0),
            (else_try),
              (lt, "$g_presentation_obj_custom_battle_designer_8_last_value", 0),
              (val_add, "$g_presentation_obj_custom_battle_designer_6_last_value", "$g_presentation_obj_custom_battle_designer_8_last_value"),
              (assign, "$g_presentation_obj_custom_battle_designer_8_last_value", 0),
            (try_end),
            (overlay_set_val, "$g_presentation_obj_custom_battle_designer_6", "$g_presentation_obj_custom_battle_designer_6_last_value"),
            (overlay_set_val, "$g_presentation_obj_custom_battle_designer_8", "$g_presentation_obj_custom_battle_designer_8_last_value"),
          (try_end),
          (assign, reg0, "$g_presentation_obj_custom_battle_designer_6_last_value"),
          (overlay_set_text, "$g_presentation_obj_custom_battle_designer_12", "str_reg0_percent"),
          (assign, reg0, "$g_presentation_obj_custom_battle_designer_7_last_value"),
          (overlay_set_text, "$g_presentation_obj_custom_battle_designer_13", "str_reg0_percent"),
          (assign, reg0, "$g_presentation_obj_custom_battle_designer_8_last_value"),
          (overlay_set_text, "$g_presentation_obj_custom_battle_designer_14", "str_reg0_percent"),
        (try_end),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_custom_battle_designer_8"),
        (try_begin),
          (eq, "$g_presentation_obj_custom_battle_designer_8_locked", 1),
          (neq, ":var1", "$g_presentation_obj_custom_battle_designer_8_last_value"),
          (overlay_set_val, "$g_presentation_obj_custom_battle_designer_8", "$g_presentation_obj_custom_battle_designer_8_last_value"),
        (else_try),
          (try_begin),
            (lt, ":var1", "$g_presentation_obj_custom_battle_designer_8_last_value"),
            (store_sub, ":var13", "$g_presentation_obj_custom_battle_designer_8_last_value", ":var1"),
            (try_begin),
              (eq, "$g_presentation_obj_custom_battle_designer_7_locked", 1),
              (assign, ":var14", 0),
              (assign, ":var15", ":var13"),
            (else_try),
              (eq, "$g_presentation_obj_custom_battle_designer_6_locked", 1),
              (assign, ":var14", ":var13"),
              (assign, ":var15", 0),
            (else_try),
              (store_div, ":var14", ":var13", 2),
              (store_sub, ":var15", ":var13", ":var14"),
              (try_begin),
                (neq, ":var14", ":var15"),
                (store_random_in_range, ":var16", 0, 2),
                (eq, ":var16", 0),
                (val_sub, ":var15", 1),
                (val_add, ":var14", 1),
              (try_end),
            (try_end),
            (assign, "$g_presentation_obj_custom_battle_designer_8_last_value", ":var1"),
            (val_add, "$g_presentation_obj_custom_battle_designer_7_last_value", ":var14"),
            (val_add, "$g_presentation_obj_custom_battle_designer_6_last_value", ":var15"),
            (try_begin),
              (gt, "$g_presentation_obj_custom_battle_designer_7_last_value", 100),
              (store_sub, ":var13", "$g_presentation_obj_custom_battle_designer_7_last_value", 100),
              (val_add, "$g_presentation_obj_custom_battle_designer_6_last_value", ":var13"),
              (assign, "$g_presentation_obj_custom_battle_designer_7_last_value", 100),
            (else_try),
              (gt, "$g_presentation_obj_custom_battle_designer_6_last_value", 100),
              (store_sub, ":var13", "$g_presentation_obj_custom_battle_designer_6_last_value", 100),
              (val_add, "$g_presentation_obj_custom_battle_designer_7_last_value", ":var13"),
              (assign, "$g_presentation_obj_custom_battle_designer_6_last_value", 100),
            (try_end),
            (overlay_set_val, "$g_presentation_obj_custom_battle_designer_7", "$g_presentation_obj_custom_battle_designer_7_last_value"),
            (overlay_set_val, "$g_presentation_obj_custom_battle_designer_6", "$g_presentation_obj_custom_battle_designer_6_last_value"),
          (else_try),
            (gt, ":var1", "$g_presentation_obj_custom_battle_designer_8_last_value"),
            (store_sub, ":var13", ":var1", "$g_presentation_obj_custom_battle_designer_8_last_value"),
            (try_begin),
              (eq, "$g_presentation_obj_custom_battle_designer_7_locked", 1),
              (assign, ":var14", 0),
              (assign, ":var15", ":var13"),
            (else_try),
              (eq, "$g_presentation_obj_custom_battle_designer_6_locked", 1),
              (assign, ":var14", ":var13"),
              (assign, ":var15", 0),
            (else_try),
              (store_div, ":var14", ":var13", 2),
              (store_sub, ":var15", ":var13", ":var14"),
              (try_begin),
                (neq, ":var14", ":var15"),
                (store_random_in_range, ":var16", 0, 2),
                (eq, ":var16", 0),
                (val_sub, ":var15", 1),
                (val_add, ":var14", 1),
              (try_end),
            (try_end),
            (assign, "$g_presentation_obj_custom_battle_designer_8_last_value", ":var1"),
            (val_sub, "$g_presentation_obj_custom_battle_designer_7_last_value", ":var14"),
            (val_sub, "$g_presentation_obj_custom_battle_designer_6_last_value", ":var15"),
            (try_begin),
              (lt, "$g_presentation_obj_custom_battle_designer_7_last_value", 0),
              (val_add, "$g_presentation_obj_custom_battle_designer_6_last_value", "$g_presentation_obj_custom_battle_designer_7_last_value"),
              (assign, "$g_presentation_obj_custom_battle_designer_7_last_value", 0),
            (else_try),
              (lt, "$g_presentation_obj_custom_battle_designer_6_last_value", 0),
              (val_add, "$g_presentation_obj_custom_battle_designer_7_last_value", "$g_presentation_obj_custom_battle_designer_6_last_value"),
              (assign, "$g_presentation_obj_custom_battle_designer_6_last_value", 0),
            (try_end),
            (overlay_set_val, "$g_presentation_obj_custom_battle_designer_7", "$g_presentation_obj_custom_battle_designer_7_last_value"),
            (overlay_set_val, "$g_presentation_obj_custom_battle_designer_6", "$g_presentation_obj_custom_battle_designer_6_last_value"),
          (try_end),
          (assign, reg0, "$g_presentation_obj_custom_battle_designer_6_last_value"),
          (overlay_set_text, "$g_presentation_obj_custom_battle_designer_12", "str_reg0_percent"),
          (assign, reg0, "$g_presentation_obj_custom_battle_designer_7_last_value"),
          (overlay_set_text, "$g_presentation_obj_custom_battle_designer_13", "str_reg0_percent"),
          (assign, reg0, "$g_presentation_obj_custom_battle_designer_8_last_value"),
          (overlay_set_text, "$g_presentation_obj_custom_battle_designer_14", "str_reg0_percent"),
        (try_end),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_custom_battle_designer_9"),
        (try_begin),
          (eq, "$g_presentation_obj_custom_battle_designer_9_locked", 1),
          (neq, ":var1", "$g_presentation_obj_custom_battle_designer_9_last_value"),
          (overlay_set_val, "$g_presentation_obj_custom_battle_designer_9", "$g_presentation_obj_custom_battle_designer_9_last_value"),
        (else_try),
          (try_begin),
            (lt, ":var1", "$g_presentation_obj_custom_battle_designer_9_last_value"),
            (store_sub, ":var13", "$g_presentation_obj_custom_battle_designer_9_last_value", ":var1"),
            (try_begin),
              (eq, "$g_presentation_obj_custom_battle_designer_10_locked", 1),
              (assign, ":var14", 0),
              (assign, ":var15", ":var13"),
            (else_try),
              (eq, "$g_presentation_obj_custom_battle_designer_11_locked", 1),
              (assign, ":var14", ":var13"),
              (assign, ":var15", 0),
            (else_try),
              (store_div, ":var14", ":var13", 2),
              (store_sub, ":var15", ":var13", ":var14"),
              (try_begin),
                (neq, ":var14", ":var15"),
                (store_random_in_range, ":var16", 0, 2),
                (eq, ":var16", 0),
                (val_sub, ":var15", 1),
                (val_add, ":var14", 1),
              (try_end),
            (try_end),
            (assign, "$g_presentation_obj_custom_battle_designer_9_last_value", ":var1"),
            (val_add, "$g_presentation_obj_custom_battle_designer_10_last_value", ":var14"),
            (val_add, "$g_presentation_obj_custom_battle_designer_11_last_value", ":var15"),
            (try_begin),
              (gt, "$g_presentation_obj_custom_battle_designer_10_last_value", 100),
              (store_sub, ":var13", "$g_presentation_obj_custom_battle_designer_10_last_value", 100),
              (val_add, "$g_presentation_obj_custom_battle_designer_11_last_value", ":var13"),
              (assign, "$g_presentation_obj_custom_battle_designer_10_last_value", 100),
            (else_try),
              (gt, "$g_presentation_obj_custom_battle_designer_11_last_value", 100),
              (store_sub, ":var13", "$g_presentation_obj_custom_battle_designer_11_last_value", 100),
              (val_add, "$g_presentation_obj_custom_battle_designer_10_last_value", ":var13"),
              (assign, "$g_presentation_obj_custom_battle_designer_11_last_value", 100),
            (try_end),
            (overlay_set_val, "$g_presentation_obj_custom_battle_designer_10", "$g_presentation_obj_custom_battle_designer_10_last_value"),
            (overlay_set_val, "$g_presentation_obj_custom_battle_designer_11", "$g_presentation_obj_custom_battle_designer_11_last_value"),
          (else_try),
            (gt, ":var1", "$g_presentation_obj_custom_battle_designer_9_last_value"),
            (store_sub, ":var13", ":var1", "$g_presentation_obj_custom_battle_designer_9_last_value"),
            (try_begin),
              (eq, "$g_presentation_obj_custom_battle_designer_10_locked", 1),
              (assign, ":var14", 0),
              (assign, ":var15", ":var13"),
            (else_try),
              (eq, "$g_presentation_obj_custom_battle_designer_11_locked", 1),
              (assign, ":var14", ":var13"),
              (assign, ":var15", 0),
            (else_try),
              (store_div, ":var14", ":var13", 2),
              (store_sub, ":var15", ":var13", ":var14"),
              (try_begin),
                (neq, ":var14", ":var15"),
                (store_random_in_range, ":var16", 0, 2),
                (eq, ":var16", 0),
                (val_sub, ":var15", 1),
                (val_add, ":var14", 1),
              (try_end),
            (try_end),
            (assign, "$g_presentation_obj_custom_battle_designer_9_last_value", ":var1"),
            (val_sub, "$g_presentation_obj_custom_battle_designer_10_last_value", ":var14"),
            (val_sub, "$g_presentation_obj_custom_battle_designer_11_last_value", ":var15"),
            (try_begin),
              (lt, "$g_presentation_obj_custom_battle_designer_10_last_value", 0),
              (val_add, "$g_presentation_obj_custom_battle_designer_11_last_value", "$g_presentation_obj_custom_battle_designer_10_last_value"),
              (assign, "$g_presentation_obj_custom_battle_designer_10_last_value", 0),
            (else_try),
              (lt, "$g_presentation_obj_custom_battle_designer_11_last_value", 0),
              (val_add, "$g_presentation_obj_custom_battle_designer_10_last_value", "$g_presentation_obj_custom_battle_designer_11_last_value"),
              (assign, "$g_presentation_obj_custom_battle_designer_11_last_value", 0),
            (try_end),
            (overlay_set_val, "$g_presentation_obj_custom_battle_designer_10", "$g_presentation_obj_custom_battle_designer_10_last_value"),
            (overlay_set_val, "$g_presentation_obj_custom_battle_designer_11", "$g_presentation_obj_custom_battle_designer_11_last_value"),
          (try_end),
          (assign, reg0, "$g_presentation_obj_custom_battle_designer_9_last_value"),
          (overlay_set_text, "$g_presentation_obj_custom_battle_designer_15", "str_reg0_percent"),
          (assign, reg0, "$g_presentation_obj_custom_battle_designer_10_last_value"),
          (overlay_set_text, "$g_presentation_obj_custom_battle_designer_16", "str_reg0_percent"),
          (assign, reg0, "$g_presentation_obj_custom_battle_designer_11_last_value"),
          (overlay_set_text, "$g_presentation_obj_custom_battle_designer_17", "str_reg0_percent"),
        (try_end),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_custom_battle_designer_10"),
        (try_begin),
          (eq, "$g_presentation_obj_custom_battle_designer_10_locked", 1),
          (neq, ":var1", "$g_presentation_obj_custom_battle_designer_10_last_value"),
          (overlay_set_val, "$g_presentation_obj_custom_battle_designer_10", "$g_presentation_obj_custom_battle_designer_10_last_value"),
        (else_try),
          (try_begin),
            (lt, ":var1", "$g_presentation_obj_custom_battle_designer_10_last_value"),
            (store_sub, ":var13", "$g_presentation_obj_custom_battle_designer_10_last_value", ":var1"),
            (try_begin),
              (eq, "$g_presentation_obj_custom_battle_designer_9_locked", 1),
              (assign, ":var14", 0),
              (assign, ":var15", ":var13"),
            (else_try),
              (eq, "$g_presentation_obj_custom_battle_designer_11_locked", 1),
              (assign, ":var14", ":var13"),
              (assign, ":var15", 0),
            (else_try),
              (store_div, ":var14", ":var13", 2),
              (store_sub, ":var15", ":var13", ":var14"),
              (try_begin),
                (neq, ":var14", ":var15"),
                (store_random_in_range, ":var16", 0, 2),
                (eq, ":var16", 0),
                (val_sub, ":var15", 1),
                (val_add, ":var14", 1),
              (try_end),
            (try_end),
            (assign, "$g_presentation_obj_custom_battle_designer_10_last_value", ":var1"),
            (val_add, "$g_presentation_obj_custom_battle_designer_9_last_value", ":var14"),
            (val_add, "$g_presentation_obj_custom_battle_designer_11_last_value", ":var15"),
            (try_begin),
              (gt, "$g_presentation_obj_custom_battle_designer_9_last_value", 100),
              (store_sub, ":var13", "$g_presentation_obj_custom_battle_designer_9_last_value", 100),
              (val_add, "$g_presentation_obj_custom_battle_designer_11_last_value", ":var13"),
              (assign, "$g_presentation_obj_custom_battle_designer_9_last_value", 100),
            (else_try),
              (gt, "$g_presentation_obj_custom_battle_designer_11_last_value", 100),
              (store_sub, ":var13", "$g_presentation_obj_custom_battle_designer_11_last_value", 100),
              (val_add, "$g_presentation_obj_custom_battle_designer_9_last_value", ":var13"),
              (assign, "$g_presentation_obj_custom_battle_designer_11_last_value", 100),
            (try_end),
            (overlay_set_val, "$g_presentation_obj_custom_battle_designer_9", "$g_presentation_obj_custom_battle_designer_9_last_value"),
            (overlay_set_val, "$g_presentation_obj_custom_battle_designer_11", "$g_presentation_obj_custom_battle_designer_11_last_value"),
          (else_try),
            (gt, ":var1", "$g_presentation_obj_custom_battle_designer_10_last_value"),
            (store_sub, ":var13", ":var1", "$g_presentation_obj_custom_battle_designer_10_last_value"),
            (try_begin),
              (eq, "$g_presentation_obj_custom_battle_designer_9_locked", 1),
              (assign, ":var14", 0),
              (assign, ":var15", ":var13"),
            (else_try),
              (eq, "$g_presentation_obj_custom_battle_designer_11_locked", 1),
              (assign, ":var14", ":var13"),
              (assign, ":var15", 0),
            (else_try),
              (store_div, ":var14", ":var13", 2),
              (store_sub, ":var15", ":var13", ":var14"),
              (try_begin),
                (neq, ":var14", ":var15"),
                (store_random_in_range, ":var16", 0, 2),
                (eq, ":var16", 0),
                (val_sub, ":var15", 1),
                (val_add, ":var14", 1),
              (try_end),
            (try_end),
            (assign, "$g_presentation_obj_custom_battle_designer_10_last_value", ":var1"),
            (val_sub, "$g_presentation_obj_custom_battle_designer_9_last_value", ":var14"),
            (val_sub, "$g_presentation_obj_custom_battle_designer_11_last_value", ":var15"),
            (try_begin),
              (lt, "$g_presentation_obj_custom_battle_designer_9_last_value", 0),
              (val_add, "$g_presentation_obj_custom_battle_designer_11_last_value", "$g_presentation_obj_custom_battle_designer_9_last_value"),
              (assign, "$g_presentation_obj_custom_battle_designer_9_last_value", 0),
            (else_try),
              (lt, "$g_presentation_obj_custom_battle_designer_11_last_value", 0),
              (val_add, "$g_presentation_obj_custom_battle_designer_9_last_value", "$g_presentation_obj_custom_battle_designer_11_last_value"),
              (assign, "$g_presentation_obj_custom_battle_designer_11_last_value", 0),
            (try_end),
            (overlay_set_val, "$g_presentation_obj_custom_battle_designer_9", "$g_presentation_obj_custom_battle_designer_9_last_value"),
            (overlay_set_val, "$g_presentation_obj_custom_battle_designer_11", "$g_presentation_obj_custom_battle_designer_11_last_value"),
          (try_end),
          (assign, reg0, "$g_presentation_obj_custom_battle_designer_9_last_value"),
          (overlay_set_text, "$g_presentation_obj_custom_battle_designer_15", "str_reg0_percent"),
          (assign, reg0, "$g_presentation_obj_custom_battle_designer_10_last_value"),
          (overlay_set_text, "$g_presentation_obj_custom_battle_designer_16", "str_reg0_percent"),
          (assign, reg0, "$g_presentation_obj_custom_battle_designer_11_last_value"),
          (overlay_set_text, "$g_presentation_obj_custom_battle_designer_17", "str_reg0_percent"),
        (try_end),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_custom_battle_designer_11"),
        (try_begin),
          (eq, "$g_presentation_obj_custom_battle_designer_11_locked", 1),
          (neq, ":var1", "$g_presentation_obj_custom_battle_designer_11_last_value"),
          (overlay_set_val, "$g_presentation_obj_custom_battle_designer_11", "$g_presentation_obj_custom_battle_designer_11_last_value"),
        (else_try),
          (try_begin),
            (lt, ":var1", "$g_presentation_obj_custom_battle_designer_11_last_value"),
            (store_sub, ":var13", "$g_presentation_obj_custom_battle_designer_11_last_value", ":var1"),
            (try_begin),
              (eq, "$g_presentation_obj_custom_battle_designer_10_locked", 1),
              (assign, ":var14", 0),
              (assign, ":var15", ":var13"),
            (else_try),
              (eq, "$g_presentation_obj_custom_battle_designer_9_locked", 1),
              (assign, ":var14", ":var13"),
              (assign, ":var15", 0),
            (else_try),
              (store_div, ":var14", ":var13", 2),
              (store_sub, ":var15", ":var13", ":var14"),
              (try_begin),
                (neq, ":var14", ":var15"),
                (store_random_in_range, ":var16", 0, 2),
                (eq, ":var16", 0),
                (val_sub, ":var15", 1),
                (val_add, ":var14", 1),
              (try_end),
            (try_end),
            (assign, "$g_presentation_obj_custom_battle_designer_11_last_value", ":var1"),
            (val_add, "$g_presentation_obj_custom_battle_designer_10_last_value", ":var14"),
            (val_add, "$g_presentation_obj_custom_battle_designer_9_last_value", ":var15"),
            (try_begin),
              (gt, "$g_presentation_obj_custom_battle_designer_10_last_value", 100),
              (store_sub, ":var13", "$g_presentation_obj_custom_battle_designer_10_last_value", 100),
              (val_add, "$g_presentation_obj_custom_battle_designer_9_last_value", ":var13"),
              (assign, "$g_presentation_obj_custom_battle_designer_10_last_value", 100),
            (else_try),
              (gt, "$g_presentation_obj_custom_battle_designer_9_last_value", 100),
              (store_sub, ":var13", "$g_presentation_obj_custom_battle_designer_9_last_value", 100),
              (val_add, "$g_presentation_obj_custom_battle_designer_10_last_value", ":var13"),
              (assign, "$g_presentation_obj_custom_battle_designer_9_last_value", 100),
            (try_end),
            (overlay_set_val, "$g_presentation_obj_custom_battle_designer_10", "$g_presentation_obj_custom_battle_designer_10_last_value"),
            (overlay_set_val, "$g_presentation_obj_custom_battle_designer_9", "$g_presentation_obj_custom_battle_designer_9_last_value"),
          (else_try),
            (gt, ":var1", "$g_presentation_obj_custom_battle_designer_11_last_value"),
            (store_sub, ":var13", ":var1", "$g_presentation_obj_custom_battle_designer_11_last_value"),
            (try_begin),
              (eq, "$g_presentation_obj_custom_battle_designer_10_locked", 1),
              (assign, ":var14", 0),
              (assign, ":var15", ":var13"),
            (else_try),
              (eq, "$g_presentation_obj_custom_battle_designer_9_locked", 1),
              (assign, ":var14", ":var13"),
              (assign, ":var15", 0),
            (else_try),
              (store_div, ":var14", ":var13", 2),
              (store_sub, ":var15", ":var13", ":var14"),
              (try_begin),
                (neq, ":var14", ":var15"),
                (store_random_in_range, ":var16", 0, 2),
                (eq, ":var16", 0),
                (val_sub, ":var15", 1),
                (val_add, ":var14", 1),
              (try_end),
            (try_end),
            (assign, "$g_presentation_obj_custom_battle_designer_11_last_value", ":var1"),
            (val_sub, "$g_presentation_obj_custom_battle_designer_10_last_value", ":var14"),
            (val_sub, "$g_presentation_obj_custom_battle_designer_9_last_value", ":var15"),
            (try_begin),
              (lt, "$g_presentation_obj_custom_battle_designer_10_last_value", 0),
              (val_add, "$g_presentation_obj_custom_battle_designer_9_last_value", "$g_presentation_obj_custom_battle_designer_10_last_value"),
              (assign, "$g_presentation_obj_custom_battle_designer_10_last_value", 0),
            (else_try),
              (lt, "$g_presentation_obj_custom_battle_designer_9_last_value", 0),
              (val_add, "$g_presentation_obj_custom_battle_designer_10_last_value", "$g_presentation_obj_custom_battle_designer_9_last_value"),
              (assign, "$g_presentation_obj_custom_battle_designer_9_last_value", 0),
            (try_end),
            (overlay_set_val, "$g_presentation_obj_custom_battle_designer_10", "$g_presentation_obj_custom_battle_designer_10_last_value"),
            (overlay_set_val, "$g_presentation_obj_custom_battle_designer_9", "$g_presentation_obj_custom_battle_designer_9_last_value"),
          (try_end),
          (assign, reg0, "$g_presentation_obj_custom_battle_designer_9_last_value"),
          (overlay_set_text, "$g_presentation_obj_custom_battle_designer_15", "str_reg0_percent"),
          (assign, reg0, "$g_presentation_obj_custom_battle_designer_10_last_value"),
          (overlay_set_text, "$g_presentation_obj_custom_battle_designer_16", "str_reg0_percent"),
          (assign, reg0, "$g_presentation_obj_custom_battle_designer_11_last_value"),
          (overlay_set_text, "$g_presentation_obj_custom_battle_designer_17", "str_reg0_percent"),
        (try_end),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_custom_battle_designer_19"),
        (assign, "$g_is_quick_battle", 1),
        (assign, ":var17", "$g_quick_battle_map"),
        (try_begin),
          (eq, "$g_quick_battle_game_type", 0),
          (assign, ":var18", "mt_quick_battle_battle"),
          (modify_visitors_at_site, ":var17"),
          (call_script, "script_spawn_quick_battle_army", 0, "$g_quick_battle_team_1_faction", "$g_presentation_obj_custom_battle_designer_6_last_value", "$g_presentation_obj_custom_battle_designer_7_last_value", "$g_presentation_obj_custom_battle_designer_8_last_value", 0, 1),
          (call_script, "script_spawn_quick_battle_army", 16, "$g_quick_battle_team_2_faction", "$g_presentation_obj_custom_battle_designer_9_last_value", "$g_presentation_obj_custom_battle_designer_10_last_value", "$g_presentation_obj_custom_battle_designer_11_last_value", 0, 0),
        (else_try),
          (eq, "$g_quick_battle_game_type", 1),
          (assign, ":var18", "mt_quick_battle_siege"),
          (modify_visitors_at_site, ":var17"),
          (call_script, "script_spawn_quick_battle_army", 16, "$g_quick_battle_team_1_faction", "$g_presentation_obj_custom_battle_designer_6_last_value", "$g_presentation_obj_custom_battle_designer_7_last_value", "$g_presentation_obj_custom_battle_designer_8_last_value", 0, 1),
          (call_script, "script_spawn_quick_battle_army", 0, "$g_quick_battle_team_2_faction", "$g_presentation_obj_custom_battle_designer_9_last_value", "$g_presentation_obj_custom_battle_designer_10_last_value", "$g_presentation_obj_custom_battle_designer_11_last_value", 1, 0),
        (else_try),
          (assign, ":var18", "mt_quick_battle_siege"),
          (modify_visitors_at_site, ":var17"),
          (call_script, "script_spawn_quick_battle_army", 0, "$g_quick_battle_team_1_faction", "$g_presentation_obj_custom_battle_designer_6_last_value", "$g_presentation_obj_custom_battle_designer_7_last_value", "$g_presentation_obj_custom_battle_designer_8_last_value", 1, 1),
          (call_script, "script_spawn_quick_battle_army", 16, "$g_quick_battle_team_2_faction", "$g_presentation_obj_custom_battle_designer_9_last_value", "$g_presentation_obj_custom_battle_designer_10_last_value", "$g_presentation_obj_custom_battle_designer_11_last_value", 0, 0),
        (try_end),
        (set_jump_mission, ":var18"),
        (jump_to_menu, "mnu_custom_battle_end"),
        (jump_to_scene, ":var17"),
        (change_screen_mission),
        (presentation_set_duration, 0),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_custom_battle_designer_20"),
        (presentation_set_duration, 0),
      (try_end),
    ]),
    (ti_on_presentation_mouse_enter_leave,
    [
      (store_trigger_param_1, ":var0"),
      (store_trigger_param_2, ":var1"),
      (this_or_next|eq, ":var0", "$g_presentation_obj_custom_battle_designer_6"),
      (this_or_next|eq, ":var0", "$g_presentation_obj_custom_battle_designer_7"),
      (this_or_next|eq, ":var0", "$g_presentation_obj_custom_battle_designer_8"),
      (this_or_next|eq, ":var0", "$g_presentation_obj_custom_battle_designer_9"),
      (this_or_next|eq, ":var0", "$g_presentation_obj_custom_battle_designer_10"),
      (eq, ":var0", "$g_presentation_obj_custom_battle_designer_11"),
      (try_begin),
        (eq, ":var1", 1),
        (try_begin),
          (eq, ":var0", "$g_presentation_obj_custom_battle_last_mouse_over_object"),
          (assign, "$g_presentation_obj_custom_battle_last_mouse_over_object", -1),
        (try_end),
      (else_try),
        (assign, "$g_presentation_obj_custom_battle_last_mouse_over_object", ":var0"),
      (try_end),
    ]),
    (ti_on_presentation_run,
    [
      (try_begin),
        (this_or_next|key_clicked, key_escape),
        (key_clicked, key_xbox_start),
        (presentation_set_duration, 0),
      (else_try),
        (key_clicked, key_right_mouse_button),
        (neq, "$g_presentation_obj_custom_battle_last_mouse_over_object", -1),
        (try_begin),
          (eq, "$g_presentation_obj_custom_battle_last_mouse_over_object", "$g_presentation_obj_custom_battle_designer_6"),
          (try_begin),
            (eq, "$g_presentation_obj_custom_battle_designer_6_locked", 0),
            (assign, "$g_presentation_obj_custom_battle_designer_6_locked", 1),
            (assign, "$g_presentation_obj_custom_battle_designer_7_locked", 0),
            (assign, "$g_presentation_obj_custom_battle_designer_8_locked", 0),
          (else_try),
            (assign, "$g_presentation_obj_custom_battle_designer_6_locked", 0),
          (try_end),
        (else_try),
          (eq, "$g_presentation_obj_custom_battle_last_mouse_over_object", "$g_presentation_obj_custom_battle_designer_7"),
          (try_begin),
            (eq, "$g_presentation_obj_custom_battle_designer_7_locked", 0),
            (assign, "$g_presentation_obj_custom_battle_designer_6_locked", 0),
            (assign, "$g_presentation_obj_custom_battle_designer_7_locked", 1),
            (assign, "$g_presentation_obj_custom_battle_designer_8_locked", 0),
          (else_try),
            (assign, "$g_presentation_obj_custom_battle_designer_7_locked", 0),
          (try_end),
        (else_try),
          (eq, "$g_presentation_obj_custom_battle_last_mouse_over_object", "$g_presentation_obj_custom_battle_designer_8"),
          (try_begin),
            (eq, "$g_presentation_obj_custom_battle_designer_8_locked", 0),
            (assign, "$g_presentation_obj_custom_battle_designer_6_locked", 0),
            (assign, "$g_presentation_obj_custom_battle_designer_7_locked", 0),
            (assign, "$g_presentation_obj_custom_battle_designer_8_locked", 1),
          (else_try),
            (assign, "$g_presentation_obj_custom_battle_designer_8_locked", 0),
          (try_end),
        (else_try),
          (eq, "$g_presentation_obj_custom_battle_last_mouse_over_object", "$g_presentation_obj_custom_battle_designer_9"),
          (try_begin),
            (eq, "$g_presentation_obj_custom_battle_designer_9_locked", 0),
            (assign, "$g_presentation_obj_custom_battle_designer_9_locked", 1),
            (assign, "$g_presentation_obj_custom_battle_designer_10_locked", 0),
            (assign, "$g_presentation_obj_custom_battle_designer_11_locked", 0),
          (else_try),
            (assign, "$g_presentation_obj_custom_battle_designer_9_locked", 0),
          (try_end),
        (else_try),
          (eq, "$g_presentation_obj_custom_battle_last_mouse_over_object", "$g_presentation_obj_custom_battle_designer_10"),
          (try_begin),
            (eq, "$g_presentation_obj_custom_battle_designer_10_locked", 0),
            (assign, "$g_presentation_obj_custom_battle_designer_9_locked", 0),
            (assign, "$g_presentation_obj_custom_battle_designer_10_locked", 1),
            (assign, "$g_presentation_obj_custom_battle_designer_11_locked", 0),
          (else_try),
            (assign, "$g_presentation_obj_custom_battle_designer_10_locked", 0),
          (try_end),
        (else_try),
          (eq, "$g_presentation_obj_custom_battle_last_mouse_over_object", "$g_presentation_obj_custom_battle_designer_11"),
          (try_begin),
            (eq, "$g_presentation_obj_custom_battle_designer_11_locked", 0),
            (assign, "$g_presentation_obj_custom_battle_designer_9_locked", 0),
            (assign, "$g_presentation_obj_custom_battle_designer_10_locked", 0),
            (assign, "$g_presentation_obj_custom_battle_designer_11_locked", 1),
          (else_try),
            (assign, "$g_presentation_obj_custom_battle_designer_11_locked", 0),
          (try_end),
        (try_end),
      (try_end),
    ]),
  ]),

  ("game_multiplayer_admin_panel", prsntf_manual_end_only, mesh_pic_bandits,
  [
    (ti_on_presentation_load,
    [
      (set_fixed_point_multiplier, 1000),
      (try_begin),
        (eq, "$g_multiplayer_selected_map", "scn_multi_scene_1"),
        (assign, ":var0", "mesh_mp_ui_host_maps_1"),
      (else_try),
        (eq, "$g_multiplayer_selected_map", "scn_multi_scene_2"),
        (assign, ":var0", "mesh_mp_ui_host_maps_2"),
      (else_try),
        (eq, "$g_multiplayer_selected_map", "scn_multi_scene_3"),
        (assign, ":var0", "mesh_mp_ui_host_maps_3"),
      (else_try),
        (eq, "$g_multiplayer_selected_map", "scn_multi_scene_4"),
        (assign, ":var0", "mesh_mp_ui_host_maps_4"),
      (else_try),
        (eq, "$g_multiplayer_selected_map", "scn_multi_scene_5"),
        (assign, ":var0", "mesh_mp_ui_host_maps_5"),
      (else_try),
        (eq, "$g_multiplayer_selected_map", "scn_multi_scene_6"),
        (assign, ":var0", "mesh_mp_ui_host_maps_6"),
      (else_try),
        (eq, "$g_multiplayer_selected_map", "scn_multi_scene_7"),
        (assign, ":var0", "mesh_mp_ui_host_maps_7"),
      (else_try),
        (eq, "$g_multiplayer_selected_map", "scn_multi_scene_8"),
        (assign, ":var0", "mesh_mp_ui_host_maps_8"),
      (else_try),
        (eq, "$g_multiplayer_selected_map", "scn_multi_scene_9"),
        (assign, ":var0", "mesh_mp_ui_host_maps_9"),
      (else_try),
        (eq, "$g_multiplayer_selected_map", "scn_multi_scene_10"),
        (assign, ":var0", "mesh_mp_ui_host_maps_10"),
      (else_try),
        (eq, "$g_multiplayer_selected_map", "scn_multi_scene_11"),
        (assign, ":var0", "mesh_mp_ui_host_maps_11"),
      (else_try),
        (eq, "$g_multiplayer_selected_map", "scn_multi_scene_12"),
        (assign, ":var0", "mesh_mp_ui_host_maps_12"),
      (else_try),
        (eq, "$g_multiplayer_selected_map", "scn_multi_scene_13"),
        (assign, ":var0", "mesh_mp_ui_host_maps_13"),
      (else_try),
        (eq, "$g_multiplayer_selected_map", "scn_multi_scene_14"),
        (assign, ":var0", "mesh_mp_ui_host_maps_14"),
      (else_try),
        (eq, "$g_multiplayer_selected_map", "scn_multi_scene_15"),
        (assign, ":var0", "mesh_mp_ui_host_maps_15"),
      (else_try),
        (eq, "$g_multiplayer_selected_map", "scn_multi_scene_16"),
        (assign, ":var0", "mesh_mp_ui_host_maps_16"),
      (else_try),
        (eq, "$g_multiplayer_selected_map", "scn_multi_scene_17"),
        (assign, ":var0", "mesh_mp_ui_host_maps_17"),
      (else_try),
        (eq, "$g_multiplayer_selected_map", "scn_multi_scene_18"),
        (assign, ":var0", "mesh_mp_ui_host_maps_18"),
      (else_try),
        (eq, "$g_multiplayer_selected_map", "scn_multi_scene_19"),
        (assign, ":var0", "mesh_mp_ui_host_maps_19"),
      (else_try),
        (eq, "$g_multiplayer_selected_map", "scn_multi_scene_20"),
        (assign, ":var0", "mesh_mp_ui_host_maps_20"),
      (else_try),
        (this_or_next|eq, "$g_multiplayer_selected_map", "scn_random_multi_plain_medium"),
        (eq, "$g_multiplayer_selected_map", "scn_random_multi_plain_large"),
        (assign, ":var0", "mesh_mp_ui_host_maps_randomp"),
      (else_try),
        (this_or_next|eq, "$g_multiplayer_selected_map", "scn_random_multi_steppe_medium"),
        (eq, "$g_multiplayer_selected_map", "scn_random_multi_steppe_large"),
        (assign, ":var0", "mesh_mp_ui_host_maps_randoms"),
      (else_try),
        (assign, ":var0", "mesh_mp_ui_host_maps_randomp"),
      (try_end),
      (create_mesh_overlay, reg0, ":var0"),
      (position_set_x, pos1, -1),
      (position_set_y, pos1, 550),
      (overlay_set_position, reg0, pos1),
      (position_set_x, pos1, 1002),
      (position_set_y, pos1, 1002),
      (overlay_set_size, reg0, pos1),
      (create_mesh_overlay, reg0, "mesh_mp_ui_host_main"),
      (position_set_x, pos1, -1),
      (position_set_y, pos1, -1),
      (overlay_set_position, reg0, pos1),
      (position_set_x, pos1, 1002),
      (position_set_y, pos1, 1002),
      (overlay_set_size, reg0, pos1),
      (assign, ":var1", 1240),
      (assign, ":var2", 40),
      (try_begin),
        (this_or_next|eq, "$g_multiplayer_game_type", 1),
        (this_or_next|eq, "$g_multiplayer_game_type", 2),
        (this_or_next|eq, "$g_multiplayer_game_type", 3),
        (this_or_next|eq, "$g_multiplayer_game_type", 4),
        (this_or_next|eq, "$g_multiplayer_game_type", 5),
        (eq, "$g_multiplayer_game_type", 6),
        (val_add, ":var1", ":var2"),
        (val_add, ":var1", ":var2"),
        (this_or_next|eq, "$g_multiplayer_game_type", 4),
        (this_or_next|eq, "$g_multiplayer_game_type", 2),
        (this_or_next|eq, "$g_multiplayer_game_type", 3),
        (eq, "$g_multiplayer_game_type", 6),
        (val_add, ":var1", ":var2"),
        (this_or_next|eq, "$g_multiplayer_game_type", 2),
        (this_or_next|eq, "$g_multiplayer_game_type", 3),
        (eq, "$g_multiplayer_game_type", 6),
        (val_add, ":var1", ":var2"),
        (this_or_next|eq, "$g_multiplayer_game_type", 2),
        (this_or_next|eq, "$g_multiplayer_game_type", 3),
        (eq, "$g_multiplayer_game_type", 6),
        (val_add, ":var1", ":var2"),
      (try_end),
      (str_clear, s0),
      (create_text_overlay, "$g_presentation_obj_admin_panel_container", s0, tf_scrollable),
      (position_set_x, pos1, 59),
      (position_set_y, pos1, 50),
      (overlay_set_position, "$g_presentation_obj_admin_panel_container", pos1),
      (position_set_x, pos1, 640),
      (position_set_y, pos1, 520),
      (overlay_set_area_size, "$g_presentation_obj_admin_panel_container", pos1),
      (set_container_overlay, "$g_presentation_obj_admin_panel_container"),
      (create_text_overlay, reg0, "str_add_to_official_game_servers_list", 0),
      (position_set_x, pos1, 30),
      (position_set_y, pos1, ":var1"),
      (overlay_set_position, reg0, pos1),
      (create_check_box_overlay, "$g_presentation_obj_admin_panel_14", "mesh_checkbox_off", "mesh_checkbox_on"),
      (position_set_x, pos1, 7),
      (store_add, ":var3", ":var1", 7),
      (position_set_y, pos1, ":var3"),
      (overlay_set_position, "$g_presentation_obj_admin_panel_14", pos1),
      (server_get_add_to_game_servers_list, ":var4"),
      (overlay_set_val, "$g_presentation_obj_admin_panel_14", ":var4"),
      (val_sub, ":var1", ":var2"),
      (create_text_overlay, reg0, "str_enable_valve_anti_cheat", 0),
      (position_set_x, pos1, 30),
      (position_set_y, pos1, ":var1"),
      (overlay_set_position, reg0, pos1),
      (create_check_box_overlay, "$g_presentation_obj_admin_panel_41", "mesh_checkbox_off", "mesh_checkbox_on"),
      (position_set_x, pos1, 7),
      (store_add, ":var3", ":var1", 7),
      (position_set_y, pos1, ":var3"),
      (overlay_set_position, "$g_presentation_obj_admin_panel_41", pos1),
      (server_get_anti_cheat, ":var5"),
      (overlay_set_val, "$g_presentation_obj_admin_panel_41", ":var5"),
      (val_sub, ":var1", ":var2"),
      (create_text_overlay, reg0, "str_server_name", 0),
      (position_set_x, pos1, 0),
      (position_set_y, pos1, ":var1"),
      (overlay_set_position, reg0, pos1),
      (str_store_server_name, s0),
      (try_begin),
        (eq, "$g_multiplayer_renaming_server_allowed", 1),
        (create_simple_text_box_overlay, "$g_presentation_obj_admin_panel_20"),
        (position_set_x, pos1, 390),
        (position_set_y, pos1, ":var1"),
        (overlay_set_position, "$g_presentation_obj_admin_panel_20", pos1),
        (overlay_set_text, "$g_presentation_obj_admin_panel_20", s0),
      (else_try),
        (assign, "$g_presentation_obj_admin_panel_20", -1),
        (create_text_overlay, reg0, s0, 0),
        (position_set_x, pos1, 385),
        (position_set_y, pos1, ":var1"),
        (overlay_set_position, reg0, pos1),
      (try_end),
      (val_sub, ":var1", ":var2"),
      (create_text_overlay, reg0, "str_game_password", 0),
      (position_set_x, pos1, 0),
      (position_set_y, pos1, ":var1"),
      (overlay_set_position, reg0, pos1),
      (create_simple_text_box_overlay, "$g_presentation_obj_admin_panel_9"),
      (position_set_x, pos1, 390),
      (position_set_y, pos1, ":var1"),
      (overlay_set_position, "$g_presentation_obj_admin_panel_9", pos1),
      (str_store_server_password, s0),
      (overlay_set_text, "$g_presentation_obj_admin_panel_9", s0),
      (val_sub, ":var1", ":var2"),
      (create_text_overlay, reg0, "str_welcome_message", 0),
      (position_set_x, pos1, 0),
      (position_set_y, pos1, ":var1"),
      (overlay_set_position, reg0, pos1),
      (create_simple_text_box_overlay, "$g_presentation_obj_admin_panel_32"),
      (position_set_x, pos1, 390),
      (position_set_y, pos1, ":var1"),
      (overlay_set_position, "$g_presentation_obj_admin_panel_32", pos1),
      (str_store_welcome_message, s0),
      (overlay_set_text, "$g_presentation_obj_admin_panel_32", s0),
      (val_sub, ":var1", ":var2"),
      (create_text_overlay, reg0, "str_map", 0),
      (position_set_x, pos1, 0),
      (position_set_y, pos1, ":var1"),
      (overlay_set_position, reg0, pos1),
      (call_script, "script_multiplayer_fill_map_game_types", "$g_multiplayer_game_type"),
      (assign, ":var6", reg0),
      (assign, ":var7", 0),
      (try_begin),
        (gt, ":var6", 12),
        (create_combo_label_overlay, "$g_presentation_obj_admin_panel_1"),
      (else_try),
        (create_combo_button_overlay, "$g_presentation_obj_admin_panel_1"),
      (try_end),
      (position_set_x, pos1, 800),
      (position_set_y, pos1, 800),
      (overlay_set_size, "$g_presentation_obj_admin_panel_1", pos1),
      (try_begin),
        (gt, ":var6", 14),
        (position_set_x, pos1, 465),
      (else_try),
        (position_set_x, pos1, 490),
      (try_end),
      (position_set_y, pos1, ":var1"),
      (overlay_set_position, "$g_presentation_obj_admin_panel_1", pos1),
      (troop_get_slot, ":var8", "trp_multiplayer_data", 0),
      (assign, ":var9", 0),
      (try_for_range, ":var10", 0, ":var6"),
        (store_add, ":var11", ":var10", 0),
        (troop_get_slot, ":var12", "trp_multiplayer_data", ":var11"),
        (store_sub, ":var13", ":var12", "scn_multi_scene_1"),
        (val_add, ":var13", "str_multi_scene_1"),
        (str_store_string, s0, ":var13"),
        (overlay_add_item, "$g_presentation_obj_admin_panel_1", s0),
        (try_begin),
          (eq, ":var12", "$g_multiplayer_selected_map"),
          (assign, ":var7", ":var10"),
          (assign, ":var9", 1),
        (try_end),
      (try_end),
      (overlay_set_val, "$g_presentation_obj_admin_panel_1", ":var7"),
      (val_sub, ":var1", ":var2"),
      (create_text_overlay, reg0, "str_game_type", 0),
      (position_set_x, pos1, 0),
      (position_set_y, pos1, ":var1"),
      (overlay_set_position, reg0, pos1),
      (try_begin),
        (eq, "$g_multiplayer_changing_game_type_allowed", 1),
        (create_combo_button_overlay, "$g_presentation_obj_admin_panel_10"),
        (position_set_x, pos1, 800),
        (position_set_y, pos1, 800),
        (overlay_set_size, "$g_presentation_obj_admin_panel_10", pos1),
        (position_set_x, pos1, 490),
        (position_set_y, pos1, ":var1"),
        (overlay_set_position, "$g_presentation_obj_admin_panel_10", pos1),
        (try_for_range, ":var14", 0, 9),
          (store_add, ":var13", ":var14", "str_multi_game_type_1"),
          (str_store_string, s0, ":var13"),
          (overlay_add_item, "$g_presentation_obj_admin_panel_10", s0),
        (try_end),
        (overlay_set_val, "$g_presentation_obj_admin_panel_10", "$g_multiplayer_game_type"),
      (else_try),
        (assign, "$g_presentation_obj_admin_panel_10", -1),
        (store_add, ":var13", "$g_multiplayer_game_type", "str_multi_game_type_1"),
        (str_store_string, s0, ":var13"),
        (create_text_overlay, reg0, s0, 0),
        (position_set_x, pos1, 385),
        (position_set_y, pos1, ":var1"),
        (overlay_set_position, reg0, pos1),
      (try_end),
      (val_sub, ":var1", ":var2"),
      (assign, reg1, 1),
      (create_text_overlay, reg0, "str_team_reg1_faction", 0),
      (position_set_x, pos1, 0),
      (position_set_y, pos1, ":var1"),
      (overlay_set_position, reg0, pos1),
      (create_combo_button_overlay, "$g_presentation_obj_admin_panel_11"),
      (position_set_x, pos1, 800),
      (position_set_y, pos1, 800),
      (overlay_set_size, "$g_presentation_obj_admin_panel_11", pos1),
      (position_set_x, pos1, 490),
      (position_set_y, pos1, ":var1"),
      (overlay_set_position, "$g_presentation_obj_admin_panel_11", pos1),
      (call_script, "script_multiplayer_fill_available_factions_combo_button", "$g_presentation_obj_admin_panel_11", "$g_multiplayer_next_team_1_faction", "$g_multiplayer_next_team_2_faction"),
      (val_sub, ":var1", ":var2"),
      (assign, reg1, 2),
      (create_text_overlay, reg0, "str_team_reg1_faction", 0),
      (position_set_x, pos1, 0),
      (position_set_y, pos1, ":var1"),
      (overlay_set_position, reg0, pos1),
      (create_combo_button_overlay, "$g_presentation_obj_admin_panel_12"),
      (position_set_x, pos1, 800),
      (position_set_y, pos1, 800),
      (overlay_set_size, "$g_presentation_obj_admin_panel_12", pos1),
      (position_set_x, pos1, 490),
      (position_set_y, pos1, ":var1"),
      (overlay_set_position, "$g_presentation_obj_admin_panel_12", pos1),
      (call_script, "script_multiplayer_fill_available_factions_combo_button", "$g_presentation_obj_admin_panel_12", "$g_multiplayer_next_team_2_faction", "$g_multiplayer_next_team_1_faction"),
      (val_sub, ":var1", ":var2"),
      (assign, reg1, 1),
      (create_text_overlay, reg0, "str_max_number_of_players", 0),
      (position_set_x, pos1, 0),
      (position_set_y, pos1, ":var1"),
      (overlay_set_position, reg0, pos1),
      (create_number_box_overlay, "$g_presentation_obj_admin_panel_21", 2, 201),
      (position_set_x, pos1, 390),
      (position_set_y, pos1, ":var1"),
      (overlay_set_position, "$g_presentation_obj_admin_panel_21", pos1),
      (server_get_max_num_players, ":var15"),
      (overlay_set_val, "$g_presentation_obj_admin_panel_21", ":var15"),
      (val_sub, ":var1", ":var2"),
      (assign, reg1, 1),
      (create_text_overlay, reg0, "str_number_of_bots_in_team_reg1", 0),
      (position_set_x, pos1, 0),
      (position_set_y, pos1, ":var1"),
      (overlay_set_position, reg0, pos1),
      (create_number_box_overlay, "$g_presentation_obj_admin_panel_3", 0, "$g_multiplayer_max_num_bots"),
      (position_set_x, pos1, 390),
      (position_set_y, pos1, ":var1"),
      (overlay_set_position, "$g_presentation_obj_admin_panel_3", pos1),
      (overlay_set_val, "$g_presentation_obj_admin_panel_3", "$g_multiplayer_num_bots_team_1"),
      (val_sub, ":var1", ":var2"),
      (assign, reg1, 2),
      (create_text_overlay, reg0, "str_number_of_bots_in_team_reg1", 0),
      (position_set_x, pos1, 0),
      (position_set_y, pos1, ":var1"),
      (overlay_set_position, reg0, pos1),
      (create_number_box_overlay, "$g_presentation_obj_admin_panel_4", 0, "$g_multiplayer_max_num_bots"),
      (position_set_x, pos1, 390),
      (position_set_y, pos1, ":var1"),
      (overlay_set_position, "$g_presentation_obj_admin_panel_4", pos1),
      (overlay_set_val, "$g_presentation_obj_admin_panel_4", "$g_multiplayer_num_bots_team_2"),
      (try_begin),
        (neq, "$g_multiplayer_game_type", 0),
        (neq, "$g_multiplayer_game_type", 7),
        (val_sub, ":var1", ":var2"),
        (create_text_overlay, reg0, "str_allow_friendly_fire", 0),
        (position_set_x, pos1, 30),
        (position_set_y, pos1, ":var1"),
        (overlay_set_position, reg0, pos1),
        (create_check_box_overlay, "$g_presentation_obj_admin_panel_5", "mesh_checkbox_off", "mesh_checkbox_on"),
        (position_set_x, pos1, 7),
        (store_add, ":var3", ":var1", 7),
        (position_set_y, pos1, ":var3"),
        (overlay_set_position, "$g_presentation_obj_admin_panel_5", pos1),
        (server_get_friendly_fire, ":var16"),
        (overlay_set_val, "$g_presentation_obj_admin_panel_5", ":var16"),
        (val_sub, ":var1", ":var2"),
        (create_text_overlay, reg0, "str_allow_melee_friendly_fire", 0),
        (position_set_x, pos1, 30),
        (position_set_y, pos1, ":var1"),
        (overlay_set_position, reg0, pos1),
        (create_check_box_overlay, "$g_presentation_obj_admin_panel_36", "mesh_checkbox_off", "mesh_checkbox_on"),
        (position_set_x, pos1, 7),
        (store_add, ":var3", ":var1", 7),
        (position_set_y, pos1, ":var3"),
        (overlay_set_position, "$g_presentation_obj_admin_panel_36", pos1),
        (server_get_melee_friendly_fire, ":var17"),
        (overlay_set_val, "$g_presentation_obj_admin_panel_36", ":var17"),
      (try_end),
      (val_sub, ":var1", ":var2"),
      (create_text_overlay, reg0, "str_friendly_fire_damage_self_ratio", 0),
      (position_set_x, pos1, 0),
      (position_set_y, pos1, ":var1"),
      (overlay_set_position, reg0, pos1),
      (create_number_box_overlay, "$g_presentation_obj_admin_panel_37", 0, 101),
      (position_set_x, pos1, 390),
      (position_set_y, pos1, ":var1"),
      (overlay_set_position, "$g_presentation_obj_admin_panel_37", pos1),
      (server_get_friendly_fire_damage_self_ratio, ":var18"),
      (overlay_set_val, "$g_presentation_obj_admin_panel_37", ":var18"),
      (val_sub, ":var1", ":var2"),
      (create_text_overlay, reg0, "str_friendly_fire_damage_friend_ratio", 0),
      (position_set_x, pos1, 0),
      (position_set_y, pos1, ":var1"),
      (overlay_set_position, reg0, pos1),
      (create_number_box_overlay, "$g_presentation_obj_admin_panel_38", 0, 101),
      (position_set_x, pos1, 390),
      (position_set_y, pos1, ":var1"),
      (overlay_set_position, "$g_presentation_obj_admin_panel_38", pos1),
      (server_get_friendly_fire_damage_friend_ratio, ":var19"),
      (overlay_set_val, "$g_presentation_obj_admin_panel_38", ":var19"),
      (val_sub, ":var1", ":var2"),
      (create_text_overlay, reg0, "str_spectator_camera", 0),
      (position_set_x, pos1, 0),
      (position_set_y, pos1, ":var1"),
      (overlay_set_position, reg0, pos1),
      (create_combo_button_overlay, "$g_presentation_obj_admin_panel_19"),
      (position_set_x, pos1, 800),
      (position_set_y, pos1, 800),
      (overlay_set_size, "$g_presentation_obj_admin_panel_19", pos1),
      (position_set_x, pos1, 490),
      (position_set_y, pos1, ":var1"),
      (overlay_set_position, "$g_presentation_obj_admin_panel_19", pos1),
      (overlay_add_item, "$g_presentation_obj_admin_panel_19", "str_free"),
      (overlay_add_item, "$g_presentation_obj_admin_panel_19", "str_stick_to_any_player"),
      (overlay_add_item, "$g_presentation_obj_admin_panel_19", "str_stick_to_team_members"),
      (overlay_add_item, "$g_presentation_obj_admin_panel_19", "str_stick_to_team_members_view"),
      (server_get_ghost_mode, ":var20"),
      (overlay_set_val, "$g_presentation_obj_admin_panel_19", ":var20"),
      (val_sub, ":var1", ":var2"),
      (create_text_overlay, reg0, "str_control_block_direction", 0),
      (position_set_x, pos1, 0),
      (position_set_y, pos1, ":var1"),
      (overlay_set_position, reg0, pos1),
      (create_combo_button_overlay, "$g_presentation_obj_admin_panel_15"),
      (position_set_x, pos1, 800),
      (position_set_y, pos1, 800),
      (overlay_set_size, "$g_presentation_obj_admin_panel_15", pos1),
      (position_set_x, pos1, 490),
      (position_set_y, pos1, ":var1"),
      (overlay_set_position, "$g_presentation_obj_admin_panel_15", pos1),
      (overlay_add_item, "$g_presentation_obj_admin_panel_15", "str_automatic"),
      (overlay_add_item, "$g_presentation_obj_admin_panel_15", "str_by_mouse_movement"),
      (server_get_control_block_dir, ":var21"),
      (overlay_set_val, "$g_presentation_obj_admin_panel_15", ":var21"),
      (val_sub, ":var1", ":var2"),
      (create_text_overlay, reg0, "str_combat_speed", 0),
      (position_set_x, pos1, 0),
      (position_set_y, pos1, ":var1"),
      (overlay_set_position, reg0, pos1),
      (create_combo_button_overlay, "$g_presentation_obj_admin_panel_26"),
      (position_set_x, pos1, 800),
      (position_set_y, pos1, 800),
      (overlay_set_size, "$g_presentation_obj_admin_panel_26", pos1),
      (position_set_x, pos1, 490),
      (position_set_y, pos1, ":var1"),
      (overlay_set_position, "$g_presentation_obj_admin_panel_26", pos1),
      (overlay_add_item, "$g_presentation_obj_admin_panel_26", "str_combat_speed_0"),
      (overlay_add_item, "$g_presentation_obj_admin_panel_26", "str_combat_speed_1"),
      (overlay_add_item, "$g_presentation_obj_admin_panel_26", "str_combat_speed_2"),
      (overlay_add_item, "$g_presentation_obj_admin_panel_26", "str_combat_speed_3"),
      (overlay_add_item, "$g_presentation_obj_admin_panel_26", "str_combat_speed_4"),
      (server_get_combat_speed, ":var22"),
      (overlay_set_val, "$g_presentation_obj_admin_panel_26", ":var22"),
      (try_begin),
        (neq, "$g_multiplayer_game_type", 5),
        (val_sub, ":var1", ":var2"),
        (create_text_overlay, reg0, "str_map_time_limit", 0),
        (position_set_x, pos1, 0),
        (position_set_y, pos1, ":var1"),
        (overlay_set_position, reg0, pos1),
        (create_number_box_overlay, "$g_presentation_obj_admin_panel_7", 5, 121),
        (position_set_x, pos1, 390),
        (position_set_y, pos1, ":var1"),
        (overlay_set_position, "$g_presentation_obj_admin_panel_7", pos1),
        (overlay_set_val, "$g_presentation_obj_admin_panel_7", "$g_multiplayer_game_max_minutes"),
      (else_try),
        (assign, "$g_presentation_obj_admin_panel_7", -1),
      (try_end),
      (try_begin),
        (this_or_next|eq, "$g_multiplayer_game_type", 2),
        (this_or_next|eq, "$g_multiplayer_game_type", 3),
        (eq, "$g_multiplayer_game_type", 6),
        (val_sub, ":var1", ":var2"),
        (create_text_overlay, reg0, "str_round_time_limit", 0),
        (position_set_x, pos1, 0),
        (position_set_y, pos1, ":var1"),
        (overlay_set_position, reg0, pos1),
        (create_number_box_overlay, "$g_presentation_obj_admin_panel_16", 60, 901),
        (position_set_x, pos1, 390),
        (position_set_y, pos1, ":var1"),
        (overlay_set_position, "$g_presentation_obj_admin_panel_16", pos1),
        (overlay_set_val, "$g_presentation_obj_admin_panel_16", "$g_multiplayer_round_max_seconds"),
      (else_try),
        (assign, "$g_presentation_obj_admin_panel_16", -1),
      (try_end),
      (try_begin),
        (this_or_next|eq, "$g_multiplayer_game_type", 2),
        (eq, "$g_multiplayer_game_type", 3),
        (val_sub, ":var1", ":var2"),
        (create_text_overlay, reg0, "str_players_take_control_of_a_bot_after_death", 0),
        (position_set_x, pos1, 30),
        (position_set_y, pos1, ":var1"),
        (overlay_set_position, reg0, pos1),
        (create_check_box_overlay, "$g_presentation_obj_admin_panel_25", "mesh_checkbox_off", "mesh_checkbox_on"),
        (position_set_x, pos1, 7),
        (store_add, ":var3", ":var1", 7),
        (position_set_y, pos1, ":var3"),
        (overlay_set_position, "$g_presentation_obj_admin_panel_25", pos1),
        (overlay_set_val, "$g_presentation_obj_admin_panel_25", "$g_multiplayer_player_respawn_as_bot"),
      (else_try),
        (assign, "$g_presentation_obj_admin_panel_25", -1),
      (try_end),
      (try_begin),
        (eq, "$g_multiplayer_game_type", 6),
        (val_sub, ":var1", ":var2"),
        (create_text_overlay, reg0, "str_defender_spawn_count_limit", 0),
        (position_set_x, pos1, 0),
        (position_set_y, pos1, ":var1"),
        (overlay_set_position, reg0, pos1),
        (create_combo_button_overlay, "$g_presentation_obj_admin_panel_27"),
        (position_set_x, pos1, 800),
        (position_set_y, pos1, 800),
        (overlay_set_size, "$g_presentation_obj_admin_panel_27", pos1),
        (position_set_x, pos1, 490),
        (position_set_y, pos1, ":var1"),
        (overlay_set_position, "$g_presentation_obj_admin_panel_27", pos1),
        (assign, reg0, 5),
        (overlay_add_item, "$g_presentation_obj_admin_panel_27", "str_reg0"),
        (assign, reg0, 4),
        (overlay_add_item, "$g_presentation_obj_admin_panel_27", "str_reg0"),
        (assign, reg0, 3),
        (overlay_add_item, "$g_presentation_obj_admin_panel_27", "str_reg0"),
        (assign, reg0, 2),
        (overlay_add_item, "$g_presentation_obj_admin_panel_27", "str_reg0"),
        (assign, reg0, 1),
        (overlay_add_item, "$g_presentation_obj_admin_panel_27", "str_reg0"),
        (overlay_add_item, "$g_presentation_obj_admin_panel_27", "str_unlimited"),
        (store_sub, ":var23", 5, "$g_multiplayer_number_of_respawn_count"),
        (overlay_set_val, "$g_presentation_obj_admin_panel_27", ":var23"),
      (else_try),
        (assign, "$g_presentation_obj_admin_panel_27", -1),
      (try_end),
      (val_sub, ":var1", ":var2"),
      (create_text_overlay, reg0, "str_team_points_limit", 0),
      (position_set_x, pos1, 0),
      (position_set_y, pos1, ":var1"),
      (overlay_set_position, reg0, pos1),
      (create_number_box_overlay, "$g_presentation_obj_admin_panel_8", 3, 1001),
      (position_set_x, pos1, 390),
      (position_set_y, pos1, ":var1"),
      (overlay_set_position, "$g_presentation_obj_admin_panel_8", pos1),
      (overlay_set_val, "$g_presentation_obj_admin_panel_8", "$g_multiplayer_game_max_points"),
      (try_begin),
        (eq, "$g_multiplayer_game_type", 5),
        (val_sub, ":var1", ":var2"),
        (create_text_overlay, reg0, "str_point_gained_from_flags", 0),
        (position_set_x, pos1, 0),
        (position_set_y, pos1, ":var1"),
        (overlay_set_position, reg0, pos1),
        (create_number_box_overlay, "$g_presentation_obj_admin_panel_17", 25, 401),
        (position_set_x, pos1, 390),
        (position_set_y, pos1, ":var1"),
        (overlay_set_position, "$g_presentation_obj_admin_panel_17", pos1),
        (overlay_set_val, "$g_presentation_obj_admin_panel_17", "$g_multiplayer_point_gained_from_flags"),
      (else_try),
        (assign, "$g_presentation_obj_admin_panel_17", -1),
      (try_end),
      (try_begin),
        (eq, "$g_multiplayer_game_type", 4),
        (val_sub, ":var1", ":var2"),
        (create_text_overlay, reg0, "str_point_gained_from_capturing_flag", 0),
        (position_set_x, pos1, 0),
        (position_set_y, pos1, ":var1"),
        (overlay_set_position, reg0, pos1),
        (create_number_box_overlay, "$g_presentation_obj_admin_panel_18", 0, 11),
        (position_set_x, pos1, 390),
        (position_set_y, pos1, ":var1"),
        (overlay_set_position, "$g_presentation_obj_admin_panel_18", pos1),
        (overlay_set_val, "$g_presentation_obj_admin_panel_18", "$g_multiplayer_point_gained_from_capturing_flag"),
      (else_try),
        (assign, "$g_presentation_obj_admin_panel_18", -1),
      (try_end),
      (val_sub, ":var1", ":var2"),
      (create_text_overlay, reg0, "str_respawn_period", 0),
      (position_set_x, pos1, 0),
      (position_set_y, pos1, ":var1"),
      (overlay_set_position, reg0, pos1),
      (create_number_box_overlay, "$g_presentation_obj_admin_panel_6", 3, 31),
      (position_set_x, pos1, 390),
      (position_set_y, pos1, ":var1"),
      (overlay_set_position, "$g_presentation_obj_admin_panel_6", pos1),
      (overlay_set_val, "$g_presentation_obj_admin_panel_6", "$g_multiplayer_respawn_period"),
      (val_sub, ":var1", ":var2"),
      (create_text_overlay, reg0, "str_initial_gold_multiplier", 0),
      (position_set_x, pos1, 0),
      (position_set_y, pos1, ":var1"),
      (overlay_set_position, reg0, pos1),
      (create_number_box_overlay, "$g_presentation_obj_admin_panel_33", 0, 1001),
      (position_set_x, pos1, 390),
      (position_set_y, pos1, ":var1"),
      (overlay_set_position, "$g_presentation_obj_admin_panel_33", pos1),
      (overlay_set_val, "$g_presentation_obj_admin_panel_33", "$g_multiplayer_initial_gold_multiplier"),
      (val_sub, ":var1", ":var2"),
      (create_text_overlay, reg0, "str_battle_earnings_multiplier", 0),
      (position_set_x, pos1, 0),
      (position_set_y, pos1, ":var1"),
      (overlay_set_position, reg0, pos1),
      (create_number_box_overlay, "$g_presentation_obj_admin_panel_34", 0, 1001),
      (position_set_x, pos1, 390),
      (position_set_y, pos1, ":var1"),
      (overlay_set_position, "$g_presentation_obj_admin_panel_34", pos1),
      (overlay_set_val, "$g_presentation_obj_admin_panel_34", "$g_multiplayer_battle_earnings_multiplier"),
      (try_begin),
        (this_or_next|eq, "$g_multiplayer_game_type", 2),
        (this_or_next|eq, "$g_multiplayer_game_type", 3),
        (eq, "$g_multiplayer_game_type", 6),
        (val_sub, ":var1", ":var2"),
        (create_text_overlay, reg0, "str_round_earnings_multiplier", 0),
        (position_set_x, pos1, 0),
        (position_set_y, pos1, ":var1"),
        (overlay_set_position, reg0, pos1),
        (create_number_box_overlay, "$g_presentation_obj_admin_panel_35", 0, 1001),
        (position_set_x, pos1, 390),
        (position_set_y, pos1, ":var1"),
        (overlay_set_position, "$g_presentation_obj_admin_panel_35", pos1),
        (overlay_set_val, "$g_presentation_obj_admin_panel_35", "$g_multiplayer_round_earnings_multiplier"),
      (else_try),
        (assign, "$g_presentation_obj_admin_panel_35", -1),
      (try_end),
      (val_sub, ":var1", ":var2"),
      (create_text_overlay, reg0, "str_make_kick_voteable", 0),
      (position_set_x, pos1, 30),
      (position_set_y, pos1, ":var1"),
      (overlay_set_position, reg0, pos1),
      (create_check_box_overlay, "$g_presentation_obj_admin_panel_28", "mesh_checkbox_off", "mesh_checkbox_on"),
      (position_set_x, pos1, 7),
      (store_add, ":var3", ":var1", 7),
      (position_set_y, pos1, ":var3"),
      (overlay_set_position, "$g_presentation_obj_admin_panel_28", pos1),
      (overlay_set_val, "$g_presentation_obj_admin_panel_28", "$g_multiplayer_kick_voteable"),
      (val_sub, ":var1", ":var2"),
      (create_text_overlay, reg0, "str_make_ban_voteable", 0),
      (position_set_x, pos1, 30),
      (position_set_y, pos1, ":var1"),
      (overlay_set_position, reg0, pos1),
      (create_check_box_overlay, "$g_presentation_obj_admin_panel_29", "mesh_checkbox_off", "mesh_checkbox_on"),
      (position_set_x, pos1, 7),
      (store_add, ":var3", ":var1", 7),
      (position_set_y, pos1, ":var3"),
      (overlay_set_position, "$g_presentation_obj_admin_panel_29", pos1),
      (overlay_set_val, "$g_presentation_obj_admin_panel_29", "$g_multiplayer_ban_voteable"),
      (val_sub, ":var1", ":var2"),
      (create_text_overlay, reg0, "str_make_maps_voteable", 0),
      (position_set_x, pos1, 30),
      (position_set_y, pos1, ":var1"),
      (overlay_set_position, reg0, pos1),
      (create_check_box_overlay, "$g_presentation_obj_admin_panel_24", "mesh_checkbox_off", "mesh_checkbox_on"),
      (position_set_x, pos1, 7),
      (store_add, ":var3", ":var1", 7),
      (position_set_y, pos1, ":var3"),
      (overlay_set_position, "$g_presentation_obj_admin_panel_24", pos1),
      (overlay_set_val, "$g_presentation_obj_admin_panel_24", "$g_multiplayer_maps_voteable"),
      (val_sub, ":var1", ":var2"),
      (create_text_overlay, reg0, "str_make_factions_voteable", 0),
      (position_set_x, pos1, 30),
      (position_set_y, pos1, ":var1"),
      (overlay_set_position, reg0, pos1),
      (create_check_box_overlay, "$g_presentation_obj_admin_panel_23", "mesh_checkbox_off", "mesh_checkbox_on"),
      (position_set_x, pos1, 7),
      (store_add, ":var3", ":var1", 7),
      (position_set_y, pos1, ":var3"),
      (overlay_set_position, "$g_presentation_obj_admin_panel_23", pos1),
      (overlay_set_val, "$g_presentation_obj_admin_panel_23", "$g_multiplayer_factions_voteable"),
      (val_sub, ":var1", ":var2"),
      (create_text_overlay, reg0, "str_bots_upper_limit_for_votes", 0),
      (position_set_x, pos1, 0),
      (position_set_y, pos1, ":var1"),
      (overlay_set_position, reg0, pos1),
      (assign, ":var24", 51),
      (val_min, ":var24", "$g_multiplayer_max_num_bots"),
      (create_number_box_overlay, "$g_presentation_obj_admin_panel_22", 0, ":var24"),
      (position_set_x, pos1, 390),
      (position_set_y, pos1, ":var1"),
      (overlay_set_position, "$g_presentation_obj_admin_panel_22", pos1),
      (overlay_set_val, "$g_presentation_obj_admin_panel_22", "$g_multiplayer_num_bots_voteable"),
      (val_sub, ":var1", ":var2"),
      (create_text_overlay, reg0, "str_valid_vote_ratio", 0),
      (position_set_x, pos1, 0),
      (position_set_y, pos1, ":var1"),
      (overlay_set_position, reg0, pos1),
      (create_number_box_overlay, "$g_presentation_obj_admin_panel_30", 50, 101),
      (position_set_x, pos1, 390),
      (position_set_y, pos1, ":var1"),
      (overlay_set_position, "$g_presentation_obj_admin_panel_30", pos1),
      (overlay_set_val, "$g_presentation_obj_admin_panel_30", "$g_multiplayer_valid_vote_ratio"),
      (val_sub, ":var1", ":var2"),
      (create_text_overlay, reg0, "str_auto_team_balance_limit", 0),
      (position_set_x, pos1, 0),
      (position_set_y, pos1, ":var1"),
      (overlay_set_position, reg0, pos1),
      (create_combo_button_overlay, "$g_presentation_obj_admin_panel_31"),
      (position_set_x, pos1, 800),
      (position_set_y, pos1, 800),
      (overlay_set_size, "$g_presentation_obj_admin_panel_31", pos1),
      (position_set_x, pos1, 490),
      (position_set_y, pos1, ":var1"),
      (overlay_set_position, "$g_presentation_obj_admin_panel_31", pos1),
      (overlay_add_item, "$g_presentation_obj_admin_panel_31", "str_unlimited"),
      (assign, reg0, 6),
      (overlay_add_item, "$g_presentation_obj_admin_panel_31", "str_reg0"),
      (assign, reg0, 5),
      (overlay_add_item, "$g_presentation_obj_admin_panel_31", "str_reg0"),
      (assign, reg0, 4),
      (overlay_add_item, "$g_presentation_obj_admin_panel_31", "str_reg0"),
      (assign, reg0, 3),
      (overlay_add_item, "$g_presentation_obj_admin_panel_31", "str_reg0"),
      (assign, reg0, 2),
      (overlay_add_item, "$g_presentation_obj_admin_panel_31", "str_reg0"),
      (try_begin),
        (ge, "$g_multiplayer_auto_team_balance_limit", 1000),
        (overlay_set_val, "$g_presentation_obj_admin_panel_31", 0),
      (else_try),
        (store_sub, ":var25", 7, "$g_multiplayer_auto_team_balance_limit"),
        (overlay_set_val, "$g_presentation_obj_admin_panel_31", ":var25"),
      (try_end),
      (val_sub, ":var1", ":var2"),
      (create_text_overlay, reg0, "str_allow_player_banners", 0),
      (position_set_x, pos1, 30),
      (position_set_y, pos1, ":var1"),
      (overlay_set_position, reg0, pos1),
      (create_check_box_overlay, "$g_presentation_obj_admin_panel_39", "mesh_checkbox_off", "mesh_checkbox_on"),
      (position_set_x, pos1, 7),
      (store_add, ":var3", ":var1", 7),
      (position_set_y, pos1, ":var3"),
      (overlay_set_position, "$g_presentation_obj_admin_panel_39", pos1),
      (overlay_set_val, "$g_presentation_obj_admin_panel_39", "$g_multiplayer_allow_player_banners"),
      (val_sub, ":var1", ":var2"),
      (create_text_overlay, reg0, "str_disallow_ranged_weapons", 0),
      (position_set_x, pos1, 30),
      (position_set_y, pos1, ":var1"),
      (overlay_set_position, reg0, pos1),
      (create_check_box_overlay, "$g_presentation_obj_admin_panel_42", "mesh_checkbox_off", "mesh_checkbox_on"),
      (position_set_x, pos1, 7),
      (store_add, ":var3", ":var1", 7),
      (position_set_y, pos1, ":var3"),
      (overlay_set_position, "$g_presentation_obj_admin_panel_42", pos1),
      (overlay_set_val, "$g_presentation_obj_admin_panel_42", "$g_multiplayer_disallow_ranged_weapons"),
      (val_sub, ":var1", ":var2"),
      (create_text_overlay, reg0, "str_force_default_armor", 0),
      (position_set_x, pos1, 30),
      (position_set_y, pos1, ":var1"),
      (overlay_set_position, reg0, pos1),
      (create_check_box_overlay, "$g_presentation_obj_admin_panel_40", "mesh_checkbox_off", "mesh_checkbox_on"),
      (position_set_x, pos1, 7),
      (store_add, ":var3", ":var1", 7),
      (position_set_y, pos1, ":var3"),
      (overlay_set_position, "$g_presentation_obj_admin_panel_40", pos1),
      (overlay_set_val, "$g_presentation_obj_admin_panel_40", "$g_multiplayer_force_default_armor"),
      (set_container_overlay, -1),
      (create_button_overlay, "$g_presentation_obj_admin_panel_13", "str_back", tf_center_justify),
      (position_set_x, pos1, 825),
      (position_set_y, pos1, 50),
      (overlay_set_position, "$g_presentation_obj_admin_panel_13", pos1),
      (position_set_x, pos1, 1500),
      (position_set_y, pos1, 1500),
      (overlay_set_size, "$g_presentation_obj_admin_panel_13", pos1),
      (create_button_overlay, "$g_presentation_obj_admin_panel_2", "str_start_map", tf_center_justify),
      (position_set_x, pos1, 825),
      (position_set_y, pos1, 90),
      (overlay_set_position, "$g_presentation_obj_admin_panel_2", pos1),
      (position_set_x, pos1, 1500),
      (position_set_y, pos1, 1500),
      (overlay_set_size, "$g_presentation_obj_admin_panel_2", pos1),
      (presentation_set_duration, 999999),
      (try_begin),
        (eq, ":var9", 0),
        (assign, "$g_multiplayer_selected_map", ":var8"),
        (presentation_set_duration, 0),
        (start_presentation, "prsnt_game_multiplayer_admin_panel"),
      (try_end),
    ]),
    (ti_on_presentation_event_state_change,
    [
      (store_trigger_param_1, ":var0"),
      (store_trigger_param_2, ":var1"),
      (try_begin),
        (eq, ":var0", "$g_presentation_obj_admin_panel_1"),
        (store_add, ":var2", ":var1", 0),
        (troop_get_slot, "$g_multiplayer_selected_map", "trp_multiplayer_data", ":var2"),
        (presentation_set_duration, 0),
        (start_presentation, "prsnt_game_multiplayer_admin_panel"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_admin_panel_2"),
        (multiplayer_send_2_int_to_server, 2, "$g_multiplayer_selected_map", "$g_multiplayer_game_type"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_admin_panel_3"),
        (multiplayer_send_2_int_to_server, 4, 1, ":var1"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_admin_panel_4"),
        (multiplayer_send_2_int_to_server, 4, 2, ":var1"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_admin_panel_5"),
        (multiplayer_send_int_to_server, 5, ":var1"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_admin_panel_6"),
        (multiplayer_send_int_to_server, 9, ":var1"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_admin_panel_7"),
        (multiplayer_send_int_to_server, 10, ":var1"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_admin_panel_8"),
        (multiplayer_send_int_to_server, 12, ":var1"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_admin_panel_9"),
        (multiplayer_send_string_to_server, 16, s0),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_admin_panel_10"),
        (assign, "$g_multiplayer_game_type", ":var1"),
        (presentation_set_duration, 0),
        (start_presentation, "prsnt_game_multiplayer_admin_panel"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_admin_panel_11"),
        (store_add, "$g_multiplayer_next_team_1_faction", ":var1", "fac_kingdom_1"),
        (multiplayer_send_2_int_to_server, 17, 1, "$g_multiplayer_next_team_1_faction"),
        (presentation_set_duration, 0),
        (start_presentation, "prsnt_game_multiplayer_admin_panel"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_admin_panel_12"),
        (store_add, "$g_multiplayer_next_team_2_faction", ":var1", "fac_kingdom_1"),
        (multiplayer_send_2_int_to_server, 17, 2, "$g_multiplayer_next_team_2_faction"),
        (presentation_set_duration, 0),
        (start_presentation, "prsnt_game_multiplayer_admin_panel"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_admin_panel_13"),
        (presentation_set_duration, 0),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_admin_panel_14"),
        (multiplayer_send_int_to_server, 8, ":var1"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_admin_panel_15"),
        (multiplayer_send_int_to_server, 7, ":var1"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_admin_panel_16"),
        (multiplayer_send_int_to_server, 11, ":var1"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_admin_panel_17"),
        (multiplayer_send_int_to_server, 13, ":var1"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_admin_panel_18"),
        (multiplayer_send_int_to_server, 14, ":var1"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_admin_panel_19"),
        (multiplayer_send_int_to_server, 6, ":var1"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_admin_panel_20"),
        (multiplayer_send_string_to_server, 15, s0),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_admin_panel_21"),
        (multiplayer_send_int_to_server, 3, ":var1"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_admin_panel_22"),
        (multiplayer_send_int_to_server, 25, ":var1"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_admin_panel_23"),
        (multiplayer_send_int_to_server, 26, ":var1"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_admin_panel_24"),
        (multiplayer_send_int_to_server, 27, ":var1"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_admin_panel_25"),
        (multiplayer_send_int_to_server, 28, ":var1"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_admin_panel_26"),
        (multiplayer_send_int_to_server, 29, ":var1"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_admin_panel_27"),
        (store_sub, ":var3", 5, ":var1"),
        (multiplayer_send_int_to_server, 30, ":var3"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_admin_panel_28"),
        (multiplayer_send_int_to_server, 31, ":var1"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_admin_panel_29"),
        (multiplayer_send_int_to_server, 32, ":var1"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_admin_panel_30"),
        (multiplayer_send_int_to_server, 33, ":var1"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_admin_panel_31"),
        (try_begin),
          (eq, ":var1", 0),
          (multiplayer_send_int_to_server, 34, 1000),
        (else_try),
          (store_sub, ":var3", 7, ":var1"),
          (multiplayer_send_int_to_server, 34, ":var3"),
        (try_end),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_admin_panel_32"),
        (server_set_welcome_message, s0),
        (multiplayer_send_string_to_server, 35, s0),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_admin_panel_33"),
        (multiplayer_send_int_to_server, 36, ":var1"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_admin_panel_34"),
        (multiplayer_send_int_to_server, 37, ":var1"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_admin_panel_35"),
        (multiplayer_send_int_to_server, 38, ":var1"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_admin_panel_36"),
        (multiplayer_send_int_to_server, 39, ":var1"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_admin_panel_37"),
        (multiplayer_send_int_to_server, 40, ":var1"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_admin_panel_38"),
        (multiplayer_send_int_to_server, 41, ":var1"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_admin_panel_39"),
        (multiplayer_send_int_to_server, 42, ":var1"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_admin_panel_40"),
        (multiplayer_send_int_to_server, 43, ":var1"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_admin_panel_41"),
        (multiplayer_send_int_to_server, 44, ":var1"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_admin_panel_42"),
        (multiplayer_send_int_to_server, 47, ":var1"),
      (try_end),
    ]),
    (ti_on_presentation_run,
    [
      (try_begin),
        (this_or_next|key_clicked, key_escape),
        (key_clicked, key_xbox_start),
        (presentation_set_duration, 0),
      (try_end),
    ]),
  ]),

  ("multiplayer_welcome_message", prsntf_manual_end_only, mesh_pic_bandits,
  [
    (ti_on_presentation_load,
    [
      (set_fixed_point_multiplier, 1000),
      (str_store_welcome_message, s0),
      (try_begin),
        (neg|str_is_empty, s0),
        (eq, "$g_multiplayer_welcome_message_shown", 0),
        (create_mesh_overlay, reg0, "mesh_mp_ui_welcome_panel"),
        (position_set_x, pos1, 200),
        (position_set_y, pos1, 400),
        (overlay_set_position, reg0, pos1),
        (create_text_overlay, reg0, s0, tf_scrollable),
        (overlay_set_color, reg0, 0xFFFFFF),
        (position_set_x, pos1, 230),
        (position_set_y, pos1, 425),
        (overlay_set_position, reg0, pos1),
        (position_set_x, pos1, 540),
        (position_set_y, pos1, 150),
        (overlay_set_area_size, reg0, pos1),
        (presentation_set_duration, 999999),
      (else_try),
        (eq, "$g_multiplayer_show_server_rules", 1),
        (create_mesh_overlay, reg0, "mesh_mp_ui_welcome_panel"),
        (position_set_x, pos1, 200),
        (position_set_y, pos1, 400),
        (overlay_set_position, reg0, pos1),
        (try_begin),
          (neg|str_is_empty, s0),
          (str_clear, s3),
          (str_store_string, s2, s0),
          (str_store_string, s2, "str_s2_s3"),
          (str_store_string, s2, "str_s2_s3"),
        (else_try),
          (str_clear, s2),
        (try_end),
        (str_store_string, s3, "@Game Rules:^"),
        (str_store_string, s2, "str_s2_s3"),
        (assign, ":var0", 1000),
        (call_script, "script_game_multiplayer_get_game_type_mission_template", "$g_multiplayer_game_type"),
        (assign, ":var1", reg0),
        (str_store_server_name, s0),
        (str_store_string, s3, "str_server_name_s0"),
        (str_store_string, s2, "str_s2_s3"),
        (try_begin),
          (eq, "$g_multiplayer_game_type", 0),
          (str_store_string, s0, "str_multi_game_type_1"),
        (else_try),
          (eq, "$g_multiplayer_game_type", 1),
          (str_store_string, s0, "str_multi_game_type_2"),
        (else_try),
          (eq, "$g_multiplayer_game_type", 2),
          (str_store_string, s0, "str_multi_game_type_3"),
        (else_try),
          (eq, "$g_multiplayer_game_type", 3),
          (str_store_string, s0, "str_multi_game_type_4"),
        (else_try),
          (eq, "$g_multiplayer_game_type", 4),
          (str_store_string, s0, "str_multi_game_type_5"),
        (else_try),
          (eq, "$g_multiplayer_game_type", 5),
          (str_store_string, s0, "str_multi_game_type_6"),
        (else_try),
          (eq, "$g_multiplayer_game_type", 6),
          (str_store_string, s0, "str_multi_game_type_7"),
        (else_try),
          (eq, "$g_multiplayer_game_type", 7),
          (str_store_string, s0, "str_multi_game_type_8"),
        (try_end),
        (str_store_string, s3, "str_game_type_s0"),
        (str_store_string, s2, "str_s2_s3"),
        (store_current_scene, ":var2"),
        (val_sub, ":var2", "scn_multi_scene_1"),
        (val_add, ":var2", "str_multi_scene_1"),
        (str_store_string, s0, ":var2"),
        (str_store_string, s3, "str_map_name_s0"),
        (str_store_string, s2, "str_s2_s3"),
        (store_mission_timer_a, ":var3"),
        (val_add, ":var3", "$server_mission_timer_while_player_joined"),
        (assign, reg0, ":var3"),
        (store_mul, "$g_multiplayer_game_max_seconds", "$g_multiplayer_game_max_minutes", 60),
        (store_sub, ":var4", "$g_multiplayer_game_max_seconds", ":var3"),
        (store_div, reg0, ":var4", 60),
        (store_mod, reg1, ":var4", 60),
        (try_begin),
          (ge, reg0, 10),
          (ge, reg1, 10),
          (str_clear, s0),
          (str_clear, s1),
        (else_try),
          (ge, reg0, 10),
          (str_clear, s0),
          (str_store_string, s1, "@0"),
        (else_try),
          (ge, reg1, 10),
          (str_store_string, s0, "@0"),
          (str_clear, s1),
        (else_try),
          (str_store_string, s0, "@0"),
          (str_store_string, s1, "@0"),
        (try_end),
        (str_store_string, s3, "str_remaining_time_s0reg0_s1reg1"),
        (str_store_string, s2, "str_s2_s3"),
        (try_for_range, ":var5", 0, ":var0"),
          (assign, reg0, -12345),
          (call_script, "script_game_get_multiplayer_server_option_for_mission_template", ":var1", ":var5"),
          (try_begin),
            (eq, reg0, -12345),
            (assign, ":var0", 0),
          (else_try),
            (call_script, "script_game_multiplayer_server_option_for_mission_template_to_string", ":var1", ":var5", reg0),
            (str_store_string, s3, s0),
            (str_store_string, s2, "str_s2_s3"),
          (try_end),
        (try_end),
        (create_text_overlay, reg0, s2, tf_scrollable),
        (overlay_set_color, reg0, 0xFFFFFF),
        (position_set_x, pos1, 230),
        (position_set_y, pos1, 425),
        (overlay_set_position, reg0, pos1),
        (position_set_x, pos1, 540),
        (position_set_y, pos1, 150),
        (overlay_set_area_size, reg0, pos1),
        (presentation_set_duration, 999999),
      (try_end),
    ]),
    (ti_on_presentation_run,
    [
      (str_store_welcome_message, s0),
      (try_begin),
        (neq, "$g_multiplayer_show_server_rules", 1),
        (this_or_next|str_is_empty, s0),
        (eq, "$g_multiplayer_welcome_message_shown", 1),
        (presentation_set_duration, 0),
        (neg|is_presentation_active, "prsnt_multiplayer_escape_menu"),
        (neg|is_presentation_active, "prsnt_multiplayer_team_select"),
        (start_presentation, "prsnt_multiplayer_team_select"),
      (else_try),
        (store_mission_timer_a, ":var0"),
        (gt, ":var0", 1),
        (this_or_next|key_clicked, key_escape),
        (this_or_next|key_clicked, key_space),
        (this_or_next|key_clicked, key_enter),
        (this_or_next|key_clicked, key_left_mouse_button),
        (this_or_next|key_clicked, key_right_mouse_button),
        (this_or_next|key_clicked, key_xbox_ltrigger),
        (key_clicked, key_xbox_rtrigger),
        (assign, "$g_multiplayer_welcome_message_shown", 1),
        (presentation_set_duration, 0),
        (neg|is_presentation_active, "prsnt_multiplayer_escape_menu"),
        (neg|is_presentation_active, "prsnt_multiplayer_team_select"),
        (try_begin),
          (eq, "$g_multiplayer_show_server_rules", 1),
          (assign, "$g_multiplayer_show_server_rules", 0),
          (start_presentation, "prsnt_multiplayer_escape_menu"),
        (else_try),
          (start_presentation, "prsnt_multiplayer_team_select"),
        (try_end),
      (try_end),
    ]),
  ]),

  ("multiplayer_team_select", prsntf_manual_end_only, mesh_pic_bandits,
  [
    (ti_on_presentation_load,
    [
      (set_fixed_point_multiplier, 1000),
      (create_mesh_overlay, reg0, "mesh_mp_ingame_menu"),
      (position_set_x, pos1, 250),
      (position_set_y, pos1, 80),
      (overlay_set_position, reg0, pos1),
      (position_set_x, pos1, 1000),
      (position_set_y, pos1, 1000),
      (overlay_set_size, reg0, pos1),
      (str_clear, s0),
      (create_text_overlay, "$g_presentation_obj_team_select_container", s0, tf_scrollable_style_2),
      (position_set_x, pos1, 285),
      (position_set_y, pos1, 125),
      (overlay_set_position, "$g_presentation_obj_team_select_container", pos1),
      (position_set_x, pos1, 405),
      (position_set_y, pos1, 500),
      (overlay_set_area_size, "$g_presentation_obj_team_select_container", pos1),
      (set_container_overlay, "$g_presentation_obj_team_select_container"),
      (assign, ":var0", 450),
      (create_text_overlay, reg0, "str_choose_a_faction", 0),
      (overlay_set_color, reg0, 0xFFFFFF),
      (position_set_x, pos1, 0),
      (position_set_y, pos1, ":var0"),
      (overlay_set_position, reg0, pos1),
      (val_sub, ":var0", 40),
      (position_set_y, pos1, ":var0"),
      (position_set_x, pos1, 100),
      (multiplayer_get_my_player, ":var1"),
      (team_get_faction, ":var2", 0),
      (str_store_faction_name, s0, ":var2"),
      (create_button_overlay, "$g_presentation_obj_team_select_1", s0, 0),
      (try_begin),
        (call_script, "script_cf_multiplayer_team_is_available", ":var1", 0),
        (overlay_set_color, "$g_presentation_obj_team_select_1", 0xFFFFFF),
        (overlay_set_hilight_color, "$g_presentation_obj_team_select_1", 0x55FF50),
        (assign, "$g_multiplayer_team_select_1_available", 1),
      (else_try),
        (overlay_set_color, "$g_presentation_obj_team_select_1", 0x888888),
        (overlay_set_hilight_color, "$g_presentation_obj_team_select_1", 0x888888),
        (assign, "$g_multiplayer_team_select_1_available", 0),
      (try_end),
      (position_set_y, pos1, ":var0"),
      (overlay_set_position, "$g_presentation_obj_team_select_1", pos1),
      (val_sub, ":var0", 40),
      (position_set_y, pos1, ":var0"),
      (team_get_faction, ":var2", 1),
      (str_store_faction_name, s0, ":var2"),
      (create_button_overlay, "$g_presentation_obj_team_select_2", s0, 0),
      (try_begin),
        (call_script, "script_cf_multiplayer_team_is_available", ":var1", 1),
        (overlay_set_color, "$g_presentation_obj_team_select_2", 0xFFFFFF),
        (overlay_set_hilight_color, "$g_presentation_obj_team_select_2", 0x55FF50),
        (assign, "$g_multiplayer_team_select_2_available", 1),
      (else_try),
        (overlay_set_color, "$g_presentation_obj_team_select_2", 0x888888),
        (overlay_set_hilight_color, "$g_presentation_obj_team_select_2", 0x888888),
        (assign, "$g_multiplayer_team_select_2_available", 0),
      (try_end),
      (overlay_set_position, "$g_presentation_obj_team_select_2", pos1),
      (val_sub, ":var0", 40),
      (position_set_y, pos1, ":var0"),
      (create_button_overlay, "$g_presentation_obj_team_select_3", "str_spectator", 0),
      (overlay_set_color, "$g_presentation_obj_team_select_3", 0xFFFFFF),
      (overlay_set_position, "$g_presentation_obj_team_select_3", pos1),
      (val_sub, ":var0", 40),
      (position_set_y, pos1, ":var0"),
      (presentation_set_duration, 999999),
    ]),
    (ti_on_presentation_event_state_change,
    [
      (store_trigger_param_1, ":var0"),
      (multiplayer_get_my_player, ":var1"),
      (try_begin),
        (eq, "$g_waiting_for_confirmation_to_terminate", 0),
        (try_begin),
          (eq, ":var0", "$g_presentation_obj_team_select_1"),
          (try_begin),
            (call_script, "script_cf_multiplayer_team_is_available", ":var1", 0),
            (try_begin),
              (player_get_team_no, ":var2", ":var1"),
              (neq, ":var2", 0),
              (assign, "$g_confirmation_result", 0),
              (assign, "$g_waiting_for_confirmation_to_terminate", 1),
              (player_get_troop_id, "$g_confirmation_troop_backup", ":var1"),
              (player_get_team_no, "$g_confirmation_team_backup", ":var1"),
              (player_set_troop_id, ":var1", -1),
              (multiplayer_send_int_to_server, 19, 0),
              (player_set_team_no, ":var1", 0),
            (else_try),
              (presentation_set_duration, 0),
              (start_presentation, "prsnt_multiplayer_troop_select"),
            (try_end),
          (try_end),
        (else_try),
          (eq, ":var0", "$g_presentation_obj_team_select_2"),
          (try_begin),
            (call_script, "script_cf_multiplayer_team_is_available", ":var1", 1),
            (try_begin),
              (player_get_team_no, ":var2", ":var1"),
              (neq, ":var2", 1),
              (assign, "$g_confirmation_result", 0),
              (assign, "$g_waiting_for_confirmation_to_terminate", 1),
              (player_get_troop_id, "$g_confirmation_troop_backup", ":var1"),
              (player_get_team_no, "$g_confirmation_team_backup", ":var1"),
              (player_set_troop_id, ":var1", -1),
              (multiplayer_send_int_to_server, 19, 1),
              (player_set_team_no, ":var1", 1),
            (else_try),
              (presentation_set_duration, 0),
              (start_presentation, "prsnt_multiplayer_troop_select"),
            (try_end),
          (try_end),
        (else_try),
          (eq, ":var0", "$g_presentation_obj_team_select_3"),
          (player_set_troop_id, ":var1", -1),
          (multiplayer_send_int_to_server, 19, 2),
          (player_set_team_no, ":var1", 2),
          (presentation_set_duration, 0),
        (try_end),
      (try_end),
    ]),
    (ti_on_presentation_run,
    [
      (multiplayer_get_my_player, ":var0"),
      (try_begin),
        (this_or_next|key_clicked, key_escape),
        (key_clicked, key_xbox_start),
        (eq, "$g_waiting_for_confirmation_to_terminate", 0),
        (multiplayer_get_my_team, ":var1"),
        (try_begin),
          (eq, ":var1", 3),
          (player_set_troop_id, ":var0", -1),
          (multiplayer_send_int_to_server, 19, 2),
          (player_set_team_no, ":var0", 2),
        (try_end),
        (presentation_set_duration, 0),
      (else_try),
        (eq, "$g_waiting_for_confirmation_to_terminate", 1),
        (eq, "$g_confirmation_result", 1),
        (assign, "$g_waiting_for_confirmation_to_terminate", 0),
        (assign, "$g_confirmation_result", 0),
        (presentation_set_duration, 0),
        (start_presentation, "prsnt_multiplayer_troop_select"),
      (else_try),
        (eq, "$g_waiting_for_confirmation_to_terminate", 1),
        (eq, "$g_confirmation_result", -1),
        (player_set_troop_id, ":var0", "$g_confirmation_troop_backup"),
        (player_set_team_no, ":var0", "$g_confirmation_team_backup"),
        (assign, "$g_waiting_for_confirmation_to_terminate", 0),
        (assign, "$g_confirmation_result", 0),
        (presentation_set_duration, 0),
        (start_presentation, "prsnt_multiplayer_team_select"),
      (else_try),
        (assign, ":var2", 0),
        (try_begin),
          (call_script, "script_cf_multiplayer_team_is_available", ":var0", 0),
          (try_begin),
            (eq, "$g_multiplayer_team_select_1_available", 0),
            (assign, ":var2", 1),
          (try_end),
        (else_try),
          (try_begin),
            (eq, "$g_multiplayer_team_select_1_available", 1),
            (assign, ":var2", 1),
          (try_end),
        (try_end),
        (try_begin),
          (call_script, "script_cf_multiplayer_team_is_available", ":var0", 1),
          (try_begin),
            (eq, "$g_multiplayer_team_select_2_available", 0),
            (assign, ":var2", 1),
          (try_end),
        (else_try),
          (try_begin),
            (eq, "$g_multiplayer_team_select_2_available", 1),
            (assign, ":var2", 1),
          (try_end),
        (try_end),
        (eq, ":var2", 1),
        (presentation_set_duration, 0),
        (start_presentation, "prsnt_multiplayer_team_select"),
      (try_end),
    ]),
  ]),

  ("multiplayer_troop_select", prsntf_manual_end_only, mesh_pic_bandits,
  [
    (ti_on_presentation_load,
    [
      (set_fixed_point_multiplier, 1000),
      (create_mesh_overlay, reg0, "mesh_mp_ingame_menu"),
      (position_set_x, pos1, 250),
      (position_set_y, pos1, 80),
      (overlay_set_position, reg0, pos1),
      (position_set_x, pos1, 1000),
      (position_set_y, pos1, 1000),
      (overlay_set_size, reg0, pos1),
      (str_clear, s0),
      (create_text_overlay, "$g_presentation_obj_troop_select_container", s0, tf_scrollable_style_2),
      (position_set_x, pos1, 285),
      (position_set_y, pos1, 125),
      (overlay_set_position, "$g_presentation_obj_troop_select_container", pos1),
      (position_set_x, pos1, 405),
      (position_set_y, pos1, 500),
      (overlay_set_area_size, "$g_presentation_obj_troop_select_container", pos1),
      (set_container_overlay, "$g_presentation_obj_troop_select_container"),
      (assign, ":var0", 450),
      (create_text_overlay, reg0, "str_choose_a_troop", 0),
      (overlay_set_color, reg0, 0xFFFFFF),
      (position_set_x, pos1, 0),
      (position_set_y, pos1, ":var0"),
      (overlay_set_position, reg0, pos1),
      (val_sub, ":var0", 40),
      (position_set_y, pos1, ":var0"),
      (position_set_x, pos1, 100),
      (multiplayer_get_my_player, ":var1"),
      (player_get_team_no, ":var2", ":var1"),
      (team_get_faction, ":var3", ":var2"),
      (try_for_range, ":var4", 30, 46),
        (troop_set_slot, "trp_multiplayer_data", ":var4", -1),
      (try_end),
      (assign, ":var5", 0),
      (try_for_range, ":var6", "trp_swadian_crossbowman_multiplayer", "trp_multiplayer_end"),
        (store_faction_of_troop, ":var7", ":var6"),
        (eq, ":var7", ":var3"),
        (str_store_troop_name, s1, ":var6"),
        (create_button_overlay, reg0, s1, 0),
        (overlay_set_color, reg0, 0xFFFFFF),
        (store_add, ":var8", ":var5", 30),
        (troop_set_slot, "trp_multiplayer_data", ":var8", reg0),
        (position_set_y, pos1, ":var0"),
        (overlay_set_position, reg0, pos1),
        (val_sub, ":var0", 40),
        (position_set_y, pos1, ":var0"),
        (val_add, ":var5", 1),
      (try_end),
      (presentation_set_duration, 999999),
    ]),
    (ti_on_presentation_event_state_change,
    [
      (store_trigger_param_1, ":var0"),
      (multiplayer_get_my_player, ":var1"),
      (player_get_team_no, ":var2", ":var1"),
      (team_get_faction, ":var3", ":var2"),
      (assign, ":var4", -1),
      (assign, ":var5", 46),
      (try_for_range, ":var6", 30, ":var5"),
        (troop_slot_eq, "trp_multiplayer_data", ":var6", ":var0"),
        (store_sub, ":var7", ":var6", 30),
        (assign, ":var8", "trp_multiplayer_end"),
        (try_for_range, ":var9", "trp_swadian_crossbowman_multiplayer", ":var8"),
          (store_faction_of_troop, ":var10", ":var9"),
          (eq, ":var10", ":var3"),
          (val_sub, ":var7", 1),
          (lt, ":var7", 0),
          (assign, ":var4", ":var9"),
          (assign, ":var8", 0),
        (try_end),
        (try_begin),
          (multiplayer_get_my_troop, ":var9"),
          (neq, ":var9", ":var4"),
          (player_set_troop_id, ":var1", ":var4"),
          (multiplayer_send_int_to_server, 20, ":var4"),
          (call_script, "script_multiplayer_set_default_item_selections_for_troop", ":var4"),
          (call_script, "script_multiplayer_send_item_selections"),
        (try_end),
        (presentation_set_duration, 0),
        (assign, "$g_presentation_state", 0),
        (start_presentation, "prsnt_multiplayer_item_select"),
        (assign, ":var5", 0),
      (try_end),
    ]),
    (ti_on_presentation_run,
    [
      (try_begin),
        (this_or_next|key_clicked, key_escape),
        (key_clicked, key_xbox_start),
        (multiplayer_get_my_player, ":var0"),
        (is_between, ":var0", 0, 1000),
        (multiplayer_get_my_troop, ":var1"),
        (try_begin),
          (neg|is_between, ":var1", "trp_swadian_crossbowman_multiplayer", "trp_multiplayer_end"),
          (player_set_troop_id, ":var0", -1),
          (multiplayer_send_int_to_server, 20, -1),
          (multiplayer_send_int_to_server, 19, 2),
          (player_set_team_no, ":var0", 2),
        (try_end),
        (presentation_set_duration, 0),
      (try_end),
    ]),
  ]),

  ("multiplayer_item_select", prsntf_manual_end_only, mesh_pic_bandits,
  [
    (ti_on_presentation_load,
    [
      (set_fixed_point_multiplier, 1000),
      (multiplayer_get_my_player, ":var0"),
      (assign, "$g_presentation_obj_item_select_1", -1),
      (assign, "$g_presentation_obj_item_select_2", -1),
      (assign, "$g_presentation_obj_item_select_3", -1),
      (assign, "$g_presentation_obj_item_select_4", -1),
      (assign, "$g_presentation_obj_item_select_5", -1),
      (assign, "$g_presentation_obj_item_select_6", -1),
      (assign, "$g_presentation_obj_item_select_7", -1),
      (assign, "$g_presentation_obj_item_select_8", -1),
      (assign, "$g_presentation_obj_item_select_9", -1),
      (assign, "$g_presentation_obj_item_select_10", -1),
      (assign, "$g_presentation_obj_item_select_11", -1),
      (assign, "$g_presentation_obj_item_select_12", -1),
      (assign, "$g_presentation_obj_item_select_13", -1),
      (assign, "$g_presentation_obj_item_select_14", -1),
      (assign, "$g_presentation_obj_item_select_15", -1),
      (assign, "$g_presentation_obj_item_select_16", -1),
      (try_begin),
        (neq, "$g_current_opened_item_details", -1),
        (close_item_details),
        (assign, "$g_current_opened_item_details", -1),
      (try_end),
      (store_add, ":var1", 2, 0),
      (player_get_slot, ":var2", ":var0", ":var1"),
      (try_begin),
        (ge, ":var2", 0),
        (create_image_button_overlay, "$g_presentation_obj_item_select_1", "mesh_mp_inventory_slot_empty", "mesh_mp_inventory_slot_empty"),
        (create_mesh_overlay_with_item_id, reg0, ":var2"),
        (position_set_x, pos1, 950),
        (position_set_y, pos1, 526),
        (overlay_set_position, reg0, pos1),
        (assign, "$g_inside_obj_1", reg0),
      (else_try),
        (create_image_button_overlay, "$g_presentation_obj_item_select_1", "mesh_mp_inventory_slot_equip", "mesh_mp_inventory_slot_equip"),
      (try_end),
      (position_set_x, pos1, 800),
      (position_set_y, pos1, 800),
      (overlay_set_size, "$g_presentation_obj_item_select_1", pos1),
      (position_set_x, pos1, 899),
      (position_set_y, pos1, 475),
      (overlay_set_position, "$g_presentation_obj_item_select_1", pos1),
      (store_add, ":var1", 2, 1),
      (player_get_slot, ":var2", ":var0", ":var1"),
      (try_begin),
        (ge, ":var2", 0),
        (create_image_button_overlay, "$g_presentation_obj_item_select_2", "mesh_mp_inventory_slot_empty", "mesh_mp_inventory_slot_empty"),
        (create_mesh_overlay_with_item_id, reg0, ":var2"),
        (position_set_x, pos1, 950),
        (position_set_y, pos1, 426),
        (overlay_set_position, reg0, pos1),
        (assign, "$g_inside_obj_2", reg0),
      (else_try),
        (create_image_button_overlay, "$g_presentation_obj_item_select_2", "mesh_mp_inventory_slot_equip", "mesh_mp_inventory_slot_equip"),
      (try_end),
      (position_set_x, pos1, 800),
      (position_set_y, pos1, 800),
      (overlay_set_size, "$g_presentation_obj_item_select_2", pos1),
      (position_set_x, pos1, 899),
      (position_set_y, pos1, 375),
      (overlay_set_position, "$g_presentation_obj_item_select_2", pos1),
      (store_add, ":var1", 2, 2),
      (player_get_slot, ":var2", ":var0", ":var1"),
      (try_begin),
        (ge, ":var2", 0),
        (create_image_button_overlay, "$g_presentation_obj_item_select_3", "mesh_mp_inventory_slot_empty", "mesh_mp_inventory_slot_empty"),
        (create_mesh_overlay_with_item_id, reg0, ":var2"),
        (position_set_x, pos1, 950),
        (position_set_y, pos1, 326),
        (overlay_set_position, reg0, pos1),
        (assign, "$g_inside_obj_3", reg0),
      (else_try),
        (create_image_button_overlay, "$g_presentation_obj_item_select_3", "mesh_mp_inventory_slot_equip", "mesh_mp_inventory_slot_equip"),
      (try_end),
      (position_set_x, pos1, 800),
      (position_set_y, pos1, 800),
      (overlay_set_size, "$g_presentation_obj_item_select_3", pos1),
      (position_set_x, pos1, 899),
      (position_set_y, pos1, 275),
      (overlay_set_position, "$g_presentation_obj_item_select_3", pos1),
      (store_add, ":var1", 2, 3),
      (player_get_slot, ":var2", ":var0", ":var1"),
      (try_begin),
        (ge, ":var2", 0),
        (create_image_button_overlay, "$g_presentation_obj_item_select_4", "mesh_mp_inventory_slot_empty", "mesh_mp_inventory_slot_empty"),
        (create_mesh_overlay_with_item_id, reg0, ":var2"),
        (position_set_x, pos1, 950),
        (position_set_y, pos1, 226),
        (overlay_set_position, reg0, pos1),
        (assign, "$g_inside_obj_4", reg0),
      (else_try),
        (create_image_button_overlay, "$g_presentation_obj_item_select_4", "mesh_mp_inventory_slot_equip", "mesh_mp_inventory_slot_equip"),
      (try_end),
      (position_set_x, pos1, 800),
      (position_set_y, pos1, 800),
      (overlay_set_size, "$g_presentation_obj_item_select_4", pos1),
      (position_set_x, pos1, 899),
      (position_set_y, pos1, 175),
      (overlay_set_position, "$g_presentation_obj_item_select_4", pos1),
      (store_add, ":var1", 2, 4),
      (player_get_slot, ":var2", ":var0", ":var1"),
      (try_begin),
        (ge, ":var2", 0),
        (create_image_button_overlay, "$g_presentation_obj_item_select_5", "mesh_mp_inventory_slot_empty", "mesh_mp_inventory_slot_empty"),
        (create_mesh_overlay_with_item_id, reg0, ":var2"),
        (position_set_x, pos1, 53),
        (position_set_y, pos1, 576),
        (overlay_set_position, reg0, pos1),
        (assign, "$g_inside_obj_5", reg0),
      (else_try),
        (create_image_button_overlay, "$g_presentation_obj_item_select_5", "mesh_mp_inventory_slot_helmet", "mesh_mp_inventory_slot_helmet"),
      (try_end),
      (position_set_x, pos1, 800),
      (position_set_y, pos1, 800),
      (overlay_set_size, "$g_presentation_obj_item_select_5", pos1),
      (position_set_x, pos1, 2),
      (position_set_y, pos1, 525),
      (overlay_set_position, "$g_presentation_obj_item_select_5", pos1),
      (store_add, ":var1", 2, 5),
      (player_get_slot, ":var2", ":var0", ":var1"),
      (try_begin),
        (ge, ":var2", 0),
        (create_image_button_overlay, "$g_presentation_obj_item_select_6", "mesh_mp_inventory_slot_empty", "mesh_mp_inventory_slot_empty"),
        (create_mesh_overlay_with_item_id, reg0, ":var2"),
        (position_set_x, pos1, 53),
        (position_set_y, pos1, 476),
        (overlay_set_position, reg0, pos1),
        (assign, "$g_inside_obj_6", reg0),
      (else_try),
        (create_image_button_overlay, "$g_presentation_obj_item_select_6", "mesh_mp_inventory_slot_armor", "mesh_mp_inventory_slot_armor"),
      (try_end),
      (position_set_x, pos1, 800),
      (position_set_y, pos1, 800),
      (overlay_set_size, "$g_presentation_obj_item_select_6", pos1),
      (position_set_x, pos1, 2),
      (position_set_y, pos1, 425),
      (overlay_set_position, "$g_presentation_obj_item_select_6", pos1),
      (store_add, ":var1", 2, 6),
      (player_get_slot, ":var2", ":var0", ":var1"),
      (try_begin),
        (ge, ":var2", 0),
        (create_image_button_overlay, "$g_presentation_obj_item_select_7", "mesh_mp_inventory_slot_empty", "mesh_mp_inventory_slot_empty"),
        (create_mesh_overlay_with_item_id, reg0, ":var2"),
        (position_set_x, pos1, 53),
        (position_set_y, pos1, 376),
        (overlay_set_position, reg0, pos1),
        (assign, "$g_inside_obj_7", reg0),
      (else_try),
        (create_image_button_overlay, "$g_presentation_obj_item_select_7", "mesh_mp_inventory_slot_boot", "mesh_mp_inventory_slot_boot"),
      (try_end),
      (position_set_x, pos1, 800),
      (position_set_y, pos1, 800),
      (overlay_set_size, "$g_presentation_obj_item_select_7", pos1),
      (position_set_x, pos1, 2),
      (position_set_y, pos1, 325),
      (overlay_set_position, "$g_presentation_obj_item_select_7", pos1),
      (store_add, ":var1", 2, 7),
      (player_get_slot, ":var2", ":var0", ":var1"),
      (try_begin),
        (ge, ":var2", 0),
        (create_image_button_overlay, "$g_presentation_obj_item_select_8", "mesh_mp_inventory_slot_empty", "mesh_mp_inventory_slot_empty"),
        (create_mesh_overlay_with_item_id, reg0, ":var2"),
        (position_set_x, pos1, 53),
        (position_set_y, pos1, 276),
        (overlay_set_position, reg0, pos1),
        (assign, "$g_inside_obj_8", reg0),
      (else_try),
        (create_image_button_overlay, "$g_presentation_obj_item_select_8", "mesh_mp_inventory_slot_glove", "mesh_mp_inventory_slot_glove"),
      (try_end),
      (position_set_x, pos1, 800),
      (position_set_y, pos1, 800),
      (overlay_set_size, "$g_presentation_obj_item_select_8", pos1),
      (position_set_x, pos1, 2),
      (position_set_y, pos1, 225),
      (overlay_set_position, "$g_presentation_obj_item_select_8", pos1),
      (store_add, ":var1", 2, 8),
      (player_get_slot, ":var2", ":var0", ":var1"),
      (try_begin),
        (ge, ":var2", 0),
        (eq, "$g_horses_are_avaliable", 1),
        (create_image_button_overlay, "$g_presentation_obj_item_select_9", "mesh_mp_inventory_slot_empty", "mesh_mp_inventory_slot_empty"),
        (create_mesh_overlay_with_item_id, reg0, ":var2"),
        (position_set_x, pos1, 53),
        (position_set_y, pos1, 176),
        (overlay_set_position, reg0, pos1),
        (assign, "$g_inside_obj_9", reg0),
      (else_try),
        (create_image_button_overlay, "$g_presentation_obj_item_select_9", "mesh_mp_inventory_slot_horse", "mesh_mp_inventory_slot_horse"),
      (try_end),
      (position_set_x, pos1, 800),
      (position_set_y, pos1, 800),
      (overlay_set_size, "$g_presentation_obj_item_select_9", pos1),
      (position_set_x, pos1, 2),
      (position_set_y, pos1, 125),
      (overlay_set_position, "$g_presentation_obj_item_select_9", pos1),
      (create_mesh_overlay, reg0, "mesh_mp_inventory_left"),
      (position_set_x, pos1, 800),
      (position_set_y, pos1, 800),
      (overlay_set_size, reg0, pos1),
      (position_set_x, pos1, 0),
      (position_set_y, pos1, 14),
      (overlay_set_position, reg0, pos1),
      (create_mesh_overlay, reg0, "mesh_mp_inventory_right"),
      (position_set_x, pos1, 800),
      (position_set_y, pos1, 800),
      (overlay_set_size, reg0, pos1),
      (position_set_x, pos1, 894),
      (position_set_y, pos1, 65),
      (overlay_set_position, reg0, pos1),
      (create_in_game_button_overlay, "$g_presentation_obj_item_select_10", "str_reset_to_default", 0),
      (overlay_set_color, "$g_presentation_obj_item_select_10", 0xFFFFFF),
      (position_set_x, pos1, 605),
      (position_set_y, pos1, 25),
      (overlay_set_position, "$g_presentation_obj_item_select_10", pos1),
      (create_in_game_button_overlay, "$g_presentation_obj_item_select_11", "str_done", 0),
      (overlay_set_color, "$g_presentation_obj_item_select_11", 0xFFFFFF),
      (position_set_x, pos1, 395),
      (position_set_y, pos1, 25),
      (overlay_set_position, "$g_presentation_obj_item_select_11", pos1),
      (assign, ":var3", 725),
      (multiplayer_get_my_player, ":var0"),
      (player_get_team_no, ":var4", ":var0"),
      (assign, ":var5", 0),
      (try_begin),
        (eq, ":var4", 0),
        (try_begin),
          (gt, "$g_multiplayer_num_bots_team_1", 0),
          (assign, ":var5", 1),
        (try_end),
      (else_try),
        (try_begin),
          (gt, "$g_multiplayer_num_bots_team_2", 0),
          (assign, ":var5", 1),
        (try_end),
      (try_end),
      (team_get_faction, ":var6", ":var4"),
      (try_begin),
        (eq, ":var5", 1),
        (neq, "$g_multiplayer_game_type", 0),
        (neq, "$g_multiplayer_game_type", 7),
        (assign, ":var7", 0),
        (try_begin),
          (eq, ":var5", 1),
          (try_for_range, ":var8", "trp_swadian_crossbowman_multiplayer_ai", "trp_swadian_crossbowman_multiplayer"),
            (store_faction_of_troop, ":var9", ":var8"),
            (eq, ":var9", ":var6"),
            (val_add, ":var7", 1),
          (try_end),
        (try_end),
        (store_mul, ":var10", ":var7", 20),
        (val_add, ":var10", 40),
        (create_mesh_overlay, reg0, "mesh_mp_ui_command_border_r"),
        (position_set_x, pos1, 280),
        (position_set_y, pos1, 680),
        (overlay_set_position, reg0, pos1),
        (position_set_x, pos1, 2500),
        (position_set_y, pos1, 2500),
        (overlay_set_size, reg0, pos1),
        (create_mesh_overlay, reg0, "mesh_mp_ui_command_border_l"),
        (position_set_x, pos1, 650),
        (position_set_y, pos1, 680),
        (overlay_set_position, reg0, pos1),
        (position_set_x, pos1, 2500),
        (position_set_y, pos1, 2500),
        (overlay_set_size, reg0, pos1),
        (create_mesh_overlay, reg0, "mesh_mp_ui_command_panel"),
        (position_set_x, pos1, 350),
        (store_sub, ":var11", 750, ":var10"),
        (position_set_y, pos1, ":var11"),
        (overlay_set_position, reg0, pos1),
        (position_set_x, pos1, 3000),
        (position_set_y, pos1, 3000),
        (overlay_set_size, reg0, pos1),
        (create_text_overlay, reg0, "str_command", 0),
        (overlay_set_color, reg0, 0xFFFFFF),
        (position_set_x, pos1, 800),
        (position_set_y, pos1, 800),
        (overlay_set_size, reg0, pos1),
        (position_set_x, pos1, 370),
        (position_set_y, pos1, ":var3"),
        (overlay_set_position, reg0, pos1),
        (val_sub, ":var3", 20),
        (assign, ":var12", 0),
        (try_for_range, ":var8", "trp_swadian_crossbowman_multiplayer_ai", "trp_swadian_crossbowman_multiplayer"),
          (store_faction_of_troop, ":var9", ":var8"),
          (eq, ":var9", ":var6"),
          (create_check_box_overlay, reg0, "mesh_checkbox_off", "mesh_checkbox_on"),
          (position_set_x, pos1, 800),
          (position_set_y, pos1, 800),
          (overlay_set_size, reg0, pos1),
          (position_set_x, pos1, 377),
          (store_add, ":var13", ":var3", 2),
          (position_set_y, pos1, ":var13"),
          (overlay_set_position, reg0, pos1),
          (try_begin),
            (eq, ":var12", 0),
            (overlay_set_val, reg0, "$g_multiplayer_bot_type_1_wanted"),
            (assign, "$g_presentation_obj_item_select_13", reg0),
          (else_try),
            (eq, ":var12", 1),
            (overlay_set_val, reg0, "$g_multiplayer_bot_type_2_wanted"),
            (assign, "$g_presentation_obj_item_select_14", reg0),
          (else_try),
            (eq, ":var12", 2),
            (overlay_set_val, reg0, "$g_multiplayer_bot_type_3_wanted"),
            (assign, "$g_presentation_obj_item_select_15", reg0),
          (else_try),
            (overlay_set_val, reg0, "$g_multiplayer_bot_type_4_wanted"),
            (assign, "$g_presentation_obj_item_select_16", reg0),
          (try_end),
          (str_store_troop_name, s0, ":var8"),
          (create_text_overlay, reg0, "str_s0", 0),
          (overlay_set_color, reg0, 0xFFFFFF),
          (position_set_x, pos1, 800),
          (position_set_y, pos1, 800),
          (overlay_set_size, reg0, pos1),
          (position_set_x, pos1, 397),
          (position_set_y, pos1, ":var3"),
          (overlay_set_position, reg0, pos1),
          (val_sub, ":var3", 20),
          (val_add, ":var12", 1),
        (try_end),
        (val_sub, ":var3", 20),
      (try_end),
      (multiplayer_get_my_player, ":var0"),
      (player_get_gold, ":var14", ":var0"),
      (call_script, "script_multiplayer_calculate_cur_selected_items_cost", ":var0", 1),
      (create_text_overlay, "$g_presentation_obj_item_select_12", "str_total_item_cost_reg0", tf_left_align|tf_single_line|tf_with_outline),
      (try_begin),
        (ge, ":var14", reg0),
        (overlay_set_color, "$g_presentation_obj_item_select_12", 0xFFFFFF),
      (else_try),
        (overlay_set_color, "$g_presentation_obj_item_select_12", 0xFF0000),
      (try_end),
      (position_set_x, pos1, 680),
      (position_set_y, pos1, 652),
      (overlay_set_position, "$g_presentation_obj_item_select_12", pos1),
      (store_add, "$g_presentation_obj_item_select_next", "$g_presentation_obj_item_select_12", 1),
      (player_get_troop_id, ":var15", ":var0"),
      (try_begin),
        (eq, "$g_presentation_state", 1),
        (call_script, "script_multiplayer_display_available_items_for_troop_and_item_classes", ":var15", 1, 18, 781, 474),
        (create_mesh_overlay, reg0, "mesh_mp_inventory_right_arrow"),
        (position_set_x, pos1, 800),
        (position_set_y, pos1, 800),
        (overlay_set_size, reg0, pos1),
        (position_set_x, pos1, 881),
        (position_set_y, pos1, 515),
        (overlay_set_position, reg0, pos1),
      (else_try),
        (eq, "$g_presentation_state", 2),
        (call_script, "script_multiplayer_display_available_items_for_troop_and_item_classes", ":var15", 1, 18, 781, 374),
        (create_mesh_overlay, reg0, "mesh_mp_inventory_right_arrow"),
        (position_set_x, pos1, 800),
        (position_set_y, pos1, 800),
        (overlay_set_size, reg0, pos1),
        (position_set_x, pos1, 881),
        (position_set_y, pos1, 415),
        (overlay_set_position, reg0, pos1),
      (else_try),
        (eq, "$g_presentation_state", 3),
        (call_script, "script_multiplayer_display_available_items_for_troop_and_item_classes", ":var15", 1, 18, 781, 274),
        (create_mesh_overlay, reg0, "mesh_mp_inventory_right_arrow"),
        (position_set_x, pos1, 800),
        (position_set_y, pos1, 800),
        (overlay_set_size, reg0, pos1),
        (position_set_x, pos1, 881),
        (position_set_y, pos1, 315),
        (overlay_set_position, reg0, pos1),
      (else_try),
        (eq, "$g_presentation_state", 4),
        (call_script, "script_multiplayer_display_available_items_for_troop_and_item_classes", ":var15", 1, 18, 781, 174),
        (create_mesh_overlay, reg0, "mesh_mp_inventory_right_arrow"),
        (position_set_x, pos1, 800),
        (position_set_y, pos1, 800),
        (overlay_set_size, reg0, pos1),
        (position_set_x, pos1, 881),
        (position_set_y, pos1, 215),
        (overlay_set_position, reg0, pos1),
      (else_try),
        (eq, "$g_presentation_state", 5),
        (call_script, "script_multiplayer_display_available_items_for_troop_and_item_classes", ":var15", 22, 24, 117, 524),
        (create_mesh_overlay, reg0, "mesh_mp_inventory_left_arrow"),
        (position_set_x, pos1, 800),
        (position_set_y, pos1, 800),
        (overlay_set_size, reg0, pos1),
        (position_set_x, pos1, 106),
        (position_set_y, pos1, 565),
        (overlay_set_position, reg0, pos1),
      (else_try),
        (eq, "$g_presentation_state", 6),
        (call_script, "script_multiplayer_display_available_items_for_troop_and_item_classes", ":var15", 19, 22, 117, 424),
        (create_mesh_overlay, reg0, "mesh_mp_inventory_left_arrow"),
        (position_set_x, pos1, 800),
        (position_set_y, pos1, 800),
        (overlay_set_size, reg0, pos1),
        (position_set_x, pos1, 106),
        (position_set_y, pos1, 465),
        (overlay_set_position, reg0, pos1),
      (else_try),
        (eq, "$g_presentation_state", 7),
        (call_script, "script_multiplayer_display_available_items_for_troop_and_item_classes", ":var15", 24, 26, 117, 324),
        (create_mesh_overlay, reg0, "mesh_mp_inventory_left_arrow"),
        (position_set_x, pos1, 800),
        (position_set_y, pos1, 800),
        (overlay_set_size, reg0, pos1),
        (position_set_x, pos1, 106),
        (position_set_y, pos1, 365),
        (overlay_set_position, reg0, pos1),
      (else_try),
        (eq, "$g_presentation_state", 8),
        (call_script, "script_multiplayer_display_available_items_for_troop_and_item_classes", ":var15", 26, 27, 117, 224),
        (create_mesh_overlay, reg0, "mesh_mp_inventory_left_arrow"),
        (position_set_x, pos1, 800),
        (position_set_y, pos1, 800),
        (overlay_set_size, reg0, pos1),
        (position_set_x, pos1, 106),
        (position_set_y, pos1, 265),
        (overlay_set_position, reg0, pos1),
      (else_try),
        (eq, "$g_presentation_state", 9),
        (eq, "$g_horses_are_avaliable", 1),
        (call_script, "script_multiplayer_display_available_items_for_troop_and_item_classes", ":var15", 18, 19, 117, 124),
        (create_mesh_overlay, reg0, "mesh_mp_inventory_left_arrow"),
        (position_set_x, pos1, 800),
        (position_set_y, pos1, 800),
        (overlay_set_size, reg0, pos1),
        (position_set_x, pos1, 106),
        (position_set_y, pos1, 165),
        (overlay_set_position, reg0, pos1),
      (try_end),
      (presentation_set_duration, 999999),
    ]),
    (ti_on_presentation_mouse_enter_leave,
    [
      (store_trigger_param_1, ":var0"),
      (store_trigger_param_2, ":var1"),
      (try_begin),
        (eq, "$g_close_equipment_selection", 0),
        (try_begin),
          (eq, ":var1", 0),
          (assign, ":var2", -1),
          (try_begin),
            (ge, ":var0", "$g_presentation_obj_item_select_next"),
            (store_sub, ":var3", ":var0", "$g_presentation_obj_item_select_next"),
            (store_mod, ":var4", ":var3", 2),
            (store_sub, ":var4", 1, ":var4"),
            (val_div, ":var3", 2),
            (store_add, ":var5", 46, ":var3"),
            (troop_get_slot, ":var2", "trp_multiplayer_data", ":var5"),
            (assign, ":var6", ":var0"),
            (val_add, ":var6", ":var4"),
          (else_try),
            (eq, ":var0", "$g_presentation_obj_item_select_1"),
            (store_add, ":var7", 2, 1),
            (val_sub, ":var7", 1),
            (multiplayer_get_my_player, ":var8"),
            (player_get_slot, ":var2", ":var8", ":var7"),
            (assign, ":var6", "$g_inside_obj_1"),
          (else_try),
            (eq, ":var0", "$g_presentation_obj_item_select_2"),
            (store_add, ":var7", 2, 2),
            (val_sub, ":var7", 1),
            (multiplayer_get_my_player, ":var8"),
            (player_get_slot, ":var2", ":var8", ":var7"),
            (assign, ":var6", "$g_inside_obj_2"),
          (else_try),
            (eq, ":var0", "$g_presentation_obj_item_select_3"),
            (store_add, ":var7", 2, 3),
            (val_sub, ":var7", 1),
            (multiplayer_get_my_player, ":var8"),
            (player_get_slot, ":var2", ":var8", ":var7"),
            (assign, ":var6", "$g_inside_obj_3"),
          (else_try),
            (eq, ":var0", "$g_presentation_obj_item_select_4"),
            (store_add, ":var7", 2, 4),
            (val_sub, ":var7", 1),
            (multiplayer_get_my_player, ":var8"),
            (player_get_slot, ":var2", ":var8", ":var7"),
            (assign, ":var6", "$g_inside_obj_4"),
          (else_try),
            (eq, ":var0", "$g_presentation_obj_item_select_5"),
            (store_add, ":var7", 2, 5),
            (val_sub, ":var7", 1),
            (multiplayer_get_my_player, ":var8"),
            (player_get_slot, ":var2", ":var8", ":var7"),
            (assign, ":var6", "$g_inside_obj_5"),
          (else_try),
            (eq, ":var0", "$g_presentation_obj_item_select_6"),
            (store_add, ":var7", 2, 6),
            (val_sub, ":var7", 1),
            (multiplayer_get_my_player, ":var8"),
            (player_get_slot, ":var2", ":var8", ":var7"),
            (assign, ":var6", "$g_inside_obj_6"),
          (else_try),
            (eq, ":var0", "$g_presentation_obj_item_select_7"),
            (store_add, ":var7", 2, 7),
            (val_sub, ":var7", 1),
            (multiplayer_get_my_player, ":var8"),
            (player_get_slot, ":var2", ":var8", ":var7"),
            (assign, ":var6", "$g_inside_obj_7"),
          (else_try),
            (eq, ":var0", "$g_presentation_obj_item_select_8"),
            (store_add, ":var7", 2, 8),
            (val_sub, ":var7", 1),
            (multiplayer_get_my_player, ":var8"),
            (player_get_slot, ":var2", ":var8", ":var7"),
            (assign, ":var6", "$g_inside_obj_8"),
          (else_try),
            (eq, ":var0", "$g_presentation_obj_item_select_9"),
            (eq, "$g_horses_are_avaliable", 1),
            (store_add, ":var7", 2, 9),
            (val_sub, ":var7", 1),
            (multiplayer_get_my_player, ":var8"),
            (player_get_slot, ":var2", ":var8", ":var7"),
            (assign, ":var6", "$g_inside_obj_9"),
          (try_end),
          (try_begin),
            (ge, ":var2", 0),
            (overlay_get_position, 0, ":var6"),
            (multiplayer_get_my_player, ":var8"),
            (player_get_troop_id, ":var9", ":var8"),
            (try_begin),
              (call_script, "script_cf_multiplayer_is_item_default_for_troop", ":var2", ":var9"),
              (show_item_details, ":var2", pos0, 0),
            (else_try),
              (store_faction_of_troop, ":var10", ":var9"),
              (store_sub, ":var11", ":var10", "fac_kingdom_1"),
              (val_add, ":var11", 30),
              (item_get_slot, ":var12", ":var2", ":var11"),
              (show_item_details, ":var2", pos0, ":var12"),
            (try_end),
            (assign, "$g_current_opened_item_details", ":var2"),
          (try_end),
        (else_try),
          (assign, ":var2", -1),
          (try_begin),
            (ge, ":var0", "$g_presentation_obj_item_select_next"),
            (store_sub, ":var3", ":var0", "$g_presentation_obj_item_select_next"),
            (val_div, ":var3", 2),
            (store_add, ":var5", 46, ":var3"),
            (troop_get_slot, ":var2", "trp_multiplayer_data", ":var5"),
          (else_try),
            (eq, ":var0", "$g_presentation_obj_item_select_1"),
            (store_add, ":var7", 2, 1),
            (val_sub, ":var7", 1),
            (multiplayer_get_my_player, ":var8"),
            (player_get_slot, ":var2", ":var8", ":var7"),
            (assign, ":var6", "$g_inside_obj_1"),
          (else_try),
            (eq, ":var0", "$g_presentation_obj_item_select_2"),
            (store_add, ":var7", 2, 2),
            (val_sub, ":var7", 1),
            (multiplayer_get_my_player, ":var8"),
            (player_get_slot, ":var2", ":var8", ":var7"),
            (assign, ":var6", "$g_inside_obj_2"),
          (else_try),
            (eq, ":var0", "$g_presentation_obj_item_select_3"),
            (store_add, ":var7", 2, 3),
            (val_sub, ":var7", 1),
            (multiplayer_get_my_player, ":var8"),
            (player_get_slot, ":var2", ":var8", ":var7"),
            (assign, ":var6", "$g_inside_obj_3"),
          (else_try),
            (eq, ":var0", "$g_presentation_obj_item_select_4"),
            (store_add, ":var7", 2, 4),
            (val_sub, ":var7", 1),
            (multiplayer_get_my_player, ":var8"),
            (player_get_slot, ":var2", ":var8", ":var7"),
            (assign, ":var6", "$g_inside_obj_4"),
          (else_try),
            (eq, ":var0", "$g_presentation_obj_item_select_5"),
            (store_add, ":var7", 2, 5),
            (val_sub, ":var7", 1),
            (multiplayer_get_my_player, ":var8"),
            (player_get_slot, ":var2", ":var8", ":var7"),
            (assign, ":var6", "$g_inside_obj_5"),
          (else_try),
            (eq, ":var0", "$g_presentation_obj_item_select_6"),
            (store_add, ":var7", 2, 6),
            (val_sub, ":var7", 1),
            (multiplayer_get_my_player, ":var8"),
            (player_get_slot, ":var2", ":var8", ":var7"),
            (assign, ":var6", "$g_inside_obj_6"),
          (else_try),
            (eq, ":var0", "$g_presentation_obj_item_select_7"),
            (store_add, ":var7", 2, 7),
            (val_sub, ":var7", 1),
            (multiplayer_get_my_player, ":var8"),
            (player_get_slot, ":var2", ":var8", ":var7"),
            (assign, ":var6", "$g_inside_obj_7"),
          (else_try),
            (eq, ":var0", "$g_presentation_obj_item_select_8"),
            (store_add, ":var7", 2, 8),
            (val_sub, ":var7", 1),
            (multiplayer_get_my_player, ":var8"),
            (player_get_slot, ":var2", ":var8", ":var7"),
            (assign, ":var6", "$g_inside_obj_8"),
          (else_try),
            (eq, ":var0", "$g_presentation_obj_item_select_9"),
            (eq, "$g_horses_are_avaliable", 1),
            (store_add, ":var7", 2, 9),
            (val_sub, ":var7", 1),
            (multiplayer_get_my_player, ":var8"),
            (player_get_slot, ":var2", ":var8", ":var7"),
            (assign, ":var6", "$g_inside_obj_9"),
          (try_end),
          (try_begin),
            (eq, "$g_current_opened_item_details", ":var2"),
            (close_item_details),
            (assign, "$g_current_opened_item_details", -1),
          (try_end),
        (try_end),
      (else_try),
        (assign, "$g_close_equipment_selection", 0),
        (presentation_set_duration, 0),
      (try_end),
    ]),
    (ti_on_presentation_event_state_change,
    [
      (store_trigger_param_1, ":var0"),
      (store_trigger_param_2, ":var1"),
      (multiplayer_get_my_player, ":var2"),
      (player_get_troop_id, ":var3", ":var2"),
      (try_begin),
        (eq, "$g_close_equipment_selection", 0),
        (try_begin),
          (eq, "$g_presentation_state", 0),
          (try_begin),
            (eq, ":var0", "$g_presentation_obj_item_select_1"),
            (assign, "$g_presentation_state", 1),
            (presentation_set_duration, 0),
            (start_presentation, "prsnt_multiplayer_item_select"),
          (else_try),
            (eq, ":var0", "$g_presentation_obj_item_select_2"),
            (assign, "$g_presentation_state", 2),
            (presentation_set_duration, 0),
            (start_presentation, "prsnt_multiplayer_item_select"),
          (else_try),
            (eq, ":var0", "$g_presentation_obj_item_select_3"),
            (assign, "$g_presentation_state", 3),
            (presentation_set_duration, 0),
            (start_presentation, "prsnt_multiplayer_item_select"),
          (else_try),
            (eq, ":var0", "$g_presentation_obj_item_select_4"),
            (assign, "$g_presentation_state", 4),
            (presentation_set_duration, 0),
            (start_presentation, "prsnt_multiplayer_item_select"),
          (else_try),
            (eq, ":var0", "$g_presentation_obj_item_select_5"),
            (assign, "$g_presentation_state", 5),
            (presentation_set_duration, 0),
            (start_presentation, "prsnt_multiplayer_item_select"),
          (else_try),
            (eq, ":var0", "$g_presentation_obj_item_select_6"),
            (assign, "$g_presentation_state", 6),
            (presentation_set_duration, 0),
            (start_presentation, "prsnt_multiplayer_item_select"),
          (else_try),
            (eq, ":var0", "$g_presentation_obj_item_select_7"),
            (assign, "$g_presentation_state", 7),
            (presentation_set_duration, 0),
            (start_presentation, "prsnt_multiplayer_item_select"),
          (else_try),
            (eq, ":var0", "$g_presentation_obj_item_select_8"),
            (assign, "$g_presentation_state", 8),
            (presentation_set_duration, 0),
            (start_presentation, "prsnt_multiplayer_item_select"),
          (else_try),
            (eq, ":var0", "$g_presentation_obj_item_select_9"),
            (eq, "$g_horses_are_avaliable", 1),
            (assign, "$g_presentation_state", 9),
            (presentation_set_duration, 0),
            (start_presentation, "prsnt_multiplayer_item_select"),
          (try_end),
        (else_try),
          (gt, "$g_presentation_state", 0),
          (store_sub, ":var4", ":var0", "$g_presentation_obj_item_select_next"),
          (val_div, ":var4", 2),
          (assign, ":var5", 146),
          (try_for_range, ":var6", 46, ":var5"),
            (neg|troop_slot_eq, "trp_multiplayer_data", ":var6", -1),
            (store_sub, ":var7", ":var6", 46),
            (eq, ":var4", ":var7"),
            (troop_get_slot, ":var8", "trp_multiplayer_data", ":var6"),
            (store_add, ":var9", 2, "$g_presentation_state"),
            (val_sub, ":var9", 1),
            (player_set_slot, ":var2", ":var9", ":var8"),
            (player_get_gold, ":var10", ":var2"),
            (call_script, "script_multiplayer_calculate_cur_selected_items_cost", ":var2", 1),
            (overlay_set_text, "$g_presentation_obj_item_select_12", "str_total_item_cost_reg0"),
            (try_begin),
              (ge, ":var10", reg0),
              (overlay_set_color, "$g_presentation_obj_item_select_12", 0xFFFFFF),
            (else_try),
              (overlay_set_color, "$g_presentation_obj_item_select_12", 0xFF0000),
            (try_end),
            (assign, ":var5", 0),
          (try_end),
          (presentation_set_duration, 0),
          (assign, "$g_presentation_state", 0),
          (start_presentation, "prsnt_multiplayer_item_select"),
        (try_end),
        (try_begin),
          (eq, ":var0", "$g_presentation_obj_item_select_10"),
          (call_script, "script_multiplayer_set_default_item_selections_for_troop", ":var3"),
          (presentation_set_duration, 0),
          (assign, "$g_presentation_state", 0),
          (start_presentation, "prsnt_multiplayer_item_select"),
        (else_try),
          (eq, ":var0", "$g_presentation_obj_item_select_11"),
          (call_script, "script_multiplayer_send_item_selections"),
          (presentation_set_duration, 0),
          (try_begin),
            (try_begin),
              (eq, "$g_multiplayer_game_type", 6),
              (gt, "$g_multiplayer_number_of_respawn_count", 0),
              (ge, "$g_my_spawn_count", "$g_multiplayer_number_of_respawn_count"),
              (multiplayer_get_my_player, ":var2"),
              (player_get_team_no, ":var11", ":var2"),
              (this_or_next|eq, ":var11", 0),
              (ge, "$g_my_spawn_count", 999),
              (assign, "$g_show_no_more_respawns_remained", 1),
            (else_try),
              (assign, "$g_show_no_more_respawns_remained", 0),
            (try_end),
            (eq, "$g_show_no_more_respawns_remained", 1),
            (store_mission_timer_a, "$g_multiplayer_respawn_start_time"),
            (start_presentation, "prsnt_multiplayer_respawn_time_counter"),
          (try_end),
        (else_try),
          (eq, ":var0", "$g_presentation_obj_item_select_13"),
          (assign, "$g_multiplayer_bot_type_1_wanted", ":var1"),
          (multiplayer_send_2_int_to_server, 1, 35, ":var1"),
        (else_try),
          (eq, ":var0", "$g_presentation_obj_item_select_14"),
          (assign, "$g_multiplayer_bot_type_2_wanted", ":var1"),
          (multiplayer_send_2_int_to_server, 1, 36, ":var1"),
        (else_try),
          (eq, ":var0", "$g_presentation_obj_item_select_15"),
          (assign, "$g_multiplayer_bot_type_3_wanted", ":var1"),
          (multiplayer_send_2_int_to_server, 1, 37, ":var1"),
        (else_try),
          (eq, ":var0", "$g_presentation_obj_item_select_16"),
          (assign, "$g_multiplayer_bot_type_4_wanted", ":var1"),
          (multiplayer_send_2_int_to_server, 1, 38, ":var1"),
        (try_end),
      (else_try),
        (assign, "$g_close_equipment_selection", 0),
        (presentation_set_duration, 0),
      (try_end),
    ]),
    (ti_on_presentation_mouse_press,
    [
      (store_trigger_param_1, ":var0"),
      (store_trigger_param_2, ":var1"),
      (try_begin),
        (eq, "$g_close_equipment_selection", 0),
        (try_begin),
          (eq, ":var1", 1),
          (try_begin),
            (eq, "$g_presentation_state", 0),
            (multiplayer_get_my_player, ":var2"),
            (try_begin),
              (eq, ":var0", "$g_presentation_obj_item_select_1"),
              (store_add, ":var3", 2, 0),
              (player_set_slot, ":var2", ":var3", -1),
              (presentation_set_duration, 0),
              (assign, "$g_presentation_state", 0),
              (start_presentation, "prsnt_multiplayer_item_select"),
            (else_try),
              (eq, ":var0", "$g_presentation_obj_item_select_2"),
              (store_add, ":var3", 2, 1),
              (player_set_slot, ":var2", ":var3", -1),
              (presentation_set_duration, 0),
              (assign, "$g_presentation_state", 0),
              (start_presentation, "prsnt_multiplayer_item_select"),
            (else_try),
              (eq, ":var0", "$g_presentation_obj_item_select_3"),
              (store_add, ":var3", 2, 2),
              (player_set_slot, ":var2", ":var3", -1),
              (presentation_set_duration, 0),
              (assign, "$g_presentation_state", 0),
              (start_presentation, "prsnt_multiplayer_item_select"),
            (else_try),
              (eq, ":var0", "$g_presentation_obj_item_select_4"),
              (store_add, ":var3", 2, 3),
              (player_set_slot, ":var2", ":var3", -1),
              (presentation_set_duration, 0),
              (assign, "$g_presentation_state", 0),
              (start_presentation, "prsnt_multiplayer_item_select"),
            (else_try),
              (eq, ":var0", "$g_presentation_obj_item_select_5"),
              (store_add, ":var3", 2, 4),
              (player_set_slot, ":var2", ":var3", -1),
              (presentation_set_duration, 0),
              (assign, "$g_presentation_state", 0),
              (start_presentation, "prsnt_multiplayer_item_select"),
            (else_try),
              (eq, ":var0", "$g_presentation_obj_item_select_6"),
              (store_add, ":var3", 2, 5),
              (player_set_slot, ":var2", ":var3", -1),
              (presentation_set_duration, 0),
              (assign, "$g_presentation_state", 0),
              (start_presentation, "prsnt_multiplayer_item_select"),
            (else_try),
              (eq, ":var0", "$g_presentation_obj_item_select_7"),
              (store_add, ":var3", 2, 6),
              (player_set_slot, ":var2", ":var3", -1),
              (presentation_set_duration, 0),
              (assign, "$g_presentation_state", 0),
              (start_presentation, "prsnt_multiplayer_item_select"),
            (else_try),
              (eq, ":var0", "$g_presentation_obj_item_select_8"),
              (store_add, ":var3", 2, 7),
              (player_set_slot, ":var2", ":var3", -1),
              (presentation_set_duration, 0),
              (assign, "$g_presentation_state", 0),
              (start_presentation, "prsnt_multiplayer_item_select"),
            (else_try),
              (eq, ":var0", "$g_presentation_obj_item_select_9"),
              (eq, "$g_horses_are_avaliable", 1),
              (store_add, ":var3", 2, 8),
              (player_set_slot, ":var2", ":var3", -1),
              (presentation_set_duration, 0),
              (assign, "$g_presentation_state", 0),
              (start_presentation, "prsnt_multiplayer_item_select"),
            (try_end),
          (else_try),
            (gt, "$g_presentation_state", 0),
            (presentation_set_duration, 0),
            (assign, "$g_presentation_state", 0),
            (start_presentation, "prsnt_multiplayer_item_select"),
          (try_end),
        (try_end),
      (else_try),
        (assign, "$g_close_equipment_selection", 0),
        (presentation_set_duration, 0),
      (try_end),
    ]),
    (ti_on_presentation_run,
    [
      (store_trigger_param_1, ":var0"),
      (try_begin),
        (eq, "$g_close_equipment_selection", 0),
        (try_begin),
          (this_or_next|key_clicked, key_escape),
          (key_clicked, key_xbox_start),
          (try_begin),
            (neq, "$g_current_opened_item_details", -1),
            (close_item_details),
            (assign, "$g_current_opened_item_details", -1),
          (try_end),
          (gt, ":var0", 200),
          (presentation_set_duration, 0),
        (try_end),
      (else_try),
        (assign, "$g_close_equipment_selection", 0),
        (presentation_set_duration, 0),
      (try_end),
    ]),
  ]),

  ("multiplayer_message_1", prsntf_read_only|prsntf_manual_end_only, mesh_pic_bandits,
  [
    (ti_on_presentation_load,
    [
      (set_fixed_point_multiplier, 1000),
      (try_begin),
        (eq, "$g_multiplayer_message_type", 12),
        (assign, ":var0", "$g_multiplayer_message_value_1"),
        (try_begin),
          (eq, ":var0", -1),
          (assign, ":var1", 4294967295),
          (str_store_string, s0, "str_round_draw_no_one_remained"),
        (else_try),
          (try_begin),
            (eq, ":var0", 0),
            (assign, ":var1", 4281589009),
          (else_try),
            (assign, ":var1", 4294919202),
          (try_end),
          (try_begin),
            (lt, "$my_team_at_start_of_round", 2),
            (try_begin),
              (eq, "$my_team_at_start_of_round", ":var0"),
              (assign, ":var1", 4281589009),
            (else_try),
              (assign, ":var1", 4294919202),
            (try_end),
          (try_end),
          (team_get_faction, ":var2", ":var0"),
          (str_store_faction_name, s1, ":var2"),
          (str_store_string, s0, "str_s1_won_round"),
        (try_end),
        (create_text_overlay, "$g_multiplayer_message_1", s0, tf_center_justify|tf_with_outline),
        (overlay_set_color, "$g_multiplayer_message_1", ":var1"),
        (try_begin),
          (neq, ":var0", -1),
          (position_set_x, pos1, 375),
        (else_try),
          (position_set_x, pos1, 400),
        (try_end),
        (position_set_x, pos1, 500),
        (position_set_y, pos1, 400),
        (overlay_set_position, "$g_multiplayer_message_1", pos1),
        (position_set_x, pos1, 2000),
        (position_set_y, pos1, 2000),
        (overlay_set_size, "$g_multiplayer_message_1", pos1),
        (presentation_set_duration, 300),
      (else_try),
        (eq, "$g_multiplayer_message_type", 4),
        (agent_get_team, ":var0", "$g_multiplayer_message_value_1"),
        (team_get_faction, ":var3", ":var0"),
        (str_store_faction_name, s1, ":var3"),
        (try_begin),
          (eq, ":var0", 0),
          (assign, ":var1", 4281589009),
        (else_try),
          (assign, ":var1", 4294919202),
        (try_end),
        (multiplayer_get_my_player, ":var4"),
        (try_begin),
          (ge, ":var4", 0),
          (player_get_agent_id, ":var5", ":var4"),
          (try_begin),
            (ge, ":var5", 0),
            (agent_get_team, ":var6", ":var5"),
            (try_begin),
              (eq, ":var6", ":var0"),
              (assign, ":var1", 4281589009),
              (play_sound, "snd_team_scored_a_point"),
            (else_try),
              (assign, ":var1", 4294919202),
              (play_sound, "snd_enemy_scored_a_point"),
            (try_end),
          (try_end),
        (try_end),
        (str_store_string, s0, "str_s1_captured_flag"),
        (create_text_overlay, "$g_multiplayer_message_1", s0, tf_center_justify|tf_with_outline),
        (overlay_set_color, "$g_multiplayer_message_1", ":var1"),
        (position_set_x, pos1, 350),
        (position_set_x, pos1, 500),
        (position_set_y, pos1, 400),
        (overlay_set_position, "$g_multiplayer_message_1", pos1),
        (position_set_x, pos1, 2000),
        (position_set_y, pos1, 2000),
        (overlay_set_size, "$g_multiplayer_message_1", pos1),
        (presentation_set_duration, 400),
      (else_try),
        (eq, "$g_multiplayer_message_type", 5),
        (try_begin),
          (ge, "$g_multiplayer_message_value_1", 0),
          (agent_get_team, ":var7", "$g_multiplayer_message_value_1"),
          (team_get_faction, ":var8", ":var7"),
          (str_store_faction_name, s1, ":var8"),
          (str_store_string, s0, "str_s1_returned_flag"),
        (else_try),
          (val_add, "$g_multiplayer_message_value_1", 1),
          (val_mul, "$g_multiplayer_message_value_1", -1),
          (assign, ":var7", "$g_multiplayer_message_value_1"),
          (team_get_faction, ":var8", ":var7"),
          (str_store_faction_name, s1, ":var8"),
          (str_store_string, s0, "str_s1_auto_returned_flag"),
        (try_end),
        (multiplayer_get_my_player, ":var4"),
        (try_begin),
          (ge, ":var4", 0),
          (player_get_agent_id, ":var5", ":var4"),
          (try_begin),
            (ge, ":var5", 0),
            (play_sound, "snd_flag_returned"),
          (try_end),
        (try_end),
        (assign, ":var1", 4294967295),
        (create_text_overlay, "$g_multiplayer_message_1", s0, tf_center_justify|tf_with_outline),
        (overlay_set_color, "$g_multiplayer_message_1", ":var1"),
        (position_set_x, pos1, 325),
        (position_set_y, pos1, 400),
        (position_set_x, pos1, 500),
        (overlay_set_position, "$g_multiplayer_message_1", pos1),
        (position_set_x, pos1, 2000),
        (position_set_y, pos1, 2000),
        (overlay_set_size, "$g_multiplayer_message_1", pos1),
        (presentation_set_duration, 400),
      (else_try),
        (eq, "$g_multiplayer_message_type", 6),
        (agent_get_team, ":var9", "$g_multiplayer_message_value_1"),
        (team_get_faction, ":var10", ":var9"),
        (str_store_faction_name, s1, ":var10"),
        (assign, ":var1", 4294967295),
        (multiplayer_get_my_player, ":var4"),
        (try_begin),
          (ge, ":var4", 0),
          (player_get_agent_id, ":var5", ":var4"),
          (try_begin),
            (ge, ":var5", 0),
            (agent_get_team, ":var6", ":var5"),
            (try_begin),
              (eq, ":var6", ":var9"),
              (play_sound, "snd_enemy_flag_taken"),
            (else_try),
              (play_sound, "snd_your_flag_taken"),
            (try_end),
          (try_end),
        (try_end),
        (str_store_string, s0, "str_s1_taken_flag"),
        (create_text_overlay, "$g_multiplayer_message_1", s0, tf_center_justify|tf_with_outline),
        (overlay_set_color, "$g_multiplayer_message_1", ":var1"),
        (position_set_x, pos1, 365),
        (position_set_x, pos1, 500),
        (position_set_y, pos1, 400),
        (overlay_set_position, "$g_multiplayer_message_1", pos1),
        (position_set_x, pos1, 2000),
        (position_set_y, pos1, 2000),
        (overlay_set_size, "$g_multiplayer_message_1", pos1),
        (presentation_set_duration, 400),
      (else_try),
        (eq, "$g_multiplayer_message_type", 9),
        (store_div, ":var0", "$g_multiplayer_message_value_1", 100),
        (store_mod, reg0, "$g_multiplayer_message_value_1", 100),
        (val_sub, ":var0", 1),
        (try_begin),
          (eq, ":var0", 0),
          (assign, ":var1", 4281589009),
        (else_try),
          (assign, ":var1", 4294919202),
        (try_end),
        (multiplayer_get_my_player, ":var4"),
        (try_begin),
          (ge, ":var4", 0),
          (player_get_agent_id, ":var5", ":var4"),
          (try_begin),
            (ge, ":var5", 0),
            (agent_get_team, ":var6", ":var5"),
            (try_begin),
              (eq, ":var6", ":var0"),
              (assign, ":var1", 4281589009),
              (play_sound, "snd_team_scored_a_point"),
            (else_try),
              (assign, ":var1", 4294919202),
              (play_sound, "snd_enemy_scored_a_point"),
            (try_end),
          (try_end),
        (try_end),
        (team_get_faction, ":var3", ":var0"),
        (str_store_faction_name, s1, ":var3"),
        (str_store_string, s0, "str_s1_captured_flag_reg0"),
        (create_text_overlay, "$g_multiplayer_message_1", s0, tf_center_justify|tf_with_outline),
        (overlay_set_color, "$g_multiplayer_message_1", ":var1"),
        (position_set_x, pos1, 345),
        (position_set_x, pos1, 500),
        (position_set_y, pos1, 400),
        (overlay_set_position, "$g_multiplayer_message_1", pos1),
        (position_set_x, pos1, 2000),
        (position_set_y, pos1, 2000),
        (overlay_set_size, "$g_multiplayer_message_1", pos1),
        (presentation_set_duration, 400),
      (else_try),
        (eq, "$g_multiplayer_message_type", 10),
        (store_div, ":var0", "$g_multiplayer_message_value_1", 100),
        (store_mod, reg0, "$g_multiplayer_message_value_1", 100),
        (val_sub, ":var0", 1),
        (multiplayer_get_my_player, ":var4"),
        (try_begin),
          (ge, ":var4", 0),
          (player_get_agent_id, ":var5", ":var4"),
          (try_begin),
            (ge, ":var5", 0),
            (agent_get_team, ":var6", ":var5"),
            (try_begin),
              (eq, ":var6", ":var0"),
              (play_sound, "snd_enemy_flag_taken"),
            (else_try),
              (play_sound, "snd_your_flag_taken"),
            (try_end),
          (try_end),
        (try_end),
        (assign, ":var1", 4294967295),
        (team_get_faction, ":var3", ":var0"),
        (str_store_faction_name, s1, ":var3"),
        (str_store_string, s0, "str_s1_pulling_flag_reg0"),
        (create_text_overlay, "$g_multiplayer_message_1", s0, tf_center_justify|tf_with_outline),
        (overlay_set_color, "$g_multiplayer_message_1", ":var1"),
        (position_set_x, pos1, 345),
        (position_set_x, pos1, 500),
        (position_set_y, pos1, 400),
        (overlay_set_position, "$g_multiplayer_message_1", pos1),
        (position_set_x, pos1, 2000),
        (position_set_y, pos1, 2000),
        (overlay_set_size, "$g_multiplayer_message_1", pos1),
        (presentation_set_duration, 400),
      (else_try),
        (eq, "$g_multiplayer_message_type", 8),
        (store_div, ":var0", "$g_multiplayer_message_value_1", 100),
        (store_mod, reg0, "$g_multiplayer_message_value_1", 100),
        (val_sub, ":var0", 1),
        (multiplayer_get_my_player, ":var4"),
        (try_begin),
          (ge, ":var4", 0),
          (player_get_agent_id, ":var5", ":var4"),
          (try_begin),
            (ge, ":var5", 0),
            (play_sound, "snd_flag_returned"),
          (try_end),
        (try_end),
        (try_begin),
          (eq, ":var0", 0),
          (assign, ":var1", 4281589009),
        (else_try),
          (assign, ":var1", 4294919202),
        (try_end),
        (multiplayer_get_my_player, ":var4"),
        (try_begin),
          (ge, ":var4", 0),
          (player_get_agent_id, ":var5", ":var4"),
          (try_begin),
            (ge, ":var5", 0),
            (agent_get_team, ":var6", ":var5"),
            (try_begin),
              (eq, ":var6", ":var0"),
              (assign, ":var1", 4281589009),
            (else_try),
              (assign, ":var1", 4294919202),
            (try_end),
          (try_end),
        (try_end),
        (team_get_faction, ":var3", ":var0"),
        (str_store_faction_name, s1, ":var3"),
        (str_store_string, s0, "str_s1_neutralized_flag_reg0"),
        (create_text_overlay, "$g_multiplayer_message_1", s0, tf_center_justify|tf_with_outline),
        (overlay_set_color, "$g_multiplayer_message_1", ":var1"),
        (position_set_x, pos1, 345),
        (position_set_x, pos1, 500),
        (position_set_y, pos1, 400),
        (overlay_set_position, "$g_multiplayer_message_1", pos1),
        (position_set_x, pos1, 2000),
        (position_set_y, pos1, 2000),
        (overlay_set_size, "$g_multiplayer_message_1", pos1),
        (presentation_set_duration, 400),
      (else_try),
        (eq, "$g_multiplayer_message_type", 13),
        (assign, ":var0", "$g_multiplayer_message_value_1"),
        (try_begin),
          (eq, ":var0", 0),
          (assign, ":var1", 4281589009),
        (else_try),
          (assign, ":var1", 4294919202),
        (try_end),
        (multiplayer_get_my_player, ":var4"),
        (try_begin),
          (ge, ":var4", 0),
          (player_get_agent_id, ":var5", ":var4"),
          (try_begin),
            (ge, ":var5", 0),
            (agent_get_team, ":var6", ":var5"),
            (try_begin),
              (eq, ":var6", ":var0"),
              (assign, ":var1", 4281589009),
            (else_try),
              (assign, ":var1", 4294919202),
            (try_end),
          (try_end),
        (try_end),
        (try_begin),
          (eq, "$g_multiplayer_message_value_1", 0),
          (str_store_string, s0, "str_s1_defended_castle"),
        (else_try),
          (eq, "$g_multiplayer_message_value_1", 1),
          (str_store_string, s0, "str_s1_captured_castle"),
        (else_try),
          (str_store_string, s0, "str_round_draw"),
          (assign, ":var1", 4294967295),
        (try_end),
        (create_text_overlay, "$g_multiplayer_message_1", s0, tf_center_justify|tf_with_outline),
        (overlay_set_color, "$g_multiplayer_message_1", ":var1"),
        (try_begin),
          (neq, "$g_multiplayer_message_value_1", -1),
          (position_set_x, pos1, 325),
        (else_try),
          (position_set_x, pos1, 400),
        (try_end),
        (position_set_x, pos1, 500),
        (position_set_y, pos1, 400),
        (overlay_set_position, "$g_multiplayer_message_1", pos1),
        (position_set_x, pos1, 2000),
        (position_set_y, pos1, 2000),
        (overlay_set_size, "$g_multiplayer_message_1", pos1),
        (presentation_set_duration, 400),
      (else_try),
        (eq, "$g_multiplayer_message_type", 14),
        (assign, ":var1", 4294967295),
        (str_store_string, s0, "str_round_draw"),
        (create_text_overlay, "$g_multiplayer_message_1", s0, tf_center_justify|tf_with_outline),
        (overlay_set_color, "$g_multiplayer_message_1", ":var1"),
        (position_set_x, pos1, 375),
        (position_set_x, pos1, 500),
        (position_set_y, pos1, 400),
        (overlay_set_position, "$g_multiplayer_message_1", pos1),
        (position_set_x, pos1, 2000),
        (position_set_y, pos1, 2000),
        (overlay_set_size, "$g_multiplayer_message_1", pos1),
        (presentation_set_duration, 400),
      (else_try),
        (eq, "$g_multiplayer_message_type", 18),
        (assign, ":var1", 4294967295),
        (str_store_string, s0, "str_death_mode_started"),
        (create_text_overlay, "$g_multiplayer_message_1", s0, tf_center_justify|tf_with_outline),
        (overlay_set_color, "$g_multiplayer_message_1", ":var1"),
        (position_set_x, pos1, 350),
        (position_set_x, pos1, 500),
        (position_set_y, pos1, 400),
        (overlay_set_position, "$g_multiplayer_message_1", pos1),
        (position_set_x, pos1, 2000),
        (position_set_y, pos1, 2000),
        (overlay_set_size, "$g_multiplayer_message_1", pos1),
        (presentation_set_duration, 400),
      (else_try),
        (eq, "$g_multiplayer_message_type", 15),
        (try_begin),
          (lt, "$g_multiplayer_message_value_1", 0),
          (val_mul, "$g_multiplayer_message_value_1", -1),
          (assign, ":var11", 0),
          (team_get_faction, ":var2", 1),
          (str_store_faction_name, s1, ":var2"),
        (else_try),
          (assign, ":var11", 1),
          (team_get_faction, ":var2", 0),
          (str_store_faction_name, s1, ":var2"),
        (try_end),
        (try_begin),
          (eq, "$g_multiplayer_message_value_1", 1),
          (assign, ":var1", 4281589009),
        (else_try),
          (assign, ":var1", 4294919202),
        (try_end),
        (multiplayer_get_my_player, ":var4"),
        (try_begin),
          (ge, ":var4", 0),
          (try_begin),
            (multiplayer_get_my_player, ":var4"),
            (player_get_team_no, ":var12", ":var4"),
            (neq, ":var11", ":var12"),
            (assign, ":var1", 4281589009),
          (else_try),
            (assign, ":var1", 4294919202),
          (try_end),
        (try_end),
        (try_begin),
          (eq, "$g_multiplayer_message_value_1", 9),
          (str_store_string, s0, "str_s1_destroyed_all_targets"),
        (else_try),
          (eq, "$g_multiplayer_message_value_1", 1),
          (str_store_string, s0, "str_s1_destroyed_catapult"),
        (else_try),
          (eq, "$g_multiplayer_message_value_1", 2),
          (str_store_string, s0, "str_s1_destroyed_trebuchet"),
        (try_end),
        (create_text_overlay, "$g_multiplayer_message_1", s0, tf_center_justify|tf_with_outline),
        (overlay_set_color, "$g_multiplayer_message_1", ":var1"),
        (position_set_x, pos1, 350),
        (position_set_x, pos1, 500),
        (position_set_y, pos1, 400),
        (overlay_set_position, "$g_multiplayer_message_1", pos1),
        (position_set_x, pos1, 2000),
        (position_set_y, pos1, 2000),
        (overlay_set_size, "$g_multiplayer_message_1", pos1),
        (presentation_set_duration, 400),
      (else_try),
        (eq, "$g_multiplayer_message_type", 16),
        (try_begin),
          (eq, "$g_defender_team", 0),
          (assign, ":var1", 4281589009),
        (else_try),
          (assign, ":var1", 4294919202),
        (try_end),
        (multiplayer_get_my_player, ":var4"),
        (try_begin),
          (ge, ":var4", 0),
          (player_get_agent_id, ":var5", ":var4"),
          (try_begin),
            (ge, ":var5", 0),
            (agent_get_team, ":var6", ":var5"),
            (try_begin),
              (eq, ":var6", "$g_defender_team"),
              (assign, ":var1", 4281589009),
            (else_try),
              (assign, ":var1", 4294919202),
            (try_end),
          (try_end),
        (try_end),
        (assign, ":var13", "$g_multiplayer_message_value_1"),
        (team_get_faction, ":var2", "$g_defender_team"),
        (str_store_faction_name, s1, ":var2"),
        (try_begin),
          (eq, ":var13", 1),
          (str_store_string, s0, "str_s1_saved_1_target"),
        (else_try),
          (eq, ":var13", 2),
          (str_store_string, s0, "str_s1_saved_2_targets"),
        (try_end),
        (create_text_overlay, "$g_multiplayer_message_1", s0, tf_center_justify|tf_with_outline),
        (overlay_set_color, "$g_multiplayer_message_1", ":var1"),
        (position_set_x, pos1, 350),
        (position_set_x, pos1, 500),
        (position_set_y, pos1, 400),
        (overlay_set_position, "$g_multiplayer_message_1", pos1),
        (position_set_x, pos1, 2000),
        (position_set_y, pos1, 2000),
        (overlay_set_size, "$g_multiplayer_message_1", pos1),
        (presentation_set_duration, 400),
      (else_try),
        (eq, "$g_multiplayer_message_type", 17),
        (assign, ":var0", "$g_multiplayer_message_value_1"),
        (try_begin),
          (eq, ":var0", 0),
          (assign, ":var1", 4281589009),
        (else_try),
          (assign, ":var1", 4294919202),
        (try_end),
        (multiplayer_get_my_player, ":var4"),
        (try_begin),
          (ge, ":var4", 0),
          (player_get_agent_id, ":var5", ":var4"),
          (try_begin),
            (ge, ":var5", 0),
            (agent_get_team, ":var6", ":var5"),
            (try_begin),
              (eq, ":var6", ":var0"),
              (assign, ":var1", 4281589009),
            (else_try),
              (assign, ":var1", 4294919202),
            (try_end),
          (try_end),
        (try_end),
        (try_begin),
          (eq, "$g_defender_team", 0),
          (team_get_faction, ":var2", 1),
        (else_try),
          (team_get_faction, ":var2", 0),
        (try_end),
        (str_store_faction_name, s1, ":var2"),
        (str_store_string, s0, "str_s1_won_round"),
        (create_text_overlay, "$g_multiplayer_message_1", s0, tf_center_justify|tf_with_outline),
        (overlay_set_color, "$g_multiplayer_message_1", ":var1"),
        (position_set_x, pos1, 350),
        (position_set_x, pos1, 500),
        (position_set_y, pos1, 400),
        (overlay_set_position, "$g_multiplayer_message_1", pos1),
        (position_set_x, pos1, 2000),
        (position_set_y, pos1, 2000),
        (overlay_set_size, "$g_multiplayer_message_1", pos1),
        (presentation_set_duration, 400),
      (try_end),
    ]),
    (ti_on_presentation_run,
    [
    ]),
  ]),

  ("multiplayer_message_2", prsntf_read_only|prsntf_manual_end_only, mesh_pic_bandits,
  [
    (ti_on_presentation_load,
    [
      (set_fixed_point_multiplier, 1000),
      (try_begin),
        (eq, "$g_multiplayer_message_type", 2),
        (assign, ":var0", 4294967295),
        (str_store_string, s0, "str_auto_team_balance_done"),
        (create_text_overlay, "$g_multiplayer_message_2", s0, tf_center_justify|tf_with_outline),
        (overlay_set_color, "$g_multiplayer_message_2", ":var0"),
        (position_set_x, pos1, 375),
        (position_set_x, pos1, 500),
        (position_set_y, pos1, 550),
        (overlay_set_position, "$g_multiplayer_message_2", pos1),
        (position_set_x, pos1, 2000),
        (position_set_y, pos1, 2000),
        (overlay_set_size, "$g_multiplayer_message_2", pos1),
        (presentation_set_duration, 300),
      (else_try),
        (eq, "$g_multiplayer_message_type", 3),
        (assign, ":var0", 4294967295),
        (try_begin),
          (neq, "$g_multiplayer_game_type", 2),
          (neq, "$g_multiplayer_game_type", 3),
          (neq, "$g_multiplayer_game_type", 6),
          (str_store_string, s0, "str_auto_team_balance_in_20_seconds"),
          (position_set_x, pos1, 375),
        (else_try),
          (str_store_string, s0, "str_auto_team_balance_next_round"),
          (position_set_x, pos1, 375),
        (try_end),
        (create_text_overlay, "$g_multiplayer_message_2", s0, tf_center_justify|tf_with_outline),
        (overlay_set_color, "$g_multiplayer_message_2", ":var0"),
        (position_set_y, pos1, 550),
        (position_set_x, pos1, 500),
        (overlay_set_position, "$g_multiplayer_message_2", pos1),
        (position_set_x, pos1, 2000),
        (position_set_y, pos1, 2000),
        (overlay_set_size, "$g_multiplayer_message_2", pos1),
        (presentation_set_duration, 300),
      (try_end),
    ]),
    (ti_on_presentation_run,
    [
    ]),
  ]),

  ("multiplayer_message_3", prsntf_read_only|prsntf_manual_end_only, mesh_pic_bandits,
  [
    (ti_on_presentation_load,
    [
      (set_fixed_point_multiplier, 1000),
      (try_begin),
        (eq, "$g_multiplayer_message_type", 7),
        (assign, ":var0", 4294967295),
        (try_begin),
          (eq, "$g_multiplayer_message_value_3", 1),
          (str_store_string, s0, "str_poll_result_yes"),
        (else_try),
          (str_store_string, s0, "str_poll_result_no"),
        (try_end),
        (create_text_overlay, "$g_multiplayer_message_3", s0, tf_center_justify|tf_with_outline),
        (overlay_set_color, "$g_multiplayer_message_3", ":var0"),
        (position_set_x, pos1, 380),
        (position_set_x, pos1, 500),
        (position_set_y, pos1, 475),
        (overlay_set_position, "$g_multiplayer_message_3", pos1),
        (position_set_x, pos1, 2000),
        (position_set_y, pos1, 2000),
        (overlay_set_size, "$g_multiplayer_message_3", pos1),
        (presentation_set_duration, 400),
      (try_end),
    ]),
    (ti_on_presentation_run,
    [
    ]),
  ]),

  ("multiplayer_round_time_counter", prsntf_read_only|prsntf_manual_end_only, mesh_pic_bandits,
  [
    (ti_on_presentation_load,
    [
      (set_fixed_point_multiplier, 1000),
      (assign, "$g_multiplayer_last_round_time_counter_value", -1),
      (str_clear, s0),
      (create_text_overlay, "$g_multiplayer_round_time_counter_overlay", s0, tf_left_align|tf_single_line|tf_with_outline),
      (overlay_set_color, "$g_multiplayer_round_time_counter_overlay", 0xFFFFFF),
      (position_set_x, pos1, 900),
      (position_set_y, pos1, 690),
      (overlay_set_position, "$g_multiplayer_round_time_counter_overlay", pos1),
      (position_set_x, pos1, 2000),
      (position_set_y, pos1, 2000),
      (overlay_set_size, "$g_multiplayer_round_time_counter_overlay", pos1),
      (presentation_set_duration, 999999),
    ]),
    (ti_on_presentation_run,
    [
      (store_mission_timer_a, ":var0"),
      (store_sub, ":var1", ":var0", "$g_round_start_time"),
      (store_sub, ":var2", "$g_multiplayer_round_max_seconds", ":var1"),
      (val_max, ":var2", 0),
      (try_begin),
        (neq, "$g_multiplayer_last_round_time_counter_value", ":var2"),
        (assign, "$g_multiplayer_last_round_time_counter_value", ":var2"),
        (store_div, reg0, ":var2", 60),
        (store_div, reg1, ":var2", 10),
        (val_mod, reg1, 6),
        (assign, reg2, ":var2"),
        (val_mod, reg2, 10),
        (str_store_string, s0, "str_reg0_dd_reg1reg2"),
        (overlay_set_text, "$g_multiplayer_round_time_counter_overlay", s0),
      (try_end),
    ]),
  ]),

  ("multiplayer_team_score_display", prsntf_read_only|prsntf_manual_end_only, mesh_pic_bandits,
  [
    (ti_on_presentation_load,
    [
      (set_fixed_point_multiplier, 1000),
      (assign, "$g_multiplayer_team_1_last_displayed_score", -1),
      (assign, "$g_multiplayer_team_2_last_displayed_score", -1),
      (str_clear, s0),
      (create_text_overlay, "$g_multiplayer_team_1_score_display_overlay", s0, tf_left_align|tf_single_line|tf_with_outline),
      (overlay_set_color, "$g_multiplayer_team_1_score_display_overlay", 0xFFFFFF),
      (position_set_x, pos1, 40),
      (position_set_y, pos1, 700),
      (overlay_set_position, "$g_multiplayer_team_1_score_display_overlay", pos1),
      (position_set_x, pos1, 1500),
      (position_set_y, pos1, 1500),
      (overlay_set_size, "$g_multiplayer_team_1_score_display_overlay", pos1),
      (create_text_overlay, "$g_multiplayer_team_2_score_display_overlay", s0, tf_left_align|tf_single_line|tf_with_outline),
      (overlay_set_color, "$g_multiplayer_team_2_score_display_overlay", 0xFFFFFF),
      (position_set_x, pos1, 40),
      (position_set_y, pos1, 645),
      (overlay_set_position, "$g_multiplayer_team_2_score_display_overlay", pos1),
      (position_set_x, pos1, 1500),
      (position_set_y, pos1, 1500),
      (overlay_set_size, "$g_multiplayer_team_2_score_display_overlay", pos1),
      (try_begin),
        (eq, "$g_multiplayer_team_1_faction", "fac_kingdom_4"),
        (create_mesh_overlay, reg0, "mesh_ui_kingdom_shield_1"),
      (else_try),
        (eq, "$g_multiplayer_team_1_faction", "fac_kingdom_2"),
        (create_mesh_overlay, reg0, "mesh_ui_kingdom_shield_2"),
      (else_try),
        (eq, "$g_multiplayer_team_1_faction", "fac_kingdom_3"),
        (create_mesh_overlay, reg0, "mesh_ui_kingdom_shield_3"),
      (else_try),
        (eq, "$g_multiplayer_team_1_faction", "fac_kingdom_5"),
        (create_mesh_overlay, reg0, "mesh_ui_kingdom_shield_4"),
      (else_try),
        (eq, "$g_multiplayer_team_1_faction", "fac_kingdom_6"),
        (create_mesh_overlay, reg0, "mesh_ui_kingdom_shield_5"),
      (else_try),
        (eq, "$g_multiplayer_team_1_faction", "fac_kingdom_1"),
        (create_mesh_overlay, reg0, "mesh_ui_kingdom_shield_6"),
      (try_end),
      (position_set_x, pos3, 25),
      (position_set_y, pos3, 715),
      (overlay_set_position, reg0, pos3),
      (position_set_x, pos1, 50),
      (position_set_y, pos1, 50),
      (overlay_set_size, reg0, pos1),
      (try_begin),
        (eq, "$g_multiplayer_team_1_faction", "$g_multiplayer_team_2_faction"),
        (create_mesh_overlay, reg0, "mesh_ui_kingdom_shield_7"),
      (else_try),
        (eq, "$g_multiplayer_team_2_faction", "fac_kingdom_4"),
        (create_mesh_overlay, reg0, "mesh_ui_kingdom_shield_1"),
      (else_try),
        (eq, "$g_multiplayer_team_2_faction", "fac_kingdom_2"),
        (create_mesh_overlay, reg0, "mesh_ui_kingdom_shield_2"),
      (else_try),
        (eq, "$g_multiplayer_team_2_faction", "fac_kingdom_3"),
        (create_mesh_overlay, reg0, "mesh_ui_kingdom_shield_3"),
      (else_try),
        (eq, "$g_multiplayer_team_2_faction", "fac_kingdom_5"),
        (create_mesh_overlay, reg0, "mesh_ui_kingdom_shield_4"),
      (else_try),
        (eq, "$g_multiplayer_team_2_faction", "fac_kingdom_6"),
        (create_mesh_overlay, reg0, "mesh_ui_kingdom_shield_5"),
      (else_try),
        (eq, "$g_multiplayer_team_2_faction", "fac_kingdom_1"),
        (create_mesh_overlay, reg0, "mesh_ui_kingdom_shield_6"),
      (try_end),
      (position_set_x, pos3, 25),
      (position_set_y, pos3, 660),
      (overlay_set_position, reg0, pos3),
      (position_set_x, pos1, 50),
      (position_set_y, pos1, 50),
      (overlay_set_size, reg0, pos1),
      (presentation_set_duration, 999999),
    ]),
    (ti_on_presentation_run,
    [
      (team_get_score, ":var0", 0),
      (team_get_score, ":var1", 1),
      (try_begin),
        (this_or_next|neq, ":var0", "$g_multiplayer_team_1_last_displayed_score"),
        (neq, ":var1", "$g_multiplayer_team_2_last_displayed_score"),
        (assign, "$g_multiplayer_team_1_last_displayed_score", ":var0"),
        (assign, "$g_multiplayer_team_2_last_displayed_score", ":var1"),
        (str_store_faction_name, s0, "$g_multiplayer_team_1_faction"),
        (assign, reg0, ":var0"),
        (overlay_set_text, "$g_multiplayer_team_1_score_display_overlay", "str_reg0"),
        (str_store_faction_name, s0, "$g_multiplayer_team_2_faction"),
        (assign, reg0, ":var1"),
        (overlay_set_text, "$g_multiplayer_team_2_score_display_overlay", "str_reg0"),
      (try_end),
    ]),
  ]),

  ("multiplayer_flag_projection_display", prsntf_read_only|prsntf_manual_end_only, mesh_pic_bandits,
  [
    (ti_on_presentation_load,
    [
      (set_fixed_point_multiplier, 1000),
      (store_sub, ":var0", "$g_multiplayer_team_1_faction", "fac_kingdom_1"),
      (val_add, ":var0", "mesh_flag_project_sw"),
      (create_mesh_overlay, "$g_presentation_obj_flag_projection_display_1", ":var0"),
      (val_sub, ":var0", "mesh_flag_project_sw"),
      (val_add, ":var0", "mesh_flag_project_sw_miss"),
      (create_mesh_overlay, "$g_presentation_obj_flag_projection_display_2", ":var0"),
      (try_begin),
        (neq, "$g_multiplayer_team_1_faction", "$g_multiplayer_team_2_faction"),
        (store_sub, ":var0", "$g_multiplayer_team_2_faction", "fac_kingdom_1"),
        (val_add, ":var0", "mesh_flag_project_sw"),
        (create_mesh_overlay, "$g_presentation_obj_flag_projection_display_3", ":var0"),
        (val_sub, ":var0", "mesh_flag_project_sw"),
        (val_add, ":var0", "mesh_flag_project_sw_miss"),
        (create_mesh_overlay, "$g_presentation_obj_flag_projection_display_4", ":var0"),
      (else_try),
        (assign, ":var0", "mesh_flag_project_rb"),
        (create_mesh_overlay, "$g_presentation_obj_flag_projection_display_3", ":var0"),
        (assign, ":var0", "mesh_flag_project_rb_miss"),
        (create_mesh_overlay, "$g_presentation_obj_flag_projection_display_4", ":var0"),
      (try_end),
      (position_set_x, pos1, 250),
      (position_set_y, pos1, 250),
      (overlay_set_size, "$g_presentation_obj_flag_projection_display_1", pos1),
      (overlay_set_size, "$g_presentation_obj_flag_projection_display_2", pos1),
      (overlay_set_size, "$g_presentation_obj_flag_projection_display_3", pos1),
      (overlay_set_size, "$g_presentation_obj_flag_projection_display_4", pos1),
      (overlay_set_display, "$g_presentation_obj_flag_projection_display_1", 0),
      (overlay_set_display, "$g_presentation_obj_flag_projection_display_2", 0),
      (overlay_set_display, "$g_presentation_obj_flag_projection_display_3", 0),
      (overlay_set_display, "$g_presentation_obj_flag_projection_display_4", 0),
      (presentation_set_duration, 999999),
    ]),
    (ti_on_presentation_run,
    [
      (set_fixed_point_multiplier, 1000),
      (scene_prop_get_instance, ":var0", "$team_1_flag_scene_prop", 0),
      (team_get_slot, ":var1", 0, 0),
      (try_begin),
        (neq, ":var1", 1),
        (prop_instance_get_position, pos1, ":var0"),
      (else_try),
        (entry_point_get_position, pos1, 64),
      (try_end),
      (position_move_z, pos1, 200, 1),
      (scene_prop_get_instance, ":var2", "$team_2_flag_scene_prop", 0),
      (team_get_slot, ":var3", 1, 0),
      (try_begin),
        (neq, ":var3", 1),
        (prop_instance_get_position, pos2, ":var2"),
      (else_try),
        (entry_point_get_position, pos2, 65),
      (try_end),
      (position_move_z, pos2, 200, 1),
      (position_get_screen_projection, pos3, pos1),
      (position_get_x, ":var4", pos3),
      (position_get_y, ":var5", pos3),
      (position_set_y, pos3, ":var5"),
      (try_begin),
        (is_between, ":var4", -100, 1100),
        (is_between, ":var5", -100, 850),
        (multiplayer_get_my_player, ":var6"),
        (try_begin),
          (ge, ":var6", 0),
          (player_get_team_no, ":var7", ":var6"),
        (else_try),
          (assign, ":var7", 2),
        (try_end),
        (try_begin),
          (neq, ":var7", 1),
          (try_begin),
            (neq, ":var1", 1),
            (overlay_set_position, "$g_presentation_obj_flag_projection_display_1", pos3),
            (overlay_set_display, "$g_presentation_obj_flag_projection_display_1", 1),
            (overlay_set_display, "$g_presentation_obj_flag_projection_display_2", 0),
          (else_try),
            (try_begin),
              (eq, ":var7", 0),
              (assign, ":var8", 64),
            (else_try),
              (assign, ":var8", 65),
            (try_end),
            (entry_point_get_position, pos5, ":var8"),
            (position_get_screen_projection, pos3, pos5),
            (overlay_set_position, "$g_presentation_obj_flag_projection_display_2", pos3),
            (overlay_set_display, "$g_presentation_obj_flag_projection_display_2", 1),
            (overlay_set_display, "$g_presentation_obj_flag_projection_display_1", 0),
          (try_end),
        (else_try),
          (try_begin),
            (neq, ":var1", 1),
            (overlay_set_position, "$g_presentation_obj_flag_projection_display_1", pos3),
            (overlay_set_display, "$g_presentation_obj_flag_projection_display_1", 1),
            (overlay_set_display, "$g_presentation_obj_flag_projection_display_2", 0),
          (try_end),
        (try_end),
      (else_try),
        (overlay_set_display, "$g_presentation_obj_flag_projection_display_1", 0),
        (overlay_set_display, "$g_presentation_obj_flag_projection_display_2", 0),
      (try_end),
      (position_get_screen_projection, pos3, pos2),
      (position_get_x, ":var4", pos3),
      (position_get_y, ":var5", pos3),
      (position_set_y, pos3, ":var5"),
      (try_begin),
        (is_between, ":var4", -100, 1100),
        (is_between, ":var5", -100, 850),
        (team_get_slot, ":var3", 1, 0),
        (multiplayer_get_my_player, ":var6"),
        (try_begin),
          (ge, ":var6", 0),
          (player_get_team_no, ":var7", ":var6"),
        (else_try),
          (assign, ":var7", 2),
        (try_end),
        (try_begin),
          (neq, ":var7", 0),
          (try_begin),
            (neq, ":var3", 1),
            (overlay_set_position, "$g_presentation_obj_flag_projection_display_3", pos3),
            (overlay_set_display, "$g_presentation_obj_flag_projection_display_3", 1),
            (overlay_set_display, "$g_presentation_obj_flag_projection_display_4", 0),
          (else_try),
            (try_begin),
              (eq, ":var7", 0),
              (assign, ":var8", 64),
            (else_try),
              (assign, ":var8", 65),
            (try_end),
            (entry_point_get_position, pos5, ":var8"),
            (position_get_screen_projection, pos3, pos5),
            (overlay_set_position, "$g_presentation_obj_flag_projection_display_4", pos3),
            (overlay_set_display, "$g_presentation_obj_flag_projection_display_4", 1),
            (overlay_set_display, "$g_presentation_obj_flag_projection_display_3", 0),
          (try_end),
        (else_try),
          (try_begin),
            (neq, ":var3", 1),
            (overlay_set_position, "$g_presentation_obj_flag_projection_display_3", pos3),
            (overlay_set_display, "$g_presentation_obj_flag_projection_display_3", 1),
            (overlay_set_display, "$g_presentation_obj_flag_projection_display_4", 0),
          (try_end),
        (try_end),
      (else_try),
        (overlay_set_display, "$g_presentation_obj_flag_projection_display_3", 0),
        (overlay_set_display, "$g_presentation_obj_flag_projection_display_4", 0),
      (try_end),
    ]),
  ]),

  ("multiplayer_flag_projection_display_bt", prsntf_read_only|prsntf_manual_end_only, mesh_pic_bandits,
  [
    (ti_on_presentation_load,
    [
      (set_fixed_point_multiplier, 1000),
      (store_sub, ":var0", "$g_multiplayer_team_1_faction", "fac_kingdom_1"),
      (val_add, ":var0", "mesh_flag_project_sw"),
      (create_mesh_overlay, "$g_presentation_obj_flag_projection_display_1", ":var0"),
      (try_begin),
        (neq, "$g_multiplayer_team_1_faction", "$g_multiplayer_team_2_faction"),
        (store_sub, ":var0", "$g_multiplayer_team_2_faction", "fac_kingdom_1"),
        (val_add, ":var0", "mesh_flag_project_sw"),
      (else_try),
        (assign, ":var0", "mesh_flag_project_rb"),
      (try_end),
      (create_mesh_overlay, "$g_presentation_obj_flag_projection_display_3", ":var0"),
      (position_set_x, pos1, 250),
      (position_set_y, pos1, 250),
      (overlay_set_size, "$g_presentation_obj_flag_projection_display_1", pos1),
      (overlay_set_size, "$g_presentation_obj_flag_projection_display_3", pos1),
      (overlay_set_display, "$g_presentation_obj_flag_projection_display_1", 0),
      (overlay_set_display, "$g_presentation_obj_flag_projection_display_3", 0),
      (presentation_set_duration, 999999),
    ]),
    (ti_on_presentation_run,
    [
      (try_begin),
        (eq, "$g_round_ended", 0),
        (set_fixed_point_multiplier, 1000),
        (scene_prop_get_instance, ":var0", "$team_1_flag_scene_prop", 0),
        (prop_instance_get_position, pos1, ":var0"),
        (position_move_z, pos1, 250, 1),
        (scene_prop_get_instance, ":var1", "$team_2_flag_scene_prop", 0),
        (prop_instance_get_position, pos2, ":var1"),
        (position_move_z, pos2, 250, 1),
        (position_get_screen_projection, pos3, pos1),
        (position_get_x, ":var2", pos3),
        (position_get_y, ":var3", pos3),
        (position_set_y, pos3, ":var3"),
        (try_begin),
          (is_between, ":var2", -100, 1100),
          (is_between, ":var3", -100, 850),
          (overlay_set_position, "$g_presentation_obj_flag_projection_display_1", pos3),
          (overlay_set_display, "$g_presentation_obj_flag_projection_display_1", 1),
        (else_try),
          (overlay_set_display, "$g_presentation_obj_flag_projection_display_1", 0),
        (try_end),
        (position_get_screen_projection, pos3, pos2),
        (position_get_x, ":var2", pos3),
        (position_get_y, ":var3", pos3),
        (position_set_y, pos3, ":var3"),
        (try_begin),
          (is_between, ":var2", -100, 1100),
          (is_between, ":var3", -100, 850),
          (overlay_set_position, "$g_presentation_obj_flag_projection_display_3", pos3),
          (overlay_set_display, "$g_presentation_obj_flag_projection_display_3", 1),
        (else_try),
          (overlay_set_display, "$g_presentation_obj_flag_projection_display_3", 0),
        (try_end),
      (else_try),
        (presentation_set_duration, 0),
      (try_end),
    ]),
  ]),

  ("multiplayer_destructible_targets_display", prsntf_read_only|prsntf_manual_end_only, mesh_pic_bandits,
  [
    (ti_on_presentation_load,
    [
      (set_fixed_point_multiplier, 1000),
      (try_begin),
        (eq, "$g_defender_team", 0),
        (store_sub, ":var0", "$g_multiplayer_team_1_faction", "fac_kingdom_1"),
      (else_try),
        (store_sub, ":var0", "$g_multiplayer_team_2_faction", "fac_kingdom_1"),
      (try_end),
      (val_add, ":var0", "mesh_flag_project_sw"),
      (create_mesh_overlay, "$g_presentation_obj_flag_projection_display_1", ":var0"),
      (create_mesh_overlay, "$g_presentation_obj_flag_projection_display_2", ":var0"),
      (position_set_x, pos1, 250),
      (position_set_y, pos1, 250),
      (overlay_set_size, "$g_presentation_obj_flag_projection_display_1", pos1),
      (overlay_set_size, "$g_presentation_obj_flag_projection_display_2", pos1),
      (overlay_set_display, "$g_presentation_obj_flag_projection_display_1", 0),
      (overlay_set_display, "$g_presentation_obj_flag_projection_display_2", 0),
      (presentation_set_duration, 999999),
    ]),
    (ti_on_presentation_run,
    [
      (try_begin),
        (eq, "$g_round_ended", 0),
        (set_fixed_point_multiplier, 1000),
        (scene_prop_get_instance, ":var0", "$g_destructible_target_1", 0),
        (prop_instance_get_position, pos1, ":var0"),
        (prop_instance_get_position, pos1, ":var0"),
        (position_move_z, pos1, 250, 1),
        (scene_prop_get_instance, ":var1", "$g_destructible_target_2", 0),
        (prop_instance_get_position, pos2, ":var1"),
        (prop_instance_get_position, pos2, ":var1"),
        (position_move_z, pos2, 250, 1),
        (position_get_screen_projection, pos3, pos1),
        (position_get_x, ":var2", pos3),
        (position_get_y, ":var3", pos3),
        (position_set_y, pos3, ":var3"),
        (try_begin),
          (is_between, ":var2", -100, 1100),
          (is_between, ":var3", -100, 850),
          (prop_instance_get_starting_position, pos0, ":var0"),
          (prop_instance_get_position, pos1, ":var0"),
          (get_sq_distance_between_positions_in_meters, ":var4", pos0, pos1),
          (le, ":var4", 2),
          (overlay_set_position, "$g_presentation_obj_flag_projection_display_1", pos3),
          (overlay_set_display, "$g_presentation_obj_flag_projection_display_1", 1),
        (else_try),
          (overlay_set_display, "$g_presentation_obj_flag_projection_display_1", 0),
        (try_end),
        (position_get_screen_projection, pos3, pos2),
        (position_get_x, ":var2", pos3),
        (position_get_y, ":var3", pos3),
        (position_set_y, pos3, ":var3"),
        (try_begin),
          (is_between, ":var2", -100, 1100),
          (is_between, ":var3", -100, 850),
          (prop_instance_get_starting_position, pos0, ":var1"),
          (prop_instance_get_position, pos1, ":var1"),
          (get_sq_distance_between_positions_in_meters, ":var4", pos0, pos1),
          (le, ":var4", 2),
          (overlay_set_position, "$g_presentation_obj_flag_projection_display_2", pos3),
          (overlay_set_display, "$g_presentation_obj_flag_projection_display_2", 1),
        (else_try),
          (overlay_set_display, "$g_presentation_obj_flag_projection_display_2", 0),
        (try_end),
      (else_try),
        (presentation_set_duration, 0),
      (try_end),
    ]),
  ]),

  ("multiplayer_respawn_time_counter", prsntf_read_only|prsntf_manual_end_only, mesh_pic_bandits,
  [
    (ti_on_presentation_load,
    [
      (set_fixed_point_multiplier, 1000),
      (assign, "$g_multiplayer_respawn_counter_overlay", -1),
      (assign, "$g_multiplayer_respawn_remained_overlay", -1),
      (assign, ":var0", 0),
      (try_begin),
        (eq, "$g_multiplayer_message_type", 13),
        (this_or_next|eq, "$g_round_ended", 1),
        (eq, "$g_flag_is_not_ready", 1),
        (assign, ":var0", 1),
      (try_end),
      (eq, ":var0", 0),
      (assign, "$g_multiplayer_last_respawn_counter_value", -1),
      (str_clear, s0),
      (create_text_overlay, "$g_multiplayer_respawn_counter_overlay", s0, tf_center_justify|tf_with_outline),
      (overlay_set_color, "$g_multiplayer_respawn_counter_overlay", 0xFFFFFF),
      (position_set_x, pos1, 500),
      (position_set_y, pos1, 600),
      (overlay_set_position, "$g_multiplayer_respawn_counter_overlay", pos1),
      (position_set_x, pos1, 2000),
      (position_set_y, pos1, 2000),
      (overlay_set_size, "$g_multiplayer_respawn_counter_overlay", pos1),
      (str_clear, s0),
      (create_text_overlay, "$g_multiplayer_respawn_remained_overlay", s0, tf_center_justify|tf_with_outline),
      (overlay_set_color, "$g_multiplayer_respawn_remained_overlay", 0xFFFFFF),
      (position_set_x, pos1, 500),
      (position_set_y, pos1, 570),
      (overlay_set_position, "$g_multiplayer_respawn_remained_overlay", pos1),
      (position_set_x, pos1, 1400),
      (position_set_y, pos1, 1400),
      (overlay_set_size, "$g_multiplayer_respawn_remained_overlay", pos1),
      (presentation_set_duration, 999999),
    ]),
    (ti_on_presentation_run,
    [
      (ge, "$g_multiplayer_respawn_counter_overlay", 0),
      (multiplayer_get_my_player, ":var0"),
      (try_begin),
        (ge, ":var0", 0),
        (player_get_team_no, ":var1", ":var0"),
        (try_begin),
          (eq, ":var1", 2),
          (presentation_set_duration, 0),
        (else_try),
          (store_mission_timer_a, ":var2"),
          (store_sub, ":var3", ":var2", "$g_multiplayer_respawn_start_time"),
          (try_begin),
            (eq, "$g_show_no_more_respawns_remained", 0),
            (assign, ":var4", "$g_multiplayer_respawn_period"),
            (try_begin),
              (eq, "$g_multiplayer_game_type", 6),
              (player_get_team_no, ":var1", ":var0"),
              (eq, ":var1", 0),
              (val_add, ":var4", 27),
            (try_end),
          (else_try),
            (assign, ":var4", 6),
          (try_end),
          (store_sub, ":var5", ":var4", ":var3"),
          (try_begin),
            (le, ":var5", 0),
            (presentation_set_duration, 0),
          (else_try),
            (neq, "$g_multiplayer_last_respawn_counter_value", ":var5"),
            (assign, "$g_multiplayer_last_respawn_counter_value", ":var5"),
            (try_begin),
              (eq, "$g_show_no_more_respawns_remained", 0),
              (assign, reg0, ":var5"),
              (str_store_string, s0, "str_respawning_in_reg0_seconds"),
              (try_begin),
                (gt, "$g_multiplayer_number_of_respawn_count", 0),
                (store_sub, reg0, "$g_multiplayer_number_of_respawn_count", "$g_my_spawn_count"),
                (multiplayer_get_my_player, ":var0"),
                (player_get_team_no, ":var6", ":var0"),
                (eq, ":var6", 0),
                (try_begin),
                  (gt, reg0, 1),
                  (str_store_string, s1, "str_reg0_respawns_remained"),
                (else_try),
                  (str_store_string, s1, "str_this_is_your_last_respawn"),
                (try_end),
              (else_try),
                (str_clear, s1),
              (try_end),
            (else_try),
              (eq, "$g_show_no_more_respawns_remained", 1),
              (str_store_string, s0, "str_no_more_respawns_remained_this_round"),
              (str_clear, s1),
              (str_store_string, s1, "str_wait_next_round"),
            (try_end),
            (overlay_set_text, "$g_multiplayer_respawn_counter_overlay", s0),
            (overlay_set_text, "$g_multiplayer_respawn_remained_overlay", s1),
          (try_end),
        (try_end),
      (else_try),
        (presentation_set_duration, 0),
      (try_end),
      (try_begin),
        (eq, "$g_multiplayer_message_type", 13),
        (this_or_next|eq, "$g_round_ended", 1),
        (eq, "$g_flag_is_not_ready", 1),
        (presentation_set_duration, 0),
      (try_end),
    ]),
  ]),

  ("multiplayer_stats_chart", prsntf_read_only|prsntf_manual_end_only, mesh_pic_bandits,
  [
    (ti_on_presentation_load,
    [
      (set_fixed_point_multiplier, 1000),
      (create_mesh_overlay, reg0, "mesh_mp_score_b"),
      (position_set_x, pos1, 100),
      (position_set_y, pos1, 100),
      (overlay_set_position, reg0, pos1),
      (position_set_x, pos1, 1000),
      (position_set_y, pos1, 1000),
      (overlay_set_size, reg0, pos1),
      (assign, ":var0", 0),
      (assign, ":var1", 0),
      (assign, ":var2", 0),
      (get_max_players, ":var3"),
      (try_for_range, ":var4", 0, ":var3"),
        (store_add, ":var5", ":var4", 211),
        (try_begin),
          (player_is_active, ":var4"),
          (troop_set_slot, "trp_multiplayer_data", ":var5", 1),
          (player_get_team_no, ":var6", ":var4"),
          (try_begin),
            (eq, ":var6", 0),
            (val_add, ":var0", 1),
          (else_try),
            (eq, ":var6", 1),
            (val_add, ":var1", 1),
          (else_try),
            (eq, ":var6", 2),
            (val_add, ":var2", 1),
          (try_end),
        (else_try),
          (troop_set_slot, "trp_multiplayer_data", ":var5", 0),
        (try_end),
      (try_end),
      (try_begin),
        (gt, "$g_multiplayer_num_bots_team_1", 0),
        (val_add, ":var0", 1),
      (try_end),
      (try_begin),
        (gt, "$g_multiplayer_num_bots_team_2", 0),
        (val_add, ":var1", 1),
      (try_end),
      (assign, ":var7", ":var0"),
      (val_max, ":var7", ":var1"),
      (val_add, ":var7", ":var2"),
      (str_clear, s0),
      (create_text_overlay, "$g_presentation_obj_stats_chart_container", s0, tf_scrollable_style_2),
      (position_set_x, pos1, 100),
      (position_set_y, pos1, 120),
      (overlay_set_position, "$g_presentation_obj_stats_chart_container", pos1),
      (position_set_x, pos1, 746),
      (position_set_y, pos1, 530),
      (overlay_set_area_size, "$g_presentation_obj_stats_chart_container", pos1),
      (set_container_overlay, "$g_presentation_obj_stats_chart_container"),
      (store_mul, ":var8", ":var7", 20),
      (val_add, ":var8", 100),
      (try_begin),
        (gt, ":var2", 0),
        (val_add, ":var8", 70),
      (try_end),
      (multiplayer_get_my_player, ":var9"),
      (try_begin),
        (gt, ":var8", 490),
        (assign, "$g_stats_chart_update_period", 8),
      (else_try),
        (assign, "$g_stats_chart_update_period", 1),
      (try_end),
      (try_begin),
        (eq, "$g_multiplayer_game_type", 5),
        (call_script, "script_get_headquarters_scores"),
        (assign, ":var10", reg0),
        (assign, ":var11", reg1),
      (try_end),
      (try_for_range, ":var12", 0, 2),
        (assign, ":var13", 0),
        (get_max_players, ":var3"),
        (try_for_range, ":var4", 0, ":var3"),
          (player_is_active, ":var4"),
          (player_get_team_no, ":var14", ":var4"),
          (eq, ":var14", ":var12"),
          (val_add, ":var13", 1),
        (try_end),
        (assign, reg0, ":var13"),
        (try_begin),
          (neq, ":var13", 1),
          (create_text_overlay, reg1, "str_reg0_players", 0),
        (else_try),
          (create_text_overlay, reg1, "str_reg0_player", 0),
        (try_end),
        (assign, ":var15", ":var8"),
        (team_get_faction, ":var16", ":var12"),
        (str_store_faction_name, s1, ":var16"),
        (create_text_overlay, reg0, s1, 0),
        (try_begin),
          (eq, ":var12", 0),
          (overlay_set_color, reg0, 0xFF0000),
          (overlay_set_color, reg1, 0xFF0000),
        (else_try),
          (overlay_set_color, reg0, 0x0099FF),
          (overlay_set_color, reg1, 0x0099FF),
        (try_end),
        (assign, ":var17", 373),
        (store_mul, ":var18", ":var17", ":var12"),
        (val_add, ":var18", 42),
        (store_add, ":var19", ":var18", 15),
        (position_set_x, pos3, ":var19"),
        (position_set_y, pos3, ":var15"),
        (store_add, ":var20", ":var18", 35),
        (position_set_x, pos1, ":var20"),
        (position_set_y, pos1, ":var15"),
        (copy_position, 2, 1),
        (store_sub, ":var21", ":var15", 10),
        (position_set_x, pos2, ":var20"),
        (position_set_y, pos2, ":var21"),
        (overlay_set_position, reg0, pos1),
        (overlay_set_position, reg1, pos2),
        (position_set_x, pos1, 1000),
        (position_set_y, pos1, 1000),
        (position_set_x, pos2, 600),
        (position_set_y, pos2, 600),
        (overlay_set_size, reg0, pos1),
        (overlay_set_size, reg1, pos2),
        (team_get_faction, ":var22", 0),
        (team_get_faction, ":var23", 1),
        (try_begin),
          (eq, ":var22", ":var23"),
          (eq, ":var12", 1),
          (create_mesh_overlay, reg0, "mesh_ui_kingdom_shield_7"),
        (else_try),
          (eq, ":var16", "fac_kingdom_4"),
          (create_mesh_overlay, reg0, "mesh_ui_kingdom_shield_1"),
        (else_try),
          (eq, ":var16", "fac_kingdom_2"),
          (create_mesh_overlay, reg0, "mesh_ui_kingdom_shield_2"),
        (else_try),
          (eq, ":var16", "fac_kingdom_3"),
          (create_mesh_overlay, reg0, "mesh_ui_kingdom_shield_3"),
        (else_try),
          (eq, ":var16", "fac_kingdom_5"),
          (create_mesh_overlay, reg0, "mesh_ui_kingdom_shield_4"),
        (else_try),
          (eq, ":var16", "fac_kingdom_6"),
          (create_mesh_overlay, reg0, "mesh_ui_kingdom_shield_5"),
        (else_try),
          (eq, ":var16", "fac_kingdom_1"),
          (create_mesh_overlay, reg0, "mesh_ui_kingdom_shield_6"),
        (try_end),
        (position_set_x, pos1, 100),
        (position_set_y, pos1, 100),
        (overlay_set_position, reg0, pos3),
        (position_set_x, pos1, 50),
        (position_set_y, pos1, 50),
        (overlay_set_size, reg0, pos1),
        (team_get_score, reg0, ":var12"),
        (create_text_overlay, reg0, "str_score_reg0", tf_right_align),
        (overlay_set_color, reg0, 0xFFFFFF),
        (store_add, ":var24", ":var18", 325),
        (store_add, ":var25", ":var15", 0),
        (position_set_x, pos1, ":var24"),
        (position_set_y, pos1, ":var25"),
        (overlay_set_position, reg0, pos1),
        (position_set_x, pos1, 1200),
        (position_set_y, pos1, 1200),
        (overlay_set_size, reg0, pos1),
        (try_begin),
          (eq, "$g_multiplayer_game_type", 5),
          (try_begin),
            (eq, ":var12", 0),
            (assign, reg0, ":var10"),
          (else_try),
            (eq, ":var12", 1),
            (assign, reg0, ":var11"),
          (try_end),
          (create_text_overlay, reg0, "str_flags_reg0", 0),
          (overlay_set_color, reg0, 0xFFFFFF),
          (store_add, ":var24", ":var18", 258),
          (store_add, ":var25", ":var15", -10),
          (position_set_x, pos1, ":var24"),
          (position_set_y, pos1, ":var25"),
          (overlay_set_position, reg0, pos1),
          (position_set_x, pos1, 600),
          (position_set_y, pos1, 600),
          (overlay_set_size, reg0, pos1),
        (try_end),
        (val_sub, ":var15", 60),
        (create_text_overlay, reg0, "str_player_name", 0),
        (overlay_set_color, reg0, 0xFFFFFF),
        (position_set_x, pos1, ":var18"),
        (position_set_y, pos1, ":var15"),
        (overlay_set_position, reg0, pos1),
        (position_set_x, pos1, 750),
        (position_set_y, pos1, 750),
        (overlay_set_size, reg0, pos1),
        (try_begin),
          (this_or_next|eq, "$g_multiplayer_game_type", 4),
          (eq, "$g_multiplayer_game_type", 5),
          (create_text_overlay, reg0, "str_score", 0),
          (overlay_set_color, reg0, 0xFFFFFF),
          (store_add, ":var24", ":var18", 138),
          (position_set_x, pos1, ":var24"),
          (position_set_y, pos1, ":var15"),
          (overlay_set_position, reg0, pos1),
          (position_set_x, pos1, 750),
          (position_set_y, pos1, 750),
          (overlay_set_size, reg0, pos1),
        (try_end),
        (create_text_overlay, reg0, "str_kills", tf_center_justify),
        (overlay_set_color, reg0, 0xFFFFFF),
        (store_add, ":var24", ":var18", 206),
        (position_set_x, pos1, ":var24"),
        (position_set_y, pos1, ":var15"),
        (overlay_set_position, reg0, pos1),
        (position_set_x, pos1, 750),
        (position_set_y, pos1, 750),
        (overlay_set_size, reg0, pos1),
        (create_text_overlay, reg0, "str_deaths", tf_center_justify),
        (overlay_set_color, reg0, 0xFFFFFF),
        (store_add, ":var24", ":var18", 260),
        (position_set_x, pos1, ":var24"),
        (position_set_y, pos1, ":var15"),
        (overlay_set_position, reg0, pos1),
        (position_set_x, pos1, 750),
        (position_set_y, pos1, 750),
        (overlay_set_size, reg0, pos1),
        (create_text_overlay, reg0, "str_ping", tf_center_justify),
        (overlay_set_color, reg0, 0xFFFFFF),
        (store_add, ":var24", ":var18", 308),
        (position_set_x, pos1, ":var24"),
        (position_set_y, pos1, ":var15"),
        (overlay_set_position, reg0, pos1),
        (position_set_x, pos1, 750),
        (position_set_y, pos1, 750),
        (overlay_set_size, reg0, pos1),
        (create_mesh_overlay, reg0, "mesh_white_plane"),
        (overlay_set_color, reg0, 0xFFFFFF),
        (overlay_set_alpha, reg0, 0xD0),
        (store_add, ":var24", ":var18", 0),
        (position_set_x, pos1, ":var24"),
        (store_add, ":var25", ":var15", -10),
        (position_set_y, pos1, ":var25"),
        (overlay_set_position, reg0, pos1),
        (position_set_x, pos1, 16500),
        (position_set_y, pos1, 50),
        (overlay_set_size, reg0, pos1),
        (val_sub, ":var15", 35),
        (store_add, ":var26", ":var3", 1),
        (try_for_range, ":var27", 0, ":var26"),
          (assign, ":var28", -30030),
          (assign, ":var29", -1),
          (try_for_range, ":var4", 0, ":var3"),
            (store_add, ":var5", ":var4", 211),
            (troop_slot_eq, "trp_multiplayer_data", ":var5", 1),
            (player_get_team_no, ":var6", ":var4"),
            (eq, ":var6", ":var12"),
            (try_begin),
              (this_or_next|eq, "$g_multiplayer_game_type", 4),
              (eq, "$g_multiplayer_game_type", 5),
              (player_get_score, ":var30", ":var4"),
            (else_try),
              (player_get_kill_count, ":var30", ":var4"),
            (try_end),
            (player_get_death_count, ":var31", ":var4"),
            (store_mul, ":var32", ":var30", 1000),
            (val_sub, ":var32", ":var31"),
            (this_or_next|gt, ":var32", ":var28"),
            (eq, ":var32", -30030),
            (assign, ":var28", ":var32"),
            (assign, ":var29", ":var4"),
          (try_end),
          (try_begin),
            (ge, ":var29", 0),
            (store_add, ":var5", ":var29", 211),
            (troop_set_slot, "trp_multiplayer_data", ":var5", 0),
            (try_begin),
              (eq, ":var9", ":var29"),
              (create_mesh_overlay, reg0, "mesh_white_plane"),
              (overlay_set_color, reg0, 0xFFFFFF),
              (overlay_set_alpha, reg0, 0x35),
              (store_add, ":var24", ":var18", 0),
              (position_set_x, pos1, ":var24"),
              (store_add, ":var25", ":var15", 0),
              (position_set_y, pos1, ":var25"),
              (overlay_set_position, reg0, pos1),
              (position_set_x, pos1, 16500),
              (position_set_y, pos1, 1000),
              (overlay_set_size, reg0, pos1),
            (try_end),
            (try_begin),
              (this_or_next|eq, "$g_multiplayer_game_type", 4),
              (eq, "$g_multiplayer_game_type", 5),
              (assign, ":var33", 16777215),
              (player_get_agent_id, ":var34", ":var29"),
              (try_begin),
                (this_or_next|lt, ":var34", 0),
                (neg|agent_is_alive, ":var34"),
                (assign, ":var33", 16711680),
              (try_end),
              (player_get_score, reg0, ":var29"),
              (create_text_overlay, reg0, "str_reg0", tf_right_align),
              (overlay_set_color, reg0, ":var33"),
              (position_set_x, pos1, 750),
              (position_set_y, pos1, 750),
              (overlay_set_size, reg0, pos1),
              (store_add, ":var24", ":var18", 165),
              (position_set_x, pos1, ":var24"),
              (position_set_y, pos1, ":var15"),
              (overlay_set_position, reg0, pos1),
            (else_try),
              (assign, ":var33", 16777215),
              (player_get_agent_id, ":var34", ":var29"),
              (try_begin),
                (this_or_next|lt, ":var34", 0),
                (neg|agent_is_alive, ":var34"),
                (assign, ":var33", 16711680),
                (create_text_overlay, reg0, "str_dead", 0),
                (overlay_set_color, reg0, ":var33"),
                (position_set_x, pos1, 750),
                (position_set_y, pos1, 750),
                (overlay_set_size, reg0, pos1),
                (store_add, ":var24", ":var18", 130),
                (position_set_x, pos1, ":var24"),
                (position_set_y, pos1, ":var15"),
                (overlay_set_position, reg0, pos1),
              (try_end),
            (try_end),
            (str_store_player_username, s1, ":var29"),
            (create_text_overlay, reg0, s1, 0),
            (overlay_set_color, reg0, ":var33"),
            (position_set_x, pos1, 750),
            (position_set_y, pos1, 750),
            (overlay_set_size, reg0, pos1),
            (position_set_x, pos1, ":var18"),
            (position_set_y, pos1, ":var15"),
            (overlay_set_position, reg0, pos1),
            (player_get_kill_count, reg0, ":var29"),
            (create_text_overlay, reg0, "str_reg0", tf_right_align),
            (overlay_set_color, reg0, ":var33"),
            (position_set_x, pos1, 750),
            (position_set_y, pos1, 750),
            (overlay_set_size, reg0, pos1),
            (store_add, ":var24", ":var18", 215),
            (position_set_x, pos1, ":var24"),
            (position_set_y, pos1, ":var15"),
            (overlay_set_position, reg0, pos1),
            (player_get_death_count, reg0, ":var29"),
            (create_text_overlay, reg0, "str_reg0", tf_right_align),
            (overlay_set_color, reg0, ":var33"),
            (position_set_x, pos1, 750),
            (position_set_y, pos1, 750),
            (overlay_set_size, reg0, pos1),
            (store_add, ":var24", ":var18", 265),
            (position_set_x, pos1, ":var24"),
            (position_set_y, pos1, ":var15"),
            (overlay_set_position, reg0, pos1),
            (player_get_ping, reg0, ":var29"),
            (create_text_overlay, reg0, "str_reg0", tf_right_align),
            (overlay_set_color, reg0, ":var33"),
            (position_set_x, pos1, 750),
            (position_set_y, pos1, 750),
            (overlay_set_size, reg0, pos1),
            (store_add, ":var24", ":var18", 315),
            (position_set_x, pos1, ":var24"),
            (position_set_y, pos1, ":var15"),
            (overlay_set_position, reg0, pos1),
            (val_sub, ":var15", 20),
          (else_try),
            (try_begin),
              (try_begin),
                (eq, ":var12", 0),
                (assign, ":var35", "$g_multiplayer_num_bots_team_1"),
              (else_try),
                (assign, ":var35", "$g_multiplayer_num_bots_team_2"),
              (try_end),
              (team_get_bot_kill_count, reg0, ":var12"),
              (team_get_bot_death_count, reg1, ":var12"),
              (try_begin),
                (this_or_next|neq, reg0, 0),
                (this_or_next|neq, reg1, 0),
                (neq, ":var35", 0),
                (assign, ":var36", 1),
              (else_try),
                (assign, ":var36", 0),
              (try_end),
              (eq, ":var36", 1),
              (assign, ":var37", 0),
              (try_for_agents, ":var38"),
                (agent_is_non_player, ":var38"),
                (agent_is_alive, ":var38"),
                (agent_get_team, ":var39", ":var38"),
                (eq, ":var39", ":var12"),
                (val_add, ":var37", 1),
              (try_end),
              (store_sub, ":var40", ":var35", ":var37"),
              (try_begin),
                (eq, ":var37", 0),
                (assign, ":var33", 16711680),
              (else_try),
                (assign, ":var33", 13684944),
              (try_end),
              (try_begin),
                (gt, ":var40", 0),
                (try_begin),
                  (eq, ":var35", 1),
                  (create_text_overlay, reg0, "str_dead", 0),
                  (store_add, ":var24", ":var18", 130),
                (else_try),
                  (assign, reg0, ":var40"),
                  (create_text_overlay, reg0, "str_reg0_dead", 0),
                  (store_add, ":var24", ":var18", 123),
                (try_end),
                (overlay_set_color, reg0, ":var33"),
                (position_set_x, pos1, 750),
                (position_set_y, pos1, 750),
                (overlay_set_size, reg0, pos1),
                (position_set_x, pos1, ":var24"),
                (position_set_y, pos1, ":var15"),
                (overlay_set_position, reg0, pos1),
              (try_end),
              (try_begin),
                (gt, ":var35", 1),
                (assign, reg0, ":var35"),
                (create_text_overlay, reg0, "str_bots_reg0_agents", 0),
              (else_try),
                (create_text_overlay, reg0, "str_bot_1_agent", 0),
              (try_end),
              (overlay_set_color, reg0, ":var33"),
              (position_set_x, pos1, 750),
              (position_set_y, pos1, 750),
              (overlay_set_size, reg0, pos1),
              (position_set_x, pos1, ":var18"),
              (position_set_y, pos1, ":var15"),
              (overlay_set_position, reg0, pos1),
              (team_get_bot_kill_count, reg0, ":var12"),
              (create_text_overlay, reg0, "str_reg0", tf_right_align),
              (overlay_set_color, reg0, ":var33"),
              (position_set_x, pos1, 750),
              (position_set_y, pos1, 750),
              (overlay_set_size, reg0, pos1),
              (store_add, ":var24", ":var18", 215),
              (position_set_x, pos1, ":var24"),
              (position_set_y, pos1, ":var15"),
              (overlay_set_position, reg0, pos1),
              (team_get_bot_death_count, reg0, ":var12"),
              (create_text_overlay, reg0, "str_reg0", tf_right_align),
              (overlay_set_color, reg0, ":var33"),
              (position_set_x, pos1, 750),
              (position_set_y, pos1, 750),
              (overlay_set_size, reg0, pos1),
              (store_add, ":var24", ":var18", 265),
              (position_set_x, pos1, ":var24"),
              (position_set_y, pos1, ":var15"),
              (overlay_set_position, reg0, pos1),
              (val_sub, ":var15", 20),
            (try_end),
            (assign, ":var26", 0),
          (try_end),
        (try_end),
        (try_begin),
          (eq, ":var12", 0),
          (assign, ":var41", ":var15"),
        (try_end),
      (try_end),
      (try_begin),
        (le, ":var41", ":var15"),
        (assign, ":var15", ":var41"),
      (try_end),
      (assign, ":var18", 42),
      (create_mesh_overlay, reg0, "mesh_white_plane"),
      (overlay_set_color, reg0, 0xFFFFFF),
      (overlay_set_alpha, reg0, 0xD0),
      (store_add, ":var24", ":var18", 0),
      (position_set_x, pos1, ":var24"),
      (store_add, ":var25", ":var15", 10),
      (position_set_y, pos1, ":var25"),
      (overlay_set_position, reg0, pos1),
      (position_set_x, pos1, 36000),
      (position_set_y, pos1, 50),
      (overlay_set_size, reg0, pos1),
      (try_begin),
        (gt, ":var2", 0),
        (assign, ":var18", 280),
        (val_sub, ":var15", 50),
        (create_text_overlay, reg0, "str_spectators", 0),
        (overlay_set_color, reg0, 0xFFFFFF),
        (position_set_x, pos1, ":var18"),
        (position_set_y, pos1, ":var15"),
        (overlay_set_position, reg0, pos1),
        (position_set_x, pos1, 1000),
        (position_set_y, pos1, 1000),
        (overlay_set_size, reg0, pos1),
        (create_text_overlay, reg0, "str_ping", tf_right_align),
        (overlay_set_color, reg0, 0xFFFFFF),
        (store_add, ":var24", ":var18", 215),
        (position_set_x, pos1, ":var24"),
        (position_set_y, pos1, ":var15"),
        (overlay_set_position, reg0, pos1),
        (position_set_x, pos1, 750),
        (position_set_y, pos1, 750),
        (overlay_set_size, reg0, pos1),
        (create_mesh_overlay, reg0, "mesh_white_plane"),
        (overlay_set_color, reg0, 0xFFFFFF),
        (overlay_set_alpha, reg0, 0xD0),
        (store_add, ":var24", ":var18", 0),
        (position_set_x, pos1, ":var24"),
        (store_add, ":var25", ":var15", -10),
        (position_set_y, pos1, ":var25"),
        (overlay_set_position, reg0, pos1),
        (position_set_x, pos1, 12000),
        (position_set_y, pos1, 50),
        (overlay_set_size, reg0, pos1),
        (val_sub, ":var15", 30),
        (assign, ":var33", 12632256),
        (store_add, ":var26", ":var3", 1),
        (try_for_range, ":var4", 0, ":var26"),
          (store_add, ":var5", ":var4", 211),
          (troop_slot_eq, "trp_multiplayer_data", ":var5", 1),
          (player_get_team_no, ":var6", ":var4"),
          (eq, ":var6", 2),
          (troop_set_slot, "trp_multiplayer_data", ":var5", 1),
          (try_begin),
            (eq, ":var9", ":var4"),
            (create_mesh_overlay, reg0, "mesh_white_plane"),
            (overlay_set_color, reg0, 0xFFFFFF),
            (overlay_set_alpha, reg0, 0x35),
            (store_add, ":var24", ":var18", 0),
            (position_set_x, pos1, ":var24"),
            (store_add, ":var25", ":var15", 0),
            (position_set_y, pos1, ":var25"),
            (overlay_set_position, reg0, pos1),
            (position_set_x, pos1, 12000),
            (position_set_y, pos1, 1000),
            (overlay_set_size, reg0, pos1),
          (try_end),
          (str_store_player_username, s1, ":var4"),
          (create_text_overlay, reg0, s1, 0),
          (overlay_set_color, reg0, ":var33"),
          (position_set_x, pos1, 750),
          (position_set_y, pos1, 750),
          (overlay_set_size, reg0, pos1),
          (position_set_x, pos1, ":var18"),
          (position_set_y, pos1, ":var15"),
          (overlay_set_position, reg0, pos1),
          (player_get_ping, reg0, ":var4"),
          (create_text_overlay, reg0, "str_reg0", tf_right_align),
          (overlay_set_color, reg0, ":var33"),
          (position_set_x, pos1, 750),
          (position_set_y, pos1, 750),
          (overlay_set_size, reg0, pos1),
          (store_add, ":var24", ":var18", 215),
          (position_set_x, pos1, ":var24"),
          (position_set_y, pos1, ":var15"),
          (overlay_set_position, reg0, pos1),
          (val_sub, ":var15", 20),
        (try_end),
      (try_end),
      (omit_key_once, key_mouse_scroll_up),
      (omit_key_once, key_mouse_scroll_down),
      (presentation_set_duration, 999999),
    ]),
    (ti_on_presentation_run,
    [
      (store_trigger_param_1, ":var0"),
      (try_begin),
        (this_or_next|key_clicked, key_mouse_scroll_up),
        (key_clicked, key_mouse_scroll_down),
        (omit_key_once, key_mouse_scroll_up),
        (omit_key_once, key_mouse_scroll_down),
      (try_end),
      (try_begin),
        (eq, "$g_multiplayer_stats_chart_opened_manually", 1),
        (neg|game_key_is_down, gk_leave),
        (assign, "$g_multiplayer_stats_chart_opened_manually", 0),
        (clear_omitted_keys),
        (presentation_set_duration, 0),
      (try_end),
      (try_begin),
        (store_mul, ":var1", "$g_stats_chart_update_period", 1000),
        (gt, ":var0", ":var1"),
        (clear_omitted_keys),
        (presentation_set_duration, 0),
        (start_presentation, "prsnt_multiplayer_stats_chart"),
      (try_end),
    ]),
  ]),

  ("multiplayer_stats_chart_deathmatch", prsntf_read_only|prsntf_manual_end_only, mesh_pic_bandits,
  [
    (ti_on_presentation_load,
    [
      (set_fixed_point_multiplier, 1000),
      (create_mesh_overlay, reg0, "mesh_mp_score_a"),
      (position_set_x, pos1, 295),
      (position_set_y, pos1, 115),
      (overlay_set_position, reg0, pos1),
      (position_set_x, pos1, 1000),
      (position_set_y, pos1, 1000),
      (overlay_set_size, reg0, pos1),
      (assign, ":var0", 0),
      (assign, ":var1", 0),
      (get_max_players, ":var2"),
      (try_for_range, ":var3", 0, ":var2"),
        (store_add, ":var4", ":var3", 211),
        (try_begin),
          (player_is_active, ":var3"),
          (troop_set_slot, "trp_multiplayer_data", ":var4", 1),
          (player_get_team_no, ":var5", ":var3"),
          (try_begin),
            (this_or_next|eq, ":var5", 0),
            (eq, ":var5", 1),
            (val_add, ":var0", 1),
          (else_try),
            (eq, ":var5", 2),
            (val_add, ":var1", 1),
          (try_end),
        (else_try),
          (troop_set_slot, "trp_multiplayer_data", ":var4", 0),
        (try_end),
      (try_end),
      (try_begin),
        (this_or_next|gt, "$g_multiplayer_num_bots_team_1", 0),
        (gt, "$g_multiplayer_num_bots_team_2", 0),
        (val_add, ":var0", 1),
      (try_end),
      (store_add, ":var6", ":var0", ":var1"),
      (str_clear, s0),
      (create_text_overlay, "$g_presentation_obj_stats_chart_deathmatch_container", s0, tf_scrollable_style_2),
      (position_set_x, pos1, 300),
      (position_set_y, pos1, 140),
      (overlay_set_position, "$g_presentation_obj_stats_chart_deathmatch_container", pos1),
      (position_set_x, pos1, 346),
      (position_set_y, pos1, 530),
      (overlay_set_area_size, "$g_presentation_obj_stats_chart_deathmatch_container", pos1),
      (set_container_overlay, "$g_presentation_obj_stats_chart_deathmatch_container"),
      (store_mul, ":var7", ":var6", 20),
      (val_add, ":var7", 80),
      (try_begin),
        (gt, ":var1", 0),
        (val_add, ":var7", 70),
      (try_end),
      (try_begin),
        (ge, ":var6", 17),
        (assign, "$g_stats_chart_update_period", 10),
      (else_try),
        (assign, "$g_stats_chart_update_period", 1),
      (try_end),
      (multiplayer_get_my_player, ":var8"),
      (assign, ":var9", ":var7"),
      (assign, ":var10", 42),
      (create_text_overlay, reg0, "str_player_name", 0),
      (overlay_set_color, reg0, 0xFFFFFF),
      (position_set_x, pos1, ":var10"),
      (position_set_y, pos1, ":var9"),
      (overlay_set_position, reg0, pos1),
      (position_set_x, pos1, 750),
      (position_set_y, pos1, 750),
      (overlay_set_size, reg0, pos1),
      (create_text_overlay, reg0, "str_kills", tf_center_justify),
      (overlay_set_color, reg0, 0xFFFFFF),
      (store_add, ":var11", ":var10", 179),
      (position_set_x, pos1, ":var11"),
      (position_set_y, pos1, ":var9"),
      (overlay_set_position, reg0, pos1),
      (position_set_x, pos1, 750),
      (position_set_y, pos1, 750),
      (overlay_set_size, reg0, pos1),
      (create_text_overlay, reg0, "str_deaths", tf_center_justify),
      (overlay_set_color, reg0, 0xFFFFFF),
      (store_add, ":var11", ":var10", 233),
      (position_set_x, pos1, ":var11"),
      (position_set_y, pos1, ":var9"),
      (overlay_set_position, reg0, pos1),
      (position_set_x, pos1, 750),
      (position_set_y, pos1, 750),
      (overlay_set_size, reg0, pos1),
      (create_text_overlay, reg0, "str_ping", tf_center_justify),
      (overlay_set_color, reg0, 0xFFFFFF),
      (store_add, ":var11", ":var10", 282),
      (position_set_x, pos1, ":var11"),
      (position_set_y, pos1, ":var9"),
      (overlay_set_position, reg0, pos1),
      (position_set_x, pos1, 750),
      (position_set_y, pos1, 750),
      (overlay_set_size, reg0, pos1),
      (create_mesh_overlay, reg0, "mesh_white_plane"),
      (overlay_set_color, reg0, 0xFFFFFF),
      (overlay_set_alpha, reg0, 0xD0),
      (store_add, ":var11", ":var10", 0),
      (position_set_x, pos1, ":var11"),
      (store_add, ":var12", ":var9", -10),
      (position_set_y, pos1, ":var12"),
      (overlay_set_position, reg0, pos1),
      (position_set_x, pos1, 15250),
      (position_set_y, pos1, 50),
      (overlay_set_size, reg0, pos1),
      (val_sub, ":var9", 35),
      (store_add, ":var13", ":var2", 1),
      (try_for_range, ":var14", 0, ":var13"),
        (assign, ":var15", -30030),
        (assign, ":var16", -1),
        (try_for_range, ":var3", 0, ":var2"),
          (store_add, ":var4", ":var3", 211),
          (troop_slot_eq, "trp_multiplayer_data", ":var4", 1),
          (player_get_team_no, ":var5", ":var3"),
          (this_or_next|eq, ":var5", 0),
          (eq, ":var5", 1),
          (player_get_kill_count, ":var17", ":var3"),
          (player_get_death_count, ":var18", ":var3"),
          (store_mul, ":var19", ":var17", 1000),
          (val_sub, ":var19", ":var18"),
          (this_or_next|gt, ":var19", ":var15"),
          (eq, ":var19", -30030),
          (assign, ":var15", ":var19"),
          (assign, ":var16", ":var3"),
        (try_end),
        (try_begin),
          (ge, ":var16", 0),
          (store_add, ":var4", ":var16", 211),
          (troop_set_slot, "trp_multiplayer_data", ":var4", 0),
          (str_store_player_username, s1, ":var16"),
          (try_begin),
            (eq, ":var8", ":var16"),
            (create_mesh_overlay, reg0, "mesh_white_plane"),
            (overlay_set_color, reg0, 0xFFFFFF),
            (overlay_set_alpha, reg0, 0x35),
            (store_add, ":var11", ":var10", 0),
            (position_set_x, pos1, ":var11"),
            (store_add, ":var12", ":var9", 0),
            (position_set_y, pos1, ":var12"),
            (overlay_set_position, reg0, pos1),
            (position_set_x, pos1, 16000),
            (position_set_y, pos1, 1000),
            (overlay_set_size, reg0, pos1),
          (try_end),
          (create_text_overlay, reg0, s1, 0),
          (overlay_set_color, reg0, 0xFFFFFF),
          (position_set_x, pos1, 750),
          (position_set_y, pos1, 750),
          (overlay_set_size, reg0, pos1),
          (position_set_x, pos1, ":var10"),
          (position_set_y, pos1, ":var9"),
          (overlay_set_position, reg0, pos1),
          (player_get_kill_count, reg0, ":var16"),
          (create_text_overlay, reg0, "str_reg0", tf_right_align),
          (overlay_set_color, reg0, 0xFFFFFF),
          (position_set_x, pos1, 750),
          (position_set_y, pos1, 750),
          (overlay_set_size, reg0, pos1),
          (store_add, ":var11", ":var10", 188),
          (position_set_x, pos1, ":var11"),
          (position_set_y, pos1, ":var9"),
          (overlay_set_position, reg0, pos1),
          (player_get_death_count, reg0, ":var16"),
          (create_text_overlay, reg0, "str_reg0", tf_right_align),
          (overlay_set_color, reg0, 0xFFFFFF),
          (position_set_x, pos1, 750),
          (position_set_y, pos1, 750),
          (overlay_set_size, reg0, pos1),
          (store_add, ":var11", ":var10", 238),
          (position_set_x, pos1, ":var11"),
          (position_set_y, pos1, ":var9"),
          (overlay_set_position, reg0, pos1),
          (player_get_ping, reg0, ":var16"),
          (create_text_overlay, reg0, "str_reg0", tf_right_align),
          (overlay_set_color, reg0, 0xFFFFFF),
          (position_set_x, pos1, 750),
          (position_set_y, pos1, 750),
          (overlay_set_size, reg0, pos1),
          (store_add, ":var11", ":var10", 288),
          (position_set_x, pos1, ":var11"),
          (position_set_y, pos1, ":var9"),
          (overlay_set_position, reg0, pos1),
          (val_sub, ":var9", 20),
        (else_try),
          (store_add, ":var20", "$g_multiplayer_num_bots_team_1", "$g_multiplayer_num_bots_team_2"),
          (ge, ":var20", 1),
          (try_begin),
            (gt, ":var20", 1),
            (assign, reg0, ":var20"),
            (create_text_overlay, reg0, "str_bots_reg0_agents", 0),
          (else_try),
            (create_text_overlay, reg0, "str_bot_1_agent", 0),
          (try_end),
          (overlay_set_color, reg0, 0xD0D0D0),
          (position_set_x, pos1, 750),
          (position_set_y, pos1, 750),
          (overlay_set_size, reg0, pos1),
          (position_set_x, pos1, ":var10"),
          (position_set_y, pos1, ":var9"),
          (overlay_set_position, reg0, pos1),
          (team_get_bot_kill_count, reg0, 0),
          (assign, ":var21", reg0),
          (team_get_bot_kill_count, reg0, 1),
          (val_add, ":var21", reg0),
          (assign, reg0, ":var21"),
          (create_text_overlay, reg0, "str_reg0", tf_right_align),
          (overlay_set_color, reg0, 0xD0D0D0),
          (position_set_x, pos1, 750),
          (position_set_y, pos1, 750),
          (overlay_set_size, reg0, pos1),
          (store_add, ":var11", ":var10", 188),
          (position_set_x, pos1, ":var11"),
          (position_set_y, pos1, ":var9"),
          (overlay_set_position, reg0, pos1),
          (team_get_bot_death_count, reg0, 0),
          (assign, ":var22", reg0),
          (team_get_bot_death_count, reg0, 1),
          (val_add, ":var22", reg0),
          (assign, reg0, ":var22"),
          (create_text_overlay, reg0, "str_reg0", tf_right_align),
          (overlay_set_color, reg0, 0xD0D0D0),
          (position_set_x, pos1, 750),
          (position_set_y, pos1, 750),
          (overlay_set_size, reg0, pos1),
          (store_add, ":var11", ":var10", 238),
          (position_set_x, pos1, ":var11"),
          (position_set_y, pos1, ":var9"),
          (overlay_set_position, reg0, pos1),
          (val_sub, ":var9", 20),
          (assign, ":var13", 0),
        (else_try),
          (assign, ":var13", 0),
        (try_end),
      (try_end),
      (assign, ":var10", 42),
      (create_mesh_overlay, reg0, "mesh_white_plane"),
      (overlay_set_color, reg0, 0xFFFFFF),
      (overlay_set_alpha, reg0, 0xD0),
      (store_add, ":var11", ":var10", 0),
      (position_set_x, pos1, ":var11"),
      (store_add, ":var12", ":var9", 10),
      (position_set_y, pos1, ":var12"),
      (overlay_set_position, reg0, pos1),
      (position_set_x, pos1, 15250),
      (position_set_y, pos1, 50),
      (overlay_set_size, reg0, pos1),
      (try_begin),
        (gt, ":var1", 0),
        (assign, ":var10", 75),
        (val_sub, ":var9", 50),
        (create_text_overlay, reg0, "str_spectators", 0),
        (overlay_set_color, reg0, 0xFFFFFF),
        (position_set_x, pos1, ":var10"),
        (position_set_y, pos1, ":var9"),
        (overlay_set_position, reg0, pos1),
        (position_set_x, pos1, 1000),
        (position_set_y, pos1, 1000),
        (overlay_set_size, reg0, pos1),
        (create_text_overlay, reg0, "str_ping", tf_center_justify),
        (overlay_set_color, reg0, 0xFFFFFF),
        (store_add, ":var11", ":var10", 218),
        (position_set_x, pos1, ":var11"),
        (position_set_y, pos1, ":var9"),
        (overlay_set_position, reg0, pos1),
        (position_set_x, pos1, 750),
        (position_set_y, pos1, 750),
        (overlay_set_size, reg0, pos1),
        (create_mesh_overlay, reg0, "mesh_white_plane"),
        (overlay_set_color, reg0, 0xFFFFFF),
        (overlay_set_alpha, reg0, 0xD0),
        (store_add, ":var11", ":var10", 0),
        (position_set_x, pos1, ":var11"),
        (store_add, ":var12", ":var9", -10),
        (position_set_y, pos1, ":var12"),
        (overlay_set_position, reg0, pos1),
        (position_set_x, pos1, 12000),
        (position_set_y, pos1, 50),
        (overlay_set_size, reg0, pos1),
        (val_sub, ":var9", 30),
        (assign, ":var23", 12632256),
        (store_add, ":var13", ":var2", 1),
        (try_for_range, ":var3", 0, ":var13"),
          (store_add, ":var4", ":var3", 211),
          (troop_slot_eq, "trp_multiplayer_data", ":var4", 1),
          (player_get_team_no, ":var5", ":var3"),
          (eq, ":var5", 2),
          (troop_set_slot, "trp_multiplayer_data", ":var4", 1),
          (try_begin),
            (eq, ":var8", ":var3"),
            (create_mesh_overlay, reg0, "mesh_white_plane"),
            (overlay_set_color, reg0, 0xFFFFFF),
            (overlay_set_alpha, reg0, 0x35),
            (store_add, ":var11", ":var10", 0),
            (position_set_x, pos1, ":var11"),
            (store_add, ":var12", ":var9", 0),
            (position_set_y, pos1, ":var12"),
            (overlay_set_position, reg0, pos1),
            (position_set_x, pos1, 12000),
            (position_set_y, pos1, 1000),
            (overlay_set_size, reg0, pos1),
          (try_end),
          (str_store_player_username, s1, ":var3"),
          (create_text_overlay, reg0, s1, 0),
          (overlay_set_color, reg0, ":var23"),
          (position_set_x, pos1, 750),
          (position_set_y, pos1, 750),
          (overlay_set_size, reg0, pos1),
          (position_set_x, pos1, ":var10"),
          (position_set_y, pos1, ":var9"),
          (overlay_set_position, reg0, pos1),
          (player_get_ping, reg0, ":var3"),
          (create_text_overlay, reg0, "str_reg0", tf_right_align),
          (overlay_set_color, reg0, ":var23"),
          (position_set_x, pos1, 750),
          (position_set_y, pos1, 750),
          (overlay_set_size, reg0, pos1),
          (store_add, ":var11", ":var10", 215),
          (position_set_x, pos1, ":var11"),
          (position_set_y, pos1, ":var9"),
          (overlay_set_position, reg0, pos1),
          (val_sub, ":var9", 20),
        (try_end),
      (try_end),
      (omit_key_once, key_mouse_scroll_up),
      (omit_key_once, key_mouse_scroll_down),
      (presentation_set_duration, 999999),
    ]),
    (ti_on_presentation_run,
    [
      (store_trigger_param_1, ":var0"),
      (try_begin),
        (this_or_next|key_clicked, key_mouse_scroll_up),
        (key_clicked, key_mouse_scroll_down),
        (omit_key_once, key_mouse_scroll_up),
        (omit_key_once, key_mouse_scroll_down),
      (try_end),
      (try_begin),
        (eq, "$g_multiplayer_stats_chart_opened_manually", 1),
        (neg|game_key_is_down, gk_leave),
        (assign, "$g_multiplayer_stats_chart_opened_manually", 0),
        (clear_omitted_keys),
        (presentation_set_duration, 0),
      (try_end),
      (try_begin),
        (store_mul, ":var1", "$g_stats_chart_update_period", 1000),
        (gt, ":var0", ":var1"),
        (clear_omitted_keys),
        (presentation_set_duration, 0),
        (start_presentation, "prsnt_multiplayer_stats_chart_deathmatch"),
      (try_end),
    ]),
  ]),

  ("multiplayer_escape_menu", prsntf_manual_end_only, mesh_pic_bandits,
  [
    (ti_on_presentation_load,
    [
      (set_fixed_point_multiplier, 1000),
      (create_mesh_overlay, reg0, "mesh_mp_ingame_menu"),
      (position_set_x, pos1, 250),
      (position_set_y, pos1, 80),
      (overlay_set_position, reg0, pos1),
      (position_set_x, pos1, 1000),
      (position_set_y, pos1, 1000),
      (overlay_set_size, reg0, pos1),
      (str_clear, s0),
      (create_text_overlay, "$g_presentation_obj_escape_menu_container", s0, tf_scrollable_style_2),
      (position_set_x, pos1, 285),
      (position_set_y, pos1, 75),
      (overlay_set_position, "$g_presentation_obj_escape_menu_container", pos1),
      (position_set_x, pos1, 405),
      (position_set_y, pos1, 550),
      (overlay_set_area_size, "$g_presentation_obj_escape_menu_container", pos1),
      (set_container_overlay, "$g_presentation_obj_escape_menu_container"),
      (assign, ":var0", 500),
      (create_text_overlay, reg0, "str_choose_an_option", 0),
      (overlay_set_color, reg0, 0xFFFFFF),
      (position_set_x, pos1, 0),
      (position_set_y, pos1, ":var0"),
      (overlay_set_position, reg0, pos1),
      (val_sub, ":var0", 40),
      (create_button_overlay, "$g_presentation_obj_escape_menu_1", "str_choose_faction", 0),
      (overlay_set_color, "$g_presentation_obj_escape_menu_1", 0xFFFFFF),
      (multiplayer_get_my_team, ":var1"),
      (assign, "$g_presentation_obj_escape_menu_2", -1),
      (assign, "$g_presentation_obj_escape_menu_3", -1),
      (assign, "$g_presentation_obj_escape_menu_6", -1),
      (assign, "$g_presentation_obj_escape_menu_7", -1),
      (assign, "$g_presentation_obj_escape_menu_8", -1),
      (assign, "$g_presentation_obj_escape_menu_9", -1),
      (assign, "$g_presentation_obj_escape_menu_10", -1),
      (assign, "$g_presentation_obj_escape_menu_11", -1),
      (assign, "$g_presentation_obj_escape_menu_12", -1),
      (assign, "$g_presentation_obj_escape_menu_13", -1),
      (try_begin),
        (lt, ":var1", 2),
        (create_button_overlay, "$g_presentation_obj_escape_menu_2", "str_choose_troop", 0),
        (overlay_set_color, "$g_presentation_obj_escape_menu_2", 0xFFFFFF),
        (multiplayer_get_my_troop, ":var2"),
        (try_begin),
          (ge, ":var2", 0),
          (create_button_overlay, "$g_presentation_obj_escape_menu_3", "str_choose_items", 0),
          (overlay_set_color, "$g_presentation_obj_escape_menu_3", 0xFFFFFF),
        (try_end),
      (try_end),
      (create_button_overlay, "$g_presentation_obj_escape_menu_4", "str_options", 0),
      (overlay_set_color, "$g_presentation_obj_escape_menu_4", 0xFFFFFF),
      (create_button_overlay, "$g_presentation_obj_escape_menu_13", "@Show game rules", 0),
      (overlay_set_color, "$g_presentation_obj_escape_menu_13", 0xFFFFFF),
      (multiplayer_get_my_player, ":var3"),
      (try_begin),
        (this_or_next|eq, "$g_multiplayer_maps_voteable", 1),
        (this_or_next|eq, "$g_multiplayer_factions_voteable", 1),
        (this_or_next|gt, "$g_multiplayer_num_bots_voteable", 0),
        (this_or_next|eq, "$g_multiplayer_kick_voteable", 1),
        (eq, "$g_multiplayer_ban_voteable", 1),
        (create_button_overlay, "$g_presentation_obj_escape_menu_6", "str_submit_a_poll", 0),
        (overlay_set_color, "$g_presentation_obj_escape_menu_6", 0xFFFFFF),
        (assign, "$g_presentation_obj_escape_menu_6_available", 1),
        (try_begin),
          (ge, ":var3", 0),
          (player_get_slot, ":var4", ":var3", 26),
          (store_mission_timer_a, ":var5"),
          (lt, ":var5", ":var4"),
          (overlay_set_color, "$g_presentation_obj_escape_menu_6", 0x888888),
          (overlay_set_hilight_color, "$g_presentation_obj_escape_menu_6", 0x888888),
          (assign, "$g_presentation_obj_escape_menu_6_available", 0),
        (try_end),
      (try_end),
      (try_begin),
        (ge, ":var3", 0),
        (player_is_admin, ":var3"),
        (create_button_overlay, "$g_presentation_obj_escape_menu_7", "str_administrator_panel", 0),
        (overlay_set_color, "$g_presentation_obj_escape_menu_7", 0xFFFFFF),
        (create_button_overlay, "$g_presentation_obj_escape_menu_8", "str_kick_player", 0),
        (overlay_set_color, "$g_presentation_obj_escape_menu_8", 0xFFFFFF),
        (create_button_overlay, "$g_presentation_obj_escape_menu_9", "str_ban_player", 0),
        (overlay_set_color, "$g_presentation_obj_escape_menu_9", 0xFFFFFF),
      (try_end),
      (create_button_overlay, "$g_presentation_obj_escape_menu_11", "str_mute_player", 0),
      (overlay_set_color, "$g_presentation_obj_escape_menu_11", 0xFFFFFF),
      (try_begin),
        (assign, "$g_presentation_obj_escape_menu_12", -1),
        (assign, ":var6", 0),
        (get_max_players, ":var7"),
        (try_for_range, ":var8", 0, ":var7"),
          (player_is_active, ":var8"),
          (player_get_is_muted, ":var9", ":var8"),
          (eq, ":var9", 1),
          (assign, ":var6", 1),
        (try_end),
        (eq, ":var6", 1),
        (create_button_overlay, "$g_presentation_obj_escape_menu_12", "str_unmute_player", 0),
        (overlay_set_color, "$g_presentation_obj_escape_menu_12", 0xFFFFFF),
      (try_end),
      (create_button_overlay, "$g_presentation_obj_escape_menu_10", "str_quit", 0),
      (overlay_set_color, "$g_presentation_obj_escape_menu_10", 0xFFFFFF),
      (position_set_x, pos1, 130),
      (position_set_y, pos1, ":var0"),
      (overlay_set_position, "$g_presentation_obj_escape_menu_1", pos1),
      (try_begin),
        (ge, "$g_presentation_obj_escape_menu_2", 0),
        (val_sub, ":var0", 40),
        (position_set_y, pos1, ":var0"),
        (overlay_set_position, "$g_presentation_obj_escape_menu_2", pos1),
      (try_end),
      (try_begin),
        (ge, "$g_presentation_obj_escape_menu_3", 0),
        (val_sub, ":var0", 40),
        (position_set_y, pos1, ":var0"),
        (overlay_set_position, "$g_presentation_obj_escape_menu_3", pos1),
      (try_end),
      (val_sub, ":var0", 40),
      (position_set_y, pos1, ":var0"),
      (overlay_set_position, "$g_presentation_obj_escape_menu_4", pos1),
      (val_sub, ":var0", 40),
      (position_set_y, pos1, ":var0"),
      (overlay_set_position, "$g_presentation_obj_escape_menu_5", pos1),
      (val_sub, ":var0", 40),
      (position_set_y, pos1, ":var0"),
      (overlay_set_position, "$g_presentation_obj_escape_menu_13", pos1),
      (try_begin),
        (ge, "$g_presentation_obj_escape_menu_6", 0),
        (val_sub, ":var0", 40),
        (position_set_y, pos1, ":var0"),
        (overlay_set_position, "$g_presentation_obj_escape_menu_6", pos1),
      (try_end),
      (try_begin),
        (ge, "$g_presentation_obj_escape_menu_7", 0),
        (val_sub, ":var0", 40),
        (position_set_y, pos1, ":var0"),
        (overlay_set_position, "$g_presentation_obj_escape_menu_7", pos1),
      (try_end),
      (try_begin),
        (ge, "$g_presentation_obj_escape_menu_8", 0),
        (val_sub, ":var0", 40),
        (position_set_y, pos1, ":var0"),
        (overlay_set_position, "$g_presentation_obj_escape_menu_8", pos1),
      (try_end),
      (try_begin),
        (ge, "$g_presentation_obj_escape_menu_9", 0),
        (val_sub, ":var0", 40),
        (position_set_y, pos1, ":var0"),
        (overlay_set_position, "$g_presentation_obj_escape_menu_9", pos1),
      (try_end),
      (val_sub, ":var0", 40),
      (position_set_y, pos1, ":var0"),
      (overlay_set_position, "$g_presentation_obj_escape_menu_11", pos1),
      (try_begin),
        (ge, "$g_presentation_obj_escape_menu_12", 0),
        (val_sub, ":var0", 40),
        (position_set_y, pos1, ":var0"),
        (overlay_set_position, "$g_presentation_obj_escape_menu_12", pos1),
      (try_end),
      (val_sub, ":var0", 40),
      (position_set_y, pos1, ":var0"),
      (overlay_set_position, "$g_presentation_obj_escape_menu_10", pos1),
      (presentation_set_duration, 999999),
    ]),
    (ti_on_presentation_event_state_change,
    [
      (store_trigger_param_1, ":var0"),
      (try_begin),
        (eq, ":var0", "$g_presentation_obj_escape_menu_1"),
        (presentation_set_duration, 0),
        (start_presentation, "prsnt_multiplayer_team_select"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_escape_menu_2"),
        (presentation_set_duration, 0),
        (start_presentation, "prsnt_multiplayer_troop_select"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_escape_menu_3"),
        (presentation_set_duration, 0),
        (assign, "$g_presentation_state", 0),
        (start_presentation, "prsnt_multiplayer_item_select"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_escape_menu_4"),
        (presentation_set_duration, 0),
        (change_screen_options),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_escape_menu_5"),
        (presentation_set_duration, 0),
        (change_screen_controls),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_escape_menu_6"),
        (eq, "$g_presentation_obj_escape_menu_6_available", 1),
        (presentation_set_duration, 0),
        (start_presentation, "prsnt_multiplayer_poll_menu"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_escape_menu_7"),
        (presentation_set_duration, 0),
        (multiplayer_send_message_to_server, 18),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_escape_menu_8"),
        (presentation_set_duration, 0),
        (assign, "$g_multiplayer_players_list_action_type", 3),
        (start_presentation, "prsnt_multiplayer_show_players_list"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_escape_menu_9"),
        (presentation_set_duration, 0),
        (assign, "$g_multiplayer_players_list_action_type", 4),
        (start_presentation, "prsnt_multiplayer_show_players_list"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_escape_menu_10"),
        (presentation_set_duration, 0),
        (finish_mission, 0),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_escape_menu_11"),
        (presentation_set_duration, 0),
        (assign, "$g_multiplayer_players_list_action_type", 5),
        (start_presentation, "prsnt_multiplayer_show_players_list"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_escape_menu_12"),
        (presentation_set_duration, 0),
        (assign, "$g_multiplayer_players_list_action_type", 6),
        (start_presentation, "prsnt_multiplayer_show_players_list"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_escape_menu_13"),
        (presentation_set_duration, 0),
        (multiplayer_send_message_to_server, 45),
      (try_end),
    ]),
    (ti_on_presentation_run,
    [
      (store_trigger_param_1, ":var0"),
      (try_begin),
        (this_or_next|key_clicked, key_escape),
        (key_clicked, key_xbox_start),
        (gt, ":var0", 200),
        (presentation_set_duration, 0),
      (try_end),
    ]),
  ]),

  ("multiplayer_poll_menu", prsntf_manual_end_only, mesh_pic_bandits,
  [
    (ti_on_presentation_load,
    [
      (set_fixed_point_multiplier, 1000),
      (create_mesh_overlay, reg0, "mesh_mp_ingame_menu"),
      (position_set_x, pos1, 250),
      (position_set_y, pos1, 80),
      (overlay_set_position, reg0, pos1),
      (position_set_x, pos1, 1000),
      (position_set_y, pos1, 1000),
      (overlay_set_size, reg0, pos1),
      (str_clear, s0),
      (create_text_overlay, "$g_presentation_obj_poll_menu_container", s0, tf_scrollable_style_2),
      (position_set_x, pos1, 285),
      (position_set_y, pos1, 125),
      (overlay_set_position, "$g_presentation_obj_poll_menu_container", pos1),
      (position_set_x, pos1, 405),
      (position_set_y, pos1, 500),
      (overlay_set_area_size, "$g_presentation_obj_poll_menu_container", pos1),
      (set_container_overlay, "$g_presentation_obj_poll_menu_container"),
      (assign, "$g_presentation_obj_poll_menu_1", -1),
      (assign, "$g_presentation_obj_poll_menu_4", -1),
      (assign, "$g_presentation_obj_poll_menu_5", -1),
      (assign, ":var0", 450),
      (create_text_overlay, reg0, "str_choose_a_poll_type", 0),
      (overlay_set_color, reg0, 0xFFFFFF),
      (position_set_x, pos1, 0),
      (position_set_y, pos1, ":var0"),
      (overlay_set_position, reg0, pos1),
      (val_sub, ":var0", 40),
      (position_set_x, pos1, 60),
      (try_begin),
        (eq, "$g_multiplayer_maps_voteable", 1),
        (create_button_overlay, "$g_presentation_obj_poll_menu_1", "str_poll_for_changing_the_map", 0),
        (overlay_set_color, "$g_presentation_obj_poll_menu_1", 0xFFFFFF),
        (position_set_y, pos1, ":var0"),
        (overlay_set_position, "$g_presentation_obj_poll_menu_1", pos1),
        (val_sub, ":var0", 40),
      (try_end),
      (try_begin),
        (eq, "$g_multiplayer_factions_voteable", 1),
        (create_button_overlay, "$g_presentation_obj_poll_menu_4", "str_poll_for_changing_the_map_and_factions", 0),
        (overlay_set_color, "$g_presentation_obj_poll_menu_4", 0xFFFFFF),
        (position_set_y, pos1, ":var0"),
        (overlay_set_position, "$g_presentation_obj_poll_menu_4", pos1),
        (val_sub, ":var0", 40),
      (try_end),
      (try_begin),
        (gt, "$g_multiplayer_num_bots_voteable", 0),
        (create_button_overlay, "$g_presentation_obj_poll_menu_5", "str_poll_for_changing_number_of_bots", 0),
        (overlay_set_color, "$g_presentation_obj_poll_menu_5", 0xFFFFFF),
        (position_set_y, pos1, ":var0"),
        (overlay_set_position, "$g_presentation_obj_poll_menu_5", pos1),
        (val_sub, ":var0", 40),
      (try_end),
      (try_begin),
        (eq, "$g_multiplayer_kick_voteable", 1),
        (create_button_overlay, "$g_presentation_obj_poll_menu_2", "str_poll_for_kicking_a_player", 0),
        (overlay_set_color, "$g_presentation_obj_poll_menu_2", 0xFFFFFF),
        (position_set_y, pos1, ":var0"),
        (overlay_set_position, "$g_presentation_obj_poll_menu_2", pos1),
        (val_sub, ":var0", 40),
      (try_end),
      (try_begin),
        (eq, "$g_multiplayer_ban_voteable", 1),
        (create_button_overlay, "$g_presentation_obj_poll_menu_3", "str_poll_for_banning_a_player", 0),
        (overlay_set_color, "$g_presentation_obj_poll_menu_3", 0xFFFFFF),
        (position_set_y, pos1, ":var0"),
        (overlay_set_position, "$g_presentation_obj_poll_menu_3", pos1),
      (try_end),
      (presentation_set_duration, 999999),
    ]),
    (ti_on_presentation_event_state_change,
    [
      (store_trigger_param_1, ":var0"),
      (try_begin),
        (eq, ":var0", "$g_presentation_obj_poll_menu_1"),
        (presentation_set_duration, 0),
        (assign, "$g_multiplayer_maps_list_action_type", 1),
        (start_presentation, "prsnt_multiplayer_show_maps_list"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_poll_menu_2"),
        (presentation_set_duration, 0),
        (assign, "$g_multiplayer_players_list_action_type", 1),
        (start_presentation, "prsnt_multiplayer_show_players_list"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_poll_menu_3"),
        (presentation_set_duration, 0),
        (assign, "$g_multiplayer_players_list_action_type", 2),
        (start_presentation, "prsnt_multiplayer_show_players_list"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_poll_menu_4"),
        (presentation_set_duration, 0),
        (assign, "$g_multiplayer_maps_list_action_type", 2),
        (start_presentation, "prsnt_multiplayer_show_maps_list"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_poll_menu_5"),
        (presentation_set_duration, 0),
        (assign, "$g_multiplayer_number_of_bots_list_action_type", 1),
        (start_presentation, "prsnt_multiplayer_show_number_of_bots_list"),
      (try_end),
    ]),
    (ti_on_presentation_run,
    [
      (store_trigger_param_1, ":var0"),
      (try_begin),
        (this_or_next|key_clicked, key_escape),
        (key_clicked, key_xbox_start),
        (gt, ":var0", 200),
        (presentation_set_duration, 0),
      (try_end),
    ]),
  ]),

  ("multiplayer_show_players_list", prsntf_manual_end_only, mesh_pic_bandits,
  [
    (ti_on_presentation_load,
    [
      (set_fixed_point_multiplier, 1000),
      (create_mesh_overlay, reg0, "mesh_mp_ingame_menu"),
      (position_set_x, pos1, 250),
      (position_set_y, pos1, 80),
      (overlay_set_position, reg0, pos1),
      (position_set_x, pos1, 1000),
      (position_set_y, pos1, 1000),
      (overlay_set_size, reg0, pos1),
      (str_clear, s0),
      (create_text_overlay, "$g_presentation_obj_show_players_1", s0, tf_scrollable_style_2),
      (position_set_x, pos1, 285),
      (position_set_y, pos1, 125),
      (overlay_set_position, "$g_presentation_obj_show_players_1", pos1),
      (position_set_x, pos1, 405),
      (position_set_y, pos1, 500),
      (overlay_set_area_size, "$g_presentation_obj_show_players_1", pos1),
      (set_container_overlay, "$g_presentation_obj_show_players_1"),
      (multiplayer_get_my_player, ":var0"),
      (assign, ":var1", 10),
      (get_max_players, ":var2"),
      (try_for_range, ":var3", 1, ":var2"),
        (player_is_active, ":var3"),
        (assign, ":var4", 0),
        (try_begin),
          (neq, "$g_multiplayer_players_list_action_type", 5),
          (neq, "$g_multiplayer_players_list_action_type", 6),
          (assign, ":var4", 1),
        (else_try),
          (eq, "$g_multiplayer_players_list_action_type", 5),
          (neq, ":var3", ":var0"),
          (player_get_is_muted, ":var5", ":var3"),
          (eq, ":var5", 0),
          (assign, ":var4", 1),
        (else_try),
          (eq, "$g_multiplayer_players_list_action_type", 6),
          (neq, ":var3", ":var0"),
          (player_get_is_muted, ":var5", ":var3"),
          (eq, ":var5", 1),
          (assign, ":var4", 1),
        (try_end),
        (eq, ":var4", 1),
        (val_add, ":var1", 40),
      (try_end),
      (create_text_overlay, reg0, "str_choose_a_player", 0),
      (overlay_set_color, reg0, 0xFFFFFF),
      (position_set_x, pos1, 0),
      (position_set_y, pos1, ":var1"),
      (overlay_set_position, reg0, pos1),
      (val_sub, ":var1", 40),
      (get_max_players, ":var2"),
      (try_for_range, ":var3", 1, ":var2"),
        (player_is_active, ":var3"),
        (player_set_slot, ":var3", 22, -1),
        (assign, ":var4", 0),
        (try_begin),
          (neq, "$g_multiplayer_players_list_action_type", 5),
          (neq, "$g_multiplayer_players_list_action_type", 6),
          (assign, ":var4", 1),
        (else_try),
          (eq, "$g_multiplayer_players_list_action_type", 5),
          (neq, ":var3", ":var0"),
          (player_get_is_muted, ":var5", ":var3"),
          (eq, ":var5", 0),
          (assign, ":var4", 1),
        (else_try),
          (eq, "$g_multiplayer_players_list_action_type", 6),
          (neq, ":var3", ":var0"),
          (player_get_is_muted, ":var5", ":var3"),
          (eq, ":var5", 1),
          (assign, ":var4", 1),
        (try_end),
        (eq, ":var4", 1),
        (str_store_player_username, s0, ":var3"),
        (create_button_overlay, ":var6", s0, 0),
        (overlay_set_color, ":var6", 0xFFFFFF),
        (position_set_x, pos1, 130),
        (position_set_y, pos1, ":var1"),
        (overlay_set_position, ":var6", pos1),
        (val_sub, ":var1", 40),
        (player_set_slot, ":var3", 22, ":var6"),
      (try_end),
      (presentation_set_duration, 999999),
    ]),
    (ti_on_presentation_event_state_change,
    [
      (store_trigger_param_1, ":var0"),
      (get_max_players, ":var1"),
      (try_for_range, ":var2", 1, ":var1"),
        (player_is_active, ":var2"),
        (player_slot_eq, ":var2", 22, ":var0"),
        (try_begin),
          (is_between, "$g_multiplayer_players_list_action_type", 1, 3),
          (try_begin),
            (multiplayer_get_my_player, ":var3"),
            (ge, ":var3", 0),
            (multiplayer_send_2_int_to_server, 21, "$g_multiplayer_players_list_action_type", ":var2"),
            (store_mission_timer_a, ":var4"),
            (val_add, ":var4", 900),
            (player_set_slot, ":var3", 26, ":var4"),
          (try_end),
        (else_try),
          (eq, "$g_multiplayer_players_list_action_type", 3),
          (multiplayer_send_int_to_server, 23, ":var2"),
        (else_try),
          (eq, "$g_multiplayer_players_list_action_type", 4),
          (multiplayer_send_int_to_server, 24, ":var2"),
        (else_try),
          (eq, "$g_multiplayer_players_list_action_type", 5),
          (player_set_is_muted, ":var2", 1),
        (else_try),
          (eq, "$g_multiplayer_players_list_action_type", 6),
          (player_set_is_muted, ":var2", 0),
        (try_end),
        (assign, ":var1", 0),
        (presentation_set_duration, 0),
      (try_end),
    ]),
    (ti_on_presentation_run,
    [
      (store_trigger_param_1, ":var0"),
      (try_begin),
        (this_or_next|key_clicked, key_escape),
        (key_clicked, key_xbox_start),
        (gt, ":var0", 200),
        (presentation_set_duration, 0),
      (try_end),
    ]),
  ]),

  ("multiplayer_show_maps_list", prsntf_manual_end_only, mesh_pic_bandits,
  [
    (ti_on_presentation_load,
    [
      (set_fixed_point_multiplier, 1000),
      (create_mesh_overlay, reg0, "mesh_mp_ingame_menu"),
      (position_set_x, pos1, 250),
      (position_set_y, pos1, 80),
      (overlay_set_position, reg0, pos1),
      (position_set_x, pos1, 1000),
      (position_set_y, pos1, 1000),
      (overlay_set_size, reg0, pos1),
      (str_clear, s0),
      (create_text_overlay, "$g_presentation_obj_show_maps_list_menu_container", s0, tf_scrollable_style_2),
      (position_set_x, pos1, 285),
      (position_set_y, pos1, 125),
      (overlay_set_position, "$g_presentation_obj_show_maps_list_menu_container", pos1),
      (position_set_x, pos1, 405),
      (position_set_y, pos1, 500),
      (overlay_set_area_size, "$g_presentation_obj_show_maps_list_menu_container", pos1),
      (set_container_overlay, "$g_presentation_obj_show_maps_list_menu_container"),
      (call_script, "script_multiplayer_fill_map_game_types", "$g_multiplayer_game_type"),
      (assign, ":var0", reg0),
      (store_mul, ":var1", ":var0", 40),
      (val_add, ":var1", 10),
      (create_text_overlay, reg0, "str_choose_a_map", 0),
      (overlay_set_color, reg0, 0xFFFFFF),
      (position_set_x, pos1, 0),
      (position_set_y, pos1, ":var1"),
      (overlay_set_position, reg0, pos1),
      (val_sub, ":var1", 40),
      (assign, ":var2", -1),
      (try_for_range, ":var3", 0, ":var0"),
        (store_add, ":var4", ":var3", 0),
        (troop_get_slot, ":var5", "trp_multiplayer_data", ":var4"),
        (store_sub, ":var6", ":var5", "scn_multi_scene_1"),
        (val_add, ":var6", "str_multi_scene_1"),
        (str_store_string, s0, ":var6"),
        (create_button_overlay, ":var2", s0, 0),
        (overlay_set_color, ":var2", 0xFFFFFF),
        (position_set_x, pos1, 100),
        (position_set_y, pos1, ":var1"),
        (overlay_set_position, ":var2", pos1),
        (val_sub, ":var1", 40),
      (try_end),
      (store_add, "$g_show_maps_list_button_list_end_index", ":var2", 1),
      (store_sub, "$g_show_maps_list_button_list_first_index", "$g_show_maps_list_button_list_end_index", ":var0"),
      (presentation_set_duration, 999999),
    ]),
    (ti_on_presentation_event_state_change,
    [
      (store_trigger_param_1, ":var0"),
      (try_for_range, ":var1", "$g_show_maps_list_button_list_first_index", "$g_show_maps_list_button_list_end_index"),
        (eq, ":var0", ":var1"),
        (call_script, "script_multiplayer_fill_map_game_types", "$g_multiplayer_game_type"),
        (store_sub, ":var2", ":var0", "$g_show_maps_list_button_list_first_index"),
        (val_add, ":var2", 0),
        (troop_get_slot, ":var3", "trp_multiplayer_data", ":var2"),
        (presentation_set_duration, 0),
        (try_begin),
          (eq, "$g_multiplayer_maps_list_action_type", 1),
          (try_begin),
            (multiplayer_get_my_player, ":var4"),
            (ge, ":var4", 0),
            (multiplayer_send_2_int_to_server, 21, 0, ":var3"),
            (store_mission_timer_a, ":var5"),
            (val_add, ":var5", 900),
            (player_set_slot, ":var4", 26, ":var5"),
          (try_end),
        (else_try),
          (assign, "$g_multiplayer_factions_list_action_type", 1),
          (assign, "$g_multiplayer_poll_for_map_and_faction_data_map", ":var3"),
          (start_presentation, "prsnt_multiplayer_show_factions_list"),
        (try_end),
        (assign, "$g_show_maps_list_button_list_end_index", 0),
      (try_end),
    ]),
    (ti_on_presentation_run,
    [
      (store_trigger_param_1, ":var0"),
      (try_begin),
        (this_or_next|key_clicked, key_escape),
        (key_clicked, key_xbox_start),
        (gt, ":var0", 200),
        (presentation_set_duration, 0),
      (try_end),
    ]),
  ]),

  ("multiplayer_show_factions_list", prsntf_manual_end_only, mesh_pic_bandits,
  [
    (ti_on_presentation_load,
    [
      (set_fixed_point_multiplier, 1000),
      (create_mesh_overlay, reg0, "mesh_mp_ingame_menu"),
      (position_set_x, pos1, 250),
      (position_set_y, pos1, 80),
      (overlay_set_position, reg0, pos1),
      (position_set_x, pos1, 1000),
      (position_set_y, pos1, 1000),
      (overlay_set_size, reg0, pos1),
      (str_clear, s0),
      (create_text_overlay, "$g_presentation_obj_show_factions_list_menu_container", s0, tf_scrollable_style_2),
      (position_set_x, pos1, 285),
      (position_set_y, pos1, 125),
      (overlay_set_position, "$g_presentation_obj_show_factions_list_menu_container", pos1),
      (position_set_x, pos1, 405),
      (position_set_y, pos1, 500),
      (overlay_set_area_size, "$g_presentation_obj_show_factions_list_menu_container", pos1),
      (set_container_overlay, "$g_presentation_obj_show_factions_list_menu_container"),
      (store_sub, ":var0", "fac_kingdoms_end", "fac_kingdom_1"),
      (try_begin),
        (eq, "$g_multiplayer_factions_list_action_type", 2),
        (val_sub, ":var0", 1),
      (try_end),
      (store_mul, ":var1", ":var0", 40),
      (val_add, ":var1", 10),
      (assign, reg0, "$g_multiplayer_factions_list_action_type"),
      (create_text_overlay, reg0, "str_choose_a_faction_for_team_reg0", 0),
      (overlay_set_color, reg0, 0xFFFFFF),
      (position_set_x, pos1, 0),
      (position_set_y, pos1, ":var1"),
      (overlay_set_position, reg0, pos1),
      (val_sub, ":var1", 40),
      (assign, ":var2", -1),
      (try_for_range, ":var3", "fac_kingdom_1", "fac_kingdoms_end"),
        (this_or_next|eq, "$g_multiplayer_factions_list_action_type", 1),
        (neq, "$g_multiplayer_poll_for_map_and_faction_data_faction_1", ":var3"),
        (str_store_faction_name, s0, ":var3"),
        (create_button_overlay, ":var2", s0, 0),
        (overlay_set_color, ":var2", 0xFFFFFF),
        (position_set_x, pos1, 100),
        (position_set_y, pos1, ":var1"),
        (overlay_set_position, ":var2", pos1),
        (val_sub, ":var1", 40),
      (try_end),
      (store_add, "$g_show_factions_list_button_list_end_index", ":var2", 1),
      (store_sub, "$g_show_factions_list_button_list_first_index", "$g_show_factions_list_button_list_end_index", ":var0"),
      (presentation_set_duration, 999999),
    ]),
    (ti_on_presentation_event_state_change,
    [
      (store_trigger_param_1, ":var0"),
      (try_for_range, ":var1", "$g_show_factions_list_button_list_first_index", "$g_show_factions_list_button_list_end_index"),
        (eq, ":var0", ":var1"),
        (store_sub, ":var2", ":var0", "$g_show_factions_list_button_list_first_index"),
        (val_add, ":var2", "fac_kingdom_1"),
        (presentation_set_duration, 0),
        (try_begin),
          (eq, "$g_multiplayer_factions_list_action_type", 2),
          (try_begin),
            (ge, ":var2", "$g_multiplayer_poll_for_map_and_faction_data_faction_1"),
            (val_add, ":var2", 1),
          (try_end),
          (try_begin),
            (multiplayer_get_my_player, ":var3"),
            (ge, ":var3", 0),
            (multiplayer_send_4_int_to_server, 21, 3, "$g_multiplayer_poll_for_map_and_faction_data_map", "$g_multiplayer_poll_for_map_and_faction_data_faction_1", ":var2"),
            (store_mission_timer_a, ":var4"),
            (val_add, ":var4", 900),
            (player_set_slot, ":var3", 26, ":var4"),
          (try_end),
        (else_try),
          (assign, "$g_multiplayer_factions_list_action_type", 2),
          (assign, "$g_multiplayer_poll_for_map_and_faction_data_faction_1", ":var2"),
          (start_presentation, "prsnt_multiplayer_show_factions_list"),
        (try_end),
        (assign, "$g_show_factions_list_button_list_end_index", 0),
      (try_end),
    ]),
    (ti_on_presentation_run,
    [
      (store_trigger_param_1, ":var0"),
      (try_begin),
        (this_or_next|key_clicked, key_escape),
        (key_clicked, key_xbox_start),
        (gt, ":var0", 200),
        (presentation_set_duration, 0),
      (try_end),
    ]),
  ]),

  ("multiplayer_show_number_of_bots_list", prsntf_manual_end_only, mesh_pic_bandits,
  [
    (ti_on_presentation_load,
    [
      (set_fixed_point_multiplier, 1000),
      (create_mesh_overlay, reg0, "mesh_mp_ingame_menu"),
      (position_set_x, pos1, 250),
      (position_set_y, pos1, 80),
      (overlay_set_position, reg0, pos1),
      (position_set_x, pos1, 1000),
      (position_set_y, pos1, 1000),
      (overlay_set_size, reg0, pos1),
      (str_clear, s0),
      (create_text_overlay, "$g_presentation_obj_show_number_of_bots_list_menu_container", s0, tf_scrollable_style_2),
      (position_set_x, pos1, 285),
      (position_set_y, pos1, 125),
      (overlay_set_position, "$g_presentation_obj_show_number_of_bots_list_menu_container", pos1),
      (position_set_x, pos1, 405),
      (position_set_y, pos1, 500),
      (overlay_set_area_size, "$g_presentation_obj_show_number_of_bots_list_menu_container", pos1),
      (set_container_overlay, "$g_presentation_obj_show_number_of_bots_list_menu_container"),
      (assign, ":var0", 0),
      (store_add, ":var1", "$g_multiplayer_num_bots_voteable", 1),
      (try_for_range, ":var2", 0, ":var1"),
        (assign, ":var3", ":var2"),
        (val_mod, ":var3", 5),
        (this_or_next|lt, ":var2", 10),
        (eq, ":var3", 0),
        (val_add, ":var0", 1),
      (try_end),
      (store_mul, ":var4", ":var0", 40),
      (val_add, ":var4", 10),
      (assign, reg0, "$g_multiplayer_number_of_bots_list_action_type"),
      (create_text_overlay, reg0, "str_choose_number_of_bots_for_team_reg0", 0),
      (overlay_set_color, reg0, 0xFFFFFF),
      (position_set_x, pos1, 0),
      (position_set_y, pos1, ":var4"),
      (overlay_set_position, reg0, pos1),
      (val_sub, ":var4", 40),
      (assign, ":var5", -1),
      (try_for_range, ":var2", 0, ":var1"),
        (assign, ":var3", ":var2"),
        (val_mod, ":var3", 5),
        (this_or_next|lt, ":var2", 10),
        (eq, ":var3", 0),
        (assign, reg0, ":var2"),
        (str_store_string, s0, "str_reg0"),
        (create_button_overlay, ":var5", s0, 0),
        (overlay_set_color, ":var5", 0xFFFFFF),
        (position_set_x, pos1, 100),
        (position_set_y, pos1, ":var4"),
        (overlay_set_position, ":var5", pos1),
        (val_sub, ":var4", 40),
      (try_end),
      (store_add, "$g_show_number_of_bots_list_button_list_end_index", ":var5", 1),
      (store_sub, "$g_show_number_of_bots_list_button_list_first_index", "$g_show_number_of_bots_list_button_list_end_index", ":var0"),
      (presentation_set_duration, 999999),
    ]),
    (ti_on_presentation_event_state_change,
    [
      (store_trigger_param_1, ":var0"),
      (try_for_range, ":var1", "$g_show_number_of_bots_list_button_list_first_index", "$g_show_number_of_bots_list_button_list_end_index"),
        (eq, ":var0", ":var1"),
        (store_sub, ":var2", ":var0", "$g_show_number_of_bots_list_button_list_first_index"),
        (try_begin),
          (lt, ":var2", 10),
          (assign, ":var3", ":var2"),
        (else_try),
          (store_sub, ":var3", ":var2", 8),
          (val_mul, ":var3", 5),
        (try_end),
        (presentation_set_duration, 0),
        (try_begin),
          (eq, "$g_multiplayer_number_of_bots_list_action_type", 2),
          (try_begin),
            (multiplayer_get_my_player, ":var4"),
            (ge, ":var4", 0),
            (multiplayer_send_3_int_to_server, 21, 4, "$g_multiplayer_poll_number_of_bots_team_1", ":var3"),
            (store_mission_timer_a, ":var5"),
            (val_add, ":var5", 900),
            (player_set_slot, ":var4", 26, ":var5"),
          (try_end),
        (else_try),
          (assign, "$g_multiplayer_number_of_bots_list_action_type", 2),
          (assign, "$g_multiplayer_poll_number_of_bots_team_1", ":var3"),
          (start_presentation, "prsnt_multiplayer_show_number_of_bots_list"),
        (try_end),
        (assign, "$g_show_number_of_bots_list_button_list_end_index", 0),
      (try_end),
    ]),
    (ti_on_presentation_run,
    [
      (store_trigger_param_1, ":var0"),
      (try_begin),
        (this_or_next|key_clicked, key_escape),
        (key_clicked, key_xbox_start),
        (gt, ":var0", 200),
        (presentation_set_duration, 0),
      (try_end),
    ]),
  ]),

  ("multiplayer_poll", prsntf_read_only|prsntf_manual_end_only, mesh_pic_bandits,
  [
    (ti_on_presentation_load,
    [
      (set_fixed_point_multiplier, 1000),
      (create_mesh_overlay, reg0, "mesh_white_plane"),
      (overlay_set_color, reg0, 0x000000),
      (overlay_set_alpha, reg0, 0x44),
      (position_set_x, pos1, 50),
      (position_set_y, pos1, 50),
      (overlay_set_position, reg0, pos1),
      (position_set_x, pos1, 37500),
      (position_set_y, pos1, 4500),
      (overlay_set_size, reg0, pos1),
      (try_begin),
        (eq, "$g_multiplayer_poll_to_show", 0),
        (store_sub, ":var0", "$g_multiplayer_poll_value_to_show", "scn_multi_scene_1"),
        (val_add, ":var0", "str_multi_scene_1"),
        (str_store_string, s0, ":var0"),
        (create_text_overlay, reg0, "str_poll_change_map", tf_center_justify),
      (else_try),
        (eq, "$g_multiplayer_poll_to_show", 1),
        (str_store_player_username, s0, "$g_multiplayer_poll_value_to_show"),
        (create_text_overlay, reg0, "str_poll_kick_player", tf_center_justify),
      (else_try),
        (eq, "$g_multiplayer_poll_to_show", 2),
        (str_store_player_username, s0, "$g_multiplayer_poll_value_to_show"),
        (create_text_overlay, reg0, "str_poll_ban_player", tf_center_justify),
      (else_try),
        (eq, "$g_multiplayer_poll_to_show", 3),
        (store_sub, ":var0", "$g_multiplayer_poll_value_to_show", "scn_multi_scene_1"),
        (val_add, ":var0", "str_multi_scene_1"),
        (str_store_string, s0, ":var0"),
        (str_store_faction_name, s1, "$g_multiplayer_poll_value_2_to_show"),
        (str_store_faction_name, s2, "$g_multiplayer_poll_value_3_to_show"),
        (create_text_overlay, reg0, "str_poll_change_map_with_faction", tf_center_justify|tf_scrollable_style_2),
      (else_try),
        (assign, reg0, "$g_multiplayer_poll_value_to_show"),
        (assign, reg1, "$g_multiplayer_poll_value_2_to_show"),
        (str_store_faction_name, s0, "$g_multiplayer_team_1_faction"),
        (str_store_faction_name, s1, "$g_multiplayer_team_2_faction"),
        (create_text_overlay, reg0, "str_poll_change_number_of_bots", tf_center_justify|tf_scrollable_style_2),
      (try_end),
      (overlay_set_color, reg0, 0xFFFFFF),
      (try_begin),
        (neq, "$g_multiplayer_poll_to_show", 3),
        (neq, "$g_multiplayer_poll_to_show", 4),
        (position_set_x, pos1, 400),
        (position_set_y, pos1, 100),
        (overlay_set_position, reg0, pos1),
      (else_try),
        (position_set_x, pos1, 50),
        (position_set_y, pos1, 70),
        (overlay_set_position, reg0, pos1),
        (position_set_x, pos1, 750),
        (position_set_y, pos1, 60),
        (overlay_set_area_size, reg0, pos1),
      (try_end),
      (store_mission_timer_a, ":var1"),
      (store_sub, "$g_multiplayer_poll_last_written_seconds_left", "$g_multiplayer_poll_client_end_time", ":var1"),
      (assign, reg0, "$g_multiplayer_poll_last_written_seconds_left"),
      (create_text_overlay, "$g_presentation_obj_poll_1", "str_poll_time_left", tf_right_align|tf_single_line),
      (overlay_set_color, "$g_presentation_obj_poll_1", 0xFFFFFF),
      (position_set_x, pos1, 790),
      (position_set_y, pos1, 60),
      (overlay_set_position, "$g_presentation_obj_poll_1", pos1),
      (omit_key_once, key_1),
      (omit_key_once, key_2),
      (presentation_set_duration, 999999),
    ]),
    (ti_on_presentation_run,
    [
      (store_trigger_param_1, ":var0"),
      (try_begin),
        (this_or_next|key_clicked, key_escape),
        (this_or_next|key_clicked, key_xbox_start),
        (key_clicked, key_2),
        (gt, ":var0", 500),
        (multiplayer_send_int_to_server, 22, 0),
        (clear_omitted_keys),
        (presentation_set_duration, 0),
      (else_try),
        (key_clicked, key_1),
        (gt, ":var0", 500),
        (multiplayer_send_int_to_server, 22, 1),
        (clear_omitted_keys),
        (presentation_set_duration, 0),
      (try_end),
      (store_mission_timer_a, ":var1"),
      (store_sub, ":var2", "$g_multiplayer_poll_client_end_time", ":var1"),
      (try_begin),
        (neq, ":var2", "$g_multiplayer_poll_last_written_seconds_left"),
        (try_begin),
          (lt, ":var2", 0),
          (clear_omitted_keys),
          (presentation_set_duration, 0),
        (else_try),
          (assign, "$g_multiplayer_poll_last_written_seconds_left", ":var2"),
          (assign, reg0, "$g_multiplayer_poll_last_written_seconds_left"),
          (overlay_set_text, "$g_presentation_obj_poll_1", "str_poll_time_left"),
        (try_end),
      (try_end),
    ]),
  ]),

  ("tutorial_show_mouse_movement", prsntf_read_only|prsntf_manual_end_only, mesh_pic_bandits,
  [
    (ti_on_presentation_load,
    [
      (try_begin),
        (this_or_next|eq, "$g_tutorial_mouse_dir", -1),
        (eq, "$g_tutorial_mouse_click", -1),
        (presentation_set_duration, 0),
      (else_try),
        (set_fixed_point_multiplier, 1000),
        (assign, "$g_tutorial_displayed_mouse_dir", "$g_tutorial_mouse_dir"),
        (assign, "$g_tutorial_displayed_mouse_click", "$g_tutorial_mouse_click"),
        (store_add, ":var0", "$g_tutorial_mouse_dir", "mesh_mouse_arrow_down"),
        (create_mesh_overlay, reg0, ":var0"),
        (position_set_x, pos1, 800),
        (position_set_y, pos1, 800),
        (overlay_set_size, reg0, pos1),
        (position_set_x, pos1, 380),
        (position_set_y, pos1, 500),
        (overlay_set_position, reg0, pos1),
        (try_begin),
          (eq, "$g_tutorial_mouse_click", 0),
          (create_mesh_overlay, reg0, "mesh_mouse_left_click"),
        (else_try),
          (create_mesh_overlay, reg0, "mesh_mouse_right_click"),
        (try_end),
        (position_set_x, pos1, 800),
        (position_set_y, pos1, 800),
        (overlay_set_size, reg0, pos1),
        (position_set_x, pos1, 540),
        (position_set_y, pos1, 500),
        (overlay_set_position, reg0, pos1),
        (create_mesh_overlay, reg0, "mesh_mouse_arrow_plus"),
        (overlay_set_color, reg0, 0xFFFFFF),
        (position_set_x, pos1, 600),
        (position_set_y, pos1, 600),
        (overlay_set_size, reg0, pos1),
        (position_set_x, pos1, 470),
        (position_set_y, pos1, 510),
        (overlay_set_position, reg0, pos1),
        (presentation_set_duration, 999999),
      (try_end),
    ]),
    (ti_on_presentation_run,
    [
      (try_begin),
        (this_or_next|neq, "$g_tutorial_displayed_mouse_dir", "$g_tutorial_mouse_dir"),
        (neq, "$g_tutorial_displayed_mouse_click", "$g_tutorial_mouse_click"),
        (presentation_set_duration, 0),
        (try_begin),
          (ge, "$g_tutorial_mouse_dir", 0),
          (ge, "$g_tutorial_mouse_click", 0),
          (start_presentation, "prsnt_tutorial_show_mouse_movement"),
        (try_end),
      (try_end),
    ]),
  ]),

  ("name_kingdom", 0, mesh_load_window,
  [
    (ti_on_presentation_load,
    [
      (set_fixed_point_multiplier, 1000),
      (try_begin),
        (neg|is_between, "$g_presentation_state", 1, 5),
        (assign, "$g_presentation_state", 1),
      (try_end),
      (store_add, ":var0", "str_name_presentation_text", "$g_presentation_state"),
      (str_store_string, s1, ":var0"),
      (create_text_overlay, reg1, "str_name_presentation_text", tf_center_justify),
      (position_set_x, pos1, 500),
      (position_set_y, pos1, 500),
      (overlay_set_position, reg1, pos1),
      (create_simple_text_box_overlay, "$g_presentation_obj_name_kingdom_1"),
      (position_set_x, pos1, 400),
      (position_set_y, pos1, 400),
      (overlay_set_position, "$g_presentation_obj_name_kingdom_1", pos1),
      (assign, "$g_presentation_obj_banner_selection_1", -1),
      (try_begin),
        (eq, "$g_presentation_state", 1),
        (try_begin),
          (store_and, ":var1", "$players_kingdom_name_set", 1),
          (this_or_next|eq, ":var1", 1),
          (eq, "$g_presentation_next_presentation", "prsnt_name_kingdom"),
          (str_store_faction_name, s7, "fac_player_supporters_faction"),
        (else_try),
          (is_between, "$g_player_court", "p_town_1", "p_castle_1"),
          (str_store_party_name, s7, "$g_player_court"),
          (str_store_string, s7, "@Kingdom of {s7}"),
        (else_try),
          (str_store_troop_name, s0, "trp_player"),
          (str_store_string, s7, "str_default_kingdom_name"),
        (try_end),
        (eq, "$g_presentation_state", 1),
        (create_button_overlay, "$g_presentation_obj_banner_selection_1", "str_color", tf_center_justify),
        (position_set_x, pos1, 500),
        (position_set_y, pos1, 300),
        (overlay_set_position, "$g_presentation_obj_banner_selection_1", pos1),
        (faction_get_color, ":var2", "$players_kingdom"),
        (overlay_set_color, "$g_presentation_obj_banner_selection_1", ":var2"),
      (else_try),
        (eq, "$g_presentation_state", 2),
        (str_store_party_name, s7, "$g_player_court"),
      (else_try),
        (eq, "$g_presentation_state", 3),
        (str_store_party_name, s7, "$g_encountered_party"),
      (else_try),
        (eq, "$g_presentation_state", 4),
        (str_store_troop_name_plural, s7, "$g_player_troop"),
      (try_end),
      (overlay_set_text, "$g_presentation_obj_name_kingdom_1", s7),
      (create_button_overlay, "$g_presentation_obj_name_kingdom_2", "str_continue_dot", tf_center_justify),
      (position_set_x, pos1, 500),
      (position_set_y, pos1, 150),
      (overlay_set_position, "$g_presentation_obj_name_kingdom_2", pos1),
      (presentation_set_duration, 999999),
    ]),
    (ti_on_presentation_event_state_change,
    [
      (store_trigger_param_1, ":var0"),
      (try_begin),
        (eq, ":var0", "$g_presentation_obj_name_kingdom_1"),
        (str_store_string, s7, s0),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_name_kingdom_2"),
        (try_begin),
          (eq, "$g_presentation_state", 1),
          (try_begin),
            (store_and, ":var1", "$players_kingdom_name_set", 1),
            (eq, ":var1", 0),
            (troop_get_slot, ":var2", "$g_player_troop", 13),
            (gt, ":var2", 0),
            (val_sub, ":var2", "spr_banner_a"),
            (troop_get_slot, ":var3", "trp_banner_background_color_array", ":var2"),
            (gt, ":var3", 0),
            (faction_set_color, "fac_player_supporters_faction", ":var3"),
          (try_end),
          (faction_set_name, "fac_player_supporters_faction", s7),
          (val_or, "$players_kingdom_name_set", 1),
        (else_try),
          (eq, "$g_presentation_state", 3),
          (party_set_name, "$g_encountered_party", s7),
        (else_try),
          (eq, "$g_presentation_state", 2),
          (try_begin),
            (troop_is_hero, "$g_player_minister"),
            (store_skill_level, ":var4", "skl_persuasion", "$g_player_minister"),
            (store_sub, ":var4", 15, ":var4"),
            (call_script, "script_change_player_relation_with_center", "$g_player_court", ":var4"),
          (try_end),
          (party_set_name, "$g_player_court", s7),
          (val_or, "$players_kingdom_name_set", 2),
        (else_try),
          (eq, "$g_presentation_state", 4),
          (troop_set_name, "$g_player_troop", s7),
          (troop_set_plural_name, "$g_player_troop", s7),
          (try_begin),
            (troop_slot_eq, "$g_player_troop", 2, 2),
            (store_faction_of_troop, ":var5", "$g_player_troop"),
            (call_script, "script_troop_set_title_according_to_faction", "$g_player_troop", ":var5"),
          (try_end),
        (try_end),
        (assign, "$g_presentation_next_presentation", -1),
        (presentation_set_duration, 0),
      (else_try),
        (eq, "$g_presentation_state", 1),
        (eq, ":var0", "$g_presentation_obj_banner_selection_1"),
        (assign, "$g_presentation_state", 0),
        (assign, "$temp", 9),
        (assign, "$g_presentation_next_presentation", "prsnt_name_kingdom"),
        (faction_set_name, "fac_player_supporters_faction", s7),
        (start_presentation, "prsnt_change_color"),
      (try_end),
    ]),
  ]),

  ("change_color", 0, mesh_load_window,
  [
    (ti_on_presentation_load,
    [
      (presentation_set_duration, 999999),
      (set_fixed_point_multiplier, 1000),
      (create_combo_button_overlay, "$g_presentation_obj_1"),
      (position_set_x, pos1, 500),
      (position_set_y, pos1, 680),
      (overlay_set_position, "$g_presentation_obj_1", pos1),
      (try_begin),
        (eq, "$g_presentation_state", 0),
        (assign, ":var0", 0),
        (try_for_range, ":var1", "fac_commoners", "fac_innocents"),
          (troop_set_slot, "trp_temp_array_a", ":var0", ":var1"),
          (str_store_faction_name, s0, ":var1"),
          (overlay_add_item, "$g_presentation_obj_1", s0),
          (val_add, ":var0", 1),
        (try_end),
        (try_for_range_backwards, ":var1", "fac_player_supporters_faction", "fac_kingdoms_end"),
          (troop_set_slot, "trp_temp_array_a", ":var0", ":var1"),
          (str_store_faction_name, s0, ":var1"),
          (overlay_add_item, "$g_presentation_obj_1", s0),
          (val_add, ":var0", 1),
        (try_end),
        (troop_set_slot, "trp_temp_array_b", 0, 11184810),
        (troop_set_slot, "trp_temp_array_b", 1, 8947848),
        (troop_set_slot, "trp_temp_array_b", 2, 16777215),
        (troop_set_slot, "trp_temp_array_b", 3, 9140480),
        (troop_set_slot, "trp_temp_array_b", 4, 16711680),
        (troop_set_slot, "trp_temp_array_b", 5, 13408512),
        (troop_set_slot, "trp_temp_array_b", 6, 4294967295),
        (troop_set_slot, "trp_temp_array_b", 7, 13417369),
        (troop_set_slot, "trp_temp_array_b", 8, 14518340),
        (troop_set_slot, "trp_temp_array_b", 9, 628224),
        (troop_get_slot, ":var1", "trp_temp_array_a", "$temp"),
        (str_store_faction_name, s0, ":var1"),
        (faction_get_color, ":var2", ":var1"),
        (overlay_set_val, "$g_presentation_obj_1", "$temp"),
        (try_begin),
          (faction_get_slot, ":var3", ":var1", 11),
          (ge, ":var3", 0),
          (create_mesh_overlay_with_tableau_material, reg0, -1, "tableau_game_character_sheet", ":var3"),
          (position_set_x, pos1, 75),
          (position_set_y, pos1, 300),
          (overlay_set_position, reg0, pos1),
          (create_mesh_overlay_with_tableau_material, reg0, -1, "tableau_faction_note_mesh_banner", ":var1"),
          (position_set_x, pos1, 700),
          (position_set_y, pos1, 350),
          (overlay_set_position, reg0, pos1),
          (position_set_x, pos1, 1250),
          (position_set_y, pos1, 1250),
          (overlay_set_size, reg0, pos1),
        (try_end),
      (else_try),
        (eq, "$g_presentation_state", 2),
        (overlay_add_item, "$g_presentation_obj_1", "str_allies_"),
        (overlay_add_item, "$g_presentation_obj_1", "str_enemies_"),
        (try_for_range_backwards, ":var4", 0, 9),
          (troop_get_slot, ":var2", "trp_mercenaries_end", ":var4"),
          (troop_set_slot, "trp_temp_array_b", ":var4", ":var2"),
          (str_store_class_name, 0, ":var4"),
          (overlay_add_item, "$g_presentation_obj_1", s0),
        (try_end),
        (troop_get_slot, ":var4", "trp_temp_array_a", "$temp"),
        (str_store_class_name, 0, ":var4"),
      (else_try),
        (eq, "$g_presentation_state", 1),
        (overlay_set_display, "$g_presentation_obj_1", 0),
        (troop_get_slot, ":var5", "$g_player_troop", 13),
        (val_sub, ":var5", "spr_banner_a"),
        (troop_get_slot, ":var2", "trp_banner_background_color_array", ":var5"),
        (assign, "$temp", ":var5"),
        (troop_set_slot, "trp_temp_array_b", "$temp", ":var2"),
        (val_add, ":var5", "mesh_banner_a01"),
        (create_mesh_overlay, reg0, ":var5"),
        (position_set_x, pos1, 800),
        (position_set_y, pos1, 600),
        (overlay_set_position, reg0, pos1),
        (position_set_x, pos1, 150),
        (position_set_y, pos1, 150),
        (overlay_set_size, reg0, pos1),
      (try_end),
      (store_add, ":var6", "$g_presentation_state", "str_color_of"),
      (str_store_string, s0, ":var6"),
      (create_text_overlay, reg1, ":var6", tf_center_justify),
      (position_set_x, pos1, 500),
      (position_set_y, pos1, 600),
      (overlay_set_position, reg1, pos1),
      (create_mesh_overlay, "$g_presentation_obj_2", "mesh_white_plane"),
      (position_set_x, pos1, 450),
      (position_set_y, pos1, 480),
      (overlay_set_position, "$g_presentation_obj_2", pos1),
      (position_set_x, pos1, 5000),
      (position_set_y, pos1, 5000),
      (overlay_set_size, "$g_presentation_obj_2", pos1),
      (overlay_set_color, "$g_presentation_obj_2", ":var2"),
      (position_set_x, pos1, 500),
      (create_slider_overlay, "$g_presentation_obj_3", 0, 255),
      (position_set_y, pos1, 400),
      (overlay_set_position, "$g_presentation_obj_3", pos1),
      (create_slider_overlay, "$g_presentation_obj_4", 0, 255),
      (position_set_y, pos1, 350),
      (overlay_set_position, "$g_presentation_obj_4", pos1),
      (create_slider_overlay, "$g_presentation_obj_5", 0, 255),
      (position_set_y, pos1, 300),
      (overlay_set_position, "$g_presentation_obj_5", pos1),
      (store_mod, ":var7", ":var2", 256),
      (val_div, ":var2", 256),
      (store_mod, ":var8", ":var2", 256),
      (val_div, ":var2", 256),
      (store_mod, ":var9", ":var2", 256),
      (overlay_set_val, "$g_presentation_obj_3", ":var9"),
      (overlay_set_val, "$g_presentation_obj_4", ":var8"),
      (overlay_set_val, "$g_presentation_obj_5", ":var7"),
      (position_set_x, pos1, 650),
      (create_number_box_overlay, "$g_presentation_obj_6", 0, 256),
      (position_set_y, pos1, 400),
      (overlay_set_position, "$g_presentation_obj_6", pos1),
      (create_number_box_overlay, "$g_presentation_obj_7", 0, 256),
      (position_set_y, pos1, 350),
      (overlay_set_position, "$g_presentation_obj_7", pos1),
      (create_number_box_overlay, "$g_presentation_obj_8", 0, 256),
      (position_set_y, pos1, 300),
      (overlay_set_position, "$g_presentation_obj_8", pos1),
      (overlay_set_val, "$g_presentation_obj_6", ":var9"),
      (overlay_set_val, "$g_presentation_obj_7", ":var8"),
      (overlay_set_val, "$g_presentation_obj_8", ":var7"),
      (assign, reg2, ":var9"),
      (assign, reg3, ":var8"),
      (assign, reg4, ":var7"),
      (position_set_x, pos1, 330),
      (create_text_overlay, reg1, "@Red:", tf_center_justify),
      (position_set_y, pos1, 400),
      (overlay_set_position, reg1, pos1),
      (create_text_overlay, reg1, "@Green:", tf_center_justify),
      (position_set_y, pos1, 350),
      (overlay_set_position, reg1, pos1),
      (create_text_overlay, reg1, "@Blue:", tf_center_justify),
      (position_set_y, pos1, 300),
      (overlay_set_position, reg1, pos1),
      (str_store_string, s0, "str_dplmc_none"),
      (create_text_overlay, "$g_presentation_obj_9", "str_html", tf_center_justify),
      (position_set_x, pos1, 500),
      (position_set_y, pos1, 450),
      (overlay_set_position, "$g_presentation_obj_9", pos1),
      (call_script, "script_convert_rgb_code_to_html_code", reg2, reg3, reg4),
      (overlay_set_text, "$g_presentation_obj_9", "str_html"),
      (create_game_button_overlay, "$g_presentation_obj_11", "str_reset_to_default"),
      (position_set_x, pos1, 420),
      (position_set_y, pos1, 230),
      (overlay_set_position, "$g_presentation_obj_11", pos1),
      (create_game_button_overlay, "$g_presentation_obj_12", "str_randomize"),
      (position_set_x, pos1, 580),
      (position_set_y, pos1, 230),
      (overlay_set_position, "$g_presentation_obj_12", pos1),
      (create_mesh_overlay, reg1, "mesh_white_plane"),
      (position_set_x, pos1, 138),
      (position_set_y, pos1, 78),
      (overlay_set_position, reg1, pos1),
      (position_set_x, pos1, 36100),
      (position_set_y, pos1, 6100),
      (overlay_set_size, reg1, pos1),
      (overlay_set_color, reg1, 0x000000),
      (assign, ":var10", 140),
      (assign, ":var11", 80),
      (try_for_range, ":var12", 0, 216),
        (create_image_button_overlay, reg1, "mesh_white_plane", "mesh_white_plane"),
        (position_set_x, pos1, ":var10"),
        (position_set_y, pos1, ":var11"),
        (overlay_set_position, reg1, pos1),
        (position_set_x, pos1, 900),
        (position_set_y, pos1, 900),
        (overlay_set_size, reg1, pos1),
        (assign, ":var13", ":var12"),
        (call_script, "script_convert_slot_no_to_color", ":var13"),
        (assign, ":var14", reg0),
        (overlay_set_color, reg1, ":var14"),
        (val_add, ":var10", 20),
        (try_begin),
          (eq, ":var10", 860),
          (assign, ":var10", 140),
          (val_add, ":var11", 20),
        (try_end),
        (troop_set_slot, "trp_temp_array_c", ":var12", reg1),
      (try_end),
      (create_game_button_overlay, "$g_presentation_obj_10", "str_done"),
      (position_set_x, pos1, 900),
      (position_set_y, pos1, 25),
      (overlay_set_position, "$g_presentation_obj_10", pos1),
    ]),
    (ti_on_presentation_event_state_change,
    [
      (store_trigger_param_1, ":var0"),
      (store_trigger_param_2, ":var1"),
      (try_begin),
        (eq, ":var0", "$g_presentation_obj_1"),
        (assign, "$temp", ":var1"),
        (start_presentation, "prsnt_change_color"),
      (else_try),
        (this_or_next|eq, ":var0", "$g_presentation_obj_3"),
        (eq, ":var0", "$g_presentation_obj_6"),
        (overlay_set_val, "$g_presentation_obj_3", ":var1"),
        (overlay_set_val, "$g_presentation_obj_6", ":var1"),
        (assign, reg2, ":var1"),
        (call_script, "script_change_color"),
      (else_try),
        (this_or_next|eq, ":var0", "$g_presentation_obj_4"),
        (eq, ":var0", "$g_presentation_obj_7"),
        (overlay_set_val, "$g_presentation_obj_4", ":var1"),
        (overlay_set_val, "$g_presentation_obj_7", ":var1"),
        (assign, reg3, ":var1"),
        (call_script, "script_change_color"),
      (else_try),
        (this_or_next|eq, ":var0", "$g_presentation_obj_5"),
        (eq, ":var0", "$g_presentation_obj_8"),
        (overlay_set_val, "$g_presentation_obj_5", ":var1"),
        (overlay_set_val, "$g_presentation_obj_8", ":var1"),
        (assign, reg4, ":var1"),
        (call_script, "script_change_color"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_11"),
        (troop_get_slot, ":var2", "trp_temp_array_a", "$temp"),
        (troop_get_slot, ":var3", "trp_temp_array_b", "$temp"),
        (try_begin),
          (eq, "$g_presentation_state", 0),
          (faction_set_color, ":var2", ":var3"),
        (else_try),
          (eq, "$g_presentation_state", 2),
          (troop_set_slot, "trp_mercenaries_end", "$temp", ":var3"),
        (else_try),
          (eq, "$g_presentation_state", 1),
          (troop_set_slot, "trp_banner_background_color_array", "$temp", ":var3"),
        (try_end),
        (overlay_set_color, "$g_presentation_obj_2", ":var3"),
        (store_mod, ":var4", ":var3", 256),
        (val_div, ":var3", 256),
        (store_mod, ":var5", ":var3", 256),
        (val_div, ":var3", 256),
        (store_mod, ":var6", ":var3", 256),
        (overlay_set_val, "$g_presentation_obj_3", ":var6"),
        (overlay_set_val, "$g_presentation_obj_4", ":var5"),
        (overlay_set_val, "$g_presentation_obj_5", ":var4"),
        (overlay_set_val, "$g_presentation_obj_6", ":var6"),
        (overlay_set_val, "$g_presentation_obj_7", ":var5"),
        (overlay_set_val, "$g_presentation_obj_8", ":var4"),
        (assign, reg2, ":var6"),
        (assign, reg3, ":var5"),
        (assign, reg4, ":var4"),
        (call_script, "script_convert_rgb_code_to_html_code", reg2, reg3, reg4),
        (overlay_set_text, "$g_presentation_obj_9", "str_html"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_12"),
        (store_random_in_range, reg2, 0, 256),
        (store_random_in_range, reg3, 0, 256),
        (store_random_in_range, reg4, 0, 256),
        (overlay_set_val, "$g_presentation_obj_3", reg2),
        (overlay_set_val, "$g_presentation_obj_4", reg3),
        (overlay_set_val, "$g_presentation_obj_5", reg4),
        (overlay_set_val, "$g_presentation_obj_6", reg2),
        (overlay_set_val, "$g_presentation_obj_7", reg3),
        (overlay_set_val, "$g_presentation_obj_8", reg4),
        (call_script, "script_change_color"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_10"),
        (try_begin),
          (gt, "$g_presentation_next_presentation", 0),
          (try_begin),
            (eq, "$g_presentation_next_presentation", "prsnt_name_kingdom"),
            (eq, "$g_presentation_state", 0),
            (assign, "$g_presentation_state", 1),
          (try_end),
          (start_presentation, "$g_presentation_next_presentation"),
        (else_try),
          (presentation_set_duration, 0),
        (try_end),
      (else_try),
        (try_for_range, ":var7", 0, 216),
          (troop_slot_eq, "trp_temp_array_c", ":var7", ":var0"),
          (assign, ":var8", ":var7"),
          (call_script, "script_convert_slot_no_to_color", ":var8"),
          (assign, ":var9", reg0),
          (store_mod, ":var4", ":var9", 256),
          (val_div, ":var9", 256),
          (store_mod, ":var5", ":var9", 256),
          (val_div, ":var9", 256),
          (store_mod, ":var6", ":var9", 256),
          (overlay_set_val, "$g_presentation_obj_3", ":var6"),
          (overlay_set_val, "$g_presentation_obj_4", ":var5"),
          (overlay_set_val, "$g_presentation_obj_5", ":var4"),
          (overlay_set_val, "$g_presentation_obj_6", ":var6"),
          (overlay_set_val, "$g_presentation_obj_7", ":var5"),
          (overlay_set_val, "$g_presentation_obj_8", ":var4"),
          (assign, reg2, ":var6"),
          (assign, reg3, ":var5"),
          (assign, reg4, ":var4"),
          (call_script, "script_change_color"),
        (try_end),
      (try_end),
    ]),
  ]),

  ("banner_selection", 0, mesh_load_window,
  [
    (ti_on_presentation_load,
    [
      (set_fixed_point_multiplier, 1000),
      (str_store_string, s1, "str_banner_selection_text"),
      (create_text_overlay, reg1, s1, tf_center_justify),
      (position_set_x, pos1, 500),
      (position_set_y, pos1, 600),
      (overlay_set_position, reg1, pos1),
      (overlay_set_text, reg1, s1),
      (create_button_overlay, "$g_presentation_obj_banner_selection_1", "@Next Page", tf_center_justify),
      (position_set_x, pos1, 500),
      (position_set_y, pos1, 50),
      (overlay_set_position, "$g_presentation_obj_banner_selection_1", pos1),
      (assign, ":var0", 150),
      (assign, ":var1", 575),
      (assign, ":var2", "mesh_banner_f21"),
      (store_sub, ":var3", "fac_kingdoms_end", "fac_kingdom_1"),
      (val_sub, ":var2", ":var3"),
      (store_mul, ":var4", 16, "$g_presentation_page_no"),
      (val_add, ":var4", "mesh_banner_a01"),
      (store_add, ":var5", ":var4", 16),
      (val_min, ":var2", ":var5"),
      (store_add, "$g_presentation_banner_start", "$g_presentation_obj_banner_selection_1", 1),
      (try_for_range, ":var6", ":var4", ":var2"),
        (create_image_button_overlay, reg1, ":var6", ":var6"),
        (position_set_x, pos1, ":var0"),
        (position_set_y, pos1, ":var1"),
        (overlay_set_position, reg1, pos1),
        (position_set_x, pos1, 100),
        (position_set_y, pos1, 100),
        (overlay_set_size, reg1, pos1),
        (val_add, ":var0", 100),
        (ge, ":var0", 900),
        (assign, ":var0", 150),
        (val_sub, ":var1", 250),
      (try_end),
      (presentation_set_duration, 999999),
    ]),
    (ti_on_presentation_event_state_change,
    [
      (store_trigger_param_1, ":var0"),
      (try_begin),
        (eq, ":var0", "$g_presentation_obj_banner_selection_1"),
        (val_add, "$g_presentation_page_no", 1),
        (val_mod, "$g_presentation_page_no", 21),
        (start_presentation, "prsnt_banner_selection"),
      (else_try),
        (store_sub, ":var1", ":var0", "$g_presentation_banner_start"),
        (store_mul, ":var2", 16, "$g_presentation_page_no"),
        (val_add, ":var1", ":var2"),
        (store_add, ":var3", ":var1", "icon_banner_01"),
        (party_set_banner_icon, "p_main_party", ":var3"),
        (store_add, ":var4", ":var1", "spr_banner_a"),
        (troop_set_slot, "trp_player", 13, ":var4"),
        (presentation_set_duration, 0),
        (assign, ":var5", 0),
        (assign, ":var6", "trp_knight_1_1_wife"),
        (try_for_range, ":var7", "trp_npc1", ":var6"),
          (troop_slot_eq, ":var7", 13, ":var4"),
          (assign, ":var5", ":var7"),
          (assign, ":var6", 0),
          (troop_set_slot, ":var7", 13, "spr_banner_f21"),
          (troop_get_slot, ":var8", ":var7", 10),
          (gt, ":var8", 0),
          (party_set_banner_icon, ":var8", "icon_banner_388"),
        (try_end),
        (try_for_range, ":var9", "p_town_1", "p_village_1"),
          (try_begin),
            (party_slot_eq, ":var9", 7, "trp_player"),
            (party_set_banner_icon, ":var9", ":var3"),
          (else_try),
            (party_slot_eq, ":var9", 7, ":var5"),
            (party_set_banner_icon, ":var9", "icon_banner_388"),
          (try_end),
        (try_end),
      (try_end),
    ]),
    (ti_on_presentation_run,
    [
      (try_begin),
        (this_or_next|key_clicked, key_space),
        (this_or_next|key_clicked, key_enter),
        (this_or_next|key_clicked, key_escape),
        (this_or_next|key_clicked, key_back_space),
        (this_or_next|key_clicked, key_xbox_ltrigger),
        (key_clicked, key_xbox_rtrigger),
        (presentation_set_duration, 0),
      (try_end),
    ]),
  ]),

  ("custom_banner", 0, mesh_load_window,
  [
    (ti_on_presentation_load,
    [
      (set_fixed_point_multiplier, 1000),
      (troop_get_slot, ":var0", "trp_player", 96),
      (val_max, ":var0", 0),
      (val_add, ":var0", "mesh_custom_banner_01"),
      (troop_get_slot, ":var1", "trp_player", 99),
      (val_max, ":var1", 0),
      (val_add, ":var1", "mesh_custom_map_banner_01"),
      (troop_get_slot, ":var2", "trp_player", 85),
      (troop_get_slot, ":var3", "trp_player", 86),
      (create_text_overlay, reg1, "str_color_no_1", 0),
      (position_set_x, pos1, 40),
      (position_set_y, pos1, 550),
      (overlay_set_position, reg1, pos1),
      (create_text_overlay, reg1, "str_color_no_2", 0),
      (position_set_x, pos1, 40),
      (position_set_y, pos1, 500),
      (overlay_set_position, reg1, pos1),
      (create_image_button_overlay_with_tableau_material, "$g_presentation_obj_custom_banner_22", "mesh_color_picker", "tableau_color_picker", ":var2"),
      (create_image_button_overlay_with_tableau_material, "$g_presentation_obj_custom_banner_23", "mesh_color_picker", "tableau_color_picker", ":var3"),
      (position_set_x, pos1, 200),
      (position_set_y, pos1, 565),
      (overlay_set_position, "$g_presentation_obj_custom_banner_22", pos1),
      (position_set_y, pos1, 515),
      (overlay_set_position, "$g_presentation_obj_custom_banner_23", pos1),
      (position_set_x, pos1, 250),
      (position_set_y, pos1, 250),
      (overlay_set_size, "$g_presentation_obj_custom_banner_22", pos1),
      (overlay_set_size, "$g_presentation_obj_custom_banner_23", pos1),
      (create_button_overlay, "$g_presentation_obj_custom_banner_2", "str_change", tf_center_justify),
      (create_button_overlay, "$g_presentation_obj_custom_banner_3", "str_change", tf_center_justify),
      (create_button_overlay, "$g_presentation_obj_custom_banner_4", "str_change_background", tf_center_justify),
      (create_button_overlay, "$g_presentation_obj_custom_banner_5", "str_change", tf_center_justify),
      (create_button_overlay, "$g_presentation_obj_custom_banner_19", "str_change", tf_center_justify),
      (create_button_overlay, "$g_presentation_obj_custom_banner_20", "str_accept", tf_center_justify),
      (troop_get_slot, ":var4", "trp_player", 97),
      (create_button_overlay, "$g_presentation_obj_custom_banner_16", "str_randomize", tf_center_justify),
      (create_image_button_overlay_with_tableau_material, "$g_presentation_obj_custom_banner_17", ":var0", "tableau_custom_banner_default", "trp_player"),
      (try_begin),
        (eq, ":var1", "mesh_custom_map_banner_01"),
        (create_image_button_overlay_with_tableau_material, "$g_presentation_obj_custom_banner_18", ":var1", "tableau_custom_banner_square", "trp_player"),
      (else_try),
        (eq, ":var1", "mesh_custom_map_banner_02"),
        (create_image_button_overlay_with_tableau_material, "$g_presentation_obj_custom_banner_18", ":var1", "tableau_custom_banner_short", "trp_player"),
      (else_try),
        (create_image_button_overlay_with_tableau_material, "$g_presentation_obj_custom_banner_18", ":var1", "tableau_custom_banner_tall", "trp_player"),
      (try_end),
      (create_image_button_overlay_with_tableau_material, "$g_presentation_obj_custom_banner_1", -1, "tableau_custom_banner_square_no_mesh", "trp_player"),
      (create_text_overlay, reg1, "str_sample_banner", tf_center_justify),
      (position_set_x, pos1, 825),
      (position_set_y, pos1, 650),
      (overlay_set_position, reg1, pos1),
      (create_text_overlay, reg1, "str_sample_map_banner", tf_center_justify),
      (position_set_y, pos1, 500),
      (overlay_set_position, reg1, pos1),
      (position_set_x, pos1, 800),
      (position_set_y, pos1, 640),
      (overlay_set_position, "$g_presentation_obj_custom_banner_17", pos1),
      (position_set_x, pos1, 780),
      (position_set_y, pos1, 315),
      (overlay_set_position, "$g_presentation_obj_custom_banner_18", pos1),
      (position_set_x, pos1, 50),
      (position_set_y, pos1, 50),
      (overlay_set_size, "$g_presentation_obj_custom_banner_17", pos1),
      (position_set_x, pos1, 50),
      (position_set_y, pos1, 50),
      (overlay_set_size, "$g_presentation_obj_custom_banner_18", pos1),
      (create_text_overlay, reg1, "str_number_of_charges", 0),
      (position_set_x, pos1, 40),
      (position_set_y, pos1, 350),
      (overlay_set_position, reg1, pos1),
      (assign, reg1, ":var4"),
      (create_text_overlay, reg2, "str_reg1", tf_center_justify),
      (position_set_x, pos1, 350),
      (position_set_y, pos1, 350),
      (overlay_set_position, reg2, pos1),
      (try_begin),
        (lt, ":var4", 4),
        (create_button_overlay, "$g_presentation_obj_custom_banner_15", "str_plus", tf_center_justify),
        (position_set_x, pos1, 385),
        (position_set_y, pos1, 350),
        (overlay_set_position, "$g_presentation_obj_custom_banner_15", pos1),
      (else_try),
        (assign, "$g_presentation_obj_custom_banner_15", -1),
      (try_end),
      (try_begin),
        (gt, ":var4", 0),
        (create_button_overlay, "$g_presentation_obj_custom_banner_21", "str_minus", tf_center_justify),
        (position_set_x, pos1, 370),
        (position_set_y, pos1, 350),
        (overlay_set_position, "$g_presentation_obj_custom_banner_21", pos1),
      (else_try),
        (assign, "$g_presentation_obj_custom_banner_21", -1),
      (try_end),
      (try_begin),
        (ge, ":var4", 1),
        (create_text_overlay, reg1, "str_charge", tf_center_justify),
        (position_set_x, pos1, 300),
        (position_set_y, pos1, 300),
        (overlay_set_position, reg1, pos1),
        (create_text_overlay, reg1, "str_color", tf_center_justify),
        (position_set_x, pos1, 550),
        (position_set_y, pos1, 300),
        (overlay_set_position, reg1, pos1),
        (create_button_overlay, "$g_presentation_obj_custom_banner_14", "str_change_charge_position", tf_center_justify),
        (position_set_y, pos1, 350),
        (position_set_x, pos1, 550),
        (overlay_set_position, "$g_presentation_obj_custom_banner_14", pos1),
        (create_text_overlay, reg1, "str_charge_no_1", 0),
        (position_set_x, pos1, 40),
        (position_set_y, pos1, 240),
        (overlay_set_position, reg1, pos1),
        (create_button_overlay, "$g_presentation_obj_custom_banner_6", "str_change", 0),
        (position_set_x, pos1, 310),
        (overlay_set_position, "$g_presentation_obj_custom_banner_6", pos1),
        (create_button_overlay, "$g_presentation_obj_custom_banner_7", "str_change", 0),
        (position_set_x, pos1, 560),
        (overlay_set_position, "$g_presentation_obj_custom_banner_7", pos1),
        (troop_get_slot, ":var5", "trp_player", 92),
        (val_mod, ":var5", 256),
        (val_add, ":var5", "mesh_custom_banner_charge_01"),
        (create_image_button_overlay, "$g_presentation_obj_custom_banner_24", ":var5", ":var5"),
        (position_set_x, pos1, 260),
        (position_set_y, pos1, 255),
        (overlay_set_position, "$g_presentation_obj_custom_banner_24", pos1),
        (position_set_x, pos1, 50),
        (position_set_y, pos1, 50),
        (overlay_set_size, "$g_presentation_obj_custom_banner_24", pos1),
        (troop_get_slot, ":var6", "trp_player", 87),
        (create_image_button_overlay_with_tableau_material, "$g_presentation_obj_custom_banner_28", "mesh_color_picker", "tableau_color_picker", ":var6"),
        (position_set_x, pos1, 530),
        (position_set_y, pos1, 255),
        (overlay_set_position, "$g_presentation_obj_custom_banner_28", pos1),
        (position_set_x, pos1, 250),
        (position_set_y, pos1, 250),
        (overlay_set_size, "$g_presentation_obj_custom_banner_28", pos1),
        (create_button_overlay, "$g_presentation_obj_custom_banner_32", "str_flip_horizontal", 0),
        (position_set_x, pos1, 700),
        (position_set_y, pos1, 240),
        (overlay_set_position, "$g_presentation_obj_custom_banner_32", pos1),
        (create_button_overlay, "$g_presentation_obj_custom_banner_33", "str_flip_vertical", 0),
        (position_set_x, pos1, 800),
        (overlay_set_position, "$g_presentation_obj_custom_banner_33", pos1),
      (try_end),
      (try_begin),
        (ge, ":var4", 2),
        (create_text_overlay, reg1, "str_charge_no_2", 0),
        (position_set_x, pos1, 40),
        (position_set_y, pos1, 180),
        (overlay_set_position, reg1, pos1),
        (create_button_overlay, "$g_presentation_obj_custom_banner_8", "str_change", 0),
        (position_set_x, pos1, 310),
        (overlay_set_position, "$g_presentation_obj_custom_banner_8", pos1),
        (create_button_overlay, "$g_presentation_obj_custom_banner_9", "str_change", 0),
        (position_set_x, pos1, 560),
        (overlay_set_position, "$g_presentation_obj_custom_banner_9", pos1),
        (troop_get_slot, ":var5", "trp_player", 93),
        (val_mod, ":var5", 256),
        (val_add, ":var5", "mesh_custom_banner_charge_01"),
        (create_image_button_overlay, "$g_presentation_obj_custom_banner_25", ":var5", ":var5"),
        (position_set_x, pos1, 260),
        (position_set_y, pos1, 195),
        (overlay_set_position, "$g_presentation_obj_custom_banner_25", pos1),
        (position_set_x, pos1, 50),
        (position_set_y, pos1, 50),
        (overlay_set_size, "$g_presentation_obj_custom_banner_25", pos1),
        (troop_get_slot, ":var6", "trp_player", 88),
        (create_image_button_overlay_with_tableau_material, "$g_presentation_obj_custom_banner_29", "mesh_color_picker", "tableau_color_picker", ":var6"),
        (position_set_x, pos1, 530),
        (position_set_y, pos1, 195),
        (overlay_set_position, "$g_presentation_obj_custom_banner_29", pos1),
        (position_set_x, pos1, 250),
        (position_set_y, pos1, 250),
        (overlay_set_size, "$g_presentation_obj_custom_banner_29", pos1),
        (create_button_overlay, "$g_presentation_obj_custom_banner_34", "str_flip_horizontal", 0),
        (position_set_x, pos1, 700),
        (position_set_y, pos1, 180),
        (overlay_set_position, "$g_presentation_obj_custom_banner_34", pos1),
        (create_button_overlay, "$g_presentation_obj_custom_banner_35", "str_flip_vertical", 0),
        (position_set_x, pos1, 800),
        (overlay_set_position, "$g_presentation_obj_custom_banner_35", pos1),
      (try_end),
      (try_begin),
        (ge, ":var4", 3),
        (create_text_overlay, reg1, "str_charge_no_3", 0),
        (position_set_x, pos1, 40),
        (position_set_y, pos1, 120),
        (overlay_set_position, reg1, pos1),
        (create_button_overlay, "$g_presentation_obj_custom_banner_10", "str_change", 0),
        (position_set_x, pos1, 310),
        (overlay_set_position, "$g_presentation_obj_custom_banner_10", pos1),
        (create_button_overlay, "$g_presentation_obj_custom_banner_11", "str_change", 0),
        (position_set_x, pos1, 560),
        (overlay_set_position, "$g_presentation_obj_custom_banner_11", pos1),
        (troop_get_slot, ":var5", "trp_player", 94),
        (val_mod, ":var5", 256),
        (val_add, ":var5", "mesh_custom_banner_charge_01"),
        (create_image_button_overlay, "$g_presentation_obj_custom_banner_26", ":var5", ":var5"),
        (position_set_x, pos1, 260),
        (position_set_y, pos1, 135),
        (overlay_set_position, "$g_presentation_obj_custom_banner_26", pos1),
        (position_set_x, pos1, 50),
        (position_set_y, pos1, 50),
        (overlay_set_size, "$g_presentation_obj_custom_banner_26", pos1),
        (troop_get_slot, ":var6", "trp_player", 89),
        (create_image_button_overlay_with_tableau_material, "$g_presentation_obj_custom_banner_30", "mesh_color_picker", "tableau_color_picker", ":var6"),
        (position_set_x, pos1, 530),
        (position_set_y, pos1, 135),
        (overlay_set_position, "$g_presentation_obj_custom_banner_30", pos1),
        (position_set_x, pos1, 250),
        (position_set_y, pos1, 250),
        (overlay_set_size, "$g_presentation_obj_custom_banner_30", pos1),
        (create_button_overlay, "$g_presentation_obj_custom_banner_36", "str_flip_horizontal", 0),
        (position_set_x, pos1, 700),
        (position_set_y, pos1, 120),
        (overlay_set_position, "$g_presentation_obj_custom_banner_36", pos1),
        (create_button_overlay, "$g_presentation_obj_custom_banner_37", "str_flip_vertical", 0),
        (position_set_x, pos1, 800),
        (overlay_set_position, "$g_presentation_obj_custom_banner_37", pos1),
      (try_end),
      (try_begin),
        (ge, ":var4", 4),
        (create_text_overlay, reg1, "str_charge_no_4", 0),
        (position_set_x, pos1, 40),
        (position_set_y, pos1, 60),
        (overlay_set_position, reg1, pos1),
        (create_button_overlay, "$g_presentation_obj_custom_banner_12", "str_change", 0),
        (position_set_x, pos1, 310),
        (overlay_set_position, "$g_presentation_obj_custom_banner_12", pos1),
        (create_button_overlay, "$g_presentation_obj_custom_banner_13", "str_change", 0),
        (position_set_x, pos1, 560),
        (overlay_set_position, "$g_presentation_obj_custom_banner_13", pos1),
        (troop_get_slot, ":var5", "trp_player", 95),
        (val_mod, ":var5", 256),
        (val_add, ":var5", "mesh_custom_banner_charge_01"),
        (create_image_button_overlay, "$g_presentation_obj_custom_banner_27", ":var5", ":var5"),
        (position_set_x, pos1, 260),
        (position_set_y, pos1, 75),
        (overlay_set_position, "$g_presentation_obj_custom_banner_27", pos1),
        (position_set_x, pos1, 50),
        (position_set_y, pos1, 50),
        (overlay_set_size, "$g_presentation_obj_custom_banner_27", pos1),
        (troop_get_slot, ":var6", "trp_player", 90),
        (create_image_button_overlay_with_tableau_material, "$g_presentation_obj_custom_banner_31", "mesh_color_picker", "tableau_color_picker", ":var6"),
        (position_set_x, pos1, 530),
        (position_set_y, pos1, 75),
        (overlay_set_position, "$g_presentation_obj_custom_banner_31", pos1),
        (position_set_x, pos1, 250),
        (position_set_y, pos1, 250),
        (overlay_set_size, "$g_presentation_obj_custom_banner_31", pos1),
        (create_button_overlay, "$g_presentation_obj_custom_banner_38", "str_flip_horizontal", 0),
        (position_set_x, pos1, 700),
        (position_set_y, pos1, 60),
        (overlay_set_position, "$g_presentation_obj_custom_banner_38", pos1),
        (create_button_overlay, "$g_presentation_obj_custom_banner_39", "str_flip_vertical", 0),
        (position_set_x, pos1, 800),
        (overlay_set_position, "$g_presentation_obj_custom_banner_39", pos1),
      (try_end),
      (position_set_x, pos1, 350),
      (position_set_y, pos1, 400),
      (overlay_set_position, "$g_presentation_obj_custom_banner_1", pos1),
      (position_set_x, pos1, 275),
      (position_set_y, pos1, 550),
      (overlay_set_position, "$g_presentation_obj_custom_banner_2", pos1),
      (position_set_y, pos1, 500),
      (overlay_set_position, "$g_presentation_obj_custom_banner_3", pos1),
      (position_set_x, pos1, 175),
      (position_set_y, pos1, 600),
      (overlay_set_position, "$g_presentation_obj_custom_banner_4", pos1),
      (position_set_x, pos1, 880),
      (position_set_y, pos1, 575),
      (overlay_set_position, "$g_presentation_obj_custom_banner_5", pos1),
      (position_set_y, pos1, 400),
      (overlay_set_position, "$g_presentation_obj_custom_banner_19", pos1),
      (position_set_y, pos1, 650),
      (position_set_x, pos1, 175),
      (overlay_set_position, "$g_presentation_obj_custom_banner_16", pos1),
      (position_set_y, pos1, 150),
      (position_set_x, pos1, 850),
      (overlay_set_position, "$g_presentation_obj_custom_banner_20", pos1),
      (presentation_set_duration, 999999),
    ]),
    (ti_on_presentation_event_state_change,
    [
      (store_trigger_param_1, ":var0"),
      (troop_get_slot, ":var1", "trp_player", 97),
      (try_begin),
        (this_or_next|eq, ":var0", "$g_presentation_obj_custom_banner_2"),
        (eq, ":var0", "$g_presentation_obj_custom_banner_22"),
        (assign, "$g_presentation_next_presentation", "prsnt_custom_banner"),
        (assign, "$g_presentation_output_slot", 85),
        (start_presentation, "prsnt_color_selection"),
      (else_try),
        (this_or_next|eq, ":var0", "$g_presentation_obj_custom_banner_3"),
        (eq, ":var0", "$g_presentation_obj_custom_banner_23"),
        (assign, "$g_presentation_next_presentation", "prsnt_custom_banner"),
        (assign, "$g_presentation_output_slot", 86),
        (start_presentation, "prsnt_color_selection"),
      (else_try),
        (this_or_next|eq, ":var0", "$g_presentation_obj_custom_banner_4"),
        (eq, ":var0", "$g_presentation_obj_custom_banner_1"),
        (assign, "$g_presentation_next_presentation", "prsnt_custom_banner"),
        (start_presentation, "prsnt_banner_background_selection"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_custom_banner_5"),
        (assign, "$g_presentation_next_presentation", "prsnt_custom_banner"),
        (start_presentation, "prsnt_banner_flag_type_selection"),
      (else_try),
        (ge, ":var1", 1),
        (this_or_next|eq, ":var0", "$g_presentation_obj_custom_banner_6"),
        (eq, ":var0", "$g_presentation_obj_custom_banner_24"),
        (assign, "$g_presentation_next_presentation", "prsnt_custom_banner"),
        (assign, "$g_presentation_output_slot", 92),
        (start_presentation, "prsnt_banner_charge_selection"),
      (else_try),
        (ge, ":var1", 1),
        (this_or_next|eq, ":var0", "$g_presentation_obj_custom_banner_7"),
        (eq, ":var0", "$g_presentation_obj_custom_banner_28"),
        (assign, "$g_presentation_next_presentation", "prsnt_custom_banner"),
        (assign, "$g_presentation_output_slot", 87),
        (start_presentation, "prsnt_color_selection"),
      (else_try),
        (ge, ":var1", 2),
        (this_or_next|eq, ":var0", "$g_presentation_obj_custom_banner_8"),
        (eq, ":var0", "$g_presentation_obj_custom_banner_25"),
        (assign, "$g_presentation_next_presentation", "prsnt_custom_banner"),
        (assign, "$g_presentation_output_slot", 93),
        (start_presentation, "prsnt_banner_charge_selection"),
      (else_try),
        (ge, ":var1", 2),
        (this_or_next|eq, ":var0", "$g_presentation_obj_custom_banner_9"),
        (eq, ":var0", "$g_presentation_obj_custom_banner_29"),
        (assign, "$g_presentation_next_presentation", "prsnt_custom_banner"),
        (assign, "$g_presentation_output_slot", 88),
        (start_presentation, "prsnt_color_selection"),
      (else_try),
        (ge, ":var1", 3),
        (this_or_next|eq, ":var0", "$g_presentation_obj_custom_banner_10"),
        (eq, ":var0", "$g_presentation_obj_custom_banner_26"),
        (assign, "$g_presentation_next_presentation", "prsnt_custom_banner"),
        (assign, "$g_presentation_output_slot", 94),
        (start_presentation, "prsnt_banner_charge_selection"),
      (else_try),
        (ge, ":var1", 3),
        (this_or_next|eq, ":var0", "$g_presentation_obj_custom_banner_11"),
        (eq, ":var0", "$g_presentation_obj_custom_banner_30"),
        (assign, "$g_presentation_next_presentation", "prsnt_custom_banner"),
        (assign, "$g_presentation_output_slot", 89),
        (start_presentation, "prsnt_color_selection"),
      (else_try),
        (ge, ":var1", 4),
        (this_or_next|eq, ":var0", "$g_presentation_obj_custom_banner_12"),
        (eq, ":var0", "$g_presentation_obj_custom_banner_27"),
        (assign, "$g_presentation_next_presentation", "prsnt_custom_banner"),
        (assign, "$g_presentation_output_slot", 95),
        (start_presentation, "prsnt_banner_charge_selection"),
      (else_try),
        (ge, ":var1", 4),
        (this_or_next|eq, ":var0", "$g_presentation_obj_custom_banner_13"),
        (eq, ":var0", "$g_presentation_obj_custom_banner_31"),
        (assign, "$g_presentation_next_presentation", "prsnt_custom_banner"),
        (assign, "$g_presentation_output_slot", 90),
        (start_presentation, "prsnt_color_selection"),
      (else_try),
        (ge, ":var1", 1),
        (eq, ":var0", "$g_presentation_obj_custom_banner_14"),
        (assign, "$g_presentation_next_presentation", "prsnt_custom_banner"),
        (start_presentation, "prsnt_banner_charge_positioning"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_custom_banner_15"),
        (troop_get_slot, ":var1", "trp_player", 97),
        (val_add, ":var1", 1),
        (val_clamp, ":var1", 0, 5),
        (troop_set_slot, "trp_player", 97, ":var1"),
        (start_presentation, "prsnt_custom_banner"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_custom_banner_21"),
        (troop_get_slot, ":var1", "trp_player", 97),
        (val_sub, ":var1", 1),
        (val_clamp, ":var1", 0, 5),
        (troop_set_slot, "trp_player", 97, ":var1"),
        (start_presentation, "prsnt_custom_banner"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_custom_banner_16"),
        (call_script, "script_get_random_custom_banner", "trp_player"),
        (start_presentation, "prsnt_custom_banner"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_custom_banner_17"),
        (assign, "$g_presentation_next_presentation", "prsnt_custom_banner"),
        (start_presentation, "prsnt_banner_flag_type_selection"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_custom_banner_18"),
        (assign, "$g_presentation_next_presentation", "prsnt_custom_banner"),
        (start_presentation, "prsnt_banner_flag_map_type_selection"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_custom_banner_19"),
        (assign, "$g_presentation_next_presentation", "prsnt_custom_banner"),
        (start_presentation, "prsnt_banner_flag_map_type_selection"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_custom_banner_32"),
        (troop_get_slot, ":var2", "trp_player", 92),
        (store_mod, ":var3", ":var2", 256),
        (val_div, ":var2", 256),
        (store_mod, ":var4", ":var2", 2),
        (val_div, ":var2", 2),
        (val_add, ":var4", 1),
        (val_mod, ":var4", 2),
        (val_mul, ":var2", 2),
        (val_add, ":var2", ":var4"),
        (val_mul, ":var2", 256),
        (val_add, ":var2", ":var3"),
        (troop_set_slot, "trp_player", 92, ":var2"),
        (start_presentation, "prsnt_custom_banner"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_custom_banner_34"),
        (troop_get_slot, ":var2", "trp_player", 93),
        (store_mod, ":var3", ":var2", 256),
        (val_div, ":var2", 256),
        (store_mod, ":var4", ":var2", 2),
        (val_div, ":var2", 2),
        (val_add, ":var4", 1),
        (val_mod, ":var4", 2),
        (val_mul, ":var2", 2),
        (val_add, ":var2", ":var4"),
        (val_mul, ":var2", 256),
        (val_add, ":var2", ":var3"),
        (troop_set_slot, "trp_player", 93, ":var2"),
        (start_presentation, "prsnt_custom_banner"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_custom_banner_36"),
        (troop_get_slot, ":var2", "trp_player", 94),
        (store_mod, ":var3", ":var2", 256),
        (val_div, ":var2", 256),
        (store_mod, ":var4", ":var2", 2),
        (val_div, ":var2", 2),
        (val_add, ":var4", 1),
        (val_mod, ":var4", 2),
        (val_mul, ":var2", 2),
        (val_add, ":var2", ":var4"),
        (val_mul, ":var2", 256),
        (val_add, ":var2", ":var3"),
        (troop_set_slot, "trp_player", 94, ":var2"),
        (start_presentation, "prsnt_custom_banner"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_custom_banner_38"),
        (troop_get_slot, ":var2", "trp_player", 95),
        (store_mod, ":var3", ":var2", 256),
        (val_div, ":var2", 256),
        (store_mod, ":var4", ":var2", 2),
        (val_div, ":var2", 2),
        (val_add, ":var4", 1),
        (val_mod, ":var4", 2),
        (val_mul, ":var2", 2),
        (val_add, ":var2", ":var4"),
        (val_mul, ":var2", 256),
        (val_add, ":var2", ":var3"),
        (troop_set_slot, "trp_player", 95, ":var2"),
        (start_presentation, "prsnt_custom_banner"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_custom_banner_33"),
        (troop_get_slot, ":var2", "trp_player", 92),
        (store_div, ":var4", ":var2", 512),
        (val_add, ":var4", 1),
        (val_mod, ":var4", 2),
        (val_mul, ":var4", 512),
        (val_mod, ":var2", 512),
        (val_add, ":var2", ":var4"),
        (troop_set_slot, "trp_player", 92, ":var2"),
        (start_presentation, "prsnt_custom_banner"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_custom_banner_35"),
        (troop_get_slot, ":var2", "trp_player", 93),
        (store_div, ":var4", ":var2", 512),
        (val_add, ":var4", 1),
        (val_mod, ":var4", 2),
        (val_mul, ":var4", 512),
        (val_mod, ":var2", 512),
        (val_add, ":var2", ":var4"),
        (troop_set_slot, "trp_player", 93, ":var2"),
        (start_presentation, "prsnt_custom_banner"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_custom_banner_37"),
        (troop_get_slot, ":var2", "trp_player", 94),
        (store_div, ":var4", ":var2", 512),
        (val_add, ":var4", 1),
        (val_mod, ":var4", 2),
        (val_mul, ":var4", 512),
        (val_mod, ":var2", 512),
        (val_add, ":var2", ":var4"),
        (troop_set_slot, "trp_player", 94, ":var2"),
        (start_presentation, "prsnt_custom_banner"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_custom_banner_39"),
        (troop_get_slot, ":var2", "trp_player", 95),
        (store_div, ":var4", ":var2", 512),
        (val_add, ":var4", 1),
        (val_mod, ":var4", 2),
        (val_mul, ":var4", 512),
        (val_mod, ":var2", 512),
        (val_add, ":var2", ":var4"),
        (troop_set_slot, "trp_player", 95, ":var2"),
        (start_presentation, "prsnt_custom_banner"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_custom_banner_20"),
        (troop_get_slot, ":var5", "trp_player", 99),
        (try_begin),
          (ge, ":var5", 0),
          (val_add, ":var5", "icon_custom_banner_01"),
          (party_set_banner_icon, "p_main_party", ":var5"),
        (try_end),
        (presentation_set_duration, 0),
      (try_end),
    ]),
  ]),

  ("banner_charge_positioning", 0, mesh_load_window,
  [
    (ti_on_presentation_load,
    [
      (set_fixed_point_multiplier, 1000),
      (create_text_overlay, reg1, "str_choose_position", tf_center_justify),
      (position_set_x, pos1, 500),
      (position_set_y, pos1, 600),
      (overlay_set_position, reg1, pos1),
      (assign, ":var0", 125),
      (assign, ":var1", 400),
      (call_script, "script_get_troop_custom_banner_num_positionings", "trp_player"),
      (assign, ":var2", reg0),
      (store_mul, ":var3", ":var2", 125),
      (val_sub, ":var3", 25),
      (store_div, ":var0", ":var3", 2),
      (store_sub, ":var0", 500, ":var0"),
      (try_for_range, ":var4", 0, ":var2"),
        (create_image_button_overlay_with_tableau_material, reg1, -1, "tableau_positioning_selection", ":var4"),
        (position_set_x, pos1, ":var0"),
        (position_set_y, pos1, ":var1"),
        (val_add, ":var0", 125),
        (overlay_set_position, reg1, pos1),
        (troop_set_slot, "trp_temp_array_a", ":var4", reg1),
      (try_end),
      (presentation_set_duration, 999999),
    ]),
    (ti_on_presentation_event_state_change,
    [
      (store_trigger_param_1, ":var0"),
      (call_script, "script_get_troop_custom_banner_num_positionings", "trp_player"),
      (assign, ":var1", reg0),
      (try_for_range, ":var2", 0, ":var1"),
        (troop_slot_eq, "trp_temp_array_a", ":var2", ":var0"),
        (troop_set_slot, "trp_player", 98, ":var2"),
        (assign, ":var1", 0),
      (try_end),
      (try_begin),
        (gt, "$g_presentation_next_presentation", 0),
        (start_presentation, "$g_presentation_next_presentation"),
      (else_try),
        (presentation_set_duration, 0),
      (try_end),
    ]),
  ]),

  ("banner_charge_selection", 0, mesh_load_window,
  [
    (ti_on_presentation_load,
    [
      (set_fixed_point_multiplier, 1000),
      (create_text_overlay, reg1, "str_choose_charge", tf_center_justify),
      (position_set_x, pos1, 500),
      (position_set_y, pos1, 650),
      (overlay_set_position, reg1, pos1),
      (assign, ":var0", 100),
      (assign, ":var1", 600),
      (try_for_range, ":var2", "mesh_custom_banner_charge_01", "mesh_tableau_mesh_custom_banner"),
        (create_image_button_overlay, reg1, ":var2", ":var2"),
        (position_set_x, pos1, ":var0"),
        (position_set_y, pos1, ":var1"),
        (val_add, ":var0", 100),
        (try_begin),
          (gt, ":var0", 900),
          (assign, ":var0", 100),
          (val_sub, ":var1", 100),
        (try_end),
        (overlay_set_position, reg1, pos1),
        (position_set_x, pos1, 80),
        (position_set_y, pos1, 80),
        (overlay_set_size, reg1, pos1),
        (store_sub, ":var3", ":var2", "mesh_custom_banner_charge_01"),
        (troop_set_slot, "trp_temp_array_a", ":var3", reg1),
      (try_end),
      (presentation_set_duration, 999999),
    ]),
    (ti_on_presentation_event_state_change,
    [
      (store_trigger_param_1, ":var0"),
      (assign, ":var1", "mesh_tableau_mesh_custom_banner"),
      (val_sub, ":var1", "mesh_custom_banner_charge_01"),
      (try_for_range, ":var2", 0, ":var1"),
        (troop_slot_eq, "trp_temp_array_a", ":var2", ":var0"),
        (troop_set_slot, "trp_player", "$g_presentation_output_slot", ":var2"),
        (assign, ":var1", 0),
      (try_end),
      (try_begin),
        (gt, "$g_presentation_next_presentation", 0),
        (start_presentation, "$g_presentation_next_presentation"),
      (else_try),
        (presentation_set_duration, 0),
      (try_end),
    ]),
  ]),

  ("banner_background_selection", 0, mesh_load_window,
  [
    (ti_on_presentation_load,
    [
      (set_fixed_point_multiplier, 1000),
      (create_text_overlay, reg1, "str_choose_background", tf_center_justify),
      (position_set_x, pos1, 500),
      (position_set_y, pos1, 600),
      (overlay_set_position, reg1, pos1),
      (assign, ":var0", 75),
      (assign, ":var1", 450),
      (try_for_range, ":var2", "mesh_custom_banner_bg", "mesh_custom_banner_charge_01"),
        (store_sub, ":var3", ":var2", "mesh_custom_banner_bg"),
        (create_image_button_overlay_with_tableau_material, reg1, -1, "tableau_background_selection", ":var3"),
        (position_set_x, pos1, ":var0"),
        (position_set_y, pos1, ":var1"),
        (val_add, ":var0", 125),
        (try_begin),
          (gt, ":var0", 900),
          (assign, ":var0", 75),
          (val_sub, ":var1", 125),
        (try_end),
        (overlay_set_position, reg1, pos1),
        (troop_set_slot, "trp_temp_array_a", ":var3", reg1),
      (try_end),
      (presentation_set_duration, 999999),
    ]),
    (ti_on_presentation_event_state_change,
    [
      (store_trigger_param_1, ":var0"),
      (assign, ":var1", "mesh_custom_banner_charge_01"),
      (val_sub, ":var1", "mesh_custom_banner_bg"),
      (try_for_range, ":var2", 0, ":var1"),
        (troop_slot_eq, "trp_temp_array_a", ":var2", ":var0"),
        (troop_set_slot, "trp_player", 91, ":var2"),
        (assign, ":var1", 0),
      (try_end),
      (try_begin),
        (gt, "$g_presentation_next_presentation", 0),
        (start_presentation, "$g_presentation_next_presentation"),
      (else_try),
        (presentation_set_duration, 0),
      (try_end),
    ]),
  ]),

  ("banner_flag_type_selection", 0, mesh_load_window,
  [
    (ti_on_presentation_load,
    [
      (set_fixed_point_multiplier, 1000),
      (create_text_overlay, reg1, "str_choose_flag_type", tf_center_justify),
      (position_set_x, pos1, 500),
      (position_set_y, pos1, 600),
      (overlay_set_position, reg1, pos1),
      (assign, ":var0", 435),
      (assign, ":var1", 450),
      (try_for_range, ":var2", "mesh_custom_banner_01", "mesh_custom_banner_bg"),
        (store_sub, ":var3", ":var2", "mesh_custom_banner_01"),
        (troop_set_slot, "trp_player", 96, ":var3"),
        (create_image_button_overlay_with_tableau_material, reg1, ":var2", "tableau_custom_banner_default", "trp_player"),
        (position_set_x, pos1, ":var0"),
        (position_set_y, pos1, ":var1"),
        (val_add, ":var0", 130),
        (overlay_set_position, reg1, pos1),
        (position_set_x, pos1, 100),
        (position_set_y, pos1, 100),
        (overlay_set_size, reg1, pos1),
        (troop_set_slot, "trp_temp_array_a", ":var3", reg1),
      (try_end),
      (presentation_set_duration, 999999),
    ]),
    (ti_on_presentation_event_state_change,
    [
      (store_trigger_param_1, ":var0"),
      (assign, ":var1", "mesh_custom_banner_bg"),
      (val_sub, ":var1", "mesh_custom_banner_01"),
      (try_for_range, ":var2", 0, ":var1"),
        (troop_slot_eq, "trp_temp_array_a", ":var2", ":var0"),
        (troop_set_slot, "trp_player", 96, ":var2"),
        (assign, ":var1", 0),
      (try_end),
      (try_begin),
        (gt, "$g_presentation_next_presentation", 0),
        (start_presentation, "$g_presentation_next_presentation"),
      (else_try),
        (presentation_set_duration, 0),
      (try_end),
    ]),
  ]),

  ("banner_flag_map_type_selection", 0, mesh_load_window,
  [
    (ti_on_presentation_load,
    [
      (set_fixed_point_multiplier, 1000),
      (create_text_overlay, reg1, "str_choose_map_flag_type", tf_center_justify),
      (position_set_x, pos1, 500),
      (position_set_y, pos1, 600),
      (overlay_set_position, reg1, pos1),
      (troop_get_slot, ":var0", "trp_player", 91),
      (val_add, ":var0", "mesh_custom_banner_bg"),
      (assign, ":var1", 250),
      (assign, ":var2", 150),
      (try_for_range, ":var3", "mesh_custom_map_banner_01", "mesh_custom_banner_01"),
        (store_sub, ":var4", ":var3", "mesh_custom_map_banner_01"),
        (troop_set_slot, "trp_player", 99, ":var4"),
        (try_begin),
          (eq, ":var3", "mesh_custom_map_banner_01"),
          (create_image_button_overlay_with_tableau_material, reg1, ":var3", "tableau_custom_banner_square", "trp_player"),
        (else_try),
          (eq, ":var3", "mesh_custom_map_banner_02"),
          (create_image_button_overlay_with_tableau_material, reg1, ":var3", "tableau_custom_banner_short", "trp_player"),
        (else_try),
          (create_image_button_overlay_with_tableau_material, reg1, ":var3", "tableau_custom_banner_tall", "trp_player"),
        (try_end),
        (position_set_x, pos1, ":var1"),
        (position_set_y, pos1, ":var2"),
        (val_add, ":var1", 200),
        (overlay_set_position, reg1, pos1),
        (position_set_x, pos1, 100),
        (position_set_y, pos1, 100),
        (overlay_set_size, reg1, pos1),
        (troop_set_slot, "trp_temp_array_a", ":var4", reg1),
      (try_end),
      (presentation_set_duration, 999999),
    ]),
    (ti_on_presentation_event_state_change,
    [
      (store_trigger_param_1, ":var0"),
      (assign, ":var1", "mesh_custom_banner_01"),
      (val_sub, ":var1", "mesh_custom_map_banner_01"),
      (try_for_range, ":var2", 0, ":var1"),
        (troop_slot_eq, "trp_temp_array_a", ":var2", ":var0"),
        (troop_set_slot, "trp_player", 99, ":var2"),
        (assign, ":var1", 0),
      (try_end),
      (try_begin),
        (gt, "$g_presentation_next_presentation", 0),
        (start_presentation, "$g_presentation_next_presentation"),
      (else_try),
        (presentation_set_duration, 0),
      (try_end),
    ]),
  ]),

  ("color_selection", 0, mesh_load_window,
  [
    (ti_on_presentation_load,
    [
      (set_fixed_point_multiplier, 1000),
      (create_text_overlay, reg1, "str_choose_color", tf_center_justify),
      (position_set_x, pos1, 500),
      (position_set_y, pos1, 600),
      (overlay_set_position, reg1, pos1),
      (assign, ":var0", 125),
      (assign, ":var1", 450),
      (try_for_range, ":var2", 0, 42),
        (call_script, "script_get_custom_banner_color_from_index", ":var2"),
        (assign, ":var3", reg0),
        (create_image_button_overlay_with_tableau_material, reg1, "mesh_color_picker", "tableau_color_picker", ":var3"),
        (position_set_x, pos1, ":var0"),
        (position_set_y, pos1, ":var1"),
        (val_add, ":var0", 50),
        (try_begin),
          (store_mod, ":var4", ":var2", 7),
          (eq, ":var4", 6),
          (assign, ":var0", 125),
          (val_sub, ":var1", 50),
        (try_end),
        (overlay_set_position, reg1, pos1),
        (position_set_x, pos1, 500),
        (position_set_y, pos1, 500),
        (overlay_set_size, reg1, pos1),
        (store_mul, ":var5", ":var2", 2),
        (store_add, ":var6", ":var5", 1),
        (troop_set_slot, "trp_temp_array_a", ":var5", reg1),
        (troop_set_slot, "trp_temp_array_a", ":var6", ":var3"),
      (try_end),
      (presentation_set_duration, 999999),
    ]),
    (ti_on_presentation_event_state_change,
    [
      (store_trigger_param_1, ":var0"),
      (assign, ":var1", 64),
      (try_for_range, ":var2", 0, ":var1"),
        (store_mul, ":var3", ":var2", 2),
        (troop_slot_eq, "trp_temp_array_a", ":var3", ":var0"),
        (store_add, ":var4", ":var3", 1),
        (troop_get_slot, ":var5", "trp_temp_array_a", ":var4"),
        (troop_set_slot, "trp_player", "$g_presentation_output_slot", ":var5"),
        (assign, ":var1", 0),
      (try_end),
      (try_begin),
        (gt, "$g_presentation_next_presentation", 0),
        (start_presentation, "$g_presentation_next_presentation"),
      (else_try),
        (presentation_set_duration, 0),
      (try_end),
    ]),
  ]),

  ("marshall_selection", 0, mesh_load_window,
  [
    (ti_on_presentation_load,
    [
      (assign, "$g_presentation_obj_marshall_selection_1", -1),
      (assign, "$g_presentation_obj_marshall_selection_2", -1),
      (assign, "$g_presentation_obj_marshall_selection_3", -1),
      (set_fixed_point_multiplier, 1000),
      (assign, "$g_presentation_next_presentation", -1),
      (store_add, ":var0", "$g_presentation_marshall_selection_max_renown_1", "$g_presentation_marshall_selection_max_renown_2"),
      (faction_get_slot, ":var1", "$players_kingdom", 11),
      (str_store_troop_name, s1, "$g_presentation_marshall_selection_max_renown_1_troop"),
      (create_text_overlay, reg1, "@Candidate #1: {s1}", tf_center_justify),
      (position_set_x, pos1, 200),
      (position_set_y, pos1, 600),
      (overlay_set_position, reg1, pos1),
      (str_store_troop_name, s1, "$g_presentation_marshall_selection_max_renown_2_troop"),
      (create_text_overlay, reg1, "@Candidate #2: {s1}", tf_center_justify),
      (position_set_x, pos1, 800),
      (position_set_y, pos1, 600),
      (overlay_set_position, reg1, pos1),
      (create_mesh_overlay_with_tableau_material, reg1, -1, "tableau_troop_note_mesh", "$g_presentation_marshall_selection_max_renown_1_troop"),
      (position_set_x, pos1, 500),
      (position_set_y, pos1, 500),
      (overlay_set_size, reg1, pos1),
      (position_set_x, pos1, 100),
      (position_set_y, pos1, 300),
      (overlay_set_position, reg1, pos1),
      (create_mesh_overlay_with_tableau_material, reg1, -1, "tableau_troop_note_mesh", "$g_presentation_marshall_selection_max_renown_2_troop"),
      (position_set_x, pos1, 500),
      (position_set_y, pos1, 500),
      (overlay_set_size, reg1, pos1),
      (position_set_x, pos1, 700),
      (position_set_y, pos1, 300),
      (overlay_set_position, reg1, pos1),
      (assign, ":var2", "$g_presentation_input"),
      (val_add, "$g_presentation_input", 1),
      (try_begin),
        (lt, ":var2", 0),
        (str_store_troop_name, s1, "$g_presentation_marshall_selection_max_renown_1_troop"),
        (str_store_troop_name, s2, "$g_presentation_marshall_selection_max_renown_2_troop"),
        (str_store_troop_name, s3, ":var1"),
        (str_store_faction_name, s4, "$players_kingdom"),
        (create_text_overlay, reg1, "@{s3} of {s4} wishes to select a new marshall and invites his vassals for a counsel. {s1} and {s2} are the likely candidates.", tf_center_justify),
        (position_set_x, pos1, 500),
        (position_set_y, pos1, 200),
        (overlay_set_position, reg1, pos1),
        (create_button_overlay, "$g_presentation_obj_marshall_selection_1", "@Continue...", tf_center_justify),
        (position_set_x, pos1, 500),
        (position_set_y, pos1, 100),
        (overlay_set_position, "$g_presentation_obj_marshall_selection_1", pos1),
        (assign, "$g_presentation_next_presentation", "prsnt_marshall_selection"),
      (else_try),
        (assign, ":var3", ":var2"),
        (try_for_range_backwards, ":var4", "trp_kingdom_heroes_including_player_begin", "trp_knight_1_1_wife"),
          (ge, ":var3", 0),
          (assign, ":var5", ":var4"),
          (assign, ":var6", 0),
          (try_begin),
            (eq, ":var4", "trp_kingdom_heroes_including_player_begin"),
            (assign, ":var5", "trp_player"),
            (try_begin),
              (eq, "$g_player_is_captive", 0),
              (assign, ":var6", 1),
            (try_end),
          (else_try),
            (store_faction_of_troop, ":var7", ":var5"),
            (eq, "$players_kingdom", ":var7"),
            (neg|troop_slot_ge, ":var5", 8, 0),
            (troop_slot_ge, ":var5", 10, 1),
            (troop_slot_eq, ":var5", 2, 2),
            (neg|faction_slot_eq, ":var7", 11, ":var5"),
            (assign, ":var6", 1),
          (try_end),
          (eq, ":var6", 1),
          (neq, "$g_presentation_marshall_selection_max_renown_1_troop", ":var5"),
          (neq, "$g_presentation_marshall_selection_max_renown_2_troop", ":var5"),
          (val_sub, ":var3", 1),
          (lt, ":var3", 0),
          (assign, "$g_presentation_next_presentation", "prsnt_marshall_selection"),
          (create_mesh_overlay_with_tableau_material, reg1, -1, "tableau_troop_note_mesh", ":var5"),
          (position_set_x, pos1, 300),
          (position_set_y, pos1, 300),
          (overlay_set_size, reg1, pos1),
          (position_set_x, pos1, 440),
          (position_set_y, pos1, 400),
          (overlay_set_position, reg1, pos1),
          (try_begin),
            (eq, ":var5", "trp_player"),
            (create_text_overlay, reg1, "@Who do you wish to support?", tf_center_justify),
            (position_set_x, pos1, 500),
            (position_set_y, pos1, 200),
            (overlay_set_position, reg1, pos1),
            (str_store_troop_name, s1, "$g_presentation_marshall_selection_max_renown_1_troop"),
            (create_button_overlay, "$g_presentation_obj_marshall_selection_2", "@{!}{s1}", tf_center_justify),
            (position_set_x, pos1, 300),
            (position_set_y, pos1, 100),
            (overlay_set_position, "$g_presentation_obj_marshall_selection_2", pos1),
            (str_store_troop_name, s1, "$g_presentation_marshall_selection_max_renown_2_troop"),
            (create_button_overlay, "$g_presentation_obj_marshall_selection_3", "@{!}{s1}", tf_center_justify),
            (position_set_x, pos1, 700),
            (position_set_y, pos1, 100),
            (overlay_set_position, "$g_presentation_obj_marshall_selection_3", pos1),
          (else_try),
            (str_store_troop_name, s1, ":var5"),
            (store_random_in_range, ":var8", 0, ":var0"),
            (val_sub, ":var8", "$g_presentation_marshall_selection_max_renown_1"),
            (try_begin),
              (lt, ":var8", 0),
              (val_add, "$g_presentation_marshall_selection_1_vote", 1),
              (str_store_troop_name, s2, "$g_presentation_marshall_selection_max_renown_1_troop"),
            (else_try),
              (val_add, "$g_presentation_marshall_selection_2_vote", 1),
              (str_store_troop_name, s2, "$g_presentation_marshall_selection_max_renown_2_troop"),
            (try_end),
            (create_text_overlay, reg1, "@{s1} gives his support to {s2}.", tf_center_justify),
            (position_set_x, pos1, 500),
            (position_set_y, pos1, 200),
            (overlay_set_position, reg1, pos1),
            (create_button_overlay, "$g_presentation_obj_marshall_selection_1", "@Continue...", tf_center_justify),
            (position_set_x, pos1, 500),
            (position_set_y, pos1, 100),
            (overlay_set_position, "$g_presentation_obj_marshall_selection_1", pos1),
          (try_end),
        (try_end),
      (try_end),
      (assign, reg0, "$g_presentation_marshall_selection_1_vote"),
      (create_text_overlay, reg1, "@Number of Supporters: {reg0}", tf_center_justify),
      (position_set_x, pos1, 200),
      (position_set_y, pos1, 550),
      (overlay_set_position, reg1, pos1),
      (assign, reg0, "$g_presentation_marshall_selection_2_vote"),
      (create_text_overlay, reg1, "@Number of Supporters: {reg0}", tf_center_justify),
      (position_set_x, pos1, 800),
      (position_set_y, pos1, 550),
      (overlay_set_position, reg1, pos1),
      (try_begin),
        (lt, "$g_presentation_next_presentation", 0),
        (try_begin),
          (gt, "$g_presentation_marshall_selection_2_vote", "$g_presentation_marshall_selection_1_vote"),
          (assign, ":var9", "$g_presentation_marshall_selection_max_renown_1_troop"),
          (assign, "$g_presentation_marshall_selection_max_renown_1_troop", "$g_presentation_marshall_selection_max_renown_2_troop"),
          (assign, "$g_presentation_marshall_selection_max_renown_2_troop", ":var9"),
        (try_end),
        (str_store_troop_name, s1, "$g_presentation_marshall_selection_max_renown_1_troop"),
        (str_store_troop_name, s2, ":var1"),
        (str_store_faction_name, s3, "$players_kingdom"),
        (create_text_overlay, reg1, "@{s2} has heard his vassals' counsel. He selects {s1} as the marshall of {s3}.", tf_center_justify),
        (position_set_x, pos1, 500),
        (position_set_y, pos1, 200),
        (overlay_set_position, reg1, pos1),
        (create_button_overlay, "$g_presentation_obj_marshall_selection_1", "@Continue...", tf_center_justify),
        (position_set_x, pos1, 500),
        (position_set_y, pos1, 100),
        (overlay_set_position, "$g_presentation_obj_marshall_selection_1", pos1),
      (try_end),
      (presentation_set_duration, 999999),
    ]),
    (ti_on_presentation_event_state_change,
    [
      (store_trigger_param_1, ":var0"),
      (try_begin),
        (eq, ":var0", "$g_presentation_obj_marshall_selection_2"),
        (val_add, "$g_presentation_marshall_selection_1_vote", 1),
        (call_script, "script_change_player_relation_with_troop", "$g_presentation_marshall_selection_max_renown_1_troop", 2),
        (call_script, "script_change_player_relation_with_troop", "$g_presentation_marshall_selection_max_renown_2_troop", -2),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_marshall_selection_3"),
        (val_add, "$g_presentation_marshall_selection_2_vote", 1),
        (call_script, "script_change_player_relation_with_troop", "$g_presentation_marshall_selection_max_renown_1_troop", -2),
        (call_script, "script_change_player_relation_with_troop", "$g_presentation_marshall_selection_max_renown_2_troop", 2),
      (try_end),
      (try_begin),
        (this_or_next|eq, ":var0", "$g_presentation_obj_marshall_selection_1"),
        (this_or_next|eq, ":var0", "$g_presentation_obj_marshall_selection_2"),
        (eq, ":var0", "$g_presentation_obj_marshall_selection_3"),
        (try_begin),
          (ge, "$g_presentation_next_presentation", 0),
          (start_presentation, "$g_presentation_next_presentation"),
        (else_try),
          (try_begin),
            (neg|faction_slot_eq, "$players_kingdom", 8, "$g_presentation_marshall_selection_max_renown_1_troop"),
            (call_script, "script_check_and_finish_active_army_quests_for_faction", "$players_kingdom"),
          (try_end),
          (faction_get_slot, ":var1", "$players_kingdom", 8),
          (try_begin),
            (ge, ":var1", 0),
            (party_is_active, ":var1"),
            (party_set_marshall, ":var1", 0),
          (try_end),
          (faction_set_slot, "$players_kingdom", 8, "$g_presentation_marshall_selection_max_renown_1_troop"),
          (try_begin),
            (eq, "$g_presentation_marshall_selection_max_renown_1_troop", "trp_player"),
            (call_script, "script_change_player_relation_with_troop", "$g_presentation_marshall_selection_max_renown_2_troop", -3),
          (try_end),
          (assign, "$g_recalculate_ais", 1),
          (assign, "$g_presentation_marshall_selection_ended", 1),
          (presentation_set_duration, 0),
        (try_end),
      (try_end),
    ]),
  ]),

  ("battle", 0, mesh_pic_bandits,
  [
    (ti_on_presentation_load,
    [
      (set_fixed_point_multiplier, 1000),
      (assign, "$g_formation_group0_selected", 0),
      (assign, "$g_formation_group1_selected", 0),
      (assign, "$g_formation_group2_selected", 0),
      (assign, "$g_formation_group3_selected", 0),
      (assign, "$g_formation_group4_selected", 0),
      (assign, "$g_formation_group5_selected", 0),
      (assign, "$g_formation_group6_selected", 0),
      (assign, "$g_formation_group7_selected", 0),
      (assign, "$g_formation_group8_selected", 0),
      (assign, "$g_presentation_obj_battle_but0", -1),
      (assign, "$g_presentation_obj_battle_but1", -1),
      (assign, "$g_presentation_obj_battle_but2", -1),
      (assign, "$g_presentation_obj_battle_but3", -1),
      (assign, "$g_presentation_obj_battle_but4", -1),
      (assign, "$g_presentation_obj_battle_but5", -1),
      (assign, "$g_presentation_obj_battle_but6", -1),
      (assign, "$g_presentation_obj_battle_but7", -1),
      (assign, "$g_presentation_obj_battle_but8", -1),
      (str_clear, s7),
      (position_set_y, pos1, 700),
      (create_text_overlay, reg1, "@Action", tf_center_justify|tf_single_line|tf_with_outline),
      (overlay_set_color, reg1, 0xFFAAAAAA),
      (position_set_x, pos1, 270),
      (overlay_set_position, reg1, pos1),
      (create_text_overlay, reg1, "@Mount", tf_center_justify|tf_single_line|tf_with_outline),
      (overlay_set_color, reg1, 0xFFAAAAAA),
      (position_set_x, pos1, 410),
      (overlay_set_position, reg1, pos1),
      (create_text_overlay, reg1, "@Attack Type", tf_center_justify|tf_single_line|tf_with_outline),
      (overlay_set_color, reg1, 0xFFAAAAAA),
      (position_set_x, pos1, 550),
      (overlay_set_position, reg1, pos1),
      (assign, "$group0_has_troops", 0),
      (assign, "$group1_has_troops", 0),
      (assign, "$group2_has_troops", 0),
      (assign, "$group3_has_troops", 0),
      (assign, "$group4_has_troops", 0),
      (assign, "$group5_has_troops", 0),
      (assign, "$group6_has_troops", 0),
      (assign, "$group7_has_troops", 0),
      (assign, "$group8_has_troops", 0),
      (assign, "$num_classes", 0),
      (try_for_agents, ":var0"),
        (agent_set_slot, ":var0", 10, 0),
        (agent_is_alive, ":var0"),
        (agent_is_human, ":var0"),
        (agent_is_non_player, ":var0"),
        (agent_get_party_id, ":var1", ":var0"),
        (eq, ":var1", "p_main_party"),
        (agent_get_division, ":var2", ":var0"),
        (try_begin),
          (eq, ":var2", 0),
          (try_begin),
            (neq, "$group0_has_troops", 1),
            (val_add, "$num_classes", 1),
          (try_end),
          (assign, "$group0_has_troops", 1),
        (else_try),
          (eq, ":var2", 1),
          (try_begin),
            (neq, "$group1_has_troops", 1),
            (val_add, "$num_classes", 1),
          (try_end),
          (assign, "$group1_has_troops", 1),
        (else_try),
          (eq, ":var2", 2),
          (try_begin),
            (neq, "$group2_has_troops", 1),
            (val_add, "$num_classes", 1),
          (try_end),
          (assign, "$group2_has_troops", 1),
        (else_try),
          (eq, ":var2", 3),
          (try_begin),
            (neq, "$group3_has_troops", 1),
            (val_add, "$num_classes", 1),
          (try_end),
          (assign, "$group3_has_troops", 1),
        (else_try),
          (eq, ":var2", 4),
          (try_begin),
            (neq, "$group4_has_troops", 1),
            (val_add, "$num_classes", 1),
          (try_end),
          (assign, "$group4_has_troops", 1),
        (else_try),
          (eq, ":var2", 5),
          (try_begin),
            (neq, "$group5_has_troops", 1),
            (val_add, "$num_classes", 1),
          (try_end),
          (assign, "$group5_has_troops", 1),
        (else_try),
          (eq, ":var2", 6),
          (try_begin),
            (neq, "$group6_has_troops", 1),
            (val_add, "$num_classes", 1),
          (try_end),
          (assign, "$group6_has_troops", 1),
        (else_try),
          (eq, ":var2", 7),
          (try_begin),
            (neq, "$group7_has_troops", 1),
            (val_add, "$num_classes", 1),
          (try_end),
          (assign, "$group7_has_troops", 1),
        (else_try),
          (eq, ":var2", 8),
          (try_begin),
            (neq, "$group8_has_troops", 1),
            (val_add, "$num_classes", 1),
          (try_end),
          (assign, "$group8_has_troops", 1),
        (try_end),
      (try_end),
      (assign, ":var3", 0),
      (assign, ":var4", 653),
      (assign, ":var5", 20),
      (assign, ":var6", 662),
      (assign, ":var7", 50),
      (assign, ":var8", 660),
      (try_begin),
        (eq, "$group0_has_troops", 1),
        (create_image_button_overlay, "$g_presentation_obj_battle_but0", "mesh_white_plane", "mesh_white_plane"),
        (position_set_x, pos1, ":var3"),
        (position_set_y, pos1, ":var4"),
        (overlay_set_position, "$g_presentation_obj_battle_but0", pos1),
        (val_add, ":var4", -40),
        (position_set_x, pos1, 32500),
        (position_set_y, pos1, 2000),
        (overlay_set_size, "$g_presentation_obj_battle_but0", pos1),
        (overlay_set_alpha, "$g_presentation_obj_battle_but0", 0x00),
        (overlay_set_color, "$g_presentation_obj_battle_but0", 0xFFFF00),
        (create_check_box_overlay, "$g_presentation_obj_battle_check0", "mesh_checkbox_off", "mesh_checkbox_on"),
        (position_set_x, pos2, ":var5"),
        (position_set_y, pos2, ":var6"),
        (overlay_set_position, "$g_presentation_obj_battle_check0", pos2),
        (val_add, ":var6", -40),
        (create_text_overlay, "$g_presentation_obj_battle_name0", s7, 0),
        (position_set_x, pos3, ":var7"),
        (position_set_y, pos3, ":var8"),
        (overlay_set_position, "$g_presentation_obj_battle_name0", pos3),
        (val_add, ":var8", -40),
        (create_text_overlay, "$g_presentation_but0_movement", s7, tf_center_justify),
        (create_text_overlay, "$g_presentation_but0_riding", s7, tf_center_justify),
        (create_text_overlay, "$g_presentation_but0_weapon_usage", s7, tf_center_justify),
      (try_end),
      (try_begin),
        (eq, "$group1_has_troops", 1),
        (create_image_button_overlay, "$g_presentation_obj_battle_but1", "mesh_white_plane", "mesh_white_plane"),
        (position_set_x, pos1, ":var3"),
        (position_set_y, pos1, ":var4"),
        (overlay_set_position, "$g_presentation_obj_battle_but1", pos1),
        (val_add, ":var4", -40),
        (position_set_x, pos1, 32500),
        (position_set_y, pos1, 2000),
        (overlay_set_size, "$g_presentation_obj_battle_but1", pos1),
        (overlay_set_alpha, "$g_presentation_obj_battle_but1", 0x00),
        (overlay_set_color, "$g_presentation_obj_battle_but1", 0xFFFF00),
        (create_check_box_overlay, "$g_presentation_obj_battle_check1", "mesh_checkbox_off", "mesh_checkbox_on"),
        (position_set_x, pos2, ":var5"),
        (position_set_y, pos2, ":var6"),
        (overlay_set_position, "$g_presentation_obj_battle_check1", pos2),
        (val_add, ":var6", -40),
        (create_text_overlay, "$g_presentation_obj_battle_name1", s7, 0),
        (position_set_x, pos3, ":var7"),
        (position_set_y, pos3, ":var8"),
        (overlay_set_position, "$g_presentation_obj_battle_name1", pos3),
        (val_add, ":var8", -40),
        (create_text_overlay, "$g_presentation_but1_movement", s7, tf_center_justify),
        (create_text_overlay, "$g_presentation_but1_riding", s7, tf_center_justify),
        (create_text_overlay, "$g_presentation_but1_weapon_usage", s7, tf_center_justify),
      (try_end),
      (try_begin),
        (eq, "$group2_has_troops", 1),
        (create_image_button_overlay, "$g_presentation_obj_battle_but2", "mesh_white_plane", "mesh_white_plane"),
        (position_set_x, pos1, ":var3"),
        (position_set_y, pos1, ":var4"),
        (overlay_set_position, "$g_presentation_obj_battle_but2", pos1),
        (val_add, ":var4", -40),
        (position_set_x, pos1, 32500),
        (position_set_y, pos1, 2000),
        (overlay_set_size, "$g_presentation_obj_battle_but2", pos1),
        (overlay_set_alpha, "$g_presentation_obj_battle_but2", 0x00),
        (overlay_set_color, "$g_presentation_obj_battle_but2", 0xFFFF00),
        (create_check_box_overlay, "$g_presentation_obj_battle_check2", "mesh_checkbox_off", "mesh_checkbox_on"),
        (position_set_x, pos2, ":var5"),
        (position_set_y, pos2, ":var6"),
        (overlay_set_position, "$g_presentation_obj_battle_check2", pos2),
        (val_add, ":var6", -40),
        (create_text_overlay, "$g_presentation_obj_battle_name2", s7, 0),
        (position_set_x, pos3, ":var7"),
        (position_set_y, pos3, ":var8"),
        (overlay_set_position, "$g_presentation_obj_battle_name2", pos3),
        (val_add, ":var8", -40),
        (create_text_overlay, "$g_presentation_but2_movement", s7, tf_center_justify),
        (create_text_overlay, "$g_presentation_but2_riding", s7, tf_center_justify),
        (create_text_overlay, "$g_presentation_but2_weapon_usage", s7, tf_center_justify),
      (try_end),
      (try_begin),
        (eq, "$group3_has_troops", 1),
        (create_image_button_overlay, "$g_presentation_obj_battle_but3", "mesh_white_plane", "mesh_white_plane"),
        (position_set_x, pos1, ":var3"),
        (position_set_y, pos1, ":var4"),
        (overlay_set_position, "$g_presentation_obj_battle_but3", pos1),
        (val_add, ":var4", -40),
        (position_set_x, pos1, 32500),
        (position_set_y, pos1, 2000),
        (overlay_set_size, "$g_presentation_obj_battle_but3", pos1),
        (overlay_set_alpha, "$g_presentation_obj_battle_but3", 0x00),
        (overlay_set_color, "$g_presentation_obj_battle_but3", 0xFFFF00),
        (create_check_box_overlay, "$g_presentation_obj_battle_check3", "mesh_checkbox_off", "mesh_checkbox_on"),
        (position_set_x, pos2, ":var5"),
        (position_set_y, pos2, ":var6"),
        (overlay_set_position, "$g_presentation_obj_battle_check3", pos2),
        (val_add, ":var6", -40),
        (create_text_overlay, "$g_presentation_obj_battle_name3", s7, 0),
        (position_set_x, pos3, ":var7"),
        (position_set_y, pos3, ":var8"),
        (overlay_set_position, "$g_presentation_obj_battle_name3", pos3),
        (val_add, ":var8", -40),
        (create_text_overlay, "$g_presentation_but3_movement", s7, tf_center_justify),
        (create_text_overlay, "$g_presentation_but3_riding", s7, tf_center_justify),
        (create_text_overlay, "$g_presentation_but3_weapon_usage", s7, tf_center_justify),
      (try_end),
      (try_begin),
        (eq, "$group4_has_troops", 1),
        (create_image_button_overlay, "$g_presentation_obj_battle_but4", "mesh_white_plane", "mesh_white_plane"),
        (position_set_x, pos1, ":var3"),
        (position_set_y, pos1, ":var4"),
        (overlay_set_position, "$g_presentation_obj_battle_but4", pos1),
        (val_add, ":var4", -40),
        (position_set_x, pos1, 32500),
        (position_set_y, pos1, 2000),
        (overlay_set_size, "$g_presentation_obj_battle_but4", pos1),
        (overlay_set_alpha, "$g_presentation_obj_battle_but4", 0x00),
        (overlay_set_color, "$g_presentation_obj_battle_but4", 0xFFFF00),
        (create_check_box_overlay, "$g_presentation_obj_battle_check4", "mesh_checkbox_off", "mesh_checkbox_on"),
        (position_set_x, pos2, ":var5"),
        (position_set_y, pos2, ":var6"),
        (overlay_set_position, "$g_presentation_obj_battle_check4", pos2),
        (val_add, ":var6", -40),
        (create_text_overlay, "$g_presentation_obj_battle_name4", s7, 0),
        (position_set_x, pos3, ":var7"),
        (position_set_y, pos3, ":var8"),
        (overlay_set_position, "$g_presentation_obj_battle_name4", pos3),
        (val_add, ":var8", -40),
        (create_text_overlay, "$g_presentation_but4_movement", s7, tf_center_justify),
        (create_text_overlay, "$g_presentation_but4_riding", s7, tf_center_justify),
        (create_text_overlay, "$g_presentation_but4_weapon_usage", s7, tf_center_justify),
      (try_end),
      (try_begin),
        (eq, "$group5_has_troops", 1),
        (create_image_button_overlay, "$g_presentation_obj_battle_but5", "mesh_white_plane", "mesh_white_plane"),
        (position_set_x, pos1, ":var3"),
        (position_set_y, pos1, ":var4"),
        (overlay_set_position, "$g_presentation_obj_battle_but5", pos1),
        (val_add, ":var4", -40),
        (position_set_x, pos1, 32500),
        (position_set_y, pos1, 2000),
        (overlay_set_size, "$g_presentation_obj_battle_but5", pos1),
        (overlay_set_alpha, "$g_presentation_obj_battle_but5", 0x00),
        (overlay_set_color, "$g_presentation_obj_battle_but5", 0xFFFF00),
        (create_check_box_overlay, "$g_presentation_obj_battle_check5", "mesh_checkbox_off", "mesh_checkbox_on"),
        (position_set_x, pos2, ":var5"),
        (position_set_y, pos2, ":var6"),
        (overlay_set_position, "$g_presentation_obj_battle_check5", pos2),
        (val_add, ":var6", -40),
        (create_text_overlay, "$g_presentation_obj_battle_name5", s7, 0),
        (position_set_x, pos3, ":var7"),
        (position_set_y, pos3, ":var8"),
        (overlay_set_position, "$g_presentation_obj_battle_name5", pos3),
        (val_add, ":var8", -40),
        (create_text_overlay, "$g_presentation_but5_movement", s7, tf_center_justify),
        (create_text_overlay, "$g_presentation_but5_riding", s7, tf_center_justify),
        (create_text_overlay, "$g_presentation_but5_weapon_usage", s7, tf_center_justify),
      (try_end),
      (try_begin),
        (eq, "$group6_has_troops", 1),
        (create_image_button_overlay, "$g_presentation_obj_battle_but6", "mesh_white_plane", "mesh_white_plane"),
        (position_set_x, pos1, ":var3"),
        (position_set_y, pos1, ":var4"),
        (overlay_set_position, "$g_presentation_obj_battle_but6", pos1),
        (val_add, ":var4", -40),
        (position_set_x, pos1, 32500),
        (position_set_y, pos1, 2000),
        (overlay_set_size, "$g_presentation_obj_battle_but6", pos1),
        (overlay_set_alpha, "$g_presentation_obj_battle_but6", 0x00),
        (overlay_set_color, "$g_presentation_obj_battle_but6", 0xFFFF00),
        (create_check_box_overlay, "$g_presentation_obj_battle_check6", "mesh_checkbox_off", "mesh_checkbox_on"),
        (position_set_x, pos2, ":var5"),
        (position_set_y, pos2, ":var6"),
        (overlay_set_position, "$g_presentation_obj_battle_check6", pos2),
        (val_add, ":var6", -40),
        (create_text_overlay, "$g_presentation_obj_battle_name6", s7, 0),
        (position_set_x, pos3, ":var7"),
        (position_set_y, pos3, ":var8"),
        (overlay_set_position, "$g_presentation_obj_battle_name6", pos3),
        (val_add, ":var8", -40),
        (create_text_overlay, "$g_presentation_but6_movement", s7, tf_center_justify),
        (create_text_overlay, "$g_presentation_but6_riding", s7, tf_center_justify),
        (create_text_overlay, "$g_presentation_but6_weapon_usage", s7, tf_center_justify),
      (try_end),
      (try_begin),
        (eq, "$group7_has_troops", 1),
        (create_image_button_overlay, "$g_presentation_obj_battle_but7", "mesh_white_plane", "mesh_white_plane"),
        (position_set_x, pos1, ":var3"),
        (position_set_y, pos1, ":var4"),
        (overlay_set_position, "$g_presentation_obj_battle_but7", pos1),
        (val_add, ":var4", -40),
        (position_set_x, pos1, 32500),
        (position_set_y, pos1, 2000),
        (overlay_set_size, "$g_presentation_obj_battle_but7", pos1),
        (overlay_set_alpha, "$g_presentation_obj_battle_but7", 0x00),
        (overlay_set_color, "$g_presentation_obj_battle_but7", 0xFFFF00),
        (create_check_box_overlay, "$g_presentation_obj_battle_check7", "mesh_checkbox_off", "mesh_checkbox_on"),
        (position_set_x, pos2, ":var5"),
        (position_set_y, pos2, ":var6"),
        (overlay_set_position, "$g_presentation_obj_battle_check7", pos2),
        (val_add, ":var6", -40),
        (create_text_overlay, "$g_presentation_obj_battle_name7", s7, 0),
        (position_set_x, pos3, ":var7"),
        (position_set_y, pos3, ":var8"),
        (overlay_set_position, "$g_presentation_obj_battle_name7", pos3),
        (val_add, ":var8", -40),
        (create_text_overlay, "$g_presentation_but7_movement", s7, tf_center_justify),
        (create_text_overlay, "$g_presentation_but7_riding", s7, tf_center_justify),
        (create_text_overlay, "$g_presentation_but7_weapon_usage", s7, tf_center_justify),
      (try_end),
      (try_begin),
        (eq, "$group8_has_troops", 1),
        (create_image_button_overlay, "$g_presentation_obj_battle_but8", "mesh_white_plane", "mesh_white_plane"),
        (position_set_x, pos1, ":var3"),
        (position_set_y, pos1, ":var4"),
        (overlay_set_position, "$g_presentation_obj_battle_but8", pos1),
        (val_add, ":var4", -40),
        (position_set_x, pos1, 32500),
        (position_set_y, pos1, 2000),
        (overlay_set_size, "$g_presentation_obj_battle_but8", pos1),
        (overlay_set_alpha, "$g_presentation_obj_battle_but8", 0x00),
        (overlay_set_color, "$g_presentation_obj_battle_but8", 0xFFFF00),
        (create_check_box_overlay, "$g_presentation_obj_battle_check8", "mesh_checkbox_off", "mesh_checkbox_on"),
        (position_set_x, pos2, ":var5"),
        (position_set_y, pos2, ":var6"),
        (overlay_set_position, "$g_presentation_obj_battle_check8", pos2),
        (val_add, ":var6", -40),
        (create_text_overlay, "$g_presentation_obj_battle_name8", s7, 0),
        (position_set_x, pos3, ":var7"),
        (position_set_y, pos3, ":var8"),
        (overlay_set_position, "$g_presentation_obj_battle_name8", pos3),
        (val_add, ":var8", -40),
        (create_text_overlay, "$g_presentation_but8_movement", s7, tf_center_justify),
        (create_text_overlay, "$g_presentation_but8_riding", s7, tf_center_justify),
        (create_text_overlay, "$g_presentation_but8_weapon_usage", s7, tf_center_justify),
      (try_end),
      (get_player_agent_no, ":var9"),
      (agent_get_team, ":var10", ":var9"),
      (call_script, "script_update_order_panel", ":var10"),
      (assign, ":var11", 640),
      (assign, ":var12", "$num_classes"),
      (val_mul, ":var12", -40),
      (val_add, ":var11", ":var12"),
      (create_listbox_overlay, "$g_presentation_obj_battle_10", "str_space", 0),
      (create_listbox_overlay, "$g_presentation_obj_battle_11", "str_space", 0),
      (create_listbox_overlay, "$g_presentation_obj_battle_12", "str_space", 0),
      (create_listbox_overlay, "$g_presentation_obj_battle_13", "str_space", 0),
      (overlay_add_item, "$g_presentation_obj_battle_10", "@Stand Ground"),
      (overlay_add_item, "$g_presentation_obj_battle_10", "@Charge"),
      (overlay_add_item, "$g_presentation_obj_battle_10", "@Follow Me"),
      (overlay_add_item, "$g_presentation_obj_battle_10", "@Hold This Position"),
      (create_button_overlay, "$g_presentation_obj_battle_14", "@Spread Out", tf_center_justify|tf_single_line|tf_with_outline),
      (overlay_set_color, "$g_presentation_obj_battle_14", 0xFFFFFFFF),
      (create_button_overlay, "$g_presentation_obj_battle_15", "@Stand Closer", tf_center_justify|tf_single_line|tf_with_outline),
      (overlay_set_color, "$g_presentation_obj_battle_15", 0xFFFFFFFF),
      (create_button_overlay, "$g_presentation_obj_battle_16", "@Fall Back", tf_center_justify|tf_single_line|tf_with_outline),
      (overlay_set_color, "$g_presentation_obj_battle_16", 0xFFFFFFFF),
      (create_button_overlay, "$g_presentation_obj_battle_17", "@Advance", tf_center_justify|tf_single_line|tf_with_outline),
      (overlay_set_color, "$g_presentation_obj_battle_17", 0xFFFFFFFF),
      (position_set_x, pos1, 600),
      (position_set_y, pos1, 600),
      (overlay_set_size, "$g_presentation_obj_battle_10", pos1),
      (val_add, ":var11", -35),
      (position_set_x, pos1, 205),
      (position_set_y, pos1, ":var11"),
      (val_add, ":var11", 35),
      (overlay_set_position, "$g_presentation_obj_battle_10", pos1),
      (overlay_set_alpha, "$g_presentation_obj_battle_10", 0x60),
      (overlay_set_val, "$g_presentation_obj_battle_10", "$g_latest_order_1"),
      (val_add, ":var11", -40),
      (position_set_x, pos1, 130),
      (position_set_y, pos1, ":var11"),
      (val_add, ":var11", 40),
      (overlay_set_position, "$g_presentation_obj_battle_14", pos1),
      (val_add, ":var11", -20),
      (position_set_x, pos1, 130),
      (position_set_y, pos1, ":var11"),
      (val_add, ":var11", 20),
      (overlay_set_position, "$g_presentation_obj_battle_15", pos1),
      (val_add, ":var11", 0),
      (position_set_x, pos1, 130),
      (position_set_y, pos1, ":var11"),
      (val_add, ":var11", 0),
      (overlay_set_position, "$g_presentation_obj_battle_16", pos1),
      (val_add, ":var11", 20),
      (position_set_x, pos1, 130),
      (position_set_y, pos1, ":var11"),
      (val_add, ":var11", -20),
      (overlay_set_position, "$g_presentation_obj_battle_17", pos1),
      (overlay_add_item, "$g_presentation_obj_battle_11", "@Dismount"),
      (overlay_add_item, "$g_presentation_obj_battle_11", "@Mount"),
      (position_set_x, pos1, 600),
      (position_set_y, pos1, 600),
      (overlay_set_size, "$g_presentation_obj_battle_11", pos1),
      (position_set_x, pos1, 350),
      (position_set_y, pos1, ":var11"),
      (overlay_set_position, "$g_presentation_obj_battle_11", pos1),
      (overlay_set_alpha, "$g_presentation_obj_battle_11", 0x60),
      (overlay_set_val, "$g_presentation_obj_battle_11", "$g_latest_order_2"),
      (overlay_add_item, "$g_presentation_obj_battle_12", "@Fire At Will"),
      (overlay_add_item, "$g_presentation_obj_battle_12", "@Hold Your Fire"),
      (position_set_x, pos1, 600),
      (position_set_y, pos1, 600),
      (overlay_set_size, "$g_presentation_obj_battle_12", pos1),
      (position_set_x, pos1, 495),
      (position_set_y, pos1, ":var11"),
      (overlay_set_position, "$g_presentation_obj_battle_12", pos1),
      (overlay_set_alpha, "$g_presentation_obj_battle_12", 0x60),
      (overlay_set_val, "$g_presentation_obj_battle_12", "$g_latest_order_3"),
      (overlay_add_item, "$g_presentation_obj_battle_13", "@Use Blunt Weapons"),
      (overlay_add_item, "$g_presentation_obj_battle_13", "@Use Any Weapon"),
      (position_set_x, pos1, 600),
      (position_set_y, pos1, 600),
      (overlay_set_size, "$g_presentation_obj_battle_13", pos1),
      (val_add, ":var11", -35),
      (position_set_x, pos1, 495),
      (position_set_y, pos1, ":var11"),
      (val_add, ":var11", 35),
      (overlay_set_position, "$g_presentation_obj_battle_13", pos1),
      (overlay_set_alpha, "$g_presentation_obj_battle_13", 0x60),
      (overlay_set_val, "$g_presentation_obj_battle_13", "$g_latest_order_4"),
      (create_text_overlay, "$g_presentation_obj_battle_22", "str_us_", 0),
      (create_text_overlay, "$g_presentation_obj_battle_23", "str_allies_", 0),
      (create_text_overlay, "$g_presentation_obj_battle_24", "str_enemies_", 0),
      (create_text_overlay, "$g_presentation_obj_battle_25", "@Ready", tf_center_justify),
      (create_text_overlay, "$g_presentation_obj_battle_26", "@Wounded", tf_center_justify),
      (create_text_overlay, "$g_presentation_obj_battle_28", "str_routed", tf_center_justify),
      (create_text_overlay, "$g_presentation_obj_battle_27", "@Dead", tf_center_justify),
      (create_text_overlay, "$g_battle_us_ready", s7, tf_center_justify),
      (create_text_overlay, "$g_battle_us_wounded", s7, tf_center_justify),
      (create_text_overlay, "$g_battle_us_routed", s7, tf_center_justify),
      (create_text_overlay, "$g_battle_us_dead", s7, tf_center_justify),
      (create_text_overlay, "$g_battle_enemies_ready", s7, tf_center_justify),
      (create_text_overlay, "$g_battle_enemies_wounded", s7, tf_center_justify),
      (create_text_overlay, "$g_battle_enemies_routed", s7, tf_center_justify),
      (create_text_overlay, "$g_battle_enemies_dead", s7, tf_center_justify),
      (create_text_overlay, "$g_battle_allies_ready", s7, tf_center_justify),
      (create_text_overlay, "$g_battle_allies_wounded", s7, tf_center_justify),
      (create_text_overlay, "$g_battle_allies_routed", s7, tf_center_justify),
      (create_text_overlay, "$g_battle_allies_dead", s7, tf_center_justify),
      (create_image_button_overlay, "$g_battle_report_plane", "mesh_white_plane", "mesh_white_plane"),
      (overlay_set_color, "$g_battle_report_plane", 0x000000),
      (position_set_x, pos1, 15500),
      (position_set_y, pos1, 6000),
      (overlay_set_size, "$g_battle_report_plane", pos1),
      (position_set_x, pos1, 672),
      (position_set_y, pos1, 275),
      (overlay_set_position, "$g_battle_report_plane", pos1),
      (overlay_set_alpha, "$g_battle_report_plane", 0x44),
      (overlay_set_color, "$g_battle_report_plane", 0x1166BB),
      (position_set_x, pos1, 750),
      (position_set_y, pos1, 750),
      (overlay_set_size, "$g_presentation_obj_battle_14", pos1),
      (overlay_set_size, "$g_presentation_obj_battle_15", pos1),
      (overlay_set_size, "$g_presentation_obj_battle_16", pos1),
      (overlay_set_size, "$g_presentation_obj_battle_17", pos1),
      (overlay_set_size, "$g_presentation_obj_battle_22", pos1),
      (overlay_set_size, "$g_presentation_obj_battle_23", pos1),
      (overlay_set_size, "$g_presentation_obj_battle_24", pos1),
      (overlay_set_size, "$g_presentation_obj_battle_25", pos1),
      (overlay_set_size, "$g_presentation_obj_battle_26", pos1),
      (overlay_set_size, "$g_presentation_obj_battle_27", pos1),
      (overlay_set_size, "$g_presentation_obj_battle_28", pos1),
      (overlay_set_size, "$g_battle_us_ready", pos1),
      (overlay_set_size, "$g_battle_us_wounded", pos1),
      (overlay_set_size, "$g_battle_us_routed", pos1),
      (overlay_set_size, "$g_battle_us_dead", pos1),
      (overlay_set_size, "$g_battle_enemies_ready", pos1),
      (overlay_set_size, "$g_battle_enemies_wounded", pos1),
      (overlay_set_size, "$g_battle_enemies_routed", pos1),
      (overlay_set_size, "$g_battle_enemies_dead", pos1),
      (overlay_set_size, "$g_battle_allies_ready", pos1),
      (overlay_set_size, "$g_battle_allies_wounded", pos1),
      (overlay_set_size, "$g_battle_allies_routed", pos1),
      (overlay_set_size, "$g_battle_allies_dead", pos1),
      (assign, ":var3", 675),
      (assign, ":var4", 280),
      (val_add, ":var3", 70),
      (val_add, ":var4", 90),
      (position_set_x, pos1, ":var3"),
      (position_set_y, pos1, ":var4"),
      (overlay_set_position, "$g_presentation_obj_battle_25", pos1),
      (val_add, ":var3", 70),
      (position_set_x, pos1, ":var3"),
      (overlay_set_position, "$g_presentation_obj_battle_26", pos1),
      (val_add, ":var3", 70),
      (position_set_x, pos1, ":var3"),
      (overlay_set_position, "$g_presentation_obj_battle_28", pos1),
      (val_add, ":var3", 70),
      (position_set_x, pos1, ":var3"),
      (overlay_set_position, "$g_presentation_obj_battle_27", pos1),
      (val_add, ":var3", -280),
      (val_add, ":var4", -30),
      (position_set_x, pos1, ":var3"),
      (position_set_y, pos1, ":var4"),
      (overlay_set_position, "$g_presentation_obj_battle_22", pos1),
      (val_add, ":var4", -30),
      (position_set_y, pos1, ":var4"),
      (overlay_set_position, "$g_presentation_obj_battle_23", pos1),
      (val_add, ":var4", -30),
      (position_set_y, pos1, ":var4"),
      (overlay_set_position, "$g_presentation_obj_battle_24", pos1),
      (get_scene_boundaries, pos2, pos3),
      (position_transform_position_to_local, pos4, pos2, pos3),
      (set_fixed_point_multiplier, 1000),
      (position_get_x, ":var13", pos4),
      (position_get_y, ":var14", pos4),
      (set_fixed_point_multiplier, 1000),
      (store_div, ":var15", ":var14", 100),
      (store_div, ":var15", ":var13", ":var15"),
      (try_begin),
        (gt, ":var15", 100),
        (assign, "$g_battle_map_width", 300),
        (store_div, "$g_battle_map_scale", ":var13", "$g_battle_map_width"),
        (store_div, "$g_battle_map_height", ":var14", "$g_battle_map_scale"),
      (else_try),
        (assign, "$g_battle_map_height", 300),
        (store_div, "$g_battle_map_scale", ":var14", "$g_battle_map_height"),
        (store_div, "$g_battle_map_width", ":var13", "$g_battle_map_scale"),
      (try_end),
      (create_image_button_overlay, "$g_battle_map_plane", "mesh_white_plane", "mesh_white_plane"),
      (overlay_set_color, "$g_battle_map_plane", 0x000000),
      (store_add, ":var16", "$g_battle_map_width", 20),
      (store_add, ":var17", "$g_battle_map_height", 20),
      (store_mul, ":var18", ":var16", 50),
      (store_mul, ":var19", ":var17", 50),
      (position_set_x, pos1, ":var18"),
      (position_set_y, pos1, ":var19"),
      (overlay_set_size, "$g_battle_map_plane", pos1),
      (store_sub, ":var20", 990, ":var16"),
      (store_sub, ":var21", 740, ":var17"),
      (position_set_x, pos1, ":var20"),
      (position_set_y, pos1, ":var21"),
      (overlay_set_position, "$g_battle_map_plane", pos1),
      (overlay_set_alpha, "$g_battle_map_plane", 0x44),
      (create_mesh_overlay, "$g_battle_map_infantry_order_flag", "mesh_flag_infantry"),
      (create_mesh_overlay, "$g_battle_map_archers_order_flag", "mesh_flag_archers"),
      (create_mesh_overlay, "$g_battle_map_cavalry_order_flag", "mesh_flag_cavalry"),
      (overlay_set_alpha, "$g_battle_map_infantry_order_flag", 0x00),
      (overlay_set_alpha, "$g_battle_map_archers_order_flag", 0x00),
      (overlay_set_alpha, "$g_battle_map_cavalry_order_flag", 0x00),
      (create_mesh_overlay, reg0, "mesh_flag4"),
      (overlay_set_alpha, reg0, 0x00),
      (create_mesh_overlay, reg0, "mesh_flag5"),
      (overlay_set_alpha, reg0, 0x00),
      (create_mesh_overlay, reg0, "mesh_flag6"),
      (overlay_set_alpha, reg0, 0x00),
      (create_mesh_overlay, reg0, "mesh_flag7"),
      (overlay_set_alpha, reg0, 0x00),
      (create_mesh_overlay, reg0, "mesh_flag8"),
      (overlay_set_alpha, reg0, 0x00),
      (create_mesh_overlay, reg0, "mesh_flag9"),
      (overlay_set_alpha, reg0, 0x00),
      (call_script, "script_update_order_panel_checked_classes"),
      (call_script, "script_update_order_panel_statistics_and_map"),
      (presentation_set_duration, 999999),
    ]),
    (ti_on_presentation_event_state_change,
    [
      (store_trigger_param_1, ":var0"),
      (store_trigger_param_2, ":var1"),
      (get_player_agent_no, ":var2"),
      (agent_get_team, ":var3", ":var2"),
      (assign, ":var4", 0),
      (try_begin),
        (eq, "$group0_has_troops", 1),
        (eq, ":var0", "$g_presentation_obj_battle_check0"),
        (assign, ":var4", 1),
        (assign, "$g_formation_group0_selected", ":var1"),
        (try_begin),
          (eq, ":var1", 1),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but0", 250, 0x000044),
        (else_try),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but0", 250, 0x000000),
        (try_end),
      (else_try),
        (eq, "$group1_has_troops", 1),
        (eq, ":var0", "$g_presentation_obj_battle_check1"),
        (assign, ":var4", 1),
        (assign, "$g_formation_group1_selected", ":var1"),
        (try_begin),
          (eq, ":var1", 1),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but1", 250, 0x000044),
        (else_try),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but1", 250, 0x000000),
        (try_end),
      (else_try),
        (eq, "$group2_has_troops", 1),
        (eq, ":var0", "$g_presentation_obj_battle_check2"),
        (assign, ":var4", 1),
        (assign, "$g_formation_group2_selected", ":var1"),
        (try_begin),
          (eq, ":var1", 1),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but2", 250, 0x000044),
        (else_try),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but2", 250, 0x000000),
        (try_end),
      (else_try),
        (eq, "$group3_has_troops", 1),
        (eq, ":var0", "$g_presentation_obj_battle_check3"),
        (assign, ":var4", 1),
        (assign, "$g_formation_group3_selected", ":var1"),
        (try_begin),
          (eq, ":var1", 1),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but3", 250, 0x000044),
        (else_try),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but3", 250, 0x000000),
        (try_end),
      (else_try),
        (eq, "$group4_has_troops", 1),
        (eq, ":var0", "$g_presentation_obj_battle_check4"),
        (assign, ":var4", 1),
        (assign, "$g_formation_group4_selected", ":var1"),
        (try_begin),
          (eq, ":var1", 1),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but4", 250, 0x000044),
        (else_try),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but4", 250, 0x000000),
        (try_end),
      (else_try),
        (eq, "$group5_has_troops", 1),
        (eq, ":var0", "$g_presentation_obj_battle_check5"),
        (assign, ":var4", 1),
        (assign, "$g_formation_group5_selected", ":var1"),
        (try_begin),
          (eq, ":var1", 1),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but5", 250, 0x000044),
        (else_try),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but5", 250, 0x000000),
        (try_end),
      (else_try),
        (eq, "$group6_has_troops", 1),
        (eq, ":var0", "$g_presentation_obj_battle_check6"),
        (assign, ":var4", 1),
        (assign, "$g_formation_group6_selected", ":var1"),
        (try_begin),
          (eq, ":var1", 1),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but6", 250, 0x000044),
        (else_try),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but6", 250, 0x000000),
        (try_end),
      (else_try),
        (eq, "$group7_has_troops", 1),
        (eq, ":var0", "$g_presentation_obj_battle_check7"),
        (assign, ":var4", 1),
        (assign, "$g_formation_group7_selected", ":var1"),
        (try_begin),
          (eq, ":var1", 1),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but7", 250, 0x000044),
        (else_try),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but7", 250, 0x000000),
        (try_end),
      (else_try),
        (eq, "$group8_has_troops", 1),
        (eq, ":var0", "$g_presentation_obj_battle_check8"),
        (assign, ":var4", 1),
        (assign, "$g_formation_group8_selected", ":var1"),
        (try_begin),
          (eq, ":var1", 1),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but8", 250, 0x000044),
        (else_try),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but8", 250, 0x000000),
        (try_end),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_battle_but0"),
        (assign, ":var4", 1),
        (assign, "$g_formation_group0_selected", 1),
        (overlay_animate_to_alpha, "$g_presentation_obj_battle_but0", 250, 0x000044),
        (overlay_set_val, "$g_presentation_obj_battle_check0", 1),
        (try_begin),
          (eq, "$group1_has_troops", 1),
          (assign, "$g_formation_group1_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check1", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but1", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group2_has_troops", 1),
          (assign, "$g_formation_group2_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check2", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but2", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group3_has_troops", 1),
          (assign, "$g_formation_group3_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check3", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but3", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group4_has_troops", 1),
          (assign, "$g_formation_group4_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check4", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but4", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group5_has_troops", 1),
          (assign, "$g_formation_group5_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check5", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but5", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group6_has_troops", 1),
          (assign, "$g_formation_group6_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check6", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but6", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group7_has_troops", 1),
          (assign, "$g_formation_group7_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check7", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but7", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group8_has_troops", 1),
          (assign, "$g_formation_group8_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check8", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but8", 250, 0x000000),
        (try_end),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_battle_but1"),
        (assign, ":var4", 1),
        (assign, "$g_formation_group1_selected", 1),
        (overlay_animate_to_alpha, "$g_presentation_obj_battle_but1", 250, 0x000044),
        (overlay_set_val, "$g_presentation_obj_battle_check1", 1),
        (try_begin),
          (eq, "$group0_has_troops", 1),
          (assign, "$g_formation_group0_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check0", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but0", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group2_has_troops", 1),
          (assign, "$g_formation_group2_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check2", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but2", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group3_has_troops", 1),
          (assign, "$g_formation_group3_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check3", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but3", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group4_has_troops", 1),
          (assign, "$g_formation_group4_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check4", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but4", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group5_has_troops", 1),
          (assign, "$g_formation_group5_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check5", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but5", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group6_has_troops", 1),
          (assign, "$g_formation_group6_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check6", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but6", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group7_has_troops", 1),
          (assign, "$g_formation_group7_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check7", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but7", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group8_has_troops", 1),
          (assign, "$g_formation_group8_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check8", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but8", 250, 0x000000),
        (try_end),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_battle_but2"),
        (assign, ":var4", 1),
        (assign, "$g_formation_group2_selected", 1),
        (overlay_animate_to_alpha, "$g_presentation_obj_battle_but2", 250, 0x000044),
        (overlay_set_val, "$g_presentation_obj_battle_check2", 1),
        (try_begin),
          (eq, "$group0_has_troops", 1),
          (assign, "$g_formation_group0_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check0", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but0", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group1_has_troops", 1),
          (assign, "$g_formation_group1_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check1", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but1", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group3_has_troops", 1),
          (assign, "$g_formation_group3_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check3", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but3", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group4_has_troops", 1),
          (assign, "$g_formation_group4_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check4", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but4", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group5_has_troops", 1),
          (assign, "$g_formation_group5_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check5", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but5", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group6_has_troops", 1),
          (assign, "$g_formation_group6_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check6", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but6", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group7_has_troops", 1),
          (assign, "$g_formation_group7_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check7", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but7", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group8_has_troops", 1),
          (assign, "$g_formation_group8_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check8", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but8", 250, 0x000000),
        (try_end),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_battle_but3"),
        (assign, ":var4", 1),
        (assign, "$g_formation_group3_selected", 1),
        (overlay_animate_to_alpha, "$g_presentation_obj_battle_but3", 250, 0x000044),
        (overlay_set_val, "$g_presentation_obj_battle_check3", 1),
        (try_begin),
          (eq, "$group0_has_troops", 1),
          (assign, "$g_formation_group0_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check0", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but0", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group1_has_troops", 1),
          (assign, "$g_formation_group1_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check1", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but1", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group2_has_troops", 1),
          (assign, "$g_formation_group2_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check2", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but2", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group4_has_troops", 1),
          (assign, "$g_formation_group4_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check4", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but4", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group5_has_troops", 1),
          (assign, "$g_formation_group5_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check5", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but5", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group6_has_troops", 1),
          (assign, "$g_formation_group6_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check6", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but6", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group7_has_troops", 1),
          (assign, "$g_formation_group7_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check7", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but7", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group8_has_troops", 1),
          (assign, "$g_formation_group8_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check8", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but8", 250, 0x000000),
        (try_end),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_battle_but4"),
        (assign, ":var4", 1),
        (assign, "$g_formation_group4_selected", 1),
        (overlay_animate_to_alpha, "$g_presentation_obj_battle_but4", 250, 0x000044),
        (overlay_set_val, "$g_presentation_obj_battle_check4", 1),
        (try_begin),
          (eq, "$group0_has_troops", 1),
          (assign, "$g_formation_group0_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check0", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but0", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group1_has_troops", 1),
          (assign, "$g_formation_group1_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check1", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but1", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group2_has_troops", 1),
          (assign, "$g_formation_group2_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check2", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but2", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group3_has_troops", 1),
          (assign, "$g_formation_group3_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check3", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but3", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group5_has_troops", 1),
          (assign, "$g_formation_group5_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check5", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but5", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group6_has_troops", 1),
          (assign, "$g_formation_group6_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check6", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but6", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group7_has_troops", 1),
          (assign, "$g_formation_group7_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check7", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but7", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group8_has_troops", 1),
          (assign, "$g_formation_group8_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check8", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but8", 250, 0x000000),
        (try_end),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_battle_but5"),
        (assign, ":var4", 1),
        (assign, "$g_formation_group5_selected", 1),
        (overlay_animate_to_alpha, "$g_presentation_obj_battle_but5", 250, 0x000044),
        (overlay_set_val, "$g_presentation_obj_battle_check5", 1),
        (try_begin),
          (eq, "$group0_has_troops", 1),
          (assign, "$g_formation_group0_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check0", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but0", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group1_has_troops", 1),
          (assign, "$g_formation_group1_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check1", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but1", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group2_has_troops", 1),
          (assign, "$g_formation_group2_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check2", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but2", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group3_has_troops", 1),
          (assign, "$g_formation_group3_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check3", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but3", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group4_has_troops", 1),
          (assign, "$g_formation_group4_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check4", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but4", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group6_has_troops", 1),
          (assign, "$g_formation_group6_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check6", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but6", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group7_has_troops", 1),
          (assign, "$g_formation_group7_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check7", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but7", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group8_has_troops", 1),
          (assign, "$g_formation_group8_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check8", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but8", 250, 0x000000),
        (try_end),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_battle_but6"),
        (assign, ":var4", 1),
        (assign, "$g_formation_group6_selected", 1),
        (overlay_animate_to_alpha, "$g_presentation_obj_battle_but6", 250, 0x000044),
        (overlay_set_val, "$g_presentation_obj_battle_check6", 1),
        (try_begin),
          (eq, "$group0_has_troops", 1),
          (assign, "$g_formation_group0_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check0", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but0", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group1_has_troops", 1),
          (assign, "$g_formation_group1_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check1", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but1", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group2_has_troops", 1),
          (assign, "$g_formation_group2_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check2", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but2", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group3_has_troops", 1),
          (assign, "$g_formation_group3_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check3", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but3", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group4_has_troops", 1),
          (assign, "$g_formation_group4_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check4", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but4", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group5_has_troops", 1),
          (assign, "$g_formation_group5_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check5", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but5", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group7_has_troops", 1),
          (assign, "$g_formation_group7_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check7", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but7", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group8_has_troops", 1),
          (assign, "$g_formation_group8_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check8", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but8", 250, 0x000000),
        (try_end),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_battle_but7"),
        (assign, ":var4", 1),
        (assign, "$g_formation_group7_selected", 1),
        (overlay_animate_to_alpha, "$g_presentation_obj_battle_but7", 250, 0x000044),
        (overlay_set_val, "$g_presentation_obj_battle_check7", 1),
        (try_begin),
          (eq, "$group0_has_troops", 1),
          (assign, "$g_formation_group0_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check0", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but0", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group1_has_troops", 1),
          (assign, "$g_formation_group1_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check1", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but1", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group2_has_troops", 1),
          (assign, "$g_formation_group2_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check2", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but2", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group3_has_troops", 1),
          (assign, "$g_formation_group3_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check3", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but3", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group4_has_troops", 1),
          (assign, "$g_formation_group4_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check4", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but4", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group5_has_troops", 1),
          (assign, "$g_formation_group5_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check5", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but5", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group6_has_troops", 1),
          (assign, "$g_formation_group6_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check6", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but6", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group8_has_troops", 1),
          (assign, "$g_formation_group8_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check8", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but8", 250, 0x000000),
        (try_end),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_battle_but8"),
        (assign, ":var4", 1),
        (assign, "$g_formation_group8_selected", 1),
        (overlay_animate_to_alpha, "$g_presentation_obj_battle_but8", 250, 0x000044),
        (overlay_set_val, "$g_presentation_obj_battle_check8", 1),
        (try_begin),
          (eq, "$group0_has_troops", 1),
          (assign, "$g_formation_group0_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check0", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but0", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group1_has_troops", 1),
          (assign, "$g_formation_group1_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check1", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but1", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group2_has_troops", 1),
          (assign, "$g_formation_group2_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check2", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but2", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group3_has_troops", 1),
          (assign, "$g_formation_group3_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check3", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but3", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group4_has_troops", 1),
          (assign, "$g_formation_group4_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check4", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but4", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group5_has_troops", 1),
          (assign, "$g_formation_group5_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check5", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but5", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group6_has_troops", 1),
          (assign, "$g_formation_group6_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check6", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but6", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group7_has_troops", 1),
          (assign, "$g_formation_group7_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check7", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but7", 250, 0x000000),
        (try_end),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_battle_14"),
        (call_script, "script_team_give_order_from_order_panel", ":var2", 8),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_battle_15"),
        (call_script, "script_team_give_order_from_order_panel", ":var2", 7),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_battle_16"),
        (call_script, "script_team_give_order_from_order_panel", ":var2", 6),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_battle_17"),
        (call_script, "script_team_give_order_from_order_panel", ":var2", 5),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_battle_10"),
        (try_begin),
          (eq, ":var1", 3),
          (call_script, "script_team_give_order_from_order_panel", ":var2", 0),
          (call_script, "script_update_order_panel", ":var3"),
          (assign, "$g_latest_order_1", 3),
        (else_try),
          (eq, ":var1", 2),
          (call_script, "script_team_give_order_from_order_panel", ":var2", 1),
          (call_script, "script_update_order_panel", ":var3"),
          (assign, "$g_latest_order_1", 2),
        (else_try),
          (eq, ":var1", 1),
          (call_script, "script_team_give_order_from_order_panel", ":var2", 2),
          (call_script, "script_update_order_panel", ":var3"),
          (assign, "$g_latest_order_1", 1),
        (else_try),
          (eq, ":var1", 0),
          (call_script, "script_team_give_order_from_order_panel", ":var2", 11),
          (call_script, "script_update_order_panel", ":var3"),
          (assign, "$g_latest_order_1", 0),
        (try_end),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_battle_11"),
        (try_begin),
          (eq, ":var1", 1),
          (call_script, "script_team_give_order_from_order_panel", ":var2", 3),
          (call_script, "script_update_order_panel", ":var3"),
          (assign, "$g_latest_order_2", 1),
        (else_try),
          (eq, ":var1", 0),
          (call_script, "script_team_give_order_from_order_panel", ":var2", 4),
          (call_script, "script_update_order_panel", ":var3"),
          (assign, "$g_latest_order_2", 0),
        (try_end),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_battle_12"),
        (try_begin),
          (eq, ":var1", 1),
          (call_script, "script_team_give_order_from_order_panel", ":var2", 12),
          (call_script, "script_update_order_panel", ":var3"),
          (assign, "$g_latest_order_3", 1),
        (else_try),
          (eq, ":var1", 0),
          (call_script, "script_team_give_order_from_order_panel", ":var2", 13),
          (call_script, "script_update_order_panel", ":var3"),
          (assign, "$g_latest_order_3", 0),
        (try_end),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_battle_13"),
        (try_begin),
          (eq, ":var1", 1),
          (call_script, "script_team_give_order_from_order_panel", ":var2", 10),
          (call_script, "script_update_order_panel", ":var3"),
          (assign, "$g_latest_order_4", 1),
        (else_try),
          (eq, ":var1", 0),
          (call_script, "script_team_give_order_from_order_panel", ":var2", 9),
          (call_script, "script_update_order_panel", ":var3"),
          (assign, "$g_latest_order_4", 0),
        (try_end),
      (else_try),
        (eq, ":var0", "$g_battle_map_plane"),
        (get_scene_boundaries, pos2, pos3),
        (mouse_get_position, pos1),
        (set_fixed_point_multiplier, 1000),
        (position_get_x, ":var5", pos1),
        (position_get_y, ":var6", pos1),
        (store_sub, ":var7", 980, "$g_battle_map_width"),
        (store_sub, ":var8", 730, "$g_battle_map_height"),
        (val_sub, ":var5", ":var7"),
        (val_sub, ":var6", ":var8"),
        (val_clamp, ":var5", 0, "$g_battle_map_width"),
        (val_clamp, ":var6", 0, "$g_battle_map_height"),
        (val_mul, ":var5", "$g_battle_map_scale"),
        (val_mul, ":var6", "$g_battle_map_scale"),
        (set_fixed_point_multiplier, 1000),
        (position_set_x, pos1, ":var5"),
        (position_set_y, pos1, ":var6"),
        (position_transform_position_to_parent, pos3, pos2, pos1),
        (try_begin),
          (eq, "$g_formation_group0_selected", 1),
          (team_give_order, ":var3", 0, 0),
          (team_set_order_position, ":var3", 0, pos3),
        (try_end),
        (try_begin),
          (eq, "$g_formation_group1_selected", 1),
          (team_give_order, ":var3", 1, 0),
          (team_set_order_position, ":var3", 1, pos3),
        (try_end),
        (try_begin),
          (eq, "$g_formation_group2_selected", 1),
          (team_give_order, ":var3", 2, 0),
          (team_set_order_position, ":var3", 2, pos3),
        (try_end),
        (try_begin),
          (eq, "$g_formation_group3_selected", 1),
          (team_give_order, ":var3", 3, 0),
          (team_set_order_position, ":var3", 3, pos3),
        (try_end),
        (try_begin),
          (eq, "$g_formation_group4_selected", 1),
          (team_give_order, ":var3", 4, 0),
          (team_set_order_position, ":var3", 4, pos3),
        (try_end),
        (try_begin),
          (eq, "$g_formation_group5_selected", 1),
          (team_give_order, ":var3", 5, 0),
          (team_set_order_position, ":var3", 5, pos3),
        (try_end),
        (try_begin),
          (eq, "$g_formation_group6_selected", 1),
          (team_give_order, ":var3", 6, 0),
          (team_set_order_position, ":var3", 6, pos3),
        (try_end),
        (try_begin),
          (eq, "$g_formation_group7_selected", 1),
          (team_give_order, ":var3", 7, 0),
          (team_set_order_position, ":var3", 7, pos3),
        (try_end),
        (try_begin),
          (eq, "$g_formation_group8_selected", 1),
          (team_give_order, ":var3", 8, 0),
          (team_set_order_position, ":var3", 8, pos3),
        (try_end),
        (assign, ":var9", 1),
        (convert_to_fixed_point, ":var9"),
        (set_fixed_point_multiplier, 100),
        (call_script, "script_team_get_position_of_enemies", 24, "$fplayer_team_no", 9),
        (try_for_range, ":var10", 0, 9),
          (assign, ":var11", 0),
          (try_begin),
            (eq, ":var10", 0),
            (eq, "$g_formation_group0_selected", 1),
            (assign, ":var11", 1),
          (else_try),
            (eq, ":var10", 1),
            (eq, "$g_formation_group1_selected", 1),
            (assign, ":var11", 1),
          (else_try),
            (eq, ":var10", 2),
            (eq, "$g_formation_group2_selected", 1),
            (assign, ":var11", 1),
          (else_try),
            (eq, ":var10", 3),
            (eq, "$g_formation_group3_selected", 1),
            (assign, ":var11", 1),
          (else_try),
            (eq, ":var10", 4),
            (eq, "$g_formation_group4_selected", 1),
            (assign, ":var11", 1),
          (else_try),
            (eq, ":var10", 5),
            (eq, "$g_formation_group5_selected", 1),
            (assign, ":var11", 1),
          (else_try),
            (eq, ":var10", 6),
            (eq, "$g_formation_group6_selected", 1),
            (assign, ":var11", 1),
          (else_try),
            (eq, ":var10", 7),
            (eq, "$g_formation_group7_selected", 1),
            (assign, ":var11", 1),
          (else_try),
            (eq, ":var10", 8),
            (eq, "$g_formation_group8_selected", 1),
            (assign, ":var11", 1),
          (try_end),
          (eq, ":var11", 1),
          (store_add, ":var12", 185, ":var10"),
          (team_get_slot, ":var13", "$fplayer_team_no", ":var12"),
          (neq, ":var13", 0),
          (copy_position, 1, 3),
          (call_script, "script_point_y_toward_position", 1, 24),
          (call_script, "script_set_formation_destination", "$fplayer_team_no", ":var10", 1),
          (store_add, ":var12", 14, ":var10"),
          (team_get_slot, ":var14", "$fplayer_team_no", ":var12"),
          (store_add, ":var12", 194, ":var10"),
          (team_get_slot, ":var15", "$fplayer_team_no", ":var12"),
          (call_script, "script_get_centering_amount", ":var13", ":var14", ":var15"),
          (position_move_x, 1, reg0),
          (store_add, ":var12", 176, ":var10"),
          (try_begin),
            (team_slot_eq, "$fplayer_team_no", ":var12", 1),
            (call_script, "script_form_archers", "$fplayer_team_no", ":var10", "$fplayer_agent_no", ":var15", ":var13"),
          (else_try),
            (this_or_next|team_slot_eq, "$fplayer_team_no", ":var12", 2),
            (team_slot_eq, "$fplayer_team_no", ":var12", 5),
            (call_script, "script_form_cavalry", "$fplayer_team_no", ":var10", "$fplayer_agent_no", ":var15"),
          (else_try),
            (call_script, "script_form_infantry", "$fplayer_team_no", ":var10", "$fplayer_agent_no", ":var15", ":var13"),
          (try_end),
          (store_add, ":var12", 203, ":var10"),
          (team_set_slot, "$fplayer_team_no", ":var12", 0),
        (try_end),
        (set_fixed_point_multiplier, ":var9"),
        (call_script, "script_update_order_flags_on_map"),
        (call_script, "script_update_order_flags_on_map"),
        (call_script, "script_update_order_panel", ":var3"),
      (try_end),
      (try_begin),
        (eq, ":var4", 1),
        (team_set_order_listener, ":var3", -1),
        (try_begin),
          (this_or_next|eq, "$g_formation_group0_selected", 1),
          (eq, "$group0_has_troops", 0),
          (this_or_next|eq, "$g_formation_group1_selected", 1),
          (eq, "$group1_has_troops", 0),
          (this_or_next|eq, "$g_formation_group2_selected", 1),
          (eq, "$group2_has_troops", 0),
          (this_or_next|eq, "$g_formation_group3_selected", 1),
          (eq, "$group3_has_troops", 0),
          (this_or_next|eq, "$g_formation_group4_selected", 1),
          (eq, "$group4_has_troops", 0),
          (this_or_next|eq, "$g_formation_group5_selected", 1),
          (eq, "$group5_has_troops", 0),
          (this_or_next|eq, "$g_formation_group6_selected", 1),
          (eq, "$group6_has_troops", 0),
          (this_or_next|eq, "$g_formation_group7_selected", 1),
          (eq, "$group7_has_troops", 0),
          (this_or_next|eq, "$g_formation_group8_selected", 1),
          (eq, "$group8_has_troops", 0),
          (team_set_order_listener, ":var3", 9),
        (else_try),
          (eq, "$g_formation_group0_selected", 1),
          (team_set_order_listener, ":var3", 0, 1),
        (else_try),
          (eq, "$g_formation_group1_selected", 1),
          (team_set_order_listener, ":var3", 1, 1),
        (else_try),
          (eq, "$g_formation_group2_selected", 1),
          (team_set_order_listener, ":var3", 2, 1),
        (else_try),
          (eq, "$g_formation_group3_selected", 1),
          (team_set_order_listener, ":var3", 3, 1),
        (else_try),
          (eq, "$g_formation_group4_selected", 1),
          (team_set_order_listener, ":var3", 4, 1),
        (else_try),
          (eq, "$g_formation_group5_selected", 1),
          (team_set_order_listener, ":var3", 5, 1),
        (else_try),
          (eq, "$g_formation_group6_selected", 1),
          (team_set_order_listener, ":var3", 6, 1),
        (else_try),
          (eq, "$g_formation_group7_selected", 1),
          (team_set_order_listener, ":var3", 7, 1),
        (else_try),
          (eq, "$g_formation_group8_selected", 1),
          (team_set_order_listener, ":var3", 8, 1),
        (try_end),
      (try_end),
    ]),
    (ti_on_presentation_mouse_enter_leave,
    [
      (store_trigger_param_1, ":var0"),
      (store_trigger_param_2, ":var1"),
      (try_begin),
        (eq, ":var0", "$g_presentation_obj_battle_but0"),
        (try_begin),
          (eq, ":var1", 0),
          (overlay_animate_to_color, "$g_presentation_but0_movement", 250, 0xFFFFFF),
          (overlay_animate_to_color, "$g_presentation_but0_riding", 250, 0xFFFFFF),
          (overlay_animate_to_color, "$g_presentation_but0_weapon_usage", 250, 0xFFFFFF),
          (overlay_animate_to_color, "$g_presentation_obj_battle_name0", 250, 0xFFFFFF),
        (else_try),
          (overlay_animate_to_color, "$g_presentation_but0_movement", 250, 0x000000),
          (overlay_animate_to_color, "$g_presentation_but0_riding", 250, 0x000000),
          (overlay_animate_to_color, "$g_presentation_but0_weapon_usage", 250, 0x000000),
          (overlay_animate_to_color, "$g_presentation_obj_battle_name0", 250, 0x000000),
        (try_end),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_battle_but1"),
        (try_begin),
          (eq, ":var1", 0),
          (overlay_animate_to_color, "$g_presentation_but1_movement", 250, 0xFFFFFF),
          (overlay_animate_to_color, "$g_presentation_but1_riding", 250, 0xFFFFFF),
          (overlay_animate_to_color, "$g_presentation_but1_weapon_usage", 250, 0xFFFFFF),
          (overlay_animate_to_color, "$g_presentation_obj_battle_name1", 250, 0xFFFFFF),
        (else_try),
          (overlay_animate_to_color, "$g_presentation_but1_movement", 250, 0x000000),
          (overlay_animate_to_color, "$g_presentation_but1_riding", 250, 0x000000),
          (overlay_animate_to_color, "$g_presentation_but1_weapon_usage", 250, 0x000000),
          (overlay_animate_to_color, "$g_presentation_obj_battle_name1", 250, 0x000000),
        (try_end),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_battle_but2"),
        (try_begin),
          (eq, ":var1", 0),
          (overlay_animate_to_color, "$g_presentation_but2_movement", 250, 0xFFFFFF),
          (overlay_animate_to_color, "$g_presentation_but2_riding", 250, 0xFFFFFF),
          (overlay_animate_to_color, "$g_presentation_but2_weapon_usage", 250, 0xFFFFFF),
          (overlay_animate_to_color, "$g_presentation_obj_battle_name2", 250, 0xFFFFFF),
        (else_try),
          (overlay_animate_to_color, "$g_presentation_but2_movement", 250, 0x000000),
          (overlay_animate_to_color, "$g_presentation_but2_riding", 250, 0x000000),
          (overlay_animate_to_color, "$g_presentation_but2_weapon_usage", 250, 0x000000),
          (overlay_animate_to_color, "$g_presentation_obj_battle_name2", 250, 0x000000),
        (try_end),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_battle_but3"),
        (try_begin),
          (eq, ":var1", 0),
          (overlay_animate_to_color, "$g_presentation_but3_movement", 250, 0xFFFFFF),
          (overlay_animate_to_color, "$g_presentation_but3_riding", 250, 0xFFFFFF),
          (overlay_animate_to_color, "$g_presentation_but3_weapon_usage", 250, 0xFFFFFF),
          (overlay_animate_to_color, "$g_presentation_obj_battle_name3", 250, 0xFFFFFF),
        (else_try),
          (overlay_animate_to_color, "$g_presentation_but3_movement", 250, 0x000000),
          (overlay_animate_to_color, "$g_presentation_but3_riding", 250, 0x000000),
          (overlay_animate_to_color, "$g_presentation_but3_weapon_usage", 250, 0x000000),
          (overlay_animate_to_color, "$g_presentation_obj_battle_name3", 250, 0x000000),
        (try_end),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_battle_but4"),
        (try_begin),
          (eq, ":var1", 0),
          (overlay_animate_to_color, "$g_presentation_but4_movement", 250, 0xFFFFFF),
          (overlay_animate_to_color, "$g_presentation_but4_riding", 250, 0xFFFFFF),
          (overlay_animate_to_color, "$g_presentation_but4_weapon_usage", 250, 0xFFFFFF),
          (overlay_animate_to_color, "$g_presentation_obj_battle_name4", 250, 0xFFFFFF),
        (else_try),
          (overlay_animate_to_color, "$g_presentation_but4_movement", 250, 0x000000),
          (overlay_animate_to_color, "$g_presentation_but4_riding", 250, 0x000000),
          (overlay_animate_to_color, "$g_presentation_but4_weapon_usage", 250, 0x000000),
          (overlay_animate_to_color, "$g_presentation_obj_battle_name4", 250, 0x000000),
        (try_end),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_battle_but5"),
        (try_begin),
          (eq, ":var1", 0),
          (overlay_animate_to_color, "$g_presentation_but5_movement", 250, 0xFFFFFF),
          (overlay_animate_to_color, "$g_presentation_but5_riding", 250, 0xFFFFFF),
          (overlay_animate_to_color, "$g_presentation_but5_weapon_usage", 250, 0xFFFFFF),
          (overlay_animate_to_color, "$g_presentation_obj_battle_name5", 250, 0xFFFFFF),
        (else_try),
          (overlay_animate_to_color, "$g_presentation_but5_movement", 250, 0x000000),
          (overlay_animate_to_color, "$g_presentation_but5_riding", 250, 0x000000),
          (overlay_animate_to_color, "$g_presentation_but5_weapon_usage", 250, 0x000000),
          (overlay_animate_to_color, "$g_presentation_obj_battle_name5", 250, 0x000000),
        (try_end),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_battle_but6"),
        (try_begin),
          (eq, ":var1", 0),
          (overlay_animate_to_color, "$g_presentation_but6_movement", 250, 0xFFFFFF),
          (overlay_animate_to_color, "$g_presentation_but6_riding", 250, 0xFFFFFF),
          (overlay_animate_to_color, "$g_presentation_but6_weapon_usage", 250, 0xFFFFFF),
          (overlay_animate_to_color, "$g_presentation_obj_battle_name6", 250, 0xFFFFFF),
        (else_try),
          (overlay_animate_to_color, "$g_presentation_but6_movement", 250, 0x000000),
          (overlay_animate_to_color, "$g_presentation_but6_riding", 250, 0x000000),
          (overlay_animate_to_color, "$g_presentation_but6_weapon_usage", 250, 0x000000),
          (overlay_animate_to_color, "$g_presentation_obj_battle_name6", 250, 0x000000),
        (try_end),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_battle_but7"),
        (try_begin),
          (eq, ":var1", 0),
          (overlay_animate_to_color, "$g_presentation_but7_movement", 250, 0xFFFFFF),
          (overlay_animate_to_color, "$g_presentation_but7_riding", 250, 0xFFFFFF),
          (overlay_animate_to_color, "$g_presentation_but7_weapon_usage", 250, 0xFFFFFF),
          (overlay_animate_to_color, "$g_presentation_obj_battle_name7", 250, 0xFFFFFF),
        (else_try),
          (overlay_animate_to_color, "$g_presentation_but7_movement", 250, 0x000000),
          (overlay_animate_to_color, "$g_presentation_but7_riding", 250, 0x000000),
          (overlay_animate_to_color, "$g_presentation_but7_weapon_usage", 250, 0x000000),
          (overlay_animate_to_color, "$g_presentation_obj_battle_name7", 250, 0x000000),
        (try_end),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_battle_but8"),
        (try_begin),
          (eq, ":var1", 0),
          (overlay_animate_to_color, "$g_presentation_but8_movement", 250, 0xFFFFFF),
          (overlay_animate_to_color, "$g_presentation_but8_riding", 250, 0xFFFFFF),
          (overlay_animate_to_color, "$g_presentation_but8_weapon_usage", 250, 0xFFFFFF),
          (overlay_animate_to_color, "$g_presentation_obj_battle_name8", 250, 0xFFFFFF),
        (else_try),
          (overlay_animate_to_color, "$g_presentation_but8_movement", 250, 0x000000),
          (overlay_animate_to_color, "$g_presentation_but8_riding", 250, 0x000000),
          (overlay_animate_to_color, "$g_presentation_but8_weapon_usage", 250, 0x000000),
          (overlay_animate_to_color, "$g_presentation_obj_battle_name8", 250, 0x000000),
        (try_end),
      (try_end),
    ]),
    (ti_on_presentation_run,
    [
      (store_trigger_param_1, ":var0"),
      (try_begin),
        (this_or_next|game_key_clicked, gk_infantry_hear),
        (this_or_next|game_key_clicked, gk_archers_hear),
        (this_or_next|game_key_clicked, gk_cavalry_hear),
        (this_or_next|game_key_clicked, gk_group3_hear),
        (this_or_next|game_key_clicked, gk_group4_hear),
        (this_or_next|game_key_clicked, gk_group5_hear),
        (this_or_next|game_key_clicked, gk_group6_hear),
        (this_or_next|game_key_clicked, gk_group7_hear),
        (this_or_next|game_key_clicked, gk_group8_hear),
        (this_or_next|game_key_clicked, gk_everyone_hear),
        (game_key_clicked, gk_reverse_order_group),
        (call_script, "script_update_order_panel_checked_classes"),
      (try_end),
      (try_begin),
        (this_or_next|game_key_clicked, gk_order_1),
        (this_or_next|game_key_clicked, gk_order_2),
        (this_or_next|game_key_clicked, gk_order_3),
        (this_or_next|game_key_clicked, gk_order_4),
        (this_or_next|game_key_clicked, gk_order_5),
        (game_key_clicked, gk_order_6),
        (get_player_agent_no, ":var1"),
        (agent_get_team, ":var2", ":var1"),
        (call_script, "script_update_order_panel", ":var2"),
      (try_end),
      (try_begin),
        (gt, ":var0", 200),
        (game_key_clicked, gk_view_orders),
        (try_for_agents, ":var3"),
          (agent_set_slot, ":var3", 10, 0),
        (try_end),
        (presentation_set_duration, 0),
      (try_end),
    ]),
  ]),

  ("sliders", 0, mesh_pic_bandits,
  [
    (ti_on_presentation_load,
    [
      (set_fixed_point_multiplier, 1000),
      (create_slider_overlay, "$g_presentation_obj_sliders_1", 0, 100),
      (create_slider_overlay, "$g_presentation_obj_sliders_2", 0, 100),
      (create_slider_overlay, "$g_presentation_obj_sliders_3", 0, 100),
      (create_slider_overlay, "$g_presentation_obj_sliders_4", 0, 100),
      (assign, reg1, 25),
      (str_store_string, s1, "str_reg1"),
      (create_text_overlay, "$g_presentation_obj_sliders_5", s1),
      (create_text_overlay, "$g_presentation_obj_sliders_6", s1),
      (create_text_overlay, "$g_presentation_obj_sliders_7", s1),
      (create_text_overlay, "$g_presentation_obj_sliders_8", s1),
      (assign, "$g_presentation_obj_sliders_1_val", 25),
      (overlay_set_val, "$g_presentation_obj_sliders_1", 25),
      (assign, "$g_presentation_obj_sliders_2_val", 25),
      (overlay_set_val, "$g_presentation_obj_sliders_2", 25),
      (assign, "$g_presentation_obj_sliders_3_val", 25),
      (overlay_set_val, "$g_presentation_obj_sliders_3", 25),
      (assign, "$g_presentation_obj_sliders_4_val", 25),
      (overlay_set_val, "$g_presentation_obj_sliders_4", 25),
      (position_set_x, pos1, 600),
      (position_set_y, pos1, 200),
      (overlay_set_position, "$g_presentation_obj_sliders_1", pos1),
      (position_set_y, pos1, 300),
      (overlay_set_position, "$g_presentation_obj_sliders_2", pos1),
      (position_set_y, pos1, 400),
      (overlay_set_position, "$g_presentation_obj_sliders_3", pos1),
      (position_set_y, pos1, 500),
      (overlay_set_position, "$g_presentation_obj_sliders_4", pos1),
      (position_set_x, pos1, 800),
      (position_set_y, pos1, 200),
      (overlay_set_position, "$g_presentation_obj_sliders_5", pos1),
      (position_set_y, pos1, 300),
      (overlay_set_position, "$g_presentation_obj_sliders_6", pos1),
      (position_set_y, pos1, 400),
      (overlay_set_position, "$g_presentation_obj_sliders_7", pos1),
      (position_set_y, pos1, 500),
      (overlay_set_position, "$g_presentation_obj_sliders_8", pos1),
      (position_set_x, pos1, 500),
      (overlay_set_size, "$g_presentation_obj_sliders_3", pos1),
    ]),
    (ti_on_presentation_run,
    [
    ]),
    (ti_on_presentation_event_state_change,
    [
      (store_trigger_param_1, ":var0"),
      (store_trigger_param_2, ":var1"),
      (assign, ":var2", 0),
      (try_begin),
        (eq, ":var0", "$g_presentation_obj_sliders_1"),
        (try_begin),
          (neq, "$g_presentation_obj_sliders_1_val", ":var1"),
          (assign, "$g_presentation_obj_sliders_1_val", ":var1"),
          (assign, ":var2", 1),
        (try_end),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_sliders_2"),
        (try_begin),
          (neq, "$g_presentation_obj_sliders_2_val", ":var1"),
          (assign, "$g_presentation_obj_sliders_2_val", ":var1"),
          (assign, ":var2", 1),
        (try_end),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_sliders_3"),
        (try_begin),
          (neq, "$g_presentation_obj_sliders_3_val", ":var1"),
          (assign, "$g_presentation_obj_sliders_3_val", ":var1"),
          (assign, ":var2", 1),
        (try_end),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_sliders_4"),
        (try_begin),
          (neq, "$g_presentation_obj_sliders_4_val", ":var1"),
          (assign, "$g_presentation_obj_sliders_4_val", ":var1"),
          (assign, ":var2", 1),
        (try_end),
      (try_end),
      (try_begin),
        (eq, ":var2", 1),
        (assign, ":var3", 0),
        (val_add, ":var3", "$g_presentation_obj_sliders_1_val"),
        (val_add, ":var3", "$g_presentation_obj_sliders_2_val"),
        (val_add, ":var3", "$g_presentation_obj_sliders_3_val"),
        (val_add, ":var3", "$g_presentation_obj_sliders_4_val"),
        (store_sub, ":var4", 100, ":var3"),
        (assign, ":var5", "$g_presentation_obj_sliders_1_val"),
        (assign, ":var6", "$g_presentation_obj_sliders_2_val"),
        (assign, ":var7", "$g_presentation_obj_sliders_3_val"),
        (assign, ":var8", "$g_presentation_obj_sliders_4_val"),
        (assign, ":var9", 1),
        (assign, ":var10", 0),
        (assign, ":var11", 100),
        (try_begin),
          (lt, ":var4", 0),
          (val_mul, ":var4", -1),
          (assign, ":var9", -1),
          (assign, ":var10", 1),
          (assign, ":var11", 101),
        (try_end),
        (store_sub, ":var12", ":var3", ":var1"),
        (val_add, ":var12", 30),
        (try_for_range, ":var13", 0, ":var4"),
          (store_random_in_range, ":var14", 0, ":var12"),
          (try_begin),
            (neq, ":var0", "$g_presentation_obj_sliders_1"),
            (val_sub, ":var14", "$g_presentation_obj_sliders_1_val"),
            (val_sub, ":var14", 10),
            (lt, ":var14", 0),
            (is_between, ":var5", ":var10", ":var11"),
            (val_add, ":var5", ":var9"),
          (else_try),
            (neq, ":var0", "$g_presentation_obj_sliders_2"),
            (val_sub, ":var14", "$g_presentation_obj_sliders_2_val"),
            (val_sub, ":var14", 10),
            (lt, ":var14", 0),
            (is_between, ":var6", ":var10", ":var11"),
            (val_add, ":var6", ":var9"),
          (else_try),
            (neq, ":var0", "$g_presentation_obj_sliders_3"),
            (val_sub, ":var14", "$g_presentation_obj_sliders_3_val"),
            (val_sub, ":var14", 10),
            (lt, ":var14", 0),
            (is_between, ":var7", ":var10", ":var11"),
            (val_add, ":var7", ":var9"),
          (else_try),
            (is_between, ":var8", ":var10", ":var11"),
            (val_add, ":var8", ":var9"),
          (else_try),
            (val_add, ":var4", 1),
          (try_end),
        (try_end),
        (assign, "$g_presentation_obj_sliders_1_val", ":var5"),
        (assign, "$g_presentation_obj_sliders_2_val", ":var6"),
        (assign, "$g_presentation_obj_sliders_3_val", ":var7"),
        (assign, "$g_presentation_obj_sliders_4_val", ":var8"),
      (try_end),
      (overlay_set_val, "$g_presentation_obj_sliders_1", "$g_presentation_obj_sliders_1_val"),
      (overlay_set_val, "$g_presentation_obj_sliders_2", "$g_presentation_obj_sliders_2_val"),
      (overlay_set_val, "$g_presentation_obj_sliders_3", "$g_presentation_obj_sliders_3_val"),
      (overlay_set_val, "$g_presentation_obj_sliders_4", "$g_presentation_obj_sliders_4_val"),
      (assign, reg1, "$g_presentation_obj_sliders_1_val"),
      (str_store_string, s1, "str_reg1"),
      (overlay_set_text, "$g_presentation_obj_sliders_5", s1),
      (assign, reg1, "$g_presentation_obj_sliders_2_val"),
      (str_store_string, s1, "str_reg1"),
      (overlay_set_text, "$g_presentation_obj_sliders_6", s1),
      (assign, reg1, "$g_presentation_obj_sliders_3_val"),
      (str_store_string, s1, "str_reg1"),
      (overlay_set_text, "$g_presentation_obj_sliders_7", s1),
      (assign, reg1, "$g_presentation_obj_sliders_4_val"),
      (str_store_string, s1, "str_reg1"),
      (overlay_set_text, "$g_presentation_obj_sliders_8", s1),
    ]),
  ]),

  ("minimap", prsntf_read_only, mesh_pic_bandits,
  [
    (ti_on_presentation_load,
    [
      (assign, "$g_minimap_ratio", 65),
      (set_fixed_point_multiplier, 1000),
      (create_mesh_overlay, reg0, "mesh_white_plane"),
      (position_set_x, pos1, 1200),
      (position_set_y, pos1, 800),
      (overlay_set_position, reg0, pos1),
      (try_begin),
        (eq, "$g_show_minimap", 1),
        (try_for_agents, ":var0"),
          (agent_set_slot, ":var0", 10, 0),
        (try_end),
        (get_scene_boundaries, pos2, pos3),
        (position_transform_position_to_local, pos4, pos2, pos3),
        (set_fixed_point_multiplier, 1000),
        (position_get_x, ":var1", pos4),
        (position_get_y, ":var2", pos4),
        (set_fixed_point_multiplier, 1000),
        (store_div, ":var3", ":var2", 100),
        (store_div, ":var3", ":var1", ":var3"),
        (try_begin),
          (gt, ":var3", 100),
          (store_mul, ":var4", "$g_minimap_ratio", 3),
          (assign, "$g_battle_map_width", ":var4"),
          (store_div, "$g_battle_map_scale", ":var1", "$g_battle_map_width"),
          (store_div, "$g_battle_map_height", ":var2", "$g_battle_map_scale"),
        (else_try),
          (store_mul, ":var4", "$g_minimap_ratio", 3),
          (assign, "$g_battle_map_height", ":var4"),
          (store_div, "$g_battle_map_scale", ":var2", "$g_battle_map_height"),
          (store_div, "$g_battle_map_width", ":var1", "$g_battle_map_scale"),
        (try_end),
        (create_mesh_overlay, "$g_battle_map_plane", "mesh_white_plane"),
        (overlay_set_color, "$g_battle_map_plane", 0x000000),
        (store_add, ":var5", "$g_battle_map_width", 20),
        (store_add, ":var6", "$g_battle_map_height", 20),
        (store_mul, ":var7", ":var5", 50),
        (store_mul, ":var8", ":var6", 50),
        (position_set_x, pos1, ":var7"),
        (position_set_y, pos1, ":var8"),
        (overlay_set_size, "$g_battle_map_plane", pos1),
        (store_sub, ":var9", 990, ":var5"),
        (store_sub, ":var10", 740, ":var6"),
        (position_set_x, pos1, ":var9"),
        (position_set_y, pos1, ":var10"),
        (overlay_set_position, "$g_battle_map_plane", pos1),
        (overlay_set_alpha, "$g_battle_map_plane", 0x22),
        (try_begin),
          (scene_prop_get_instance, ":var11", "spr_inventory", 0),
          (ge, ":var11", 0),
          (create_mesh_overlay, "$g_presentation_obj_39", "mesh_white_plane"),
          (overlay_set_color, "$g_presentation_obj_39", 0xFF00FF),
          (position_set_x, pos1, 250),
          (position_set_y, pos1, 250),
          (overlay_set_size, "$g_presentation_obj_39", pos1),
        (try_end),
        (call_script, "script_update_order_panel_map"),
      (try_end),
      (presentation_set_duration, 999999),
    ]),
    (ti_on_presentation_run,
    [
      (set_fixed_point_multiplier, 1000),
      (try_begin),
        (game_key_clicked, gk_view_orders),
        (presentation_set_duration, 1500),
        (start_presentation, "prsnt_battle"),
      (try_end),
    ]),
  ]),

  ("magic_overlay", prsntf_read_only|prsntf_manual_end_only, mesh_pic_bandits,
  [
    (ti_on_presentation_load,
    [
      (presentation_set_duration, 999999),
      (set_fixed_point_multiplier, 1000),
      (store_mission_timer_a, ":var0"),
      (try_begin),
        (le, ":var0", 5),
        (store_skill_level, ":var1", 20, "trp_player"),
        (val_mul, ":var1", 10),
        (assign, ":var2", ":var1"),
        (val_add, ":var1", 200),
        (troop_set_slot, "trp_player", 229, ":var1"),
        (troop_set_slot, "trp_player", 230, ":var2"),
        (assign, reg30, ":var1"),
      (else_try),
        (troop_get_slot, ":var3", "trp_player", 230),
        (assign, reg30, ":var3"),
      (try_end),
      (str_store_string, s1, "@Current Mana: {reg30}"),
      (create_text_overlay, "$g_presentation_obj_magic_overlay_1", s1),
      (overlay_set_color, "$g_presentation_obj_magic_overlay_1", 0x0066FF),
      (position_set_x, pos1, 10),
      (position_set_y, pos1, 700),
      (overlay_set_position, "$g_presentation_obj_magic_overlay_1", pos1),
      (troop_get_slot, ":var4", "trp_player", 231),
      (str_store_item_name, s2, ":var4"),
      (str_store_string, s1, "@Current Spell: {s2}"),
      (create_text_overlay, "$g_presentation_obj_magic_overlay_2", s1),
      (overlay_set_color, "$g_presentation_obj_magic_overlay_2", 0xFFFFFF),
      (position_set_x, pos1, 10),
      (position_set_y, pos1, 670),
      (overlay_set_position, "$g_presentation_obj_magic_overlay_2", pos1),
    ]),
    (ti_on_presentation_run,
    [
      (troop_get_slot, ":var0", "trp_player", 230),
      (assign, reg30, ":var0"),
      (str_store_string, s1, "@Current Mana: {reg30}"),
      (overlay_set_text, "$g_presentation_obj_magic_overlay_1", s1),
      (troop_get_slot, ":var1", "trp_player", 231),
      (str_store_item_name, s3, ":var1"),
      (store_mission_timer_a, ":var2"),
      (item_get_slot, ":var3", ":var1", 160),
      (item_get_slot, ":var4", ":var1", 157),
      (item_get_slot, ":var5", ":var1", 161),
      (try_begin),
        (eq, ":var5", 1),
        (try_begin),
          (item_slot_eq, ":var1", 113, 2),
          (assign, ":var4", 10),
        (else_try),
          (assign, ":var4", 30),
        (try_end),
      (try_end),
      (try_begin),
        (ge, ":var3", 1),
        (store_sub, ":var6", ":var2", ":var3"),
        (try_begin),
          (eq, ":var6", ":var4"),
          (try_begin),
            (eq, ":var5", 1),
            (item_get_slot, ":var7", ":var1", 157),
            (store_sub, ":var8", ":var2", ":var7"),
            (item_set_slot, ":var1", 160, ":var8"),
          (try_end),
          (call_script, "script_cf_equip_spell_ammo"),
        (try_end),
        (try_begin),
          (ge, ":var6", ":var4"),
          (str_store_string, s6, "@(activated)"),
        (else_try),
          (store_sub, ":var9", ":var4", ":var6"),
          (assign, reg6, ":var9"),
          (str_store_string, s6, "@(activating in {reg6} seconds)"),
        (try_end),
      (else_try),
        (str_store_string, s6, "@(activated)"),
      (try_end),
      (str_store_string, s1, "@{s3} {s6}"),
      (overlay_set_text, "$g_presentation_obj_magic_overlay_2", s1),
    ]),
  ]),

  ("potion_overlay", prsntf_read_only|prsntf_manual_end_only, mesh_pic_bandits,
  [
    (ti_on_presentation_load,
    [
      (presentation_set_duration, 999999),
      (set_fixed_point_multiplier, 1000),
      (get_player_agent_no, ":var0"),
      (call_script, "script_list_at", "trp_list_37", 1),
      (assign, ":var1", reg1),
      (agent_set_slot, ":var0", 157, ":var1"),
      (str_store_item_name, s4, ":var1"),
      (str_store_string, s5, "@Current Potion: {s4}"),
      (create_text_overlay, "$g_presentation_obj_potion_overlay_1", s5),
      (overlay_set_color, "$g_presentation_obj_potion_overlay_1", 0xFFFFFF),
      (position_set_x, pos1, 700),
      (position_set_y, pos1, 700),
      (overlay_set_position, "$g_presentation_obj_potion_overlay_1", pos1),
    ]),
    (ti_on_presentation_run,
    [
      (get_player_agent_no, ":var0"),
      (agent_get_slot, ":var1", ":var0", 157),
      (try_begin),
        (ge, ":var1", 1),
        (str_store_item_name, s4, ":var1"),
        (str_store_string, s5, "@Current Potion: {s4}"),
      (else_try),
        (str_store_string, s5, "@Out of potions"),
      (try_end),
      (overlay_set_text, "$g_presentation_obj_potion_overlay_1", s5),
    ]),
  ]),

  ("arena_training", prsntf_read_only|prsntf_manual_end_only, mesh_pic_bandits,
  [
    (ti_on_presentation_load,
    [
      (presentation_set_duration, 999999),
      (set_fixed_point_multiplier, 1000),
      (get_player_agent_no, ":var0"),
      (agent_get_kill_count, reg1, ":var0", 1),
      (str_store_string, s1, "@Number of men knocked down: {reg1}"),
      (create_text_overlay, "$g_presentation_obj_arena_training_1", s1),
      (overlay_set_color, "$g_presentation_obj_arena_training_1", 0xFFFFFF),
      (position_set_x, pos1, 10),
      (position_set_y, pos1, 700),
      (overlay_set_position, "$g_presentation_obj_arena_training_1", pos1),
      (assign, reg1, 0),
      (str_store_string, s1, "@Number of men left: {reg1}"),
      (create_text_overlay, "$g_presentation_obj_arena_training_2", s1),
      (overlay_set_color, "$g_presentation_obj_arena_training_2", 0xFFFFFF),
      (position_set_x, pos1, 10),
      (position_set_y, pos1, 670),
      (overlay_set_position, "$g_presentation_obj_arena_training_2", pos1),
    ]),
    (ti_on_presentation_run,
    [
      (get_player_agent_no, ":var0"),
      (agent_get_kill_count, reg1, ":var0", 1),
      (str_store_string, s1, "@Opponents Beaten: {reg1}"),
      (overlay_set_text, "$g_presentation_obj_arena_training_1", s1),
      (assign, ":var1", "$g_arena_training_max_opponents"),
      (try_for_agents, ":var2"),
        (agent_is_human, ":var2"),
        (neg|agent_is_alive, ":var2"),
        (neq, ":var2", ":var0"),
        (val_sub, ":var1", 1),
      (try_end),
      (assign, reg1, ":var1"),
      (str_store_string, s1, "@Opponents Remaining: {reg1}"),
      (overlay_set_text, "$g_presentation_obj_arena_training_2", s1),
    ]),
  ]),

  ("retirement", 0, mesh_load_window,
  [
    (ti_on_presentation_load,
    [
      (presentation_set_duration, 999999),
      (set_fixed_point_multiplier, 1000),
      (create_button_overlay, "$g_presentation_obj_retirement_1", "@Remain in retirement.", tf_center_justify),
      (create_button_overlay, "$g_presentation_obj_retirement_2", "@Go back to the adventuring.", tf_center_justify),
      (position_set_x, pos1, 500),
      (position_set_y, pos1, 80),
      (overlay_set_position, "$g_presentation_obj_retirement_1", pos1),
      (position_set_y, pos1, 40),
      (overlay_set_position, "$g_presentation_obj_retirement_2", pos1),
      (assign, ":var0", 0),
      (store_troop_gold, ":var1", "trp_player"),
      (store_div, ":var2", ":var1", 200),
      (val_add, ":var0", ":var2"),
      (assign, ":var3", 0),
      (assign, ":var4", 0),
      (assign, ":var5", 0),
      (assign, ":var6", 0),
      (assign, ":var7", 0),
      (assign, ":var8", 0),
      (assign, ":var9", 0),
      (try_for_range, ":var10", "p_town_1", "p_salt_mine"),
        (party_get_slot, ":var11", ":var10", 0),
        (try_begin),
          (party_slot_eq, ":var10", 7, "trp_player"),
          (try_begin),
            (eq, ":var11", 3),
            (val_add, ":var3", 1),
          (else_try),
            (eq, ":var11", 2),
            (val_add, ":var4", 1),
          (else_try),
            (val_add, ":var5", 1),
          (try_end),
        (try_end),
        (party_get_slot, ":var12", ":var10", 26),
        (try_begin),
          (ge, ":var12", 40),
          (try_begin),
            (eq, ":var11", 3),
            (val_add, ":var6", 1),
          (else_try),
            (eq, ":var11", 4),
            (val_add, ":var7", 1),
          (try_end),
        (else_try),
          (le, ":var12", -40),
          (try_begin),
            (eq, ":var11", 3),
            (val_add, ":var8", 1),
          (else_try),
            (eq, ":var11", 4),
            (val_add, ":var9", 1),
          (try_end),
        (try_end),
      (try_end),
      (store_mul, ":var13", ":var3", 100),
      (store_mul, ":var14", ":var4", 50),
      (store_mul, ":var15", ":var5", 20),
      (store_add, ":var16", ":var3", ":var4"),
      (val_add, ":var16", ":var5"),
      (store_add, ":var17", ":var13", ":var14"),
      (val_add, ":var17", ":var15"),
      (val_add, ":var0", ":var17"),
      (store_mul, ":var18", ":var6", 20),
      (store_mul, ":var19", ":var7", 4),
      (store_add, ":var20", ":var6", ":var7"),
      (store_add, ":var21", ":var18", ":var19"),
      (val_add, ":var0", ":var21"),
      (store_mul, ":var22", ":var8", -40),
      (store_mul, ":var23", ":var9", -8),
      (store_add, ":var24", ":var8", ":var9"),
      (store_add, ":var25", ":var22", ":var23"),
      (val_add, ":var0", ":var25"),
      (assign, ":var26", 0),
      (troop_get_inventory_capacity, ":var27", "trp_player"),
      (try_for_range, ":var28", 0, ":var27"),
        (troop_get_inventory_slot, ":var29", "trp_player", ":var28"),
        (ge, ":var29", 0),
        (store_item_value, ":var30", ":var29"),
        (val_add, ":var26", ":var30"),
      (try_end),
      (store_div, ":var31", ":var26", 200),
      (val_add, ":var0", ":var31"),
      (troop_get_slot, ":var32", "trp_player", 7),
      (store_div, ":var33", ":var32", 1),
      (val_add, ":var0", ":var33"),
      (assign, ":var34", 0),
      (assign, ":var35", 0),
      (try_for_range, ":var36", "trp_npc1", "trp_heroes_end"),
        (this_or_next|troop_slot_eq, ":var36", 2, 2),
        (troop_slot_eq, ":var36", 2, 6),
        (call_script, "script_troop_get_player_relation", ":var36"),
        (assign, ":var12", reg0),
        (try_begin),
          (ge, ":var12", 40),
          (val_add, ":var35", 1),
        (else_try),
          (le, ":var12", -40),
          (val_add, ":var34", 1),
        (try_end),
      (try_end),
      (store_mul, ":var37", ":var35", 10),
      (val_add, ":var0", ":var37"),
      (store_mul, ":var38", ":var34", -10),
      (val_add, ":var0", ":var38"),
      (store_current_day, ":var39"),
      (store_div, ":var40", ":var39", -1),
      (val_add, ":var0", ":var40"),
      (store_mul, ":var41", "$g_total_victories", 2),
      (val_add, ":var0", ":var41"),
      (store_mul, ":var42", "$g_total_defeats", -3),
      (val_add, ":var0", ":var42"),
      (store_mul, ":var43", "$g_total_quests_completed", 4),
      (val_add, ":var0", ":var43"),
      (troop_get_xp, ":var44", "trp_player"),
      (store_div, ":var45", ":var44", 5000),
      (val_add, ":var0", ":var45"),
      (assign, ":var46", 0),
      (assign, ":var47", 0),
      (try_for_range, ":var36", "trp_npc1", "trp_kingdom_1_lord"),
        (try_begin),
          (troop_slot_eq, ":var36", 2, 5),
          (val_add, ":var46", 1),
        (else_try),
          (troop_slot_ge, ":var36", 82, 1),
          (val_add, ":var47", 1),
        (try_end),
      (try_end),
      (store_div, ":var48", ":var46", 2),
      (val_add, ":var0", ":var48"),
      (store_div, ":var49", ":var47", -4),
      (val_add, ":var0", ":var49"),
      (get_average_game_difficulty, ":var50"),
      (assign, ":var51", ":var0"),
      (val_mul, ":var0", ":var50"),
      (val_div, ":var0", 75),
      (val_mul, ":var0", ":var50"),
      (val_div, ":var0", 75),
      (store_sub, ":var51", ":var0", ":var51"),
      (assign, reg5, ":var39"),
      (store_character_level, reg4, "trp_player"),
      (create_text_overlay, reg1, "@You have retired at level {reg4} after {reg5} days of adventuring.", tf_center_justify),
      (position_set_x, pos1, 700),
      (position_set_y, pos1, 700),
      (overlay_set_position, reg1, pos1),
      (position_set_x, pos1, 950),
      (position_set_y, pos1, 950),
      (overlay_set_size, reg1, pos1),
      (create_text_overlay, reg2, "@Effect on Score", tf_center_justify),
      (position_set_x, pos1, 750),
      (position_set_y, pos1, 750),
      (overlay_set_size, reg2, pos1),
      (position_set_x, pos1, 850),
      (position_set_y, pos1, 670),
      (overlay_set_position, reg2, pos1),
      (assign, reg0, ":var16"),
      (create_text_overlay, reg1, "@Settlements owned by you: {reg0}", 0),
      (position_set_x, pos1, 750),
      (position_set_y, pos1, 750),
      (overlay_set_size, reg1, pos1),
      (position_set_x, pos1, 600),
      (position_set_y, pos1, 650),
      (overlay_set_position, reg1, pos1),
      (assign, reg0, ":var17"),
      (create_text_overlay, reg1, "@{!}{reg0?+:}{reg0}", tf_center_justify),
      (position_set_x, pos1, 750),
      (position_set_y, pos1, 750),
      (overlay_set_size, reg1, pos1),
      (position_set_x, pos1, 850),
      (position_set_y, pos1, 650),
      (overlay_set_position, reg1, pos1),
      (try_begin),
        (gt, reg0, 0),
        (overlay_set_color, reg1, 0x00AA00),
      (try_end),
      (assign, reg0, ":var20"),
      (create_text_overlay, reg1, "@Friendly Settlements: {reg0}", 0),
      (position_set_x, pos1, 750),
      (position_set_y, pos1, 750),
      (overlay_set_size, reg1, pos1),
      (position_set_x, pos1, 600),
      (position_set_y, pos1, 630),
      (overlay_set_position, reg1, pos1),
      (assign, reg0, ":var21"),
      (create_text_overlay, reg1, "@{!}{reg0?+:}{reg0}", tf_center_justify),
      (position_set_x, pos1, 750),
      (position_set_y, pos1, 750),
      (overlay_set_size, reg1, pos1),
      (position_set_x, pos1, 850),
      (position_set_y, pos1, 630),
      (overlay_set_position, reg1, pos1),
      (try_begin),
        (gt, reg0, 0),
        (overlay_set_color, reg1, 0x00AA00),
      (try_end),
      (assign, reg0, ":var24"),
      (create_text_overlay, reg1, "@Hostile Settlements: {reg0}", 0),
      (position_set_x, pos1, 750),
      (position_set_y, pos1, 750),
      (overlay_set_size, reg1, pos1),
      (position_set_x, pos1, 600),
      (position_set_y, pos1, 610),
      (overlay_set_position, reg1, pos1),
      (assign, reg0, ":var25"),
      (create_text_overlay, reg1, "@{!}{reg0}", tf_center_justify),
      (position_set_x, pos1, 750),
      (position_set_y, pos1, 750),
      (overlay_set_size, reg1, pos1),
      (position_set_x, pos1, 850),
      (position_set_y, pos1, 610),
      (overlay_set_position, reg1, pos1),
      (try_begin),
        (lt, reg0, 0),
        (overlay_set_color, reg1, 0xFF0000),
      (try_end),
      (assign, reg0, ":var35"),
      (create_text_overlay, reg1, "@Friendly Lords: {reg0}", 0),
      (position_set_x, pos1, 750),
      (position_set_y, pos1, 750),
      (overlay_set_size, reg1, pos1),
      (position_set_x, pos1, 600),
      (position_set_y, pos1, 590),
      (overlay_set_position, reg1, pos1),
      (assign, reg0, ":var37"),
      (create_text_overlay, reg1, "@{!}{reg0?+:}{reg0}", tf_center_justify),
      (position_set_x, pos1, 750),
      (position_set_y, pos1, 750),
      (overlay_set_size, reg1, pos1),
      (position_set_x, pos1, 850),
      (position_set_y, pos1, 590),
      (overlay_set_position, reg1, pos1),
      (try_begin),
        (gt, reg0, 0),
        (overlay_set_color, reg1, 0x00AA00),
      (try_end),
      (assign, reg0, ":var34"),
      (create_text_overlay, reg1, "@Enemy Lords: {reg0}", 0),
      (position_set_x, pos1, 750),
      (position_set_y, pos1, 750),
      (overlay_set_size, reg1, pos1),
      (position_set_x, pos1, 600),
      (position_set_y, pos1, 570),
      (overlay_set_position, reg1, pos1),
      (assign, reg0, ":var38"),
      (create_text_overlay, reg1, "@{!}{reg0}", tf_center_justify),
      (position_set_x, pos1, 750),
      (position_set_y, pos1, 750),
      (overlay_set_size, reg1, pos1),
      (position_set_x, pos1, 850),
      (position_set_y, pos1, 570),
      (overlay_set_position, reg1, pos1),
      (try_begin),
        (lt, reg0, 0),
        (overlay_set_color, reg1, 0xFF0000),
      (try_end),
      (assign, reg0, "$g_total_victories"),
      (create_text_overlay, reg1, "@Victories: {reg0}", 0),
      (position_set_x, pos1, 750),
      (position_set_y, pos1, 750),
      (overlay_set_size, reg1, pos1),
      (position_set_x, pos1, 600),
      (position_set_y, pos1, 550),
      (overlay_set_position, reg1, pos1),
      (assign, reg0, ":var41"),
      (create_text_overlay, reg1, "@{!}{reg0?+:}{reg0}", tf_center_justify),
      (position_set_x, pos1, 750),
      (position_set_y, pos1, 750),
      (overlay_set_size, reg1, pos1),
      (position_set_x, pos1, 850),
      (position_set_y, pos1, 550),
      (overlay_set_position, reg1, pos1),
      (try_begin),
        (gt, reg0, 0),
        (overlay_set_color, reg1, 0x00AA00),
      (try_end),
      (assign, reg0, "$g_total_defeats"),
      (create_text_overlay, reg1, "@Defeats: {reg0}", 0),
      (position_set_x, pos1, 750),
      (position_set_y, pos1, 750),
      (overlay_set_size, reg1, pos1),
      (position_set_x, pos1, 600),
      (position_set_y, pos1, 530),
      (overlay_set_position, reg1, pos1),
      (assign, reg0, ":var42"),
      (create_text_overlay, reg1, "@{!}{reg0}", tf_center_justify),
      (position_set_x, pos1, 750),
      (position_set_y, pos1, 750),
      (overlay_set_size, reg1, pos1),
      (position_set_x, pos1, 850),
      (position_set_y, pos1, 530),
      (overlay_set_position, reg1, pos1),
      (try_begin),
        (lt, reg0, 0),
        (overlay_set_color, reg1, 0xFF0000),
      (try_end),
      (assign, reg0, "$g_total_quests_completed"),
      (create_text_overlay, reg1, "@Quests Completed: {reg0}", 0),
      (position_set_x, pos1, 750),
      (position_set_y, pos1, 750),
      (overlay_set_size, reg1, pos1),
      (position_set_x, pos1, 600),
      (position_set_y, pos1, 510),
      (overlay_set_position, reg1, pos1),
      (assign, reg0, ":var43"),
      (create_text_overlay, reg1, "@{!}{reg0?+:}{reg0}", tf_center_justify),
      (position_set_x, pos1, 750),
      (position_set_y, pos1, 750),
      (overlay_set_size, reg1, pos1),
      (position_set_x, pos1, 850),
      (position_set_y, pos1, 510),
      (overlay_set_position, reg1, pos1),
      (try_begin),
        (gt, reg0, 0),
        (overlay_set_color, reg1, 0x00AA00),
      (try_end),
      (assign, reg0, ":var46"),
      (create_text_overlay, reg1, "@Companions Found: {reg0}", 0),
      (position_set_x, pos1, 750),
      (position_set_y, pos1, 750),
      (overlay_set_size, reg1, pos1),
      (position_set_x, pos1, 600),
      (position_set_y, pos1, 490),
      (overlay_set_position, reg1, pos1),
      (assign, reg0, ":var48"),
      (create_text_overlay, reg1, "@{!}{reg0?+:}{reg0}", tf_center_justify),
      (position_set_x, pos1, 750),
      (position_set_y, pos1, 750),
      (overlay_set_size, reg1, pos1),
      (position_set_x, pos1, 850),
      (position_set_y, pos1, 490),
      (overlay_set_position, reg1, pos1),
      (try_begin),
        (gt, reg0, 0),
        (overlay_set_color, reg1, 0x00AA00),
      (try_end),
      (assign, reg0, ":var47"),
      (create_text_overlay, reg1, "@Companions Lost/Departed: {reg0}", 0),
      (position_set_x, pos1, 750),
      (position_set_y, pos1, 750),
      (overlay_set_size, reg1, pos1),
      (position_set_x, pos1, 600),
      (position_set_y, pos1, 470),
      (overlay_set_position, reg1, pos1),
      (assign, reg0, ":var49"),
      (create_text_overlay, reg1, "@{!}{reg0}", tf_center_justify),
      (position_set_x, pos1, 750),
      (position_set_y, pos1, 750),
      (overlay_set_size, reg1, pos1),
      (position_set_x, pos1, 850),
      (position_set_y, pos1, 470),
      (overlay_set_position, reg1, pos1),
      (try_begin),
        (lt, reg0, 0),
        (overlay_set_color, reg1, 0xFF0000),
      (try_end),
      (assign, reg0, ":var1"),
      (create_text_overlay, reg1, "@Wealth: {reg0} denars", 0),
      (position_set_x, pos1, 750),
      (position_set_y, pos1, 750),
      (overlay_set_size, reg1, pos1),
      (position_set_x, pos1, 600),
      (position_set_y, pos1, 450),
      (overlay_set_position, reg1, pos1),
      (assign, reg0, ":var2"),
      (create_text_overlay, reg1, "@{!}{reg0?+:}{reg0}", tf_center_justify),
      (position_set_x, pos1, 750),
      (position_set_y, pos1, 750),
      (overlay_set_size, reg1, pos1),
      (position_set_x, pos1, 850),
      (position_set_y, pos1, 450),
      (overlay_set_position, reg1, pos1),
      (try_begin),
        (gt, reg0, 0),
        (overlay_set_color, reg1, 0x00AA00),
      (try_end),
      (assign, reg0, ":var26"),
      (create_text_overlay, reg1, "@Inventory: {reg0} denars", 0),
      (position_set_x, pos1, 750),
      (position_set_y, pos1, 750),
      (overlay_set_size, reg1, pos1),
      (position_set_x, pos1, 600),
      (position_set_y, pos1, 430),
      (overlay_set_position, reg1, pos1),
      (assign, reg0, ":var31"),
      (create_text_overlay, reg1, "@{!}{reg0?+:}{reg0}", tf_center_justify),
      (position_set_x, pos1, 750),
      (position_set_y, pos1, 750),
      (overlay_set_size, reg1, pos1),
      (position_set_x, pos1, 850),
      (position_set_y, pos1, 430),
      (overlay_set_position, reg1, pos1),
      (try_begin),
        (gt, reg0, 0),
        (overlay_set_color, reg1, 0x00AA00),
      (try_end),
      (assign, reg0, ":var32"),
      (create_text_overlay, reg1, "@Renown: {reg0}", 0),
      (position_set_x, pos1, 750),
      (position_set_y, pos1, 750),
      (overlay_set_size, reg1, pos1),
      (position_set_x, pos1, 600),
      (position_set_y, pos1, 410),
      (overlay_set_position, reg1, pos1),
      (assign, reg0, ":var33"),
      (create_text_overlay, reg1, "@{!}{reg0?+:}{reg0}", tf_center_justify),
      (position_set_x, pos1, 750),
      (position_set_y, pos1, 750),
      (overlay_set_size, reg1, pos1),
      (position_set_x, pos1, 850),
      (position_set_y, pos1, 410),
      (overlay_set_position, reg1, pos1),
      (try_begin),
        (gt, reg0, 0),
        (overlay_set_color, reg1, 0x00AA00),
      (try_end),
      (assign, reg0, ":var44"),
      (create_text_overlay, reg1, "@Experience: {reg0}", 0),
      (position_set_x, pos1, 750),
      (position_set_y, pos1, 750),
      (overlay_set_size, reg1, pos1),
      (position_set_x, pos1, 600),
      (position_set_y, pos1, 390),
      (overlay_set_position, reg1, pos1),
      (assign, reg0, ":var45"),
      (create_text_overlay, reg1, "@{!}{reg0?+:}{reg0}", tf_center_justify),
      (position_set_x, pos1, 750),
      (position_set_y, pos1, 750),
      (overlay_set_size, reg1, pos1),
      (position_set_x, pos1, 850),
      (position_set_y, pos1, 390),
      (overlay_set_position, reg1, pos1),
      (try_begin),
        (gt, reg0, 0),
        (overlay_set_color, reg1, 0x00AA00),
      (try_end),
      (assign, reg0, ":var39"),
      (create_text_overlay, reg1, "@Days Passed: {reg0}", 0),
      (position_set_x, pos1, 750),
      (position_set_y, pos1, 750),
      (overlay_set_size, reg1, pos1),
      (position_set_x, pos1, 600),
      (position_set_y, pos1, 370),
      (overlay_set_position, reg1, pos1),
      (assign, reg0, ":var40"),
      (create_text_overlay, reg1, "@{!}{reg0}", tf_center_justify),
      (position_set_x, pos1, 750),
      (position_set_y, pos1, 750),
      (overlay_set_size, reg1, pos1),
      (position_set_x, pos1, 850),
      (position_set_y, pos1, 370),
      (overlay_set_position, reg1, pos1),
      (try_begin),
        (lt, reg0, 0),
        (overlay_set_color, reg1, 0xFF0000),
      (try_end),
      (assign, reg0, ":var50"),
      (create_text_overlay, reg1, "@Difficulty: {reg0}%", 0),
      (position_set_x, pos1, 750),
      (position_set_y, pos1, 750),
      (overlay_set_size, reg1, pos1),
      (position_set_x, pos1, 600),
      (position_set_y, pos1, 350),
      (overlay_set_position, reg1, pos1),
      (assign, reg0, ":var51"),
      (assign, reg3, reg0),
      (val_max, reg3, 0),
      (create_text_overlay, reg1, "@{!}{reg3?+:}{reg0}", tf_center_justify),
      (position_set_x, pos1, 750),
      (position_set_y, pos1, 750),
      (overlay_set_size, reg1, pos1),
      (position_set_x, pos1, 850),
      (position_set_y, pos1, 350),
      (overlay_set_position, reg1, pos1),
      (try_begin),
        (gt, reg0, 0),
        (overlay_set_color, reg1, 0x00AA00),
      (else_try),
        (lt, reg0, 0),
        (overlay_set_color, reg1, 0xFF0000),
      (try_end),
      (assign, reg0, ":var0"),
      (create_text_overlay, reg1, "@TOTAL SCORE: {reg0}", tf_center_justify),
      (position_set_x, pos1, 750),
      (position_set_y, pos1, 320),
      (overlay_set_position, reg1, pos1),
      (assign, ":var52", 0),
      (assign, ":var53", 0),
      (assign, ":var54", 0),
      (assign, ":var55", 0),
      (assign, ":var56", 0),
      (assign, ":var57", 0),
      (try_for_range, ":var58", "p_town_1", "p_salt_mine"),
        (try_begin),
          (party_slot_eq, ":var58", 7, "trp_player"),
          (try_begin),
            (party_slot_eq, ":var58", 0, 3),
            (val_add, ":var54", 1),
          (else_try),
            (party_slot_eq, ":var58", 0, 2),
            (val_add, ":var53", 1),
          (else_try),
            (val_add, ":var52", 1),
          (try_end),
        (else_try),
          (party_get_slot, ":var59", ":var58", 26),
          (gt, ":var59", 0),
          (try_begin),
            (party_slot_eq, ":var58", 0, 3),
            (val_add, ":var57", ":var59"),
          (else_try),
            (party_slot_eq, ":var58", 0, 2),
            (val_add, ":var56", ":var59"),
          (else_try),
            (val_add, ":var55", ":var59"),
          (try_end),
        (try_end),
      (try_end),
      (try_begin),
        (gt, ":var54", 0),
        (store_random_in_range, ":var60", 0, ":var54"),
        (try_for_range, ":var58", "p_town_1", "p_castle_1"),
          (party_slot_eq, ":var58", 7, "trp_player"),
          (val_sub, ":var60", 1),
          (lt, ":var60", 0),
          (str_store_party_name, s9, ":var58"),
        (try_end),
      (else_try),
        (gt, ":var57", 0),
        (store_random_in_range, ":var61", 0, ":var57"),
        (try_for_range, ":var58", "p_town_1", "p_castle_1"),
          (party_get_slot, ":var59", ":var58", 26),
          (gt, ":var59", 0),
          (val_sub, ":var61", ":var59"),
          (lt, ":var61", 0),
          (str_store_party_name, s9, ":var58"),
        (try_end),
      (else_try),
        (store_random_in_range, ":var60", "p_town_1", "p_castle_1"),
        (str_store_party_name, s9, ":var60"),
      (try_end),
      (try_begin),
        (gt, ":var53", 0),
        (store_random_in_range, ":var62", 0, ":var53"),
        (try_for_range, ":var58", "p_castle_1", "p_village_1"),
          (party_slot_eq, ":var58", 7, "trp_player"),
          (val_sub, ":var62", 1),
          (lt, ":var62", 0),
          (str_store_party_name, s8, ":var58"),
        (try_end),
      (else_try),
        (gt, ":var56", 0),
        (store_random_in_range, ":var63", 0, ":var56"),
        (try_for_range, ":var58", "p_castle_1", "p_village_1"),
          (party_get_slot, ":var59", ":var58", 26),
          (gt, ":var59", 0),
          (val_sub, ":var63", ":var59"),
          (lt, ":var63", 0),
          (str_store_party_name, s8, ":var58"),
        (try_end),
      (else_try),
        (store_random_in_range, ":var62", "p_castle_1", "p_village_1"),
        (str_store_party_name, s8, ":var62"),
      (try_end),
      (try_begin),
        (gt, ":var52", 0),
        (store_random_in_range, ":var64", 0, ":var52"),
        (try_for_range, ":var58", "p_village_1", "p_salt_mine"),
          (party_slot_eq, ":var58", 7, "trp_player"),
          (val_sub, ":var64", 1),
          (lt, ":var64", 0),
          (str_store_party_name, s7, ":var58"),
        (try_end),
      (else_try),
        (gt, ":var55", 0),
        (store_random_in_range, ":var65", 0, ":var55"),
        (try_for_range, ":var58", "p_village_1", "p_salt_mine"),
          (party_get_slot, ":var59", ":var58", 26),
          (gt, ":var59", 0),
          (val_sub, ":var65", ":var59"),
          (lt, ":var65", 0),
          (str_store_party_name, s7, ":var58"),
        (try_end),
      (else_try),
        (store_random_in_range, ":var64", "p_village_1", "p_salt_mine"),
        (str_store_party_name, s7, ":var64"),
      (try_end),
      (try_begin),
        (lt, ":var0", 100),
        (create_mesh_overlay_with_tableau_material, reg1, -1, "tableau_retirement_troop", 0),
        (str_store_string, s0, "str_retirement_text_1"),
      (else_try),
        (lt, ":var0", 200),
        (create_mesh_overlay_with_tableau_material, reg1, -1, "tableau_retirement_troop", 1),
        (str_store_string, s0, "str_retirement_text_2"),
      (else_try),
        (lt, ":var0", 400),
        (create_mesh_overlay_with_tableau_material, reg1, -1, "tableau_retirement_troop", 2),
        (str_store_string, s0, "str_retirement_text_3"),
      (else_try),
        (lt, ":var0", 700),
        (create_mesh_overlay_with_tableau_material, reg1, -1, "tableau_retirement_troop", 3),
        (str_store_string, s0, "str_retirement_text_4"),
      (else_try),
        (lt, ":var0", 1200),
        (create_mesh_overlay_with_tableau_material, reg1, -1, "tableau_retirement_troop", 4),
        (str_store_string, s0, "str_retirement_text_5"),
      (else_try),
        (lt, ":var0", 1850),
        (create_mesh_overlay_with_tableau_material, reg1, -1, "tableau_retirement_troop", 5),
        (str_store_string, s0, "str_retirement_text_6"),
      (else_try),
        (lt, ":var0", 2500),
        (create_mesh_overlay_with_tableau_material, reg1, -1, "tableau_retirement_troop", 6),
        (str_store_string, s0, "str_retirement_text_7"),
      (else_try),
        (lt, ":var0", 3500),
        (create_mesh_overlay_with_tableau_material, reg1, -1, "tableau_retirement_troop", 7),
        (str_store_string, s0, "str_retirement_text_8"),
      (else_try),
        (lt, ":var0", 5000),
        (create_mesh_overlay_with_tableau_material, reg1, -1, "tableau_retirement_troop", 8),
        (str_store_string, s0, "str_retirement_text_9"),
      (else_try),
        (create_mesh_overlay_with_tableau_material, reg1, -1, "tableau_retirement_troop", 9),
        (str_store_string, s0, "str_retirement_text_10"),
      (try_end),
      (position_set_x, pos1, 0),
      (position_set_y, pos1, 120),
      (overlay_set_position, reg1, pos1),
      (create_text_overlay, reg1, s0, tf_double_space|tf_scrollable),
      (position_set_x, pos1, 600),
      (position_set_y, pos1, 120),
      (overlay_set_position, reg1, pos1),
      (position_set_x, pos1, 360),
      (position_set_y, pos1, 190),
      (overlay_set_area_size, reg1, pos1),
      (position_set_x, pos1, 800),
      (position_set_y, pos1, 800),
      (overlay_set_size, reg1, pos1),
    ]),
    (ti_on_presentation_event_state_change,
    [
      (store_trigger_param_1, ":var0"),
      (try_begin),
        (eq, ":var0", "$g_presentation_obj_retirement_1"),
        (jump_to_menu, "mnu_end_game"),
        (start_presentation, "prsnt_game_credits"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_retirement_2"),
        (presentation_set_duration, 0),
        (change_screen_return),
      (try_end),
    ]),
  ]),

  ("budget_report", 0, mesh_load_window,
  [
    (ti_on_presentation_load,
    [
      (presentation_set_duration, 999999),
      (set_fixed_point_multiplier, 1000),
      (create_mesh_overlay, reg1, "mesh_pic_payment"),
      (position_set_x, pos1, 800),
      (position_set_y, pos1, 800),
      (overlay_set_size, reg1, pos1),
      (position_set_x, pos1, 170),
      (position_set_y, pos1, 0),
      (overlay_set_position, reg1, pos1),
      (create_text_overlay, reg1, "str_weekly_budget", tf_center_justify),
      (position_set_x, pos1, 1500),
      (position_set_y, pos1, 1500),
      (overlay_set_size, reg1, pos1),
      (position_set_x, pos1, 260),
      (position_set_y, pos1, 650),
      (overlay_set_position, reg1, pos1),
      (create_text_overlay, reg1, "str_weekly_budget", tf_center_justify),
      (position_set_x, pos1, 1500),
      (position_set_y, pos1, 1500),
      (overlay_set_size, reg1, pos1),
      (position_set_x, pos1, 260),
      (position_set_y, pos1, 650),
      (overlay_set_position, reg1, pos1),
      (try_begin),
        (store_current_hours, ":var0"),
        (store_sub, ":var1", "$budget_next_payday", ":var0"),
        (try_begin),
          (eq, "$budget_next_payday", 0),
          (str_store_date, s22, "@unknown yet"),
        (else_try),
          (lt, ":var1", 24),
          (str_store_date, s22, "@tomorrow"),
        (else_try),
          (str_store_date, s22, "$budget_next_payday"),
        (try_end),
        (str_store_string, s21, "@Next Payday: {s22}"),
      (try_end),
      (str_clear, s0),
      (create_text_overlay, "$g_presentation_obj_bugdet_report_container", s0, tf_scrollable_style_2),
      (position_set_x, pos1, 0),
      (position_set_y, pos1, 100),
      (overlay_set_position, "$g_presentation_obj_bugdet_report_container", pos1),
      (position_set_x, pos1, 505),
      (position_set_y, pos1, 500),
      (overlay_set_area_size, "$g_presentation_obj_bugdet_report_container", pos1),
      (set_container_overlay, "$g_presentation_obj_bugdet_report_container"),
      (game_get_reduce_campaign_ai, ":var2"),
      (try_begin),
        (eq, ":var2", 0),
        (assign, ":var3", 2),
        (assign, ":var4", 5),
      (else_try),
        (eq, ":var2", 1),
        (assign, ":var3", 4),
        (assign, ":var4", 4),
      (else_try),
        (eq, ":var2", 2),
        (assign, ":var3", 6),
        (assign, ":var4", 3),
      (try_end),
      (assign, ":var5", "fac_player_supporters_faction"),
      (try_begin),
        (is_between, "$players_kingdom", "fac_kingdom_1", "fac_kingdoms_end"),
        (call_script, "script_dplmc_get_troop_standing_in_faction", "trp_player", "$players_kingdom"),
        (ge, reg0, 50),
        (assign, ":var5", "$players_kingdom"),
      (try_end),
      (assign, ":var6", 0),
      (assign, ":var7", 0),
      (assign, ":var8", 0),
      (assign, ":var9", 0),
      (try_for_range, ":var10", "p_town_1", "p_salt_mine"),
        (try_begin),
          (party_slot_ge, ":var10", 147, 1),
          (val_add, ":var6", 1),
        (try_end),
        (party_slot_eq, ":var10", 7, "trp_player"),
        (val_add, ":var6", 1),
        (val_add, ":var7", 1),
        (try_begin),
          (is_between, ":var10", "p_town_1", "p_castle_1"),
          (val_add, ":var6", 1),
          (val_add, ":var7", 1),
        (try_end),
      (try_end),
      (try_begin),
        (gt, "$players_kingdom", 0),
        (neq, "$players_kingdom", "fac_player_supporters_faction"),
        (neq, "$players_kingdom", "fac_player_faction"),
        (eq, "$player_has_homage", 0),
        (val_add, ":var6", 1),
      (try_end),
      (try_begin),
        (gt, ":var7", ":var3"),
        (val_add, ":var6", 1),
      (try_end),
      (try_for_parties, ":var11"),
        (assign, ":var12", 0),
        (try_begin),
          (this_or_next|party_slot_eq, ":var11", 0, 3),
          (party_slot_eq, ":var11", 0, 2),
          (party_slot_eq, ":var11", 7, "trp_player"),
          (assign, ":var12", 1),
        (else_try),
          (this_or_next|party_slot_eq, ":var11", 0, 3),
          (party_slot_eq, ":var11", 0, 2),
          (neg|party_slot_ge, ":var11", 7, 1),
          (store_faction_of_party, ":var13", ":var11"),
          (this_or_next|eq, ":var5", ":var13"),
          (eq, ":var13", "fac_player_supporters_faction"),
          (this_or_next|is_between, ":var5", "fac_kingdom_1", "fac_kingdoms_end"),
          (faction_slot_eq, "fac_player_supporters_faction", 11, "trp_player"),
          (assign, ":var12", 1),
        (try_end),
        (this_or_next|eq, ":var11", "p_main_party"),
        (this_or_next|party_slot_eq, ":var11", 0, 33),
        (eq, ":var12", 1),
        (assign, ":var14", 0),
        (try_begin),
          (party_slot_eq, ":var11", 0, 7),
          (party_slot_eq, ":var11", 41, "trp_player"),
          (assign, ":var14", 1),
        (try_end),
        (this_or_next|eq, ":var14", 1),
        (eq, ":var12", 1),
        (val_add, ":var6", 1),
      (try_end),
      (try_begin),
        (gt, "$g_player_debt_to_party_members", 0),
        (val_add, ":var6", 2),
      (try_end),
      (try_begin),
        (this_or_next|gt, "$g_player_minister", 0),
        (this_or_next|troop_slot_ge, "trp_player", 30, 0),
        (this_or_next|gt, "$g_player_chamberlain", 0),
        (gt, "$g_player_constable", 0),
        (val_add, ":var6", 1),
      (try_end),
      (try_begin),
        (gt, "$g_player_chamberlain", 0),
        (val_add, ":var6", 2),
      (try_end),
      (val_add, ":var6", 3),
      (store_mul, ":var15", 27, ":var6"),
      (assign, ":var16", 0),
      (call_script, "script_list_clear_deep", "trp_list_12"),
      (try_for_range, ":var10", 0, 35),
        (call_script, "script_list_add", "trp_list_12", 0),
      (try_end),
      (assign, ":var17", reg1),
      (try_for_range, ":var10", "p_town_1", "p_castle_1"),
        (party_get_slot, ":var18", ":var10", 147),
        (gt, ":var18", 1),
        (neg|party_slot_ge, ":var10", 149, 1),
        (store_faction_of_party, ":var19", ":var10"),
        (store_relation, ":var20", ":var19", "$players_kingdom"),
        (ge, ":var20", 0),
        (assign, ":var21", ":var18"),
        (gt, ":var21", 91),
        (try_begin),
          (val_sub, ":var21", 90),
          (call_script, "script_list_at_nc", "trp_list_12", ":var21"),
          (assign, ":var22", reg1),
          (val_add, ":var22", 1),
          (call_script, "script_list_set", "trp_list_12", ":var22", ":var21"),
        (try_end),
      (try_end),
      (assign, reg1, ":var17"),
      (try_for_range, ":var10", "p_town_1", "p_salt_mine"),
        (try_begin),
          (is_between, ":var10", "p_town_1", "p_castle_1"),
          (party_get_slot, ":var18", ":var10", 147),
          (gt, ":var18", 1),
          (neg|party_slot_ge, ":var10", 149, 1),
          (str_store_party_name, s0, ":var10"),
          (call_script, "script_process_player_enterprise", ":var18", ":var10"),
          (assign, ":var23", reg0),
          (assign, ":var24", reg4),
          (assign, ":var25", reg5),
          (assign, ":var26", reg10),
          (store_sub, ":var27", ":var10", "p_town_1"),
          (store_add, ":var28", ":var27", "trp_town_1_master_craftsman"),
          (item_get_slot, ":var29", ":var18", 55),
          (assign, ":var30", 0),
          (try_begin),
            (party_slot_eq, ":var10", 148, 1),
            (assign, ":var31", 0),
            (troop_get_inventory_capacity, ":var32", ":var28"),
            (try_for_range, ":var33", 0, ":var32"),
              (troop_get_inventory_slot, ":var34", ":var28", ":var33"),
              (lt, ":var34", 1),
              (val_add, ":var31", 1),
            (try_end),
            (assign, ":var30", ":var29"),
            (val_min, ":var30", ":var31"),
            (gt, ":var30", 0),
            (store_mul, ":var35", ":var24", ":var30"),
            (val_sub, ":var23", ":var35"),
            (val_sub, ":var29", ":var30"),
          (try_end),
          (try_begin),
            (eq, "$g_apply_budget_report_to_gold", 1),
            (troop_add_items, ":var28", ":var18", ":var30"),
            (store_sub, ":var36", ":var18", "itm_spice"),
            (val_add, ":var36", 260),
            (party_get_slot, ":var37", ":var10", ":var36"),
            (store_mul, ":var38", ":var29", 15),
            (val_sub, ":var37", ":var38"),
            (party_set_slot, ":var10", ":var36", ":var37"),
            (gt, "$cheat_mode", 0),
            (str_store_troop_name, s3, ":var28"),
            (assign, reg3, ":var30"),
            (display_message, "@{!}DEBUG -- Adding {reg3} items to {s3}"),
          (try_end),
          (item_get_slot, ":var39", ":var18", 52),
          (try_begin),
            (item_slot_ge, ":var18", 57, 1),
            (assign, ":var40", ":var39"),
          (else_try),
            (assign, ":var40", 0),
          (try_end),
          (assign, ":var41", 0),
          (assign, ":var42", 0),
          (try_begin),
            (troop_get_inventory_capacity, ":var32", ":var28"),
            (try_for_range, ":var33", 0, ":var32"),
              (troop_get_inventory_slot, ":var43", ":var28", ":var33"),
              (lt, ":var41", ":var39"),
              (item_slot_eq, ":var18", 50, ":var43"),
              (val_add, ":var41", 1),
            (else_try),
              (lt, ":var42", ":var40"),
              (item_slot_eq, ":var18", 57, ":var43"),
              (val_add, ":var42", 1),
            (try_end),
            (try_begin),
              (gt, ":var41", 0),
              (val_sub, ":var39", ":var41"),
              (store_mul, ":var44", ":var25", ":var41"),
              (val_add, ":var23", ":var44"),
            (try_end),
            (try_begin),
              (gt, ":var42", 0),
              (val_sub, ":var40", ":var42"),
              (assign, ":var44", ":var26"),
              (val_add, ":var23", ":var44"),
            (try_end),
          (try_end),
          (try_begin),
            (eq, "$g_apply_budget_report_to_gold", 1),
            (item_get_slot, ":var45", ":var18", 50),
            (troop_remove_items, ":var28", ":var45", ":var41"),
            (item_get_slot, ":var46", ":var18", 57),
            (troop_remove_items, ":var28", ":var46", ":var42"),
            (store_sub, ":var36", ":var45", "itm_spice"),
            (val_add, ":var36", 260),
            (party_get_slot, ":var37", ":var10", ":var36"),
            (store_mul, ":var38", ":var29", 15),
            (val_add, ":var37", ":var38"),
            (party_set_slot, ":var10", ":var36", ":var37"),
            (try_begin),
              (gt, ":var40", 0),
              (store_sub, ":var36", ":var46", "itm_spice"),
              (val_add, ":var36", 260),
              (party_get_slot, ":var37", ":var10", ":var36"),
              (val_add, ":var37", 15),
              (party_set_slot, ":var10", ":var36", ":var37"),
            (try_end),
          (try_end),
          (call_script, "script_get_enterprise_name", ":var18"),
          (str_store_string, s5, reg0),
          (create_text_overlay, reg1, "str_enterprise_s5_at_s0", 0),
          (position_set_x, pos1, 900),
          (position_set_y, pos1, 900),
          (overlay_set_size, reg1, pos1),
          (position_set_x, pos1, 25),
          (position_set_y, pos1, ":var15"),
          (overlay_set_position, reg1, pos1),
          (assign, reg0, ":var23"),
          (try_begin),
            (store_faction_of_party, ":var19", ":var10"),
            (store_relation, ":var20", ":var19", "$players_kingdom"),
            (lt, ":var20", 0),
            (assign, reg0, 0),
            (assign, ":var23", 0),
            (create_text_overlay, reg1, "str_under_sequestration", tf_right_align|tf_single_line),
            (overlay_set_color, reg1, 0xFF0000),
          (else_try),
            (ge, reg0, 0),
            (create_text_overlay, reg1, "@{!}{reg0}", tf_right_align|tf_single_line),
            (overlay_set_color, reg1, 0x00AA00),
          (else_try),
            (create_text_overlay, reg1, "@{!}{reg0}", tf_right_align|tf_single_line),
            (overlay_set_color, reg1, 0xFF0000),
          (try_end),
          (val_add, ":var8", ":var23"),
          (val_add, ":var16", ":var23"),
          (position_set_x, pos1, 900),
          (position_set_y, pos1, 900),
          (overlay_set_size, reg1, pos1),
          (position_set_x, pos1, 500),
          (position_set_y, pos1, ":var15"),
          (overlay_set_position, reg1, pos1),
          (val_sub, ":var15", 27),
        (try_end),
        (party_slot_eq, ":var10", 7, "trp_player"),
        (party_get_slot, ":var47", ":var10", 47),
        (party_get_slot, ":var48", ":var10", 48),
        (store_add, ":var49", ":var47", ":var48"),
        (val_add, ":var8", ":var49"),
        (val_add, ":var9", ":var49"),
        (val_add, ":var16", ":var49"),
        (str_store_party_name, s0, ":var10"),
        (try_begin),
          (neg|is_between, ":var10", "p_castle_1", "p_village_1"),
          (party_get_slot, ":var50", ":var10", 580),
          (neq, ":var50", 0),
          (call_script, "script_dplmc_describe_tax_rate_to_s50", ":var50"),
          (str_store_string, s0, "@{s0} ({s50})"),
        (try_end),
        (create_text_overlay, reg1, "str_rents_from_s0", 0),
        (str_store_party_name, s0, ":var10"),
        (position_set_x, pos1, 900),
        (position_set_y, pos1, 900),
        (overlay_set_size, reg1, pos1),
        (position_set_x, pos1, 25),
        (position_set_y, pos1, ":var15"),
        (overlay_set_position, reg1, pos1),
        (try_begin),
          (gt, ":var47", 0),
          (assign, reg0, ":var47"),
          (create_text_overlay, reg1, "@{!}{reg0}", tf_right_align|tf_single_line),
          (overlay_set_color, reg1, 0x00AA00),
        (else_try),
          (create_text_overlay, reg1, "@None", tf_right_align|tf_single_line),
        (try_end),
        (position_set_x, pos1, 900),
        (position_set_y, pos1, 900),
        (overlay_set_size, reg1, pos1),
        (position_set_x, pos1, 500),
        (position_set_y, pos1, ":var15"),
        (overlay_set_position, reg1, pos1),
        (val_sub, ":var15", 27),
        (try_begin),
          (is_between, ":var10", "p_town_1", "p_castle_1"),
          (create_text_overlay, reg1, "str_tariffs_from_s0", 0),
          (position_set_x, pos1, 900),
          (position_set_y, pos1, 900),
          (overlay_set_size, reg1, pos1),
          (position_set_x, pos1, 25),
          (position_set_y, pos1, ":var15"),
          (overlay_set_position, reg1, pos1),
          (try_begin),
            (gt, ":var48", 0),
            (assign, reg0, ":var48"),
            (create_text_overlay, reg1, "@{!}{reg0}", tf_right_align|tf_single_line),
            (overlay_set_color, reg1, 0x00AA00),
          (else_try),
            (create_text_overlay, reg1, "@None", tf_right_align|tf_single_line),
          (try_end),
          (position_set_x, pos1, 900),
          (position_set_y, pos1, 900),
          (overlay_set_size, reg1, pos1),
          (position_set_x, pos1, 500),
          (position_set_y, pos1, ":var15"),
          (overlay_set_position, reg1, pos1),
          (val_sub, ":var15", 27),
        (try_end),
      (try_end),
      (try_begin),
        (gt, "$players_kingdom", 0),
        (neq, "$players_kingdom", "fac_player_supporters_faction"),
        (neq, "$players_kingdom", "fac_player_faction"),
        (eq, "$player_has_homage", 0),
        (str_store_faction_name, s0, "$players_kingdom"),
        (create_text_overlay, reg1, "str_mercenary_payment_from_s0", 0),
        (position_set_x, pos1, 900),
        (position_set_y, pos1, 900),
        (overlay_set_size, reg1, pos1),
        (position_set_x, pos1, 25),
        (position_set_y, pos1, ":var15"),
        (overlay_set_position, reg1, pos1),
        (call_script, "script_party_calculate_strength", "p_main_party", 0),
        (assign, ":var51", reg0),
        (try_for_parties, ":var11"),
          (party_slot_eq, ":var11", 0, 33),
          (call_script, "script_party_calculate_strength", ":var11", 0),
          (val_add, ":var51", reg0),
        (try_end),
        (val_div, ":var51", 2),
        (val_add, ":var51", 30),
        (call_script, "script_round_value", ":var51"),
        (val_add, ":var16", reg0),
        (create_text_overlay, reg1, "@{!}{reg0}", tf_right_align|tf_single_line),
        (position_set_x, pos1, 900),
        (position_set_y, pos1, 900),
        (overlay_set_size, reg1, pos1),
        (overlay_set_color, reg1, 0x00AA00),
        (position_set_x, pos1, 500),
        (position_set_y, pos1, ":var15"),
        (overlay_set_position, reg1, pos1),
        (val_sub, ":var15", 27),
      (try_end),
      (try_begin),
        (gt, ":var7", ":var3"),
        (gt, ":var8", 0),
        (store_sub, ":var52", ":var7", ":var3"),
        (val_mul, ":var52", ":var4"),
        (val_min, ":var52", 65),
        (store_mul, ":var53", ":var9", ":var52"),
        (val_div, ":var53", 100),
        (assign, ":var54", 0),
        (try_begin),
          (gt, "$g_player_chamberlain", 0),
          (val_add, ":var54", 10),
        (try_end),
        (try_begin),
          (try_begin),
            (is_between, ":var5", "fac_kingdom_1", "fac_kingdoms_end"),
            (neg|faction_slot_eq, "fac_player_supporters_faction", 21, 0),
            (faction_get_slot, reg0, ":var5", 243),
            (faction_set_slot, "fac_player_supporters_faction", 243, reg0),
            (faction_get_slot, reg0, ":var5", 241),
            (faction_set_slot, "fac_player_supporters_faction", 241, reg0),
            (faction_get_slot, reg0, ":var5", 244),
            (faction_set_slot, "fac_player_supporters_faction", 244, reg0),
            (faction_get_slot, reg0, ":var5", 242),
            (faction_set_slot, "fac_player_supporters_faction", 242, reg0),
            (faction_get_slot, reg0, ":var5", 246),
            (faction_set_slot, "fac_player_supporters_faction", 246, reg0),
          (try_end),
          (this_or_next|is_between, ":var5", "fac_kingdom_1", "fac_kingdoms_end"),
          (faction_slot_eq, "fac_player_supporters_faction", 21, 0),
          (try_begin),
            (faction_get_slot, ":var55", "fac_player_supporters_faction", 241),
            (neq, ":var55", 0),
            (val_mul, ":var55", 5),
            (val_add, ":var54", ":var55"),
          (try_end),
          (try_begin),
            (faction_get_slot, ":var56", "fac_player_supporters_faction", 243),
            (neq, ":var56", 0),
            (val_mul, ":var56", 3),
            (val_add, ":var54", ":var56"),
          (try_end),
        (else_try),
          (gt, "$players_kingdom", 0),
          (faction_get_slot, ":var55", "$players_kingdom", 241),
          (neq, ":var55", 0),
          (val_mul, ":var55", -5),
          (val_add, ":var54", ":var55"),
        (try_end),
        (try_begin),
          (gt, ":var53", 0),
          (store_mul, ":var57", ":var53", ":var54"),
          (val_div, ":var57", 100),
          (store_mul, ":var54", ":var57", 100),
          (val_div, ":var54", ":var53"),
          (val_sub, ":var53", ":var57"),
        (try_end),
        (val_sub, ":var16", ":var53"),
        (try_begin),
          (gt, "$g_player_chamberlain", 0),
          (str_store_string, s55, "str_loss_due_to_tax_inefficiency"),
          (assign, reg0, ":var54"),
          (val_mul, reg0, -1),
          (str_store_string, s55, "@{s55} ({reg0}%)"),
          (create_text_overlay, reg1, "@{s55}", 0),
        (else_try),
          (create_text_overlay, reg1, "str_loss_due_to_tax_inefficiency", 0),
        (try_end),
        (position_set_x, pos1, 25),
        (position_set_y, pos1, ":var15"),
        (overlay_set_position, reg1, pos1),
        (position_set_x, pos1, 900),
        (position_set_y, pos1, 900),
        (overlay_set_size, reg1, pos1),
        (store_mul, reg0, ":var53", -1),
        (create_text_overlay, reg1, "@{!}{reg0}", tf_right_align|tf_single_line),
        (position_set_x, pos1, 900),
        (position_set_y, pos1, 900),
        (overlay_set_size, reg1, pos1),
        (overlay_set_color, reg1, 0xFF0000),
        (position_set_x, pos1, 500),
        (position_set_y, pos1, ":var15"),
        (overlay_set_position, reg1, pos1),
        (val_sub, ":var15", 27),
      (try_end),
      (try_for_parties, ":var11"),
        (assign, ":var12", 0),
        (try_begin),
          (this_or_next|party_slot_eq, ":var11", 0, 3),
          (party_slot_eq, ":var11", 0, 2),
          (party_slot_eq, ":var11", 7, "trp_player"),
          (neg|party_slot_eq, ":var11", 39, "trp_peasant_woman"),
          (assign, ":var12", 1),
        (else_try),
          (this_or_next|party_slot_eq, ":var11", 0, 3),
          (party_slot_eq, ":var11", 0, 2),
          (neg|party_slot_ge, ":var11", 7, 1),
          (store_faction_of_party, ":var13", ":var11"),
          (this_or_next|eq, ":var5", ":var13"),
          (eq, ":var13", "fac_player_supporters_faction"),
          (this_or_next|is_between, ":var5", "fac_kingdom_1", "fac_kingdoms_end"),
          (faction_slot_eq, "fac_player_supporters_faction", 11, "trp_player"),
          (assign, ":var12", 1),
        (try_end),
        (assign, ":var14", 0),
        (try_begin),
          (party_slot_eq, ":var11", 0, 7),
          (party_slot_eq, ":var11", 41, "trp_player"),
          (assign, ":var14", 1),
        (try_end),
        (this_or_next|eq, ":var14", 1),
        (this_or_next|eq, ":var11", "p_main_party"),
        (this_or_next|party_slot_eq, ":var11", 0, 33),
        (eq, ":var12", 1),
        (assign, ":var58", 0),
        (party_get_num_companion_stacks, ":var59", ":var11"),
        (try_for_range, ":var60", 0, ":var59"),
          (party_stack_get_troop_id, ":var61", ":var11", ":var60"),
          (party_stack_get_size, ":var62", ":var11", ":var60"),
          (call_script, "script_game_get_troop_wage", ":var61", ":var11"),
          (assign, ":var63", reg0),
          (val_mul, ":var63", ":var62"),
          (val_add, ":var58", ":var63"),
        (try_end),
        (try_begin),
          (eq, ":var12", 1),
          (val_div, ":var58", 2),
        (else_try),
          (eq, ":var11", "p_main_party"),
          (store_sub, ":var64", 14, "$g_cur_week_half_daily_wage_payments"),
          (val_mul, ":var58", ":var64"),
          (val_div, ":var58", 14),
        (try_end),
        (val_mul, ":var58", -1),
        (val_add, ":var16", ":var58"),
        (str_store_party_name, s0, ":var11"),
        (try_begin),
          (eq, ":var11", "p_main_party"),
          (str_store_string, s0, "str_s0s_party"),
        (try_end),
        (create_text_overlay, reg1, "str_wages_for_s0", 0),
        (position_set_x, pos1, 900),
        (position_set_y, pos1, 900),
        (overlay_set_size, reg1, pos1),
        (position_set_x, pos1, 25),
        (position_set_y, pos1, ":var15"),
        (overlay_set_position, reg1, pos1),
        (try_begin),
          (lt, ":var58", 0),
          (assign, reg0, ":var58"),
          (create_text_overlay, reg1, "@{!}{reg0}", tf_right_align|tf_single_line),
          (overlay_set_color, reg1, 0xFF0000),
        (else_try),
          (create_text_overlay, reg1, "@None", tf_right_align|tf_single_line),
        (try_end),
        (position_set_x, pos1, 900),
        (position_set_y, pos1, 900),
        (overlay_set_size, reg1, pos1),
        (position_set_x, pos1, 500),
        (position_set_y, pos1, ":var15"),
        (overlay_set_position, reg1, pos1),
        (val_sub, ":var15", 27),
      (try_end),
      (try_begin),
        (gt, "$g_player_debt_to_party_members", 0),
        (val_sub, ":var16", "$g_player_debt_to_party_members"),
        (create_text_overlay, reg1, "str_earlier_debts", 0),
        (position_set_x, pos1, 900),
        (position_set_y, pos1, 900),
        (overlay_set_size, reg1, pos1),
        (position_set_x, pos1, 25),
        (position_set_y, pos1, ":var15"),
        (overlay_set_position, reg1, pos1),
        (store_mul, reg0, "$g_player_debt_to_party_members", -1),
        (create_text_overlay, reg1, "@{!}{reg0}", tf_right_align|tf_single_line),
        (position_set_x, pos1, 900),
        (position_set_y, pos1, 900),
        (overlay_set_size, reg1, pos1),
        (overlay_set_color, reg1, 0xFF0000),
        (position_set_x, pos1, 500),
        (position_set_y, pos1, ":var15"),
        (overlay_set_position, reg1, pos1),
        (val_sub, ":var15", 27),
      (try_end),
      (assign, ":var65", 0),
      (try_begin),
        (gt, "$g_player_minister", 0),
        (val_add, ":var65", 15),
      (try_end),
      (try_begin),
        (troop_slot_ge, "trp_player", 30, 0),
        (val_add, ":var65", 10),
      (try_end),
      (try_begin),
        (gt, "$g_player_chamberlain", 0),
        (val_add, ":var65", 15),
      (try_end),
      (try_begin),
        (gt, "$g_player_constable", 0),
        (val_add, ":var65", 15),
      (try_end),
      (try_begin),
        (gt, "$g_player_chancellor", 0),
        (val_add, ":var65", 20),
      (try_end),
      (try_begin),
        (gt, ":var65", 0),
        (val_sub, ":var16", ":var65"),
        (create_text_overlay, reg1, "@Staff:", 0),
        (position_set_x, pos1, 900),
        (position_set_y, pos1, 900),
        (overlay_set_size, reg1, pos1),
        (position_set_x, pos1, 25),
        (position_set_y, pos1, ":var15"),
        (overlay_set_position, reg1, pos1),
        (store_mul, reg0, ":var65", -1),
        (create_text_overlay, reg1, "@{!}{reg0}", tf_right_align|tf_single_line),
        (position_set_x, pos1, 900),
        (position_set_y, pos1, 900),
        (overlay_set_size, reg1, pos1),
        (overlay_set_color, reg1, 0xFF0000),
        (position_set_x, pos1, 500),
        (position_set_y, pos1, ":var15"),
        (overlay_set_position, reg1, pos1),
        (val_sub, ":var15", 27),
      (try_end),
      (create_mesh_overlay, reg1, "mesh_white_plane"),
      (overlay_set_color, reg1, 0x000000),
      (position_set_x, pos1, 24000),
      (position_set_y, pos1, 50),
      (overlay_set_size, reg1, pos1),
      (position_set_x, pos1, 25),
      (store_add, ":var66", ":var15", 25),
      (position_set_y, pos1, ":var66"),
      (overlay_set_position, reg1, pos1),
      (create_text_overlay, reg1, "str_net_change", 0),
      (position_set_x, pos1, 900),
      (position_set_y, pos1, 900),
      (overlay_set_size, reg1, pos1),
      (position_set_x, pos1, 25),
      (position_set_y, pos1, ":var15"),
      (overlay_set_position, reg1, pos1),
      (assign, reg0, ":var16"),
      (create_text_overlay, reg1, "@{!}{reg0}", tf_right_align|tf_single_line),
      (position_set_x, pos1, 900),
      (position_set_y, pos1, 900),
      (overlay_set_size, reg1, pos1),
      (try_begin),
        (gt, reg0, 0),
        (overlay_set_color, reg1, 0x00AA00),
      (else_try),
        (lt, reg0, 0),
        (overlay_set_color, reg1, 0xFF0000),
      (try_end),
      (position_set_x, pos1, 500),
      (position_set_y, pos1, ":var15"),
      (overlay_set_position, reg1, pos1),
      (val_sub, ":var15", 27),
      (create_text_overlay, reg1, "str_earlier_wealth", 0),
      (position_set_x, pos1, 900),
      (position_set_y, pos1, 900),
      (overlay_set_size, reg1, pos1),
      (position_set_x, pos1, 25),
      (position_set_y, pos1, ":var15"),
      (overlay_set_position, reg1, pos1),
      (try_begin),
        (gt, "$g_player_chamberlain", 0),
        (store_troop_gold, ":var67", "trp_household_possessions"),
      (else_try),
        (store_troop_gold, ":var67", "trp_player"),
      (try_end),
      (assign, reg0, ":var67"),
      (create_text_overlay, reg1, "@{!}{reg0}", tf_right_align|tf_single_line),
      (position_set_x, pos1, 900),
      (position_set_y, pos1, 900),
      (overlay_set_size, reg1, pos1),
      (position_set_x, pos1, 500),
      (position_set_y, pos1, ":var15"),
      (overlay_set_position, reg1, pos1),
      (val_sub, ":var15", 27),
      (val_mul, ":var16", -1),
      (assign, ":var68", 0),
      (try_begin),
        (ge, ":var67", ":var16"),
        (assign, ":var69", ":var16"),
        (assign, ":var70", 0),
      (else_try),
        (assign, ":var69", ":var67"),
        (store_sub, ":var70", ":var16", ":var67"),
        (try_begin),
          (gt, "$g_player_chamberlain", 0),
          (store_troop_gold, ":var71", "trp_player"),
          (try_begin),
            (ge, ":var71", ":var70"),
            (assign, ":var68", ":var70"),
            (assign, ":var70", 0),
          (else_try),
            (assign, ":var68", ":var71"),
            (val_sub, ":var70", ":var71"),
          (try_end),
          (try_begin),
            (eq, "$g_apply_budget_report_to_gold", 1),
            (troop_remove_gold, "trp_player", ":var68"),
            (assign, reg0, ":var68"),
            (display_message, "@You paid {reg0} cash to liquidate a debt"),
          (try_end),
        (try_end),
      (try_end),
      (create_text_overlay, reg1, "str_new_wealth", 0),
      (position_set_x, pos1, 900),
      (position_set_y, pos1, 900),
      (overlay_set_size, reg1, pos1),
      (position_set_x, pos1, 25),
      (position_set_y, pos1, ":var15"),
      (overlay_set_position, reg1, pos1),
      (store_sub, reg0, ":var67", ":var69"),
      (create_text_overlay, reg1, "@{!}{reg0}", tf_right_align|tf_single_line),
      (position_set_x, pos1, 900),
      (position_set_y, pos1, 900),
      (overlay_set_size, reg1, pos1),
      (position_set_x, pos1, 500),
      (position_set_y, pos1, ":var15"),
      (overlay_set_position, reg1, pos1),
      (val_sub, ":var15", 27),
      (try_begin),
        (gt, "$g_player_chamberlain", 0),
        (gt, ":var68", 0),
        (create_text_overlay, reg1, "@Earlier cash:", 0),
        (position_set_x, pos1, 900),
        (position_set_y, pos1, 900),
        (overlay_set_size, reg1, pos1),
        (position_set_x, pos1, 25),
        (position_set_y, pos1, ":var15"),
        (overlay_set_position, reg1, pos1),
        (assign, reg0, ":var71"),
        (create_text_overlay, reg1, "@{!}{reg0}", tf_right_align|tf_single_line),
        (position_set_x, pos1, 900),
        (position_set_y, pos1, 900),
        (overlay_set_size, reg1, pos1),
        (position_set_x, pos1, 500),
        (position_set_y, pos1, ":var15"),
        (overlay_set_position, reg1, pos1),
        (val_sub, ":var15", 27),
        (create_text_overlay, reg1, "@New cash:", 0),
        (position_set_x, pos1, 900),
        (position_set_y, pos1, 900),
        (overlay_set_size, reg1, pos1),
        (position_set_x, pos1, 25),
        (position_set_y, pos1, ":var15"),
        (overlay_set_position, reg1, pos1),
        (store_sub, reg0, ":var71", ":var68"),
        (create_text_overlay, reg1, "@{!}{reg0}", tf_right_align|tf_single_line),
        (position_set_x, pos1, 900),
        (position_set_y, pos1, 900),
        (overlay_set_size, reg1, pos1),
        (position_set_x, pos1, 500),
        (position_set_y, pos1, ":var15"),
        (overlay_set_position, reg1, pos1),
        (val_sub, ":var15", 27),
      (try_end),
      (try_begin),
        (gt, ":var70", 0),
        (create_text_overlay, reg1, "str_new_debts", 0),
        (position_set_x, pos1, 900),
        (position_set_y, pos1, 900),
        (overlay_set_size, reg1, pos1),
        (position_set_x, pos1, 25),
        (position_set_y, pos1, ":var15"),
        (overlay_set_position, reg1, pos1),
        (assign, reg0, ":var70"),
        (create_text_overlay, reg1, "@{!}{reg0}", tf_right_align|tf_single_line),
        (position_set_x, pos1, 900),
        (position_set_y, pos1, 900),
        (overlay_set_size, reg1, pos1),
        (position_set_x, pos1, 500),
        (position_set_y, pos1, ":var15"),
        (overlay_set_position, reg1, pos1),
        (val_sub, ":var15", 27),
        (neq, "$g_apply_budget_report_to_gold", 0),
        (call_script, "script_objectionable_action", 2, "str_men_unpaid"),
      (try_end),
      (set_container_overlay, -1),
      (create_button_overlay, "$g_presentation_obj_budget_report_1", "@Continue..."),
      (position_set_x, pos1, 225),
      (position_set_y, pos1, 60),
      (overlay_set_position, "$g_presentation_obj_budget_report_1", pos1),
      (try_begin),
        (eq, "$g_apply_budget_report_to_gold", 1),
        (assign, "$g_player_debt_to_party_members", ":var70"),
        (try_begin),
          (gt, ":var69", 0),
          (try_begin),
            (gt, "$g_player_chamberlain", 0),
            (call_script, "script_dplmc_withdraw_from_treasury", ":var69"),
          (else_try),
            (troop_remove_gold, "trp_player", ":var69"),
          (try_end),
        (else_try),
          (val_mul, ":var69", -1),
          (try_begin),
            (gt, "$g_player_chamberlain", 0),
            (call_script, "script_dplmc_pay_into_treasury", ":var69"),
          (else_try),
            (troop_add_gold, "trp_player", ":var69"),
          (try_end),
        (try_end),
        (try_for_range, ":var10", "p_town_1", "p_salt_mine"),
          (party_slot_eq, ":var10", 7, "trp_player"),
          (party_set_slot, ":var10", 47, 0),
          (party_set_slot, ":var10", 48, 0),
        (try_end),
        (assign, "$g_cur_week_half_daily_wage_payments", 0),
      (try_end),
    ]),
    (ti_on_presentation_event_state_change,
    [
      (store_trigger_param_1, ":var0"),
      (try_begin),
        (eq, ":var0", "$g_presentation_obj_budget_report_1"),
        (presentation_set_duration, 0),
      (try_end),
    ]),
  ]),

  ("game_before_quit", 0, mesh_load_window,
  [
    (ti_on_presentation_load,
    [
      (try_begin),
        (is_trial_version),
        (set_fixed_point_multiplier, 1000),
        (create_mesh_overlay, reg0, "mesh_quit_adv"),
        (position_set_x, pos1, -1),
        (position_set_y, pos1, -1),
        (overlay_set_position, reg0, pos1),
        (position_set_x, pos1, 1002),
        (position_set_y, pos1, 1002),
        (overlay_set_size, reg0, pos1),
        (assign, "$g_game_before_quit_state", 0),
        (presentation_set_duration, 999999),
      (try_end),
    ]),
    (ti_on_presentation_run,
    [
      (store_trigger_param_1, ":var0"),
      (gt, ":var0", 500),
      (try_begin),
        (this_or_next|key_clicked, key_space),
        (this_or_next|key_clicked, key_enter),
        (this_or_next|key_clicked, key_escape),
        (this_or_next|key_clicked, key_back_space),
        (this_or_next|key_clicked, key_left_mouse_button),
        (this_or_next|key_clicked, key_right_mouse_button),
        (this_or_next|key_clicked, key_xbox_ltrigger),
        (key_clicked, key_xbox_rtrigger),
        (try_begin),
          (eq, "$g_game_before_quit_state", 0),
          (val_add, "$g_game_before_quit_state", 1),
          (create_mesh_overlay, reg0, "mesh_quit_adv_b"),
          (position_set_x, pos1, -1),
          (position_set_y, pos1, -1),
          (overlay_set_position, reg0, pos1),
          (position_set_x, pos1, 1002),
          (position_set_y, pos1, 1002),
          (overlay_set_size, reg0, pos1),
        (else_try),
          (presentation_set_duration, 0),
        (try_end),
      (try_end),
    ]),
  ]),

  ("multiplayer_duel_start_counter", prsntf_read_only|prsntf_manual_end_only, mesh_pic_bandits,
  [
    (ti_on_presentation_load,
    [
      (set_fixed_point_multiplier, 1000),
      (assign, "$g_multiplayer_duel_start_counter_overlay", -1),
      (assign, "$g_multiplayer_last_duel_start_counter_value", -1),
      (str_clear, s0),
      (create_text_overlay, "$g_multiplayer_duel_start_counter_overlay", s0, tf_center_justify|tf_with_outline),
      (overlay_set_color, "$g_multiplayer_duel_start_counter_overlay", 0xFFFFFF),
      (position_set_x, pos1, 500),
      (position_set_y, pos1, 600),
      (overlay_set_position, "$g_multiplayer_duel_start_counter_overlay", pos1),
      (position_set_x, pos1, 2000),
      (position_set_y, pos1, 2000),
      (overlay_set_size, "$g_multiplayer_duel_start_counter_overlay", pos1),
      (presentation_set_duration, 999999),
    ]),
    (ti_on_presentation_run,
    [
      (ge, "$g_multiplayer_duel_start_counter_overlay", 0),
      (store_mission_timer_a, ":var0"),
      (store_sub, ":var1", ":var0", "$g_multiplayer_duel_start_time"),
      (store_sub, ":var2", 3, ":var1"),
      (try_begin),
        (le, ":var2", 0),
        (presentation_set_duration, 0),
      (else_try),
        (neq, "$g_multiplayer_last_duel_start_counter_value", ":var2"),
        (assign, "$g_multiplayer_last_duel_start_counter_value", ":var2"),
        (assign, reg0, ":var2"),
        (str_store_string, s0, "str_duel_starts_in_reg0_seconds"),
        (overlay_set_text, "$g_multiplayer_duel_start_counter_overlay", s0),
      (try_end),
    ]),
  ]),

  ("faction_troop_trees", 0, mesh_pic_bandits,
  [
    (ti_on_presentation_load,
    [
      (presentation_set_duration, 999999),
      (set_fixed_point_multiplier, 1000),
      (create_mesh_overlay, reg1, "mesh_load_window"),
      (position_set_x, pos1, 0),
      (position_set_y, pos1, 0),
      (overlay_set_position, reg1, pos1),
      (create_combo_button_overlay, "$g_presentation_obj_1"),
      (position_set_x, pos1, 500),
      (position_set_y, pos1, 690),
      (overlay_set_position, "$g_presentation_obj_1", pos1),
      (store_sub, ":var0", "fac_kingdoms_end", "fac_kingdom_1"),
      (store_add, ":var1", ":var0", 3),
      (overlay_add_item, "$g_presentation_obj_1", "@Others"),
      (overlay_add_item, "$g_presentation_obj_1", "@Outlaws"),
      (overlay_add_item, "$g_presentation_obj_1", "@Mercenary"),
      (try_for_range_backwards, ":var2", 0, ":var0"),
        (store_add, ":var3", ":var2", "fac_kingdom_1"),
        (str_store_faction_name, s0, ":var3"),
        (overlay_add_item, "$g_presentation_obj_1", s0),
      (try_end),
      (store_sub, ":var4", ":var1", "$g_selected_page"),
      (val_sub, ":var4", 1),
      (overlay_set_val, "$g_presentation_obj_1", ":var4"),
      (create_game_button_overlay, "$g_presentation_obj_2", "@Close"),
      (position_set_x, pos1, 750),
      (position_set_y, pos1, 685),
      (overlay_set_position, "$g_presentation_obj_2", pos1),
      (create_text_overlay, reg1, "@Click the center button to toggle faction^Click the avatars to view details of them", tf_left_align),
      (position_set_x, pos1, 800),
      (position_set_y, pos1, 800),
      (overlay_set_size, reg1, pos1),
      (position_set_x, pos1, 30),
      (position_set_y, pos1, 690),
      (overlay_set_position, reg1, pos1),
      (try_begin),
        (is_between, "$g_selected_page", 0, ":var0"),
        (store_add, ":var5", "mesh_pic_arms_swadian", "$g_selected_page"),
        (create_mesh_overlay, reg1, ":var5"),
        (position_set_x, pos1, 120),
        (position_set_y, pos1, 100),
        (overlay_set_position, reg1, pos1),
        (position_set_x, pos1, 300),
        (position_set_y, pos1, 300),
        (overlay_set_size, reg1, pos1),
      (try_end),
      (assign, ":var6", 1),
      (try_for_range, ":var7", "trp_farmer", "trp_town_walker_1"),
        (neg|troop_is_hero, ":var7"),
        (troop_get_upgrade_troop, ":var8", ":var7", 0),
        (gt, ":var8", 0),
        (call_script, "script_get_page_no_of_troop_tree_for_troop_on", ":var7"),
        (assign, ":var9", reg0),
        (eq, ":var9", "$g_selected_page"),
        (assign, reg0, 1),
        (call_script, "script_troop_tree_recursive_detect_max_tier", ":var7", 1),
        (assign, ":var10", reg0),
        (try_begin),
          (gt, ":var10", ":var6"),
          (assign, ":var6", ":var10"),
        (try_end),
      (try_end),
      (val_sub, ":var6", 1),
      (val_max, ":var6", 1),
      (store_div, ":var11", 700, ":var6"),
      (val_min, ":var11", 120),
      (str_clear, s0),
      (create_text_overlay, reg1, s0, tf_scrollable),
      (position_set_x, pos1, 15),
      (position_set_y, pos1, 15),
      (overlay_set_position, reg1, pos1),
      (position_set_x, pos1, 800),
      (position_set_y, pos1, 660),
      (overlay_set_area_size, reg1, pos1),
      (set_container_overlay, reg1),
      (assign, "$g_cur_slot_no", 0),
      (assign, reg2, 75),
      (try_for_range, ":var7", "trp_farmer", "trp_town_walker_1"),
        (neg|troop_is_hero, ":var7"),
        (troop_get_upgrade_troop, ":var8", ":var7", 0),
        (gt, ":var8", 0),
        (call_script, "script_get_page_no_of_troop_tree_for_troop_on", ":var7"),
        (assign, ":var9", reg0),
        (eq, ":var9", "$g_selected_page"),
        (assign, ":var12", 1),
        (assign, ":var13", "trp_town_walker_1"),
        (try_for_range, ":var14", "trp_farmer", ":var13"),
          (neg|troop_is_hero, ":var14"),
          (call_script, "script_get_page_no_of_troop_tree_for_troop_on", ":var14"),
          (assign, ":var15", reg0),
          (eq, ":var15", "$g_selected_page"),
          (troop_get_upgrade_troop, ":var16", ":var14", 0),
          (troop_get_upgrade_troop, ":var17", ":var14", 1),
          (this_or_next|eq, ":var16", ":var7"),
          (eq, ":var17", ":var7"),
          (assign, ":var12", 0),
          (assign, ":var13", 0),
        (try_end),
        (eq, ":var12", 1),
        (call_script, "script_troop_tree_recursive_backtracking", ":var7", 50, reg2, ":var11"),
        (val_add, reg2, 160),
      (try_end),
      (set_container_overlay, -1),
      (try_begin),
        (gt, "$g_selected_troop", 0),
        (store_mul, ":var7", "$g_selected_troop", 2),
        (create_image_button_overlay_with_tableau_material, reg1, -1, "tableau_game_party_window", ":var7"),
        (position_set_x, pos1, 450),
        (position_set_y, pos1, 600),
        (overlay_set_size, reg1, pos1),
        (position_set_x, pos1, 810),
        (position_set_y, pos1, 550),
        (overlay_set_position, reg1, pos1),
        (position_set_x, pos2, 750),
        (position_set_y, pos2, 750),
        (position_set_x, pos3, 900),
        (position_set_y, pos3, 900),
        (str_store_troop_name, s1, "$g_selected_troop"),
        (create_text_overlay, reg1, s1, tf_center_justify),
        (position_set_x, pos1, 900),
        (position_set_y, pos1, 710),
        (overlay_set_position, reg1, pos1),
        (overlay_set_size, reg1, pos2),
        (store_character_level, reg3, "$g_selected_troop"),
        (assign, ":var18", 35),
        (store_skill_level, ":var19", 36, "$g_selected_troop"),
        (store_attribute_level, ":var20", "$g_selected_troop", ca_strength),
        (val_mul, ":var19", 2),
        (val_add, ":var18", ":var19"),
        (val_add, ":var18", ":var20"),
        (assign, reg4, ":var18"),
        (create_text_overlay, reg1, "@Level: {reg3}^Health: {reg4}", tf_left_align),
        (position_set_x, pos1, 900),
        (position_set_y, pos1, 665),
        (overlay_set_position, reg1, pos1),
        (overlay_set_size, reg1, pos2),
        (create_text_overlay, reg1, "@Attributes", tf_left_align),
        (position_set_x, pos1, 900),
        (position_set_y, pos1, 630),
        (overlay_set_position, reg1, pos1),
        (overlay_set_size, reg1, pos3),
        (create_text_overlay, reg1, "@STR^AGI^INT^CHA", tf_left_align),
        (position_set_x, pos1, 900),
        (position_set_y, pos1, 570),
        (overlay_set_position, reg1, pos1),
        (overlay_set_size, reg1, pos2),
        (try_for_range, ":var21", 0, 4),
          (try_begin),
            (eq, ":var21", 0),
            (store_attribute_level, reg2, "$g_selected_troop", ":var21"),
            (str_store_string, s1, "@{reg2}"),
          (else_try),
            (store_attribute_level, reg2, "$g_selected_troop", ":var21"),
            (str_store_string, s1, "@{s1}^{reg2}"),
          (try_end),
        (try_end),
        (create_text_overlay, reg1, s1, tf_right_align),
        (position_set_x, pos1, 980),
        (position_set_y, pos1, 570),
        (overlay_set_position, reg1, pos1),
        (overlay_set_size, reg1, pos2),
        (position_set_x, pos1, 840),
        (position_set_y, pos1, 527),
        (overlay_set_position, reg1, pos1),
        (overlay_set_size, reg1, pos3),
        (create_text_overlay, reg1, "@Ironflesh^Power Strike^Power Throw^Power Draw^Shield^Athletics^Riding^Horse Archery", tf_left_align),
        (position_set_x, pos1, 840),
        (position_set_y, pos1, 415),
        (overlay_set_position, reg1, pos1),
        (overlay_set_size, reg1, pos2),
        (try_for_range_backwards, ":var22", 0, 42),
          (try_begin),
            (eq, ":var22", "skl_ironflesh"),
            (store_skill_level, reg2, ":var22", "$g_selected_troop"),
            (str_store_string, s1, "@{reg2}"),
          (else_try),
            (this_or_next|eq, ":var22", "skl_power_strike"),
            (this_or_next|eq, ":var22", "skl_power_throw"),
            (this_or_next|eq, ":var22", "skl_power_draw"),
            (this_or_next|eq, ":var22", "skl_shield"),
            (this_or_next|eq, ":var22", "skl_athletics"),
            (this_or_next|eq, ":var22", "skl_riding"),
            (eq, ":var22", "skl_horse_archery"),
            (store_skill_level, reg2, ":var22", "$g_selected_troop"),
            (str_store_string, s1, "@{s1}^{reg2}"),
          (try_end),
        (try_end),
        (create_text_overlay, reg1, s1, tf_right_align),
        (position_set_x, pos1, 980),
        (position_set_y, pos1, 415),
        (overlay_set_position, reg1, pos1),
        (overlay_set_size, reg1, pos2),
        (create_text_overlay, reg1, "@Proficiencies", tf_left_align),
        (position_set_x, pos1, 840),
        (position_set_y, pos1, 385),
        (overlay_set_position, reg1, pos1),
        (overlay_set_size, reg1, pos3),
        (create_text_overlay, reg1, "@1H Weapons^2H Weapons^Polearms^Archery^Crossbows^Throwing^Firearm", tf_left_align),
        (position_set_x, pos1, 840),
        (position_set_y, pos1, 285),
        (overlay_set_position, reg1, pos1),
        (overlay_set_size, reg1, pos2),
        (try_for_range, ":var23", 0, 7),
          (try_begin),
            (eq, ":var23", 0),
            (store_proficiency_level, reg2, "$g_selected_troop", ":var23"),
            (str_store_string, s1, "@{reg2}"),
          (else_try),
            (is_between, ":var23", 1, 7),
            (store_proficiency_level, reg2, "$g_selected_troop", ":var23"),
            (str_store_string, s1, "@{s1}^{reg2}"),
          (try_end),
        (try_end),
        (create_text_overlay, reg1, s1, tf_right_align),
        (position_set_x, pos1, 980),
        (position_set_y, pos1, 285),
        (overlay_set_position, reg1, pos1),
        (overlay_set_size, reg1, pos2),
        (create_text_overlay, reg1, "@Equipments", tf_left_align),
        (position_set_x, pos1, 840),
        (position_set_y, pos1, 235),
        (overlay_set_position, reg1, pos1),
        (overlay_set_size, reg1, pos3),
        (str_clear, s0),
        (create_text_overlay, "$g_presentation_obj_3", s0, tf_scrollable),
        (position_set_x, pos1, 840),
        (position_set_y, pos1, 30),
        (overlay_set_position, "$g_presentation_obj_3", pos1),
        (position_set_x, pos1, 138),
        (position_set_y, pos1, 202),
        (overlay_set_area_size, "$g_presentation_obj_3", pos1),
        (set_container_overlay, "$g_presentation_obj_3"),
        (troop_clear_inventory, "trp_temp_array_a"),
        (troop_get_inventory_capacity, ":var24", "$g_selected_troop"),
        (try_for_range, ":var25", 0, ":var24"),
          (troop_get_inventory_slot, ":var26", "$g_selected_troop", ":var25"),
          (gt, ":var26", -1),
          (troop_get_inventory_slot_modifier, ":var27", "$g_selected_troop", ":var25"),
          (troop_add_item, "trp_temp_array_a", ":var26", ":var27"),
        (try_end),
        (assign, ":var28", 0),
        (assign, ":var29", 280),
        (assign, ":var30", 10),
        (try_for_range, ":var31", 0, 8),
          (try_for_range, ":var32", 0, 3),
            (create_mesh_overlay, reg1, "mesh_mp_inventory_choose"),
            (position_set_x, pos1, 320),
            (position_set_y, pos1, 320),
            (overlay_set_size, reg1, pos1),
            (position_set_x, pos1, ":var28"),
            (position_set_y, pos1, ":var29"),
            (overlay_set_position, reg1, pos1),
            (troop_set_slot, "trp_temp_array_a", ":var30", reg1),
            (create_mesh_overlay, reg1, "mesh_inv_slot"),
            (position_set_x, pos1, 400),
            (position_set_y, pos1, 400),
            (overlay_set_size, reg1, pos1),
            (position_set_x, pos1, ":var28"),
            (position_set_y, pos1, ":var29"),
            (overlay_set_position, reg1, pos1),
            (troop_get_inventory_slot, ":var33", "trp_temp_array_a", ":var30"),
            (val_max, ":var33", 0),
            (create_mesh_overlay_with_item_id, reg1, ":var33"),
            (position_set_x, pos1, 400),
            (position_set_y, pos1, 400),
            (overlay_set_size, reg1, pos1),
            (store_add, ":var34", ":var28", 20),
            (store_add, ":var35", ":var29", 20),
            (position_set_x, pos1, ":var34"),
            (position_set_y, pos1, ":var35"),
            (overlay_set_position, reg1, pos1),
            (troop_set_slot, "trp_temp_array_b", ":var30", reg1),
            (val_add, ":var28", 40),
            (val_add, ":var30", 1),
          (try_end),
          (assign, ":var28", 0),
          (val_sub, ":var29", 40),
        (try_end),
        (set_container_overlay, -1),
      (try_end),
    ]),
    (ti_on_presentation_mouse_enter_leave,
    [
      (store_trigger_param_1, ":var0"),
      (store_trigger_param_2, ":var1"),
      (try_begin),
        (gt, "$g_selected_troop", 0),
        (try_begin),
          (eq, ":var1", 0),
          (try_for_range, ":var2", 10, 106),
            (troop_slot_eq, "trp_temp_array_a", ":var2", ":var0"),
            (troop_get_inventory_slot, ":var3", "trp_temp_array_a", ":var2"),
            (troop_get_inventory_slot_modifier, ":var4", "trp_temp_array_a", ":var2"),
            (try_begin),
              (gt, ":var3", -1),
              (troop_get_slot, ":var5", "trp_temp_array_b", ":var2"),
              (overlay_get_position, 0, ":var5"),
              (show_item_details_with_modifier, ":var3", ":var4", pos0, 100),
              (assign, "$g_current_opened_item_details", ":var2"),
            (try_end),
          (try_end),
        (else_try),
          (try_for_range, ":var2", 10, 106),
            (troop_slot_eq, "trp_temp_array_a", ":var2", ":var0"),
            (try_begin),
              (eq, "$g_current_opened_item_details", ":var2"),
              (close_item_details),
            (try_end),
          (try_end),
        (try_end),
      (try_end),
    ]),
    (ti_on_presentation_event_state_change,
    [
      (store_trigger_param_1, ":var0"),
      (store_trigger_param_2, ":var1"),
      (try_for_range, ":var2", 0, "$g_cur_slot_no"),
        (troop_slot_eq, "trp_stack_selection_amounts", ":var2", ":var0"),
        (troop_get_slot, "$g_selected_troop", "trp_stack_selection_ids", ":var2"),
        (start_presentation, "prsnt_faction_troop_trees"),
      (try_end),
      (try_begin),
        (eq, ":var0", "$g_presentation_obj_1"),
        (store_sub, ":var3", "fac_kingdoms_end", "fac_kingdom_1"),
        (val_add, ":var3", 3),
        (store_sub, "$g_selected_page", ":var3", ":var1"),
        (val_sub, "$g_selected_page", 1),
        (assign, "$g_selected_troop", 0),
        (start_presentation, "prsnt_faction_troop_trees"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_2"),
        (assign, "$g_selected_troop", 0),
        (assign, "$g_selected_page", 0),
        (presentation_set_duration, 0),
      (try_end),
    ]),
  ]),

  ("all_items", 0, mesh_load_window,
  [
    (ti_on_presentation_load,
    [
      (presentation_set_duration, 999999),
      (set_fixed_point_multiplier, 1000),
      (create_combo_label_overlay, "$g_presentation_obj_1"),
      (position_set_x, pos1, 500),
      (position_set_y, pos1, 675),
      (overlay_set_position, "$g_presentation_obj_1", pos1),
      (overlay_add_item, "$g_presentation_obj_1", "@Weapons"),
      (overlay_add_item, "$g_presentation_obj_1", "@Armors"),
      (overlay_add_item, "$g_presentation_obj_1", "@Others"),
      (overlay_set_val, "$g_presentation_obj_1", "$temp"),
      (create_game_button_overlay, "$g_presentation_obj_5", "@Done"),
      (position_set_x, pos1, 900),
      (position_set_y, pos1, 25),
      (overlay_set_position, "$g_presentation_obj_5", pos1),
      (str_clear, s0),
      (create_text_overlay, "$g_presentation_obj_6", s0, tf_scrollable),
      (position_set_x, pos1, 50),
      (position_set_y, pos1, 100),
      (overlay_set_position, "$g_presentation_obj_6", pos1),
      (position_set_x, pos1, 890),
      (position_set_y, pos1, 560),
      (overlay_set_area_size, "$g_presentation_obj_6", pos1),
      (set_container_overlay, "$g_presentation_obj_6"),
      (assign, ":var0", 3773),
      (assign, "$temp_2", 0),
      (try_begin),
        (eq, "$temp", 0),
        (try_for_range, ":var1", 0, ":var0"),
          (item_get_type, ":var2", ":var1"),
          (this_or_next|is_between, ":var2", 2, 11),
          (is_between, ":var2", 16, 19),
          (val_add, "$temp_2", 1),
        (try_end),
      (else_try),
        (eq, "$temp", 1),
        (try_for_range, ":var1", 0, ":var0"),
          (item_get_type, ":var2", ":var1"),
          (is_between, ":var2", 12, 16),
          (val_add, "$temp_2", 1),
        (try_end),
      (else_try),
        (eq, "$temp", 2),
        (try_for_range, ":var1", 0, ":var0"),
          (item_get_type, ":var2", ":var1"),
          (this_or_next|eq, ":var2", 1),
          (this_or_next|eq, ":var2", 11),
          (this_or_next|eq, ":var2", 19),
          (eq, ":var2", 20),
          (val_add, "$temp_2", 1),
        (try_end),
      (try_end),
      (store_div, ":var3", "$temp_2", 11),
      (store_mod, ":var4", "$temp_2", 11),
      (val_min, ":var4", 1),
      (val_add, ":var3", ":var4"),
      (store_mul, ":var5", ":var3", 80),
      (val_sub, ":var5", 80),
      (assign, ":var6", 0),
      (assign, ":var7", 0),
      (try_for_range, ":var1", 0, ":var0"),
        (item_get_type, ":var2", ":var1"),
        (try_begin),
          (eq, "$temp", 0),
          (try_begin),
            (this_or_next|is_between, ":var2", 2, 11),
            (is_between, ":var2", 16, 19),
            (assign, ":var8", 1),
          (else_try),
            (assign, ":var8", 0),
          (try_end),
        (else_try),
          (eq, "$temp", 1),
          (try_begin),
            (is_between, ":var2", 12, 16),
            (assign, ":var8", 1),
          (else_try),
            (assign, ":var8", 0),
          (try_end),
        (else_try),
          (eq, "$temp", 2),
          (try_begin),
            (this_or_next|eq, ":var2", 1),
            (this_or_next|eq, ":var2", 11),
            (this_or_next|eq, ":var2", 19),
            (eq, ":var2", 20),
            (assign, ":var8", 1),
          (else_try),
            (assign, ":var8", 0),
          (try_end),
        (try_end),
        (eq, ":var8", 1),
        (create_mesh_overlay, reg1, "mesh_inv_slot"),
        (position_set_x, pos1, 800),
        (position_set_y, pos1, 800),
        (overlay_set_size, reg1, pos1),
        (position_set_x, pos1, ":var6"),
        (position_set_y, pos1, ":var5"),
        (overlay_set_position, reg1, pos1),
        (create_mesh_overlay, reg1, "mesh_mp_inventory_choose"),
        (position_set_x, pos1, 640),
        (position_set_y, pos1, 640),
        (overlay_set_size, reg1, pos1),
        (position_set_x, pos1, ":var6"),
        (position_set_y, pos1, ":var5"),
        (overlay_set_position, reg1, pos1),
        (troop_set_slot, "trp_temp_array_a", ":var7", reg1),
        (create_mesh_overlay_with_item_id, reg1, ":var1"),
        (position_set_x, pos1, 800),
        (position_set_y, pos1, 800),
        (overlay_set_size, reg1, pos1),
        (store_add, ":var9", ":var6", 40),
        (store_add, ":var10", ":var5", 40),
        (position_set_x, pos1, ":var9"),
        (position_set_y, pos1, ":var10"),
        (overlay_set_position, reg1, pos1),
        (troop_set_slot, "trp_temp_array_b", ":var7", reg1),
        (troop_set_slot, "trp_temp_array_c", ":var7", ":var1"),
        (val_add, ":var6", 80),
        (val_add, ":var7", 1),
        (try_begin),
          (ge, ":var6", 880),
          (assign, ":var6", 0),
          (val_sub, ":var5", 80),
        (try_end),
      (try_end),
      (set_container_overlay, -1),
    ]),
    (ti_on_presentation_mouse_enter_leave,
    [
      (store_trigger_param_1, ":var0"),
      (store_trigger_param_2, ":var1"),
      (try_begin),
        (eq, ":var1", 0),
        (try_for_range, ":var2", 0, "$temp_2"),
          (troop_slot_eq, "trp_temp_array_a", ":var2", ":var0"),
          (troop_get_slot, ":var3", "trp_temp_array_c", ":var2"),
          (troop_get_slot, ":var4", "trp_temp_array_b", ":var2"),
          (overlay_get_position, 0, ":var4"),
          (show_item_details, ":var3", pos0, 100),
          (assign, "$g_current_opened_item_details", ":var2"),
        (try_end),
      (else_try),
        (try_for_range, ":var2", 0, "$temp_2"),
          (troop_slot_eq, "trp_temp_array_a", ":var2", ":var0"),
          (try_begin),
            (eq, "$g_current_opened_item_details", ":var2"),
            (close_item_details),
          (try_end),
        (try_end),
      (try_end),
    ]),
    (ti_on_presentation_event_state_change,
    [
      (store_trigger_param_1, ":var0"),
      (store_trigger_param_2, ":var1"),
      (try_begin),
        (eq, ":var0", "$g_presentation_obj_1"),
        (assign, "$temp", ":var1"),
        (start_presentation, "prsnt_all_items"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_5"),
        (presentation_set_duration, 0),
      (try_end),
    ]),
  ]),

  ("jrider_faction_relations_report2", 0, mesh_message_window,
  [
    (ti_on_presentation_load,
    [
      (presentation_set_duration, 999999),
      (set_fixed_point_multiplier, 1000),
      (create_mesh_overlay, reg1, "mesh_pic_castledes"),
      (position_set_x, pos1, 180),
      (position_set_y, pos1, 180),
      (overlay_set_size, reg1, pos1),
      (position_set_x, pos1, 795),
      (position_set_y, pos1, 600),
      (overlay_set_position, reg1, pos1),
      (create_mesh_overlay, reg1, "mesh_pic_looted_village"),
      (position_set_x, pos1, 170),
      (position_set_y, pos1, 170),
      (overlay_set_size, reg1, pos1),
      (position_set_x, pos1, -15),
      (position_set_y, pos1, 600),
      (overlay_set_position, reg1, pos1),
      (create_text_overlay, reg1, "@ Faction Relations Report ", tf_center_justify),
      (position_set_x, pos1, 500),
      (position_set_y, pos1, 670),
      (overlay_set_position, reg1, pos1),
      (position_set_x, pos1, 1500),
      (position_set_y, pos1, 1500),
      (overlay_set_size, reg1, pos1),
      (create_game_button_overlay, reg1, "@ Return to menu "),
      (position_set_x, pos1, 500),
      (position_set_y, pos1, 23),
      (overlay_set_position, reg1, pos1),
      (assign, "$g_jrider_faction_report_return_to_menu", reg1),
      (assign, ":var0", 250),
      (assign, ":var1", 620),
      (position_set_y, pos1, ":var1"),
      (try_for_range, ":var2", 36, "fac_kingdoms_end"),
        (faction_slot_eq, ":var2", 21, 0),
        (try_begin),
          (is_between, ":var2", "fac_kingdom_1", "fac_kingdoms_end"),
          (store_sub, ":var3", ":var2", "fac_kingdom_1"),
          (val_add, ":var3", "str_swadians"),
          (str_store_string, s1, ":var3"),
        (else_try),
          (str_store_string, s1, "@Your kingdom"),
        (try_end),
        (str_store_string, s11, ":var3"),
        (create_text_overlay, reg10, s1, tf_left_align|tf_with_outline),
        (faction_get_color, ":var4", ":var2"),
        (overlay_set_color, reg10, ":var4"),
        (position_set_x, pos3, 650),
        (position_set_y, pos3, 800),
        (overlay_set_size, reg10, pos3),
        (position_set_x, pos1, ":var0"),
        (overlay_set_position, reg10, pos1),
        (val_add, ":var0", 70),
      (try_end),
      (assign, ":var0", 215),
      (assign, ":var1", 597),
      (assign, ":var5", 0),
      (position_set_x, ":var5", 720),
      (position_set_y, ":var5", 775),
      (assign, ":var6", 40),
      (position_set_x, ":var6", 40),
      (position_set_y, ":var6", 28000),
      (create_text_overlay, reg2, "@Player^Relation", tf_center_justify),
      (overlay_set_size, reg2, ":var5"),
      (position_set_x, pos1, ":var0"),
      (position_set_y, pos1, ":var1"),
      (overlay_set_position, reg2, pos1),
      (val_add, ":var0", 40),
      (try_for_range, ":var7", 0, 10),
        (create_mesh_overlay, reg1, "mesh_white_plane"),
        (overlay_set_color, reg1, 0x000000),
        (overlay_set_size, reg1, ":var6"),
        (store_sub, ":var8", ":var0", 15),
        (store_sub, ":var9", ":var1", 500),
        (position_set_x, pos2, ":var8"),
        (position_set_y, pos2, ":var9"),
        (overlay_set_position, reg1, pos2),
        (val_add, ":var0", 70),
        (try_begin),
          (eq, "$cheat_mode", 1),
          (assign, reg20, ":var7"),
          (display_message, "@{!}DEBUG - Drawing line {reg20}"),
        (try_end),
      (try_end),
      (str_clear, s9),
      (str_clear, s8),
      (str_clear, s3),
      (str_clear, s60),
      (str_clear, s61),
      (str_clear, s0),
      (create_text_overlay, reg1, s0, tf_scrollable_style_2),
      (position_set_x, pos1, 50),
      (position_set_y, pos1, 70),
      (overlay_set_position, reg1, pos1),
      (position_set_x, pos1, 860),
      (position_set_y, pos1, 527),
      (overlay_set_area_size, reg1, pos1),
      (set_container_overlay, reg1),
      (assign, ":var10", 0),
      (assign, ":var1", 0),
      (assign, ":var11", 0),
      (try_for_range_backwards, ":var12", "fac_player_supporters_faction", "fac_kingdoms_end"),
        (faction_slot_eq, ":var12", 21, 0),
        (assign, ":var13", 220),
        (try_for_range, ":var14", 36, "fac_kingdoms_end"),
          (faction_slot_eq, ":var14", 21, 0),
          (try_begin),
            (neq, ":var14", ":var12"),
            (str_store_faction_name, s8, ":var14"),
            (try_begin),
              (neq, ":var14", ":var12"),
              (call_script, "script_diplomacy_faction_get_diplomatic_status_with_faction", ":var12", ":var14"),
              (assign, ":var15", reg0),
              (assign, ":var16", reg1),
              (try_begin),
                (eq, ":var15", -2),
                (str_store_string, s60, "@War"),
                (assign, reg60, 14483456),
                (assign, reg59, 0),
              (else_try),
                (eq, ":var15", -1),
                (str_store_string, s60, "@Casus Belli"),
                (assign, reg60, 14516224),
                (assign, reg59, ":var16"),
              (else_try),
                (eq, ":var15", 0),
                (str_store_string, s60, "@Peace"),
                (assign, reg60, 16777215),
                (assign, reg59, 0),
              (else_try),
                (eq, ":var15", 1),
                (str_store_string, s60, "@Truce"),
                (assign, reg60, 14540253),
                (assign, reg59, ":var16"),
                (try_begin),
                  (ge, ":var16", 61),
                  (str_store_string, s60, "@Alliance"),
                  (assign, reg60, 65280),
                  (store_sub, reg59, ":var16", 60),
                (else_try),
                  (ge, ":var16", 41),
                  (str_store_string, s60, "@Defense"),
                  (assign, reg60, 65450),
                  (store_sub, reg59, ":var16", 40),
                (else_try),
                  (ge, ":var16", 21),
                  (str_store_string, s60, "@Trade"),
                  (assign, reg60, 65484),
                  (store_sub, reg59, ":var16", 20),
                (try_end),
              (try_end),
              (val_add, ":var0", 40),
              (create_text_overlay, reg10, s60, tf_left_align|tf_with_outline),
              (overlay_set_size, reg10, ":var10"),
              (overlay_set_color, reg10, reg60),
              (store_sub, ":var8", ":var13", 20),
              (store_add, ":var17", ":var1", 54),
              (position_set_x, pos3, ":var8"),
              (position_set_y, pos3, ":var17"),
              (overlay_set_position, reg10, pos3),
              (create_text_overlay, reg10, "@{reg59?{reg59} days:}", tf_center_justify),
              (overlay_set_size, reg10, ":var10"),
              (store_add, ":var17", ":var1", 36),
              (store_add, ":var8", ":var13", 10),
              (position_set_x, pos3, ":var8"),
              (position_set_y, pos3, ":var17"),
              (overlay_set_position, reg10, pos3),
              (store_relation, ":var18", ":var12", ":var14"),
              (assign, reg61, ":var18"),
              (create_text_overlay, reg10, "@{reg61}", tf_center_justify),
              (overlay_set_size, reg10, ":var10"),
              (store_add, ":var17", ":var1", 18),
              (store_add, ":var8", ":var13", 10),
              (position_set_x, pos3, ":var8"),
              (position_set_y, pos3, ":var17"),
              (overlay_set_position, reg10, pos3),
            (try_end),
          (try_end),
          (val_add, ":var13", 70),
        (try_end),
        (assign, ":var0", 165),
        (val_add, ":var1", 54),
        (create_mesh_overlay, reg1, "mesh_white_plane"),
        (overlay_set_color, reg1, 0x000000),
        (position_set_x, pos1, 42000),
        (position_set_y, pos1, 60),
        (overlay_set_size, reg1, pos1),
        (position_set_x, pos1, 17),
        (store_add, ":var17", ":var1", 20),
        (position_set_y, pos1, ":var17"),
        (overlay_set_position, reg1, pos1),
        (str_store_faction_name, s9, ":var12"),
        (str_store_string, s1, "@{s9}"),
        (create_text_overlay, reg10, s1, tf_left_align|tf_with_outline),
        (faction_get_color, ":var4", ":var12"),
        (overlay_set_color, reg10, ":var4"),
        (position_set_x, pos3, 750),
        (position_set_y, pos3, 850),
        (overlay_set_size, reg10, pos3),
        (position_set_x, pos3, 10),
        (position_set_y, pos3, ":var1"),
        (overlay_set_position, reg10, pos3),
        (assign, ":var0", 165),
        (assign, ":var10", 0),
        (position_set_x, ":var10", 700),
        (position_set_y, ":var10", 800),
        (store_relation, reg1, "fac_player_supporters_faction", ":var12"),
        (try_begin),
          (ge, reg1, 90),
          (str_store_string, s3, "@Loyal"),
        (else_try),
          (ge, reg1, 80),
          (str_store_string, s3, "@Devoted"),
        (else_try),
          (ge, reg1, 70),
          (str_store_string, s3, "@Fond"),
        (else_try),
          (ge, reg1, 60),
          (str_store_string, s3, "@Gracious"),
        (else_try),
          (ge, reg1, 50),
          (str_store_string, s3, "@Friendly"),
        (else_try),
          (ge, reg1, 40),
          (str_store_string, s3, "@Supportive"),
        (else_try),
          (ge, reg1, 30),
          (str_store_string, s3, "@Favorable"),
        (else_try),
          (ge, reg1, 20),
          (str_store_string, s3, "@Cooperative"),
        (else_try),
          (ge, reg1, 10),
          (str_store_string, s3, "@Accepting"),
        (else_try),
          (ge, reg1, 0),
          (str_store_string, s3, "@Indifferent"),
        (else_try),
          (ge, reg1, -10),
          (str_store_string, s3, "@Suspicious"),
        (else_try),
          (ge, reg1, -20),
          (str_store_string, s3, "@Grumbling"),
        (else_try),
          (ge, reg1, -30),
          (str_store_string, s3, "@Hostile"),
        (else_try),
          (ge, reg1, -40),
          (str_store_string, s3, "@Resentful"),
        (else_try),
          (ge, reg1, -50),
          (str_store_string, s3, "@Angry"),
        (else_try),
          (ge, reg1, -60),
          (str_store_string, s3, "@Hateful"),
        (else_try),
          (ge, reg1, -70),
          (str_store_string, s3, "@Revengeful"),
        (else_try),
          (str_store_string, s3, "@Vengeful"),
        (try_end),
        (call_script, "script_evaluate_faction_prejudice", "p_main_party", ":var12"),
        (create_text_overlay, reg10, "@{reg1}", tf_right_align),
        (try_begin),
          (lt, reg1, 0),
          (overlay_animate_to_color, reg10, 200, 0xFF2222),
        (try_end),
        (overlay_set_size, reg10, ":var10"),
        (store_add, ":var8", ":var0", 20),
        (position_set_x, pos1, ":var8"),
        (position_set_y, pos1, ":var1"),
        (overlay_set_position, reg10, pos1),
        (overlay_set_color, reg10, ":var11"),
        (create_text_overlay, reg10, "@{s3}", tf_right_align),
        (overlay_set_size, reg10, ":var10"),
        (position_set_x, pos1, ":var8"),
        (store_sub, ":var17", ":var1", 20),
        (position_set_y, pos1, ":var17"),
        (overlay_set_position, reg10, pos1),
        (overlay_set_color, reg10, ":var11"),
        (try_begin),
          (neq, ":var12", "fac_player_supporters_faction"),
          (store_sub, ":var19", ":var12", "fac_player_supporters_faction"),
          (val_add, ":var19", "mesh_pic_recruits"),
          (create_mesh_overlay, reg10, ":var19"),
          (position_set_x, pos1, 75),
          (position_set_y, pos1, 75),
          (overlay_set_size, reg10, pos1),
          (position_set_x, pos1, 165),
          (store_sub, ":var17", ":var1", 37),
          (position_set_y, pos1, ":var17"),
          (overlay_set_position, reg10, pos1),
        (try_end),
        (assign, ":var20", 0),
        (assign, ":var21", 0),
        (assign, ":var22", 0),
        (assign, ":var23", 0),
        (try_for_parties, ":var24"),
          (store_faction_of_party, ":var25", ":var24"),
          (eq, ":var25", ":var12"),
          (try_begin),
            (party_slot_eq, ":var24", 0, 13),
            (val_add, ":var20", 1),
          (else_try),
            (party_slot_eq, ":var24", 0, 11),
            (val_add, ":var21", 1),
          (else_try),
            (this_or_next|party_slot_eq, ":var24", 0, 3),
            (this_or_next|party_slot_eq, ":var24", 0, 2),
            (party_slot_eq, ":var24", 0, 4),
            (val_add, ":var22", 1),
            (try_begin),
              (party_slot_eq, ":var24", 7, -1),
              (val_add, ":var23", 1),
            (try_end),
          (try_end),
        (try_end),
        (assign, ":var26", 0),
        (try_for_range, ":var27", "trp_npc1", "trp_knight_1_1_wife"),
          (troop_slot_eq, ":var27", 2, 2),
          (troop_slot_ge, ":var27", 8, 0),
          (store_faction_of_troop, ":var28", ":var27"),
          (eq, ":var28", ":var12"),
          (val_add, ":var26", 1),
        (try_end),
        (assign, reg61, ":var22"),
        (assign, reg58, ":var23"),
        (create_text_overlay, reg10, "@{reg61} {reg58?({reg58} U) :}Centers", tf_left_align),
        (overlay_set_size, reg10, ":var10"),
        (position_set_x, pos1, 15),
        (store_sub, ":var17", ":var1", 17),
        (position_set_y, pos1, ":var17"),
        (overlay_set_position, reg10, pos1),
        (overlay_set_color, reg10, 0x000000),
        (assign, reg62, ":var21"),
        (create_text_overlay, reg10, "@{reg62} Caravans", tf_left_align),
        (overlay_set_size, reg10, ":var10"),
        (position_set_x, pos1, 15),
        (val_sub, ":var17", 17),
        (position_set_y, pos1, ":var17"),
        (overlay_set_position, reg10, pos1),
        (overlay_set_color, reg10, 0x000000),
        (assign, reg60, ":var20"),
        (assign, reg59, ":var26"),
        (create_text_overlay, reg10, "@{reg60} {reg59?({reg59} P) :}Lords", tf_left_align),
        (overlay_set_size, reg10, ":var10"),
        (position_set_x, pos1, 15),
        (val_sub, ":var17", 17),
        (position_set_y, pos1, ":var17"),
        (overlay_set_position, reg10, pos1),
        (overlay_set_color, reg10, 0x000000),
        (val_add, ":var1", 18),
      (try_end),
      (set_container_overlay, -1),
    ]),
    (ti_on_presentation_event_state_change,
    [
      (store_trigger_param_1, ":var0"),
      (try_begin),
        (eq, ":var0", "$g_jrider_faction_report_return_to_menu"),
        (presentation_set_duration, 0),
      (try_end),
    ]),
    (ti_on_presentation_run,
    [
      (try_begin),
        (this_or_next|key_clicked, key_escape),
        (key_clicked, key_right_mouse_button),
        (presentation_set_duration, 0),
        (jump_to_menu, "mnu_reports"),
      (try_end),
    ]),
  ]),

  ("jrider_faction_relations_report3", 0, mesh_message_window,
  [
    (ti_on_presentation_load,
    [
      (presentation_set_duration, 999999),
      (set_fixed_point_multiplier, 1000),
      (create_mesh_overlay, reg1, "mesh_pic_castledes"),
      (position_set_x, pos1, 180),
      (position_set_y, pos1, 180),
      (overlay_set_size, reg1, pos1),
      (position_set_x, pos1, 795),
      (position_set_y, pos1, 600),
      (overlay_set_position, reg1, pos1),
      (create_mesh_overlay, reg1, "mesh_pic_looted_village"),
      (position_set_x, pos1, 170),
      (position_set_y, pos1, 170),
      (overlay_set_size, reg1, pos1),
      (position_set_x, pos1, -15),
      (position_set_y, pos1, 600),
      (overlay_set_position, reg1, pos1),
      (create_text_overlay, reg1, "@ Faction Relations Report ", tf_center_justify),
      (position_set_x, pos1, 500),
      (position_set_y, pos1, 670),
      (overlay_set_position, reg1, pos1),
      (position_set_x, pos1, 1500),
      (position_set_y, pos1, 1500),
      (overlay_set_size, reg1, pos1),
      (create_game_button_overlay, reg1, "@ Return to menu "),
      (position_set_x, pos1, 500),
      (position_set_y, pos1, 23),
      (overlay_set_position, reg1, pos1),
      (assign, "$g_jrider_faction_report_return_to_menu", reg1),
      (assign, ":var0", 250),
      (assign, ":var1", 620),
      (position_set_y, pos1, ":var1"),
      (try_for_range, ":var2", "fac_player_supporters_faction", 36),
        (faction_slot_eq, ":var2", 21, 0),
        (try_begin),
          (is_between, ":var2", "fac_kingdom_1", "fac_kingdoms_end"),
          (store_sub, ":var3", ":var2", "fac_kingdom_1"),
          (val_add, ":var3", "str_swadians"),
          (str_store_string, s1, ":var3"),
        (else_try),
          (str_store_string, s1, "@Your kingdom"),
        (try_end),
        (str_store_string, s11, ":var3"),
        (create_text_overlay, reg10, s1, tf_left_align|tf_with_outline),
        (faction_get_color, ":var4", ":var2"),
        (overlay_set_color, reg10, ":var4"),
        (position_set_x, pos3, 650),
        (position_set_y, pos3, 800),
        (overlay_set_size, reg10, pos3),
        (position_set_x, pos1, ":var0"),
        (overlay_set_position, reg10, pos1),
        (val_add, ":var0", 70),
      (try_end),
      (assign, ":var0", 215),
      (assign, ":var1", 597),
      (assign, ":var5", 0),
      (position_set_x, ":var5", 720),
      (position_set_y, ":var5", 775),
      (assign, ":var6", 40),
      (position_set_x, ":var6", 50),
      (position_set_y, ":var6", 28000),
      (create_text_overlay, reg2, "@Player^Relation", tf_center_justify),
      (overlay_set_size, reg2, ":var5"),
      (position_set_x, pos1, ":var0"),
      (position_set_y, pos1, ":var1"),
      (overlay_set_position, reg2, pos1),
      (val_add, ":var0", 40),
      (try_for_range, ":var7", 0, 9),
        (create_mesh_overlay, reg1, "mesh_white_plane"),
        (overlay_set_color, reg1, 0x000000),
        (overlay_set_size, reg1, ":var6"),
        (store_sub, ":var8", ":var0", 15),
        (store_sub, ":var9", ":var1", 500),
        (position_set_x, pos2, ":var8"),
        (position_set_y, pos2, ":var9"),
        (overlay_set_position, reg1, pos2),
        (val_add, ":var0", 70),
        (try_begin),
          (eq, "$cheat_mode", 1),
          (assign, reg20, ":var7"),
          (display_message, "@{!}DEBUG - Drawing line {reg20}"),
        (try_end),
      (try_end),
      (str_clear, s9),
      (str_clear, s8),
      (str_clear, s3),
      (str_clear, s60),
      (str_clear, s61),
      (str_clear, s0),
      (create_text_overlay, reg1, s0, tf_scrollable_style_2),
      (position_set_x, pos1, 50),
      (position_set_y, pos1, 70),
      (overlay_set_position, reg1, pos1),
      (position_set_x, pos1, 860),
      (position_set_y, pos1, 527),
      (overlay_set_area_size, reg1, pos1),
      (set_container_overlay, reg1),
      (assign, ":var10", 0),
      (assign, ":var1", 0),
      (assign, ":var11", 0),
      (try_for_range_backwards, ":var12", "fac_player_supporters_faction", "fac_kingdoms_end"),
        (faction_slot_eq, ":var12", 21, 0),
        (assign, ":var13", 220),
        (try_for_range, ":var14", "fac_player_supporters_faction", 36),
          (faction_slot_eq, ":var14", 21, 0),
          (try_begin),
            (neq, ":var14", ":var12"),
            (str_store_faction_name, s8, ":var14"),
            (try_begin),
              (neq, ":var14", ":var12"),
              (call_script, "script_diplomacy_faction_get_diplomatic_status_with_faction", ":var12", ":var14"),
              (assign, ":var15", reg0),
              (assign, ":var16", reg1),
              (try_begin),
                (eq, ":var15", -2),
                (str_store_string, s60, "@War"),
                (assign, reg60, 14483456),
                (assign, reg59, 0),
              (else_try),
                (eq, ":var15", -1),
                (str_store_string, s60, "@Casus Belli"),
                (assign, reg60, 14516224),
                (assign, reg59, ":var16"),
              (else_try),
                (eq, ":var15", 0),
                (str_store_string, s60, "@Peace"),
                (assign, reg60, 16777215),
                (assign, reg59, 0),
              (else_try),
                (eq, ":var15", 1),
                (str_store_string, s60, "@Truce"),
                (assign, reg60, 14540253),
                (assign, reg59, ":var16"),
                (try_begin),
                  (ge, ":var16", 61),
                  (str_store_string, s60, "@Alliance"),
                  (assign, reg60, 65280),
                  (store_sub, reg59, ":var16", 60),
                (else_try),
                  (ge, ":var16", 41),
                  (str_store_string, s60, "@Defense"),
                  (assign, reg60, 65450),
                  (store_sub, reg59, ":var16", 40),
                (else_try),
                  (ge, ":var16", 21),
                  (str_store_string, s60, "@Trade"),
                  (assign, reg60, 65484),
                  (store_sub, reg59, ":var16", 20),
                (try_end),
              (try_end),
              (val_add, ":var0", 50),
              (create_text_overlay, reg10, s60, tf_left_align|tf_with_outline),
              (overlay_set_size, reg10, ":var10"),
              (overlay_set_color, reg10, reg60),
              (store_sub, ":var8", ":var13", 20),
              (store_add, ":var17", ":var1", 54),
              (position_set_x, pos3, ":var8"),
              (position_set_y, pos3, ":var17"),
              (overlay_set_position, reg10, pos3),
              (create_text_overlay, reg10, "@{reg59?{reg59} days:}", tf_center_justify),
              (overlay_set_size, reg10, ":var10"),
              (store_add, ":var17", ":var1", 36),
              (store_add, ":var8", ":var13", 10),
              (position_set_x, pos3, ":var8"),
              (position_set_y, pos3, ":var17"),
              (overlay_set_position, reg10, pos3),
              (store_relation, ":var18", ":var12", ":var14"),
              (assign, reg61, ":var18"),
              (create_text_overlay, reg10, "@{reg61}", tf_center_justify),
              (overlay_set_size, reg10, ":var10"),
              (store_add, ":var17", ":var1", 18),
              (store_add, ":var8", ":var13", 10),
              (position_set_x, pos3, ":var8"),
              (position_set_y, pos3, ":var17"),
              (overlay_set_position, reg10, pos3),
            (try_end),
          (try_end),
          (val_add, ":var13", 70),
        (try_end),
        (assign, ":var0", 165),
        (val_add, ":var1", 54),
        (create_mesh_overlay, reg1, "mesh_white_plane"),
        (overlay_set_color, reg1, 0x000000),
        (position_set_x, pos1, 42000),
        (position_set_y, pos1, 60),
        (overlay_set_size, reg1, pos1),
        (position_set_x, pos1, 17),
        (store_add, ":var17", ":var1", 20),
        (position_set_y, pos1, ":var17"),
        (overlay_set_position, reg1, pos1),
        (str_store_faction_name, s9, ":var12"),
        (str_store_string, s1, "@{s9}"),
        (create_text_overlay, reg10, s1, tf_left_align|tf_with_outline),
        (faction_get_color, ":var4", ":var12"),
        (overlay_set_color, reg10, ":var4"),
        (position_set_x, pos3, 750),
        (position_set_y, pos3, 850),
        (overlay_set_size, reg10, pos3),
        (position_set_x, pos3, 10),
        (position_set_y, pos3, ":var1"),
        (overlay_set_position, reg10, pos3),
        (assign, ":var0", 165),
        (assign, ":var10", 0),
        (position_set_x, ":var10", 700),
        (position_set_y, ":var10", 800),
        (store_relation, reg1, "fac_player_supporters_faction", ":var12"),
        (try_begin),
          (ge, reg1, 90),
          (str_store_string, s3, "@Loyal"),
        (else_try),
          (ge, reg1, 80),
          (str_store_string, s3, "@Devoted"),
        (else_try),
          (ge, reg1, 70),
          (str_store_string, s3, "@Fond"),
        (else_try),
          (ge, reg1, 60),
          (str_store_string, s3, "@Gracious"),
        (else_try),
          (ge, reg1, 50),
          (str_store_string, s3, "@Friendly"),
        (else_try),
          (ge, reg1, 40),
          (str_store_string, s3, "@Supportive"),
        (else_try),
          (ge, reg1, 30),
          (str_store_string, s3, "@Favorable"),
        (else_try),
          (ge, reg1, 20),
          (str_store_string, s3, "@Cooperative"),
        (else_try),
          (ge, reg1, 10),
          (str_store_string, s3, "@Accepting"),
        (else_try),
          (ge, reg1, 0),
          (str_store_string, s3, "@Indifferent"),
        (else_try),
          (ge, reg1, -10),
          (str_store_string, s3, "@Suspicious"),
        (else_try),
          (ge, reg1, -20),
          (str_store_string, s3, "@Grumbling"),
        (else_try),
          (ge, reg1, -30),
          (str_store_string, s3, "@Hostile"),
        (else_try),
          (ge, reg1, -40),
          (str_store_string, s3, "@Resentful"),
        (else_try),
          (ge, reg1, -50),
          (str_store_string, s3, "@Angry"),
        (else_try),
          (ge, reg1, -60),
          (str_store_string, s3, "@Hateful"),
        (else_try),
          (ge, reg1, -70),
          (str_store_string, s3, "@Revengeful"),
        (else_try),
          (str_store_string, s3, "@Vengeful"),
        (try_end),
        (call_script, "script_evaluate_faction_prejudice", "p_main_party", ":var12"),
        (create_text_overlay, reg10, "@{reg1}", tf_right_align),
        (try_begin),
          (lt, reg1, 0),
          (overlay_animate_to_color, reg10, 200, 0xFF2222),
        (try_end),
        (overlay_set_size, reg10, ":var10"),
        (store_add, ":var8", ":var0", 20),
        (position_set_x, pos1, ":var8"),
        (position_set_y, pos1, ":var1"),
        (overlay_set_position, reg10, pos1),
        (overlay_set_color, reg10, ":var11"),
        (create_text_overlay, reg10, "@{s3}", tf_right_align),
        (overlay_set_size, reg10, ":var10"),
        (position_set_x, pos1, ":var8"),
        (store_sub, ":var17", ":var1", 20),
        (position_set_y, pos1, ":var17"),
        (overlay_set_position, reg10, pos1),
        (overlay_set_color, reg10, ":var11"),
        (try_begin),
          (neq, ":var12", "fac_player_supporters_faction"),
          (store_sub, ":var19", ":var12", "fac_player_supporters_faction"),
          (val_add, ":var19", "mesh_pic_recruits"),
          (create_mesh_overlay, reg10, ":var19"),
          (position_set_x, pos1, 75),
          (position_set_y, pos1, 75),
          (overlay_set_size, reg10, pos1),
          (position_set_x, pos1, 165),
          (store_sub, ":var17", ":var1", 37),
          (position_set_y, pos1, ":var17"),
          (overlay_set_position, reg10, pos1),
        (try_end),
        (assign, ":var20", 0),
        (assign, ":var21", 0),
        (assign, ":var22", 0),
        (assign, ":var23", 0),
        (try_for_parties, ":var24"),
          (store_faction_of_party, ":var25", ":var24"),
          (eq, ":var25", ":var12"),
          (try_begin),
            (party_slot_eq, ":var24", 0, 13),
            (val_add, ":var20", 1),
          (else_try),
            (party_slot_eq, ":var24", 0, 11),
            (val_add, ":var21", 1),
          (else_try),
            (this_or_next|party_slot_eq, ":var24", 0, 3),
            (this_or_next|party_slot_eq, ":var24", 0, 2),
            (party_slot_eq, ":var24", 0, 4),
            (val_add, ":var22", 1),
            (try_begin),
              (party_slot_eq, ":var24", 7, -1),
              (val_add, ":var23", 1),
            (try_end),
          (try_end),
        (try_end),
        (assign, ":var26", 0),
        (try_for_range, ":var27", "trp_npc1", "trp_knight_1_1_wife"),
          (troop_slot_eq, ":var27", 2, 2),
          (troop_slot_ge, ":var27", 8, 0),
          (store_faction_of_troop, ":var28", ":var27"),
          (eq, ":var28", ":var12"),
          (val_add, ":var26", 1),
        (try_end),
        (assign, reg61, ":var22"),
        (assign, reg58, ":var23"),
        (create_text_overlay, reg10, "@{reg61} {reg58?({reg58} U) :}Centers", tf_left_align),
        (overlay_set_size, reg10, ":var10"),
        (position_set_x, pos1, 15),
        (store_sub, ":var17", ":var1", 17),
        (position_set_y, pos1, ":var17"),
        (overlay_set_position, reg10, pos1),
        (overlay_set_color, reg10, 0x000000),
        (assign, reg62, ":var21"),
        (create_text_overlay, reg10, "@{reg62} Caravans", tf_left_align),
        (overlay_set_size, reg10, ":var10"),
        (position_set_x, pos1, 15),
        (val_sub, ":var17", 17),
        (position_set_y, pos1, ":var17"),
        (overlay_set_position, reg10, pos1),
        (overlay_set_color, reg10, 0x000000),
        (assign, reg60, ":var20"),
        (assign, reg59, ":var26"),
        (create_text_overlay, reg10, "@{reg60} {reg59?({reg59} P) :}Lords", tf_left_align),
        (overlay_set_size, reg10, ":var10"),
        (position_set_x, pos1, 15),
        (val_sub, ":var17", 17),
        (position_set_y, pos1, ":var17"),
        (overlay_set_position, reg10, pos1),
        (overlay_set_color, reg10, 0x000000),
        (val_add, ":var1", 18),
      (try_end),
      (set_container_overlay, -1),
    ]),
    (ti_on_presentation_event_state_change,
    [
      (store_trigger_param_1, ":var0"),
      (try_begin),
        (eq, ":var0", "$g_jrider_faction_report_return_to_menu"),
        (presentation_set_duration, 0),
      (try_end),
    ]),
    (ti_on_presentation_run,
    [
      (try_begin),
        (this_or_next|key_clicked, key_escape),
        (key_clicked, key_right_mouse_button),
        (presentation_set_duration, 0),
        (jump_to_menu, "mnu_reports"),
      (try_end),
    ]),
  ]),

  ("equipment_overview", 0, mesh_lco_background_split,
  [
    (ti_on_presentation_load,
    [
      (call_script, "script_lco_initialize_presentation"),
      (call_script, "script_lco_create_label", "str_lco_i_title_companions", 250, 714, 1000, 16),
      (str_store_troop_name, s40, "trp_player"),
      (call_script, "script_lco_create_label", "str_lco_s40", 750, 714, 1000, 16),
      (str_clear, s40),
      (call_script, "script_lco_create_mesh", "mesh_pic_camp", -300, 138, 750, 750),
      (call_script, "script_lco_create_mesh", "mesh_pic_messenger", 110, 138, 750, 750),
      (call_script, "script_lco_create_label", "str_lco_i_ae_with", 275, 175, 750, 0),
      (call_script, "script_lco_create_label", "str_lco_i_ae_with", 275, 175, 750, 0),
      (call_script, "script_lco_create_checkbox", "str_lco_i_ae_with_horses", 275, 150, "$g_lco_auto_horses"),
      (assign, "$g_lco_cb_0", reg0),
      (call_script, "script_lco_create_checkbox", "str_lco_i_ae_with_armors", 375, 150, "$g_lco_auto_armors"),
      (assign, "$g_lco_cb_1", reg0),
      (call_script, "script_lco_create_checkbox", "str_lco_i_ae_with_shields", 275, 125, "$g_lco_auto_shields"),
      (assign, "$g_lco_cb_2", reg0),
      (call_script, "script_lco_create_button", "str_lco_i_ae_companion", 355, 75, 190, 42),
      (assign, "$g_lco_auto_equip", reg0),
      (call_script, "script_lco_create_button", "str_lco_i_ae_everyone", 355, 25, 190, 42),
      (assign, "$g_lco_auto_equip_all", reg0),
      (call_script, "script_lco_create_label", "str_lco_i_hero_panel_title", 25, 652, 750, 0),
      (call_script, "script_lco_create_label", "str_lco_i_hero_panel_title", 25, 652, 750, 0),
      (call_script, "script_lco_create_container", 0, 125, 250, 527, 1),
      (store_mul, ":var0", "$g_lco_heroes", 25),
      (val_sub, ":var0", 25),
      (val_max, ":var0", 500),
      (try_for_range, ":var1", 0, "$g_lco_heroes"),
        (troop_get_slot, ":var2", "trp_companions_overview", ":var1"),
        (store_add, ":var3", "$g_lco_heroes", ":var1"),
        (troop_set_slot, "trp_companions_overview", ":var3", ":var2"),
        (store_mul, ":var4", ":var1", 25),
        (store_sub, ":var4", ":var0", ":var4"),
        (call_script, "script_lco_create_mesh", "mesh_lco_panel", 25, ":var4", 310, 300),
        (troop_set_slot, "trp_companions_overview", ":var1", reg0),
      (try_end),
      (store_mul, ":var4", "$g_lco_active_hero", 25),
      (store_sub, ":var4", ":var0", ":var4"),
      (call_script, "script_lco_create_mesh", "mesh_lco_panel_down", 25, ":var4", 310, 300),
      (assign, "$g_lco_active_panel", reg0),
      (val_add, ":var0", 1),
      (try_for_range, ":var1", 0, "$g_lco_heroes"),
        (store_add, ":var3", "$g_lco_heroes", ":var1"),
        (troop_get_slot, ":var2", "trp_companions_overview", ":var3"),
        (store_mul, ":var4", ":var1", 25),
        (store_sub, ":var4", ":var0", ":var4"),
        (call_script, "script_lco_troop_name_to_s40", ":var2"),
        (call_script, "script_lco_create_label", "str_lco_s40", 30, ":var4", 750, 0),
      (try_end),
      (str_clear, s40),
      (set_container_overlay, -1),
      (store_mul, ":var1", "$g_lco_heroes", 2),
      (call_script, "script_lco_create_label", "str_lco_i_weapons", 272, 650, 750, 0),
      (call_script, "script_lco_create_label", "str_lco_i_weapons", 272, 650, 750, 0),
      (try_for_range, reg1, 0, 4),
        (store_mul, ":var4", reg1, 25),
        (store_sub, ":var4", 625, ":var4"),
        (call_script, "script_lco_create_mesh", "mesh_lco_panel", 272, ":var4", 310, 300),
        (troop_set_slot, "trp_companions_overview", ":var1", reg0),
        (val_add, ":var1", 1),
      (try_end),
      (call_script, "script_lco_create_label", "str_lco_i_armor", 272, 500, 750, 0),
      (call_script, "script_lco_create_label", "str_lco_i_armor", 272, 500, 750, 0),
      (try_for_range, reg1, 0, 4),
        (store_mul, ":var4", reg1, 25),
        (store_sub, ":var4", 475, ":var4"),
        (call_script, "script_lco_create_mesh", "mesh_lco_panel", 272, ":var4", 310, 300),
        (troop_set_slot, "trp_companions_overview", ":var1", reg0),
        (val_add, ":var1", 1),
      (try_end),
      (call_script, "script_lco_create_label", "str_lco_i_horse", 272, 350, 750, 0),
      (call_script, "script_lco_create_label", "str_lco_i_horse", 272, 350, 750, 0),
      (call_script, "script_lco_create_mesh", "mesh_lco_panel", 272, 325, 310, 300),
      (troop_set_slot, "trp_companions_overview", ":var1", reg0),
      (val_add, ":var1", 1),
      (try_begin),
        (eq, "$g_lco_suppress_books", 0),
        (call_script, "script_lco_create_label", "str_lco_i_books", 272, 275, 750, 0),
        (call_script, "script_lco_create_label", "str_lco_i_books", 272, 275, 750, 0),
        (try_for_range, reg1, 0, 2),
          (store_mul, ":var4", reg1, 25),
          (store_sub, ":var4", 250, ":var4"),
          (call_script, "script_lco_create_mesh", "mesh_lco_panel", 272, ":var4", 310, 300),
          (troop_set_slot, "trp_companions_overview", ":var1", reg0),
          (val_add, ":var1", 1),
        (try_end),
      (else_try),
        (val_add, ":var1", 2),
      (try_end),
      (str_clear, s40),
      (try_for_range, reg1, 0, 4),
        (store_mul, ":var4", reg1, 25),
        (store_sub, ":var4", 626, ":var4"),
        (call_script, "script_lco_create_label", 40, 277, ":var4", 750, 0),
        (troop_set_slot, "trp_companions_overview", ":var1", reg0),
        (val_add, ":var1", 1),
      (try_end),
      (try_for_range, reg1, 0, 4),
        (store_mul, ":var4", reg1, 25),
        (store_sub, ":var4", 476, ":var4"),
        (call_script, "script_lco_create_label", 40, 277, ":var4", 750, 0),
        (troop_set_slot, "trp_companions_overview", ":var1", reg0),
        (val_add, ":var1", 1),
      (try_end),
      (call_script, "script_lco_create_label", 40, 277, 326, 750, 0),
      (troop_set_slot, "trp_companions_overview", ":var1", reg0),
      (val_add, ":var1", 1),
      (try_begin),
        (eq, "$g_lco_suppress_books", 0),
        (try_for_range, reg1, 0, 2),
          (store_mul, ":var4", reg1, 25),
          (store_sub, ":var4", 251, ":var4"),
          (call_script, "script_lco_create_label", 40, 277, ":var4", 750, 0),
          (troop_set_slot, "trp_companions_overview", ":var1", reg0),
          (val_add, ":var1", 1),
        (try_end),
      (else_try),
        (val_add, ":var1", 2),
      (try_end),
      (call_script, "script_lco_create_label", "str_lco_i_weapons", 512, 650, 750, 0),
      (call_script, "script_lco_create_label", "str_lco_i_weapons", 512, 650, 750, 0),
      (try_for_range, reg1, 0, 4),
        (store_mul, ":var4", reg1, 25),
        (store_sub, ":var4", 625, ":var4"),
        (call_script, "script_lco_create_mesh", "mesh_lco_panel", 512, ":var4", 310, 300),
        (troop_set_slot, "trp_companions_overview", ":var1", reg0),
        (val_add, ":var1", 1),
      (try_end),
      (call_script, "script_lco_create_label", "str_lco_i_armor", 512, 500, 750, 0),
      (call_script, "script_lco_create_label", "str_lco_i_armor", 512, 500, 750, 0),
      (try_for_range, reg1, 0, 4),
        (store_mul, ":var4", reg1, 25),
        (store_sub, ":var4", 475, ":var4"),
        (call_script, "script_lco_create_mesh", "mesh_lco_panel", 512, ":var4", 310, 300),
        (troop_set_slot, "trp_companions_overview", ":var1", reg0),
        (val_add, ":var1", 1),
      (try_end),
      (call_script, "script_lco_create_label", "str_lco_i_horse", 512, 350, 750, 0),
      (call_script, "script_lco_create_label", "str_lco_i_horse", 512, 350, 750, 0),
      (call_script, "script_lco_create_mesh", "mesh_lco_panel", 512, 325, 310, 300),
      (troop_set_slot, "trp_companions_overview", ":var1", reg0),
      (val_add, ":var1", 1),
      (try_for_range, reg1, 0, 4),
        (store_mul, ":var4", reg1, 25),
        (store_sub, ":var4", 626, ":var4"),
        (call_script, "script_lco_create_label", 40, 517, ":var4", 750, 0),
        (troop_set_slot, "trp_companions_overview", ":var1", reg0),
        (val_add, ":var1", 1),
      (try_end),
      (try_for_range, reg1, 0, 4),
        (store_mul, ":var4", reg1, 25),
        (store_sub, ":var4", 476, ":var4"),
        (call_script, "script_lco_create_label", 40, 517, ":var4", 750, 0),
        (troop_set_slot, "trp_companions_overview", ":var1", reg0),
        (val_add, ":var1", 1),
      (try_end),
      (call_script, "script_lco_create_label", 40, 517, 326, 750, 0),
      (troop_set_slot, "trp_companions_overview", ":var1", reg0),
      (val_add, ":var1", 1),
      (call_script, "script_lco_create_label", "str_lco_i_inventory", 750, 652, 750, 0),
      (call_script, "script_lco_create_label", "str_lco_i_inventory", 750, 652, 750, 0),
      (call_script, "script_lco_create_image_button", "mesh_lco_sort_inventory", "mesh_lco_sort_inventory_down", 935, 655, 200, 200),
      (assign, "$g_lco_sort_inventory", reg0),
      (call_script, "script_lco_create_container", 750, 125, 215, 527, 1),
      (store_mul, ":var5", "$g_lco_inv_slots", 25),
      (val_sub, ":var5", 25),
      (val_max, ":var5", 500),
      (try_for_range, reg1, 0, "$g_lco_inv_slots"),
        (store_mul, ":var4", reg1, 25),
        (store_sub, ":var4", ":var5", ":var4"),
        (call_script, "script_lco_create_mesh", "mesh_lco_panel", 0, ":var4", 300, 300),
        (troop_set_slot, "trp_companions_overview", ":var1", reg0),
        (val_add, ":var1", 1),
      (try_end),
      (try_for_range, reg1, 0, "$g_lco_inv_slots"),
        (store_mul, ":var4", reg1, 25),
        (store_sub, ":var4", ":var5", ":var4"),
        (val_add, ":var4", 1),
        (call_script, "script_lco_create_label", "str_empty_string", 5, ":var4", 750, 0),
        (troop_set_slot, "trp_companions_overview", ":var1", reg0),
        (val_add, ":var1", 1),
      (try_end),
      (set_container_overlay, -1),
      (call_script, "script_lco_create_label", "str_lco_i_discard", 512, 275, 750, 0),
      (call_script, "script_lco_create_label", "str_lco_i_discard", 512, 275, 750, 0),
      (call_script, "script_lco_create_button", "str_lco_i_retrieve", 605, 25, 190, 42),
      (assign, "$g_lco_retrieve", reg0),
      (call_script, "script_lco_create_container", 515, 75, 200, 202, 1),
      (store_mul, ":var5", "$g_lco_garb_slots", 25),
      (val_sub, ":var5", 25),
      (val_max, ":var5", 175),
      (try_for_range, reg1, 0, "$g_lco_garb_slots"),
        (store_mul, ":var4", reg1, 25),
        (store_sub, ":var4", ":var5", ":var4"),
        (call_script, "script_lco_create_mesh", "mesh_lco_panel", 0, ":var4", 282, 300),
        (troop_set_slot, "trp_companions_overview", ":var1", reg0),
        (val_add, ":var1", 1),
      (try_end),
      (val_add, ":var5", 1),
      (try_for_range, reg1, 0, "$g_lco_garb_slots"),
        (store_mul, ":var4", reg1, 25),
        (store_sub, ":var4", ":var5", ":var4"),
        (call_script, "script_lco_create_label", "str_empty_string", 5, ":var4", 750, 0),
        (troop_set_slot, "trp_companions_overview", ":var1", reg0),
        (val_add, ":var1", 1),
      (try_end),
      (set_container_overlay, -1),
      (call_script, "script_lco_create_mesh", "mesh_lco_gold_icon", 775, 82, 250, 250),
      (store_troop_gold, reg60, "trp_player"),
      (call_script, "script_game_get_money_text", reg60),
      (str_store_string_reg, s40, s1),
      (call_script, "script_lco_create_label", "str_lco_s40", 810, 90, 850, 0),
      (overlay_set_color, reg0, 0xFFFF00),
      (call_script, "script_lco_create_label", "str_lco_s40", 810, 90, 850, 0),
      (call_script, "script_lco_create_label", "str_lco_s40", 810, 90, 850, 0),
      (call_script, "script_lco_create_container", 0, 0, 225, 27, 1),
      (assign, "$g_lco_dragging_panel", reg0),
      (overlay_set_display, "$g_lco_dragging_panel", 0),
      (call_script, "script_lco_create_mesh", "mesh_lco_panel", 0, 0, 310, 300),
      (call_script, "script_lco_create_label", 40, 5, 1, 750, 0),
      (assign, "$g_lco_dragging_text", reg0),
      (set_container_overlay, -1),
      (call_script, "script_lco_fill_hero_panels"),
      (call_script, "script_lco_fill_player_panels"),
    ]),
    (ti_on_presentation_event_state_change,
    [
      (store_trigger_param_1, ":var0"),
      (store_trigger_param_2, ":var1"),
      (try_begin),
        (eq, ":var0", "$g_lco_return"),
        (try_begin),
          (eq, "$g_lco_dragging", 1),
          (call_script, "script_lco_cancel_drag_item"),
        (try_end),
        (try_begin),
          (eq, "$g_lco_dragging", 1),
          (display_message, "str_lco_error_drop_first", 0xFF4040),
        (else_try),
          (call_script, "script_lco_clear_all_items", "$g_lco_garbage_troop"),
          (assign, "$g_lco_garbage_troop", "trp_companions_discard"),
          (jump_to_menu, "mnu_lco_auto_return"),
          (presentation_set_duration, 0),
        (try_end),
      (else_try),
        (eq, ":var0", "$g_lco_retrieve"),
        (try_begin),
          (this_or_next|key_is_down, key_left_control),
          (key_is_down, key_right_control),
          (call_script, "script_lco_retrieve_discarded_best"),
        (else_try),
          (call_script, "script_lco_retrieve_discarded"),
        (try_end),
        (call_script, "script_lco_fill_player_panels"),
      (else_try),
        (eq, ":var0", "$g_lco_sort_inventory"),
        (call_script, "script_lco_sort_player_inventory"),
        (call_script, "script_lco_fill_player_panels"),
      (else_try),
        (eq, ":var0", "$g_lco_cb_0"),
        (assign, "$g_lco_auto_horses", ":var1"),
      (else_try),
        (eq, ":var0", "$g_lco_cb_1"),
        (assign, "$g_lco_auto_armors", ":var1"),
      (else_try),
        (eq, ":var0", "$g_lco_cb_2"),
        (assign, "$g_lco_auto_shields", ":var1"),
      (else_try),
        (eq, ":var0", "$g_lco_inc_0"),
        (assign, "$g_lco_include_companions", ":var1"),
        (presentation_set_duration, 0),
      (else_try),
        (eq, ":var0", "$g_lco_inc_1"),
        (assign, "$g_lco_include_lords", ":var1"),
        (presentation_set_duration, 0),
      (else_try),
        (eq, ":var0", "$g_lco_inc_2"),
        (assign, "$g_lco_include_regulars", ":var1"),
        (presentation_set_duration, 0),
      (else_try),
        (eq, ":var0", "$g_lco_switch_page_0"),
        (assign, "$g_lco_page", 0),
        (presentation_set_duration, 0),
      (else_try),
        (eq, ":var0", "$g_lco_switch_page_1"),
        (assign, "$g_lco_page", 1),
        (presentation_set_duration, 0),
      (else_try),
        (eq, ":var0", "$g_lco_switch_page_2"),
      (else_try),
        (eq, ":var0", "$g_lco_auto_equip"),
        (try_begin),
          (store_add, ":var2", "$g_lco_heroes", "$g_lco_active_hero"),
          (troop_get_slot, ":var3", "trp_companions_overview", ":var2"),
          (call_script, "script_cf_lco_controllable", ":var3"),
          (call_script, "script_lco_backup_inventory", ":var3"),
          (call_script, "script_lco_hero_grab_equipment", ":var3"),
          (troop_equip_items, ":var3"),
          (call_script, "script_lco_hero_return_equipment", ":var3"),
          (call_script, "script_lco_retrieve_inventory", ":var3"),
          (troop_get_type, reg60, ":var3"),
          (str_store_troop_name, s41, ":var3"),
          (display_message, "str_lco_message_hero_ae"),
          (call_script, "script_lco_fill_hero_panels"),
          (call_script, "script_lco_fill_player_panels"),
        (else_try),
          (display_message, "str_lco_drop_error_control", 0xFF4040),
        (try_end),
      (else_try),
        (eq, ":var0", "$g_lco_auto_equip_all"),
        (store_add, ":var4", "$g_lco_heroes", "$g_lco_heroes"),
        (try_for_range, ":var2", "$g_lco_heroes", ":var4"),
          (troop_get_slot, ":var3", "trp_companions_overview", ":var2"),
          (call_script, "script_cf_lco_controllable", ":var3"),
          (call_script, "script_lco_backup_inventory", ":var3"),
          (call_script, "script_lco_hero_grab_equipment", ":var3"),
          (troop_equip_items, ":var3"),
          (call_script, "script_lco_hero_return_equipment", ":var3"),
          (call_script, "script_lco_retrieve_inventory", ":var3"),
        (try_end),
        (display_message, "str_lco_message_all_heroes_ae"),
        (call_script, "script_lco_fill_hero_panels"),
        (call_script, "script_lco_fill_player_panels"),
      (try_end),
    ]),
    (ti_on_presentation_mouse_press,
    [
      (store_trigger_param_1, ":var0"),
      (store_trigger_param_2, ":var1"),
      (try_begin),
        (eq, ":var1", 0),
        (try_begin),
          (eq, "$g_lco_panel_found", 0),
          (try_for_range, ":var2", 0, "$g_lco_heroes"),
            (troop_slot_eq, "trp_companions_overview", ":var2", ":var0"),
            (assign, "$g_lco_panel_found", 1),
            (try_begin),
              (this_or_next|key_is_down, key_left_control),
              (key_is_down, key_right_control),
              (try_begin),
                (eq, "$g_lco_dragging", 1),
                (store_add, ":var3", "$g_lco_heroes", ":var2"),
                (troop_get_slot, ":var4", "trp_companions_overview", ":var3"),
                (call_script, "script_cf_lco_controllable", ":var4"),
                (try_begin),
                  (call_script, "script_cf_lco_auto_offer_item", ":var4", "$g_lco_drag_item", "$g_lco_drag_modifier", "$g_lco_drag_quantity"),
                  (try_begin),
                    (ge, reg0, 0),
                    (assign, "$g_lco_drag_item", reg0),
                    (assign, "$g_lco_drag_modifier", reg1),
                    (assign, "$g_lco_drag_quantity", reg2),
                    (assign, "$g_lco_drag_quantity_max", reg3),
                    (call_script, "script_lco_item_name_to_s41", "$g_lco_drag_item", "$g_lco_drag_modifier", "$g_lco_drag_quantity", "$g_lco_drag_quantity_max"),
                    (overlay_set_text, "$g_lco_dragging_text", s41),
                  (else_try),
                    (assign, "$g_lco_drag_item", -1),
                    (assign, "$g_lco_drag_modifier", 0),
                    (assign, "$g_lco_drag_quantity", 0),
                    (assign, "$g_lco_drag_quantity_max", 0),
                    (overlay_set_display, "$g_lco_dragging_panel", 0),
                    (assign, "$g_lco_dragging", 0),
                  (try_end),
                  (call_script, "script_lco_fill_hero_panels"),
                  (call_script, "script_lco_fill_player_panels"),
                (else_try),
                  (str_store_troop_name, s40, ":var4"),
                  (call_script, "script_lco_item_name_to_s41", "$g_lco_drag_item", "$g_lco_drag_modifier", "$g_lco_drag_quantity", "$g_lco_drag_quantity_max"),
                  (str_store_string, s40, "str_lco_message_hero_no_need"),
                  (display_message, s40, 0xFF4040),
                (try_end),
              (try_end),
            (else_try),
              (this_or_next|key_is_down, key_left_alt),
              (key_is_down, key_right_alt),
              (call_script, "script_lco_set_active_hero", ":var2"),
              (try_begin),
                (eq, "$g_lco_dragging", 1),
                (display_message, "str_lco_error_drop_first", 0xFF4040),
              (else_try),
                (store_add, ":var3", "$g_lco_heroes", ":var2"),
                (troop_get_slot, "$g_lco_target", "trp_companions_overview", ":var3"),
                (assign, "$g_lco_operation", 2),
                (jump_to_menu, "mnu_lco_auto_return"),
                (presentation_set_duration, 0),
              (try_end),
            (else_try),
              (call_script, "script_lco_set_active_hero", ":var2"),
            (try_end),
          (try_end),
        (try_end),
        (try_begin),
          (eq, "$g_lco_panel_found", 0),
          (call_script, "script_cf_lco_is_active_panel", ":var0"),
          (assign, "$g_lco_panel_found", 1),
          (call_script, "script_lco_get_slot_details_for_panel", ":var0"),
          (assign, ":var5", reg0),
          (assign, ":var6", reg1),
          (assign, ":var7", reg2),
          (assign, ":var8", reg3),
          (assign, ":var9", reg4),
          (assign, ":var10", reg5),
          (try_begin),
            (eq, "$g_lco_dragging", 0),
            (try_begin),
              (ge, ":var7", 0),
              (try_begin),
                (this_or_next|key_is_down, key_left_control),
                (key_is_down, key_right_control),
                (try_begin),
                  (eq, ":var5", "trp_player"),
                  (store_add, ":var3", "$g_lco_heroes", "$g_lco_active_hero"),
                  (troop_get_slot, ":var4", "trp_companions_overview", ":var3"),
                  (try_begin),
                    (call_script, "script_cf_lco_auto_offer_item", ":var4", ":var7", ":var8", ":var9"),
                    (try_begin),
                      (ge, reg0, 0),
                      (troop_set_inventory_slot, ":var5", ":var6", reg0),
                      (troop_set_inventory_slot_modifier, ":var5", ":var6", reg1),
                    (else_try),
                      (troop_set_inventory_slot, ":var5", ":var6", -1),
                    (try_end),
                    (call_script, "script_lco_fill_hero_panels"),
                    (call_script, "script_lco_fill_player_panels"),
                  (else_try),
                    (str_store_troop_name, s40, ":var4"),
                    (call_script, "script_lco_item_name_to_s41", ":var7", ":var8", ":var9", ":var10"),
                    (str_store_string, s40, "str_lco_message_hero_no_need"),
                    (display_message, s40, 0xFF4040),
                  (try_end),
                (else_try),
                  (assign, ":var11", 0),
                  (try_begin),
                    (call_script, "script_cf_lco_controllable", ":var5"),
                    (troop_get_inventory_capacity, ":var12", "trp_player"),
                    (try_for_range, ":var2", 10, ":var12"),
                      (eq, ":var11", 0),
                      (troop_get_inventory_slot, ":var13", "trp_player", ":var2"),
                      (lt, ":var13", 0),
                      (troop_set_inventory_slot, "trp_player", ":var2", ":var7"),
                      (troop_set_inventory_slot_modifier, "trp_player", ":var2", ":var8"),
                      (try_begin),
                        (gt, ":var9", 0),
                        (troop_inventory_slot_set_item_amount, ":var9"),
                      (try_end),
                      (troop_set_inventory_slot, ":var5", ":var6", -1),
                      (assign, ":var11", 1),
                      (assign, ":var12", 0),
                    (try_end),
                    (try_begin),
                      (eq, ":var11", 0),
                      (display_message, "str_lco_error_inv_full", 0xFF4040),
                    (else_try),
                      (call_script, "script_lco_fill_hero_panels"),
                      (call_script, "script_lco_fill_player_panels"),
                    (try_end),
                  (else_try),
                    (str_store_troop_name, s40, ":var4"),
                    (display_message, "str_lco_drop_error_control", 0xFF4040),
                  (try_end),
                (try_end),
              (else_try),
                (this_or_next|key_is_down, key_left_alt),
                (key_is_down, key_right_alt),
                (try_begin),
                  (call_script, "script_cf_lco_controllable", ":var5"),
                  (neq, ":var5", "$g_lco_garbage_troop"),
                  (call_script, "script_lco_discard_item", ":var7", ":var8", ":var9"),
                  (troop_set_inventory_slot, ":var5", ":var6", -1),
                  (call_script, "script_lco_fill_hero_panels"),
                  (call_script, "script_lco_fill_player_panels"),
                (try_end),
              (else_try),
                (this_or_next|key_is_down, key_left_shift),
                (key_is_down, key_right_shift),
                (eq, ":var5", "trp_player"),
                (assign, ":var14", "$g_lco_heroes"),
                (assign, ":var15", 0),
                (try_for_range, ":var2", 0, ":var14"),
                  (store_add, ":var3", "$g_lco_heroes", ":var2"),
                  (troop_get_slot, ":var4", "trp_companions_overview", ":var3"),
                  (call_script, "script_cf_lco_auto_offer_item", ":var4", ":var7", ":var8", ":var9"),
                  (str_store_troop_name, s40, ":var4"),
                  (troop_get_type, reg4, ":var4"),
                  (call_script, "script_lco_item_name_to_s41", ":var7", ":var8", ":var9", ":var10"),
                  (try_begin),
                    (ge, reg0, 0),
                    (str_store_string, s39, s41),
                    (call_script, "script_lco_item_name_to_s41", reg0, reg1, reg2, reg3),
                    (display_message, "str_lco_message_hero_replaced"),
                  (else_try),
                    (display_message, "str_lco_message_hero_equipped"),
                    (assign, ":var14", 0),
                  (try_end),
                  (assign, ":var7", reg0),
                  (assign, ":var8", reg1),
                  (assign, ":var9", reg2),
                  (assign, ":var10", reg3),
                  (assign, ":var15", 1),
                (try_end),
                (try_begin),
                  (ge, ":var7", 0),
                  (troop_set_inventory_slot, ":var5", ":var6", ":var7"),
                  (troop_set_inventory_slot_modifier, ":var5", ":var6", ":var7"),
                (else_try),
                  (troop_set_inventory_slot, ":var5", ":var6", -1),
                (try_end),
                (try_begin),
                  (eq, ":var15", 1),
                  (call_script, "script_lco_fill_hero_panels"),
                  (call_script, "script_lco_fill_player_panels"),
                (else_try),
                  (call_script, "script_lco_item_name_to_s41", ":var7", ":var8", ":var9", ":var10"),
                  (display_message, "str_lco_message_nobody_needs", 0xFF4040),
                (try_end),
              (else_try),
                (call_script, "script_lco_drag_item", ":var5", ":var6"),
                (call_script, "script_lco_fill_hero_panels"),
                (call_script, "script_lco_fill_player_panels"),
              (try_end),
            (try_end),
          (else_try),
            (try_begin),
              (call_script, "script_cf_lco_can_drop_item", ":var5", ":var6", "$g_lco_drag_item", "$g_lco_drag_modifier"),
              (call_script, "script_lco_drop_item", ":var5", ":var6"),
              (call_script, "script_lco_fill_hero_panels"),
              (call_script, "script_lco_fill_player_panels"),
            (else_try),
              (display_message, reg0, 0xFF4040),
            (try_end),
          (try_end),
        (try_end),
      (else_try),
        (eq, ":var1", 1),
        (eq, "$g_lco_panel_found", 0),
        (eq, "$g_lco_dragging", 0),
        (call_script, "script_cf_lco_is_active_panel", ":var0"),
        (assign, "$g_lco_panel_found", 1),
        (call_script, "script_lco_get_slot_details_for_panel", ":var0"),
        (eq, reg0, "trp_player"),
        (ge, reg1, 10),
        (call_script, "script_lco_freeze_slot_toggle", reg1),
        (call_script, "script_lco_fill_player_panels"),
      (try_end),
    ]),
    (ti_on_presentation_run,
    [
      (set_fixed_point_multiplier, 1000),
      (assign, "$g_lco_panel_found", 0),
      (try_begin),
        (key_clicked, key_escape),
        (try_begin),
          (eq, "$g_lco_dragging", 1),
          (call_script, "script_lco_cancel_drag_item"),
        (try_end),
        (try_begin),
          (eq, "$g_lco_dragging", 1),
          (display_message, "str_lco_error_drop_first", 0xFF4040),
        (else_try),
          (call_script, "script_lco_clear_all_items", "$g_lco_garbage_troop"),
          (assign, "$g_lco_garbage_troop", "trp_companions_discard"),
          (jump_to_menu, "mnu_lco_auto_return"),
          (presentation_set_duration, 0),
        (try_end),
      (try_end),
      (try_begin),
        (key_clicked, key_tab),
        (try_begin),
          (this_or_next|key_is_down, key_left_shift),
          (key_is_down, key_right_shift),
          (store_add, ":var0", "$g_lco_active_hero", "$g_lco_heroes"),
          (val_sub, ":var0", 1),
          (val_mod, ":var0", "$g_lco_heroes"),
          (call_script, "script_lco_set_active_hero", ":var0"),
        (else_try),
          (this_or_next|key_is_down, key_left_control),
          (key_is_down, key_right_control),
          (assign, "$g_lco_page", 0),
          (presentation_set_duration, 0),
        (else_try),
          (neg|key_is_down, key_left_alt),
          (neg|key_is_down, key_right_alt),
          (store_add, ":var0", "$g_lco_active_hero", 1),
          (val_mod, ":var0", "$g_lco_heroes"),
          (call_script, "script_lco_set_active_hero", ":var0"),
        (try_end),
      (try_end),
      (try_begin),
        (key_clicked, key_right_mouse_button),
        (eq, "$g_lco_dragging", 1),
        (call_script, "script_lco_cancel_drag_item"),
        (eq, "$g_lco_dragging", 0),
        (call_script, "script_lco_fill_hero_panels"),
        (call_script, "script_lco_fill_player_panels"),
        (assign, "$g_lco_panel_found", 1),
      (try_end),
      (try_begin),
        (eq, "$g_lco_dragging", 1),
        (mouse_get_position, pos60),
        (position_get_x, reg10, pos60),
        (position_get_y, reg11, pos60),
        (val_add, reg10, 15),
        (val_sub, reg11, 40),
        (position_set_x, pos60, reg10),
        (position_set_y, pos60, reg11),
        (overlay_set_position, "$g_lco_dragging_panel", pos60),
      (try_end),
      (try_begin),
        (eq, "$g_lco_popup_active", 1),
        (mouse_get_position, pos60),
        (position_get_y, reg11, pos60),
        (val_sub, reg11, 90),
        (position_set_y, pos60, reg11),
        (show_item_details_with_modifier, "$g_lco_popup_item", "$g_lco_popup_modifier", pos60, 100),
      (try_end),
    ]),
    (ti_on_presentation_mouse_enter_leave,
    [
      (store_trigger_param_1, ":var0"),
      (store_trigger_param_2, ":var1"),
      (try_begin),
        (eq, ":var1", 1),
        (try_begin),
          (eq, "$g_lco_popup_overlay", ":var0"),
          (try_begin),
            (eq, "$g_lco_popup_active", 1),
            (assign, "$g_lco_popup_active", 0),
            (close_item_details),
          (try_end),
        (try_end),
      (else_try),
        (call_script, "script_cf_lco_is_active_panel", ":var0"),
        (call_script, "script_lco_get_slot_details_for_panel", ":var0"),
        (try_begin),
          (ge, reg2, 0),
          (assign, "$g_lco_popup_active", 1),
          (assign, "$g_lco_popup_overlay", ":var0"),
          (assign, "$g_lco_popup_item", reg2),
          (assign, "$g_lco_popup_modifier", reg3),
        (else_try),
          (eq, "$g_lco_popup_active", 1),
          (assign, "$g_lco_popup_active", 0),
          (close_item_details),
        (try_end),
      (try_end),
    ]),
  ]),

  ("companions_overview", 0, mesh_lco_background,
  [
    (ti_on_presentation_load,
    [
      (call_script, "script_lco_initialize_presentation"),
      (call_script, "script_lco_create_mesh", "mesh_pic_camp", 0, 0, 1000, 1000),
      (call_script, "script_lco_create_button", "str_lco_i_character", 355, 25, 190, 42),
      (assign, "$g_lco_dialog", reg0),
      (store_mul, ":var0", "$g_lco_heroes", 25),
      (val_add, ":var0", 2),
      (assign, ":var1", 0),
      (try_begin),
        (lt, ":var0", 525),
        (store_sub, ":var1", 525, ":var0"),
      (try_end),
      (store_mul, ":var2", "$g_lco_heroes", 25),
      (val_max, ":var2", 525),
      (val_sub, ":var2", 25),
      (call_script, "script_lco_create_label", "str_lco_i_hero_panel_title", 25, 652, 750, 0),
      (call_script, "script_lco_create_label", "str_lco_i_hero_panel_title", 25, 652, 750, 0),
      (call_script, "script_lco_create_container", 25, 125, 925, 527, 1),
      (assign, "$g_lco_main_container", reg0),
      (try_for_range, ":var3", 0, "$g_lco_heroes"),
        (troop_get_slot, ":var4", "trp_companions_overview", ":var3"),
        (store_add, ":var5", "$g_lco_heroes", ":var3"),
        (troop_set_slot, "trp_companions_overview", ":var5", ":var4"),
        (store_mul, ":var6", ":var3", 25),
        (store_sub, ":var6", ":var2", ":var6"),
        (call_script, "script_lco_create_mesh", "mesh_lco_panel", 0, ":var6", 310, 300),
        (troop_set_slot, "trp_companions_overview", ":var3", reg0),
      (try_end),
      (store_mul, ":var6", "$g_lco_active_hero", 25),
      (store_sub, ":var6", ":var2", ":var6"),
      (call_script, "script_lco_create_mesh", "mesh_lco_panel_down", 0, ":var6", 310, 300),
      (assign, "$g_lco_active_panel", reg0),
      (val_add, ":var2", 1),
      (try_for_range, ":var3", 0, "$g_lco_heroes"),
        (store_add, ":var5", "$g_lco_heroes", ":var3"),
        (troop_get_slot, ":var4", "trp_companions_overview", ":var5"),
        (store_mul, ":var6", ":var3", 25),
        (store_sub, ":var6", ":var2", ":var6"),
        (call_script, "script_lco_troop_name_to_s40", ":var4"),
        (call_script, "script_lco_create_label", "str_lco_s40", 5, ":var6", 750, 0),
      (try_end),
      (call_script, "script_lco_create_container", 225, ":var1", 725, ":var0", 0),
      (assign, "$g_lco_attributes_1", reg0),
      (call_script, "script_lco_create_container", 225, ":var1", 725, ":var0", 0),
      (assign, "$g_lco_attributes_2", reg0),
      (set_container_overlay, "$g_lco_attributes_1"),
      (try_for_range, ":var3", 0, "$g_lco_heroes"),
        (store_add, ":var5", "$g_lco_heroes", ":var3"),
        (troop_get_slot, ":var4", "trp_companions_overview", ":var5"),
        (store_sub, ":var6", "$g_lco_heroes", ":var3"),
        (val_sub, ":var6", 1),
        (val_mul, ":var6", 25),
        (store_add, ":var7", ":var6", 1),
        (call_script, "script_lco_create_mesh", "mesh_lco_panel", 0, ":var6", 353, 300),
        (store_character_level, reg40, ":var4"),
        (call_script, "script_lco_text_label", "str_lco_reg40", 20, ":var7"),
        (troop_get_xp, reg40, ":var4"),
        (call_script, "script_lco_text_label", "str_lco_reg40", 65, ":var7"),
        (call_script, "script_lco_xp_to_next_level", ":var4"),
        (call_script, "script_lco_text_label", "str_lco_reg40", 125, ":var7"),
        (store_troop_health, reg40, ":var4", 1),
        (store_troop_health, reg42, ":var4", 0),
        (store_mul, reg41, reg40, 10000),
        (val_div, reg41, reg42),
        (val_add, reg41, 50),
        (val_div, reg41, 100),
        (call_script, "script_lco_text_label", "str_lco_reg40_41", 180, ":var7"),
        (try_begin),
          (eq, ":var4", "trp_player"),
          (assign, reg40, 100),
        (else_try),
          (call_script, "script_npc_morale", ":var4"),
          (assign, reg40, reg0),
        (try_end),
        (call_script, "script_lco_text_label", "str_lco_reg40", 225, ":var7"),
        (call_script, "script_lco_create_mesh", "mesh_lco_panel", 255, ":var6", 183, 300),
        (store_attribute_level, reg40, ":var4", ca_strength),
        (call_script, "script_lco_text_label", "str_lco_reg40", 275, ":var7"),
        (store_attribute_level, reg40, ":var4", ca_agility),
        (call_script, "script_lco_text_label", "str_lco_reg40", 305, ":var7"),
        (store_attribute_level, reg40, ":var4", ca_intelligence),
        (call_script, "script_lco_text_label", "str_lco_reg40", 335, ":var7"),
        (store_attribute_level, reg40, ":var4", ca_charisma),
        (call_script, "script_lco_text_label", "str_lco_reg40", 365, ":var7"),
        (call_script, "script_lco_create_mesh", "mesh_lco_panel", 390, ":var6", 183, 300),
        (store_skill_level, reg40, "skl_ironflesh", ":var4"),
        (call_script, "script_lco_text_label", "str_lco_reg40", 410, ":var7"),
        (store_skill_level, reg40, "skl_power_strike", ":var4"),
        (call_script, "script_lco_text_label", "str_lco_reg40", 440, ":var7"),
        (store_skill_level, reg40, "skl_power_throw", ":var4"),
        (call_script, "script_lco_text_label", "str_lco_reg40", 470, ":var7"),
        (store_skill_level, reg40, "skl_power_draw", ":var4"),
        (call_script, "script_lco_text_label", "str_lco_reg40", 500, ":var7"),
        (call_script, "script_lco_create_mesh", "mesh_lco_panel", 525, ":var6", 268, 300),
        (store_skill_level, reg40, "skl_weapon_master", ":var4"),
        (call_script, "script_lco_text_label", "str_lco_reg40", 545, ":var7"),
        (store_skill_level, reg40, "skl_shield", ":var4"),
        (call_script, "script_lco_text_label", "str_lco_reg40", 575, ":var7"),
        (store_skill_level, reg40, "skl_athletics", ":var4"),
        (call_script, "script_lco_text_label", "str_lco_reg40", 605, ":var7"),
        (store_skill_level, reg40, "skl_riding", ":var4"),
        (call_script, "script_lco_text_label", "str_lco_reg40", 635, ":var7"),
        (store_skill_level, reg40, "skl_horse_archery", ":var4"),
        (call_script, "script_lco_text_label", "str_lco_reg40", 665, ":var7"),
        (store_skill_level, reg40, "skl_looting", ":var4"),
        (call_script, "script_lco_text_label", "str_lco_reg40", 695, ":var7"),
      (try_end),
      (set_container_overlay, "$g_lco_attributes_2"),
      (try_for_range, ":var3", 0, "$g_lco_heroes"),
        (store_add, ":var5", "$g_lco_heroes", ":var3"),
        (troop_get_slot, ":var4", "trp_companions_overview", ":var5"),
        (store_sub, ":var6", "$g_lco_heroes", ":var3"),
        (val_mul, ":var6", 25),
        (val_sub, ":var6", 25),
        (store_add, ":var7", ":var6", 1),
        (call_script, "script_lco_create_mesh", "mesh_lco_panel", 0, ":var6", 486, 300),
        (store_skill_level, reg40, "skl_trainer", ":var4"),
        (call_script, "script_lco_text_label", "str_lco_reg40", 20, ":var7"),
        (store_skill_level, reg40, "skl_tracking", ":var4"),
        (call_script, "script_lco_text_label", "str_lco_reg40", 50, ":var7"),
        (store_skill_level, reg40, "skl_tactics", ":var4"),
        (call_script, "script_lco_text_label", "str_lco_reg40", 80, ":var7"),
        (store_skill_level, reg40, "skl_pathfinding", ":var4"),
        (call_script, "script_lco_text_label", "str_lco_reg40", 110, ":var7"),
        (store_skill_level, reg40, "skl_spotting", ":var4"),
        (call_script, "script_lco_text_label", "str_lco_reg40", 140, ":var7"),
        (store_skill_level, reg40, "skl_inventory_management", ":var4"),
        (call_script, "script_lco_text_label", "str_lco_reg40", 170, ":var7"),
        (store_skill_level, reg40, "skl_wound_treatment", ":var4"),
        (call_script, "script_lco_text_label", "str_lco_reg40", 200, ":var7"),
        (store_skill_level, reg40, "skl_surgery", ":var4"),
        (call_script, "script_lco_text_label", "str_lco_reg40", 230, ":var7"),
        (store_skill_level, reg40, "skl_first_aid", ":var4"),
        (call_script, "script_lco_text_label", "str_lco_reg40", 260, ":var7"),
        (store_skill_level, reg40, "skl_engineer", ":var4"),
        (call_script, "script_lco_text_label", "str_lco_reg40", 290, ":var7"),
        (store_skill_level, reg40, "skl_persuasion", ":var4"),
        (call_script, "script_lco_text_label", "str_lco_reg40", 320, ":var7"),
        (call_script, "script_lco_create_mesh", "mesh_lco_panel", 350, ":var6", 141, 300),
        (store_skill_level, reg40, "skl_prisoner_management", ":var4"),
        (call_script, "script_lco_text_label", "str_lco_reg40", 370, ":var7"),
        (store_skill_level, reg40, "skl_leadership", ":var4"),
        (call_script, "script_lco_text_label", "str_lco_reg40", 400, ":var7"),
        (store_skill_level, reg40, "skl_trade", ":var4"),
        (call_script, "script_lco_text_label", "str_lco_reg40", 430, ":var7"),
        (call_script, "script_lco_create_mesh", "mesh_lco_panel", 455, ":var6", 353, 300),
        (store_proficiency_level, reg40, ":var4", ca_strength),
        (call_script, "script_lco_text_label", "str_lco_reg40", 480, ":var7"),
        (store_proficiency_level, reg40, ":var4", ca_agility),
        (call_script, "script_lco_text_label", "str_lco_reg40", 520, ":var7"),
        (store_proficiency_level, reg40, ":var4", ca_intelligence),
        (call_script, "script_lco_text_label", "str_lco_reg40", 560, ":var7"),
        (store_proficiency_level, reg40, ":var4", ca_charisma),
        (call_script, "script_lco_text_label", "str_lco_reg40", 600, ":var7"),
        (store_proficiency_level, reg40, ":var4", 4),
        (call_script, "script_lco_text_label", "str_lco_reg40", 640, ":var7"),
        (store_proficiency_level, reg40, ":var4", 5),
        (call_script, "script_lco_text_label", "str_lco_reg40", 680, ":var7"),
      (try_end),
      (set_container_overlay, -1),
      (call_script, "script_lco_create_container", 250, 655, 730, 95, 1),
      (assign, "$g_lco_titles_1", reg0),
      (str_store_string, s0, "str_lco_c_level"),
      (call_script, "script_lco_text_caption", "str_s0", 20, 10),
      (str_store_string, s0, "str_lco_c_xp"),
      (call_script, "script_lco_text_caption", "str_s0", 65, 10),
      (str_store_string, s0, "str_lco_c_xp2next_level"),
      (call_script, "script_lco_text_caption", "str_s0", 125, 10),
      (str_store_string, s0, "str_lco_c_hp"),
      (call_script, "script_lco_text_caption", "str_s0", 180, 10),
      (str_store_string, s0, "str_lco_c_morale"),
      (call_script, "script_lco_text_caption", "str_s0", 225, 10),
      (str_store_string, s0, "str_lco_c_str"),
      (call_script, "script_lco_text_caption", "str_s0", 275, 10),
      (str_store_string, s0, "str_lco_c_agi"),
      (call_script, "script_lco_text_caption", "str_s0", 305, 10),
      (str_store_string, s0, "str_lco_c_int"),
      (call_script, "script_lco_text_caption", "str_s0", 335, 10),
      (str_store_string, s0, "str_lco_c_cha"),
      (call_script, "script_lco_text_caption", "str_s0", 365, 10),
      (str_store_string, s0, "str_lco_c_ironflesh"),
      (call_script, "script_lco_text_caption", "str_s0", 410, 10),
      (str_store_string, s0, "str_lco_c_pstrike"),
      (call_script, "script_lco_text_caption", "str_s0", 440, 10),
      (str_store_string, s0, "str_lco_c_pthrow"),
      (call_script, "script_lco_text_caption", "str_s0", 470, 10),
      (str_store_string, s0, "str_lco_c_pdraw"),
      (call_script, "script_lco_text_caption", "str_s0", 500, 10),
      (str_store_string, s0, "str_lco_c_wmaster"),
      (call_script, "script_lco_text_caption", "str_s0", 545, 10),
      (str_store_string, s0, "str_lco_c_shield"),
      (call_script, "script_lco_text_caption", "str_s0", 575, 10),
      (str_store_string, s0, "str_lco_c_athletics"),
      (call_script, "script_lco_text_caption", "str_s0", 605, 10),
      (str_store_string, s0, "str_lco_c_riding"),
      (call_script, "script_lco_text_caption", "str_s0", 635, 10),
      (str_store_string, s0, "str_lco_c_harchery"),
      (call_script, "script_lco_text_caption", "str_s0", 665, 10),
      (str_store_string, s0, "str_lco_c_looting"),
      (call_script, "script_lco_text_caption", "str_s0", 695, 10),
      (set_container_overlay, -1),
      (call_script, "script_lco_create_container", 250, 655, 730, 95, 1),
      (assign, "$g_lco_titles_2", reg0),
      (str_store_string, s0, "str_lco_c_trainer"),
      (call_script, "script_lco_text_caption", "str_s0", 20, 10),
      (str_store_string, s0, "str_lco_c_tracking"),
      (call_script, "script_lco_text_caption", "str_s0", 50, 10),
      (str_store_string, s0, "str_lco_c_tactics"),
      (call_script, "script_lco_text_caption", "str_s0", 80, 10),
      (str_store_string, s0, "str_lco_c_pathfinding"),
      (call_script, "script_lco_text_caption", "str_s0", 110, 10),
      (str_store_string, s0, "str_lco_c_spotting"),
      (call_script, "script_lco_text_caption", "str_s0", 140, 10),
      (str_store_string, s0, "str_lco_c_invmanage"),
      (call_script, "script_lco_text_caption", "str_s0", 170, 10),
      (str_store_string, s0, "str_lco_c_woundtreat"),
      (call_script, "script_lco_text_caption", "str_s0", 200, 10),
      (str_store_string, s0, "str_lco_c_surgery"),
      (call_script, "script_lco_text_caption", "str_s0", 230, 10),
      (str_store_string, s0, "str_lco_c_firstaid"),
      (call_script, "script_lco_text_caption", "str_s0", 260, 10),
      (str_store_string, s0, "str_lco_c_engineer"),
      (call_script, "script_lco_text_caption", "str_s0", 290, 10),
      (str_store_string, s0, "str_lco_c_persuasion"),
      (call_script, "script_lco_text_caption", "str_s0", 320, 10),
      (str_store_string, s0, "str_lco_c_pmanage"),
      (call_script, "script_lco_text_caption", "str_s0", 370, 10),
      (str_store_string, s0, "str_lco_c_leadership"),
      (call_script, "script_lco_text_caption", "str_s0", 400, 10),
      (str_store_string, s0, "str_lco_c_trade"),
      (call_script, "script_lco_text_caption", "str_s0", 430, 10),
      (str_store_string, s0, "str_lco_c_1hw"),
      (call_script, "script_lco_text_caption", "str_s0", 480, 10),
      (str_store_string, s0, "str_lco_c_2hw"),
      (call_script, "script_lco_text_caption", "str_s0", 520, 10),
      (str_store_string, s0, "str_lco_c_polearms"),
      (call_script, "script_lco_text_caption", "str_s0", 560, 10),
      (str_store_string, s0, "str_lco_c_bows"),
      (call_script, "script_lco_text_caption", "str_s0", 600, 10),
      (str_store_string, s0, "str_lco_c_xbows"),
      (call_script, "script_lco_text_caption", "str_s0", 640, 10),
      (str_store_string, s0, "str_lco_c_throwing"),
      (call_script, "script_lco_text_caption", "str_s0", 680, 10),
      (set_container_overlay, -1),
      (try_begin),
        (eq, "$g_lco_page", 0),
        (overlay_set_display, "$g_lco_titles_1", 1),
        (overlay_set_display, "$g_lco_attributes_1", 1),
        (overlay_set_display, "$g_lco_titles_2", 0),
        (overlay_set_display, "$g_lco_attributes_2", 0),
      (else_try),
        (overlay_set_display, "$g_lco_titles_1", 0),
        (overlay_set_display, "$g_lco_attributes_1", 0),
        (overlay_set_display, "$g_lco_titles_2", 1),
        (overlay_set_display, "$g_lco_attributes_2", 1),
      (try_end),
    ]),
    (ti_on_presentation_event_state_change,
    [
      (store_trigger_param_1, ":var0"),
      (store_trigger_param_2, ":var1"),
      (try_begin),
        (eq, ":var0", "$g_lco_return"),
        (call_script, "script_lco_clear_all_items", "$g_lco_garbage_troop"),
        (assign, "$g_lco_garbage_troop", "trp_companions_discard"),
        (jump_to_menu, "mnu_lco_auto_return"),
        (presentation_set_duration, 0),
      (else_try),
        (eq, ":var0", "$g_lco_dialog"),
        (try_begin),
          (gt, "$g_lco_heroes", 0),
          (store_add, ":var2", "$g_lco_heroes", "$g_lco_active_hero"),
          (troop_get_slot, "$g_lco_target", "trp_companions_overview", ":var2"),
          (assign, "$g_lco_operation", 2),
          (jump_to_menu, "mnu_lco_auto_return"),
          (presentation_set_duration, 0),
        (try_end),
      (else_try),
        (eq, ":var0", "$g_lco_inc_0"),
        (assign, "$g_lco_include_companions", ":var1"),
        (presentation_set_duration, 0),
      (else_try),
        (eq, ":var0", "$g_lco_inc_1"),
        (assign, "$g_lco_include_lords", ":var1"),
        (presentation_set_duration, 0),
      (else_try),
        (eq, ":var0", "$g_lco_inc_2"),
        (assign, "$g_lco_include_regulars", ":var1"),
        (presentation_set_duration, 0),
      (else_try),
        (eq, ":var0", "$g_lco_switch_page_0"),
        (neq, "$g_lco_page", 0),
        (assign, "$g_lco_page", 0),
        (position_set_x, pos60, 25),
        (position_set_y, pos60, 685),
        (overlay_set_position, "$g_lco_selected_page", pos60),
        (overlay_set_display, "$g_lco_titles_1", 1),
        (overlay_set_display, "$g_lco_attributes_1", 1),
        (overlay_set_display, "$g_lco_titles_2", 0),
        (overlay_set_display, "$g_lco_attributes_2", 0),
      (else_try),
        (eq, ":var0", "$g_lco_switch_page_1"),
        (neq, "$g_lco_page", 1),
        (assign, "$g_lco_page", 1),
        (position_set_x, pos60, 55),
        (position_set_y, pos60, 685),
        (overlay_set_position, "$g_lco_selected_page", pos60),
        (overlay_set_display, "$g_lco_titles_1", 0),
        (overlay_set_display, "$g_lco_attributes_1", 0),
        (overlay_set_display, "$g_lco_titles_2", 1),
        (overlay_set_display, "$g_lco_attributes_2", 1),
      (else_try),
        (eq, ":var0", "$g_lco_switch_page_2"),
        (assign, "$g_lco_page", 2),
        (presentation_set_duration, 0),
      (try_end),
    ]),
    (ti_on_presentation_run,
    [
      (try_begin),
        (key_clicked, key_escape),
        (call_script, "script_lco_clear_all_items", "$g_lco_garbage_troop"),
        (assign, "$g_lco_garbage_troop", "trp_companions_discard"),
        (jump_to_menu, "mnu_lco_auto_return"),
        (presentation_set_duration, 0),
      (try_end),
      (try_begin),
        (key_clicked, key_tab),
        (try_begin),
          (this_or_next|key_is_down, key_left_control),
          (key_is_down, key_right_control),
          (assign, "$g_lco_page", 2),
          (presentation_set_duration, 0),
        (else_try),
          (neg|key_is_down, key_left_alt),
          (neg|key_is_down, key_right_alt),
          (val_add, "$g_lco_page", 1),
          (val_mod, "$g_lco_page", 2),
          (try_begin),
            (eq, "$g_lco_page", 0),
            (position_set_x, pos60, 25),
            (position_set_y, pos60, 685),
            (overlay_set_position, "$g_lco_selected_page", pos60),
            (overlay_set_display, "$g_lco_titles_1", 1),
            (overlay_set_display, "$g_lco_attributes_1", 1),
            (overlay_set_display, "$g_lco_titles_2", 0),
            (overlay_set_display, "$g_lco_attributes_2", 0),
          (else_try),
            (position_set_x, pos60, 55),
            (position_set_y, pos60, 685),
            (overlay_set_position, "$g_lco_selected_page", pos60),
            (overlay_set_display, "$g_lco_titles_1", 0),
            (overlay_set_display, "$g_lco_attributes_1", 0),
            (overlay_set_display, "$g_lco_titles_2", 1),
            (overlay_set_display, "$g_lco_attributes_2", 1),
          (try_end),
        (try_end),
      (try_end),
    ]),
    (ti_on_presentation_mouse_press,
    [
      (store_trigger_param_1, ":var0"),
      (store_trigger_param_2, ":var1"),
      (set_fixed_point_multiplier, 1000),
      (try_begin),
        (eq, ":var1", 0),
        (try_begin),
          (try_for_range, ":var2", 0, "$g_lco_heroes"),
            (troop_slot_eq, "trp_companions_overview", ":var2", ":var0"),
            (assign, "$g_lco_active_hero", ":var2"),
            (set_container_overlay, "$g_lco_main_container"),
            (store_mul, ":var3", "$g_lco_active_hero", 25),
            (assign, ":var4", 525),
            (store_mul, ":var5", "$g_lco_heroes", 25),
            (val_max, ":var5", ":var4"),
            (val_sub, ":var5", 25),
            (store_sub, ":var3", ":var5", ":var3"),
            (position_set_x, pos60, 0),
            (position_set_y, pos60, ":var3"),
            (overlay_set_position, "$g_lco_active_panel", pos60),
            (try_begin),
              (this_or_next|key_is_down, key_left_alt),
              (key_is_down, key_right_alt),
              (store_add, ":var6", "$g_lco_heroes", ":var2"),
              (troop_get_slot, "$g_lco_target", "trp_companions_overview", ":var6"),
              (assign, "$g_lco_operation", 2),
              (jump_to_menu, "mnu_lco_auto_return"),
              (presentation_set_duration, 0),
            (try_end),
          (try_end),
        (try_end),
      (try_end),
    ]),
  ]),

  ("deposit_withdraw_money", 0, mesh_pic_bandits,
  [
    (ti_on_presentation_load,
    [
      (set_show_messages, 0),
      (presentation_set_duration, 999999),
      (set_fixed_point_multiplier, 1000),
      (tutorial_message, -1),
      (store_troop_gold, ":var0", "$pool_troop"),
      (store_troop_gold, ":var1", "trp_player"),
      (create_mesh_overlay, reg0, "mesh_message_window"),
      (position_set_x, pos1, 224),
      (position_set_y, pos1, 230),
      (overlay_set_position, reg0, pos1),
      (try_begin),
        (eq, "$pool_troop", "trp_household_possessions"),
        (assign, reg5, 1),
      (else_try),
        (assign, reg5, 0),
      (try_end),
      (assign, reg6, ":var0"),
      (create_text_overlay, reg0, "@{reg6}^money in the {reg5?treasury:chest}", tf_center_justify|tf_vertical_align_center),
      (position_set_x, pos1, 370),
      (position_set_y, pos1, 320),
      (overlay_set_position, reg0, pos1),
      (assign, reg4, ":var1"),
      (create_text_overlay, reg0, "@{reg4}^money in your inventory", tf_center_justify|tf_vertical_align_center),
      (position_set_x, pos1, 630),
      (position_set_y, pos1, 320),
      (overlay_set_position, reg0, pos1),
      (create_combo_button_overlay, "$g_presentation_obj_1"),
      (position_set_x, pos1, 480),
      (position_set_y, pos1, 380),
      (overlay_set_position, "$g_presentation_obj_1", pos1),
      (position_set_x, pos1, 800),
      (position_set_y, pos1, 800),
      (overlay_set_size, "$g_presentation_obj_1", pos1),
      (overlay_add_item, "$g_presentation_obj_1", "@Withdraw"),
      (overlay_add_item, "$g_presentation_obj_1", "@Deposit"),
      (overlay_set_val, "$g_presentation_obj_1", 1),
      (position_set_x, pos1, 600),
      (position_set_y, pos1, 380),
      (val_add, ":var1", 1),
      (create_number_box_overlay, "$g_presentation_obj_2", 0, ":var1"),
      (overlay_set_position, "$g_presentation_obj_2", pos1),
      (overlay_set_val, "$g_presentation_obj_2", 0),
      (overlay_set_display, "$g_presentation_obj_2", 1),
      (val_add, ":var0", 1),
      (create_number_box_overlay, "$g_presentation_obj_3", 0, ":var0"),
      (overlay_set_position, "$g_presentation_obj_3", pos1),
      (overlay_set_val, "$g_presentation_obj_3", 0),
      (overlay_set_display, "$g_presentation_obj_3", 0),
      (create_game_button_overlay, "$g_presentation_obj_5", "str_done"),
      (position_set_x, pos1, 500),
      (position_set_y, pos1, 250),
      (overlay_set_position, "$g_presentation_obj_5", pos1),
    ]),
    (ti_on_presentation_run,
    [
      (try_begin),
        (this_or_next|game_key_clicked, gk_inventory_window),
        (this_or_next|game_key_clicked, gk_character_window),
        (game_key_clicked, gk_action),
        (presentation_set_duration, 0),
      (try_end),
    ]),
    (ti_on_presentation_event_state_change,
    [
      (store_trigger_param_1, ":var0"),
      (store_trigger_param_2, ":var1"),
      (try_begin),
        (eq, ":var0", "$g_presentation_obj_1"),
        (try_begin),
          (eq, ":var1", 1),
          (overlay_set_display, "$g_presentation_obj_2", 1),
          (overlay_set_display, "$g_presentation_obj_3", 0),
        (else_try),
          (overlay_set_display, "$g_presentation_obj_2", 0),
          (overlay_set_display, "$g_presentation_obj_3", 1),
        (try_end),
      (else_try),
        (this_or_next|eq, ":var0", "$g_presentation_obj_2"),
        (eq, ":var0", "$g_presentation_obj_3"),
        (gt, ":var1", 0),
        (try_begin),
          (eq, ":var0", "$g_presentation_obj_2"),
          (troop_remove_gold, "trp_player", ":var1"),
          (troop_add_gold, "$pool_troop", ":var1"),
        (else_try),
          (eq, ":var0", "$g_presentation_obj_3"),
          (troop_remove_gold, "$pool_troop", ":var1"),
          (troop_add_gold, "trp_player", ":var1"),
        (try_end),
        (start_presentation, "prsnt_deposit_withdraw_money"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_5"),
        (set_show_messages, 1),
        (presentation_set_duration, 0),
      (try_end),
    ]),
  ]),

  ("dplmc_auto_sell_options", 0, mesh_load_window,
  [
    (ti_on_presentation_load,
    [
      (presentation_set_duration, 999999),
      (set_fixed_point_multiplier, 1000),
      (create_text_overlay, reg0, "@Sell items automatically when leaving:", tf_vertical_align_center),
      (position_set_x, pos1, 170),
      (position_set_y, pos1, 660),
      (overlay_set_position, reg0, pos1),
      (create_check_box_overlay, "$g_presentation_obj_1", "mesh_checkbox_off", "mesh_checkbox_on"),
      (position_set_x, pos1, 150),
      (position_set_y, pos1, 652),
      (overlay_set_position, "$g_presentation_obj_1", pos1),
      (overlay_set_val, "$g_presentation_obj_1", "$g_dplmc_sell_items_when_leaving"),
      (create_text_overlay, reg0, "@Price limit for auto-sell:", tf_vertical_align_center),
      (position_set_x, pos1, 150),
      (position_set_y, pos1, 610),
      (overlay_set_position, reg0, pos1),
      (create_number_box_overlay, "$g_presentation_obj_2", 10, 10000),
      (position_set_x, pos1, 600),
      (position_set_y, pos1, 596),
      (overlay_set_val, "$g_presentation_obj_2", "$g_dplmc_auto_sell_price_limit"),
      (overlay_set_position, "$g_presentation_obj_2", pos1),
      (create_game_button_overlay, "$g_presentation_obj_3", "str_done"),
      (position_set_x, pos1, 900),
      (position_set_y, pos1, 25),
      (overlay_set_position, "$g_presentation_obj_3", pos1),
      (create_text_overlay, reg0, "@Item types for auto-sell:", tf_vertical_align_center),
      (position_set_x, pos1, 150),
      (position_set_y, pos1, 578),
      (overlay_set_position, reg0, pos1),
      (create_image_button_overlay, "$g_presentation_obj_5", "mesh_drop_button_child", "mesh_drop_button_child_down"),
      (position_set_x, pos1, 160),
      (position_set_y, pos1, 528),
      (overlay_set_position, "$g_presentation_obj_5", pos1),
      (create_text_overlay, reg1, "@Select all", tf_center_justify|tf_vertical_align_center),
      (position_set_x, pos1, 265),
      (position_set_y, pos1, 538),
      (overlay_set_position, reg1, pos1),
      (create_image_button_overlay, "$g_presentation_obj_6", "mesh_drop_button_child", "mesh_drop_button_child_down"),
      (position_set_x, pos1, 385),
      (position_set_y, pos1, 528),
      (overlay_set_position, "$g_presentation_obj_6", pos1),
      (create_text_overlay, reg1, "@Select invert", tf_center_justify|tf_vertical_align_center),
      (position_set_x, pos1, 490),
      (position_set_y, pos1, 538),
      (overlay_set_position, reg1, pos1),
      (assign, ":var0", 160),
      (assign, ":var1", 500),
      (try_for_range, ":var2", 0, 20),
        (store_add, ":var3", 1, ":var2"),
        (neq, ":var3", 11),
        (neq, ":var3", 19),
        (neq, ":var3", 20),
        (position_set_x, pos1, ":var0"),
        (position_set_y, pos1, ":var1"),
        (create_mesh_overlay, reg1, "mesh_drop_button_child"),
        (overlay_set_position, reg1, pos1),
        (store_add, ":var4", ":var0", 120),
        (store_add, ":var5", ":var1", 10),
        (position_set_x, pos1, ":var4"),
        (position_set_y, pos1, ":var5"),
        (store_add, ":var6", "str_dplmc_hero_wpn_slot_horse", ":var2"),
        (str_store_string, s1, ":var6"),
        (create_text_overlay, reg1, "@{s1}", tf_center_justify|tf_vertical_align_center),
        (overlay_set_position, reg1, pos1),
        (store_add, ":var7", ":var0", 0),
        (store_add, ":var8", ":var1", 4),
        (position_set_x, pos1, ":var7"),
        (position_set_y, pos1, ":var8"),
        (create_check_box_overlay, reg1, "mesh_checkbox_off", "mesh_checkbox_on"),
        (overlay_set_position, reg1, pos1),
        (store_add, ":var9", 1, ":var2"),
        (item_get_slot, ":var10", ":var9", 59),
        (store_sub, ":var10", 1, ":var10"),
        (overlay_set_val, reg1, ":var10"),
        (troop_set_slot, "trp_temp_array_b", ":var2", reg1),
        (val_add, ":var0", 225),
        (try_begin),
          (eq, ":var0", 835),
          (assign, ":var0", 160),
          (val_sub, ":var1", 28),
        (try_end),
      (try_end),
    ]),
    (ti_on_presentation_event_state_change,
    [
      (store_trigger_param_1, ":var0"),
      (store_trigger_param_2, ":var1"),
      (try_begin),
        (eq, ":var0", "$g_presentation_obj_1"),
        (assign, "$g_dplmc_sell_items_when_leaving", ":var1"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_2"),
        (assign, "$g_dplmc_auto_sell_price_limit", ":var1"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_3"),
        (presentation_set_duration, 0),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_5"),
        (try_for_range, ":var2", 0, 20),
          (store_add, ":var3", 1, ":var2"),
          (neq, ":var3", 11),
          (neq, ":var3", 19),
          (neq, ":var3", 20),
          (item_set_slot, ":var3", 59, 0),
          (troop_get_slot, ":var4", "trp_temp_array_b", ":var2"),
          (overlay_set_val, ":var4", 1),
        (try_end),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_6"),
        (try_for_range, ":var2", 0, 20),
          (store_add, ":var3", 1, ":var2"),
          (neq, ":var3", 11),
          (neq, ":var3", 19),
          (neq, ":var3", 20),
          (item_get_slot, ":var5", ":var3", 59),
          (val_add, ":var5", 1),
          (val_mod, ":var5", 2),
          (item_set_slot, ":var3", 59, ":var5"),
          (troop_get_slot, ":var4", "trp_temp_array_b", ":var2"),
          (store_sub, ":var6", 1, ":var5"),
          (overlay_set_val, ":var4", ":var6"),
        (try_end),
      (try_end),
      (try_for_range, ":var7", 0, 20),
        (troop_slot_eq, "trp_temp_array_b", ":var7", ":var0"),
        (store_add, ":var8", 1, ":var7"),
        (store_sub, ":var5", 1, ":var1"),
        (item_set_slot, ":var8", 59, ":var5"),
      (try_end),
    ]),
  ]),

  ("dplmc_shopping_list_of_food", 0, mesh_load_window,
  [
    (ti_on_presentation_load,
    [
      (presentation_set_duration, 999999),
      (set_fixed_point_multiplier, 1000),
      (create_game_button_overlay, "$g_presentation_obj_1", "str_done"),
      (position_set_x, pos1, 900),
      (position_set_y, pos1, 25),
      (overlay_set_position, "$g_presentation_obj_1", pos1),
      (create_text_overlay, reg0, "@Buy food automatically when leaving:", tf_vertical_align_center),
      (position_set_x, pos1, 170),
      (position_set_y, pos1, 690),
      (overlay_set_position, reg0, pos1),
      (create_check_box_overlay, "$g_presentation_obj_2", "mesh_checkbox_off", "mesh_checkbox_on"),
      (position_set_x, pos1, 150),
      (position_set_y, pos1, 682),
      (overlay_set_position, "$g_presentation_obj_2", pos1),
      (overlay_set_val, "$g_presentation_obj_2", "$g_dplmc_buy_food_when_leaving"),
      (assign, ":var0", 60),
      (assign, ":var1", 550),
      (try_for_range, ":var2", "itm_wine", "itm_siege_supply"),
        (try_begin),
          (create_mesh_overlay, reg1, "mesh_inv_slot"),
          (position_set_x, pos1, 800),
          (position_set_y, pos1, 800),
          (overlay_set_size, reg1, pos1),
          (position_set_x, pos1, ":var0"),
          (position_set_y, pos1, ":var1"),
          (overlay_set_position, reg1, pos1),
          (create_mesh_overlay, reg1, "mesh_mp_inventory_choose"),
          (position_set_x, pos1, 640),
          (position_set_y, pos1, 640),
          (overlay_set_size, reg1, pos1),
          (position_set_x, pos1, ":var0"),
          (position_set_y, pos1, ":var1"),
          (overlay_set_position, reg1, pos1),
          (troop_set_slot, "trp_temp_array_a", ":var2", reg1),
          (create_mesh_overlay_with_item_id, reg1, ":var2"),
          (position_set_x, pos1, 800),
          (position_set_y, pos1, 800),
          (overlay_set_size, reg1, pos1),
          (store_add, ":var3", ":var0", 40),
          (store_add, ":var4", ":var1", 40),
          (position_set_x, pos1, ":var3"),
          (position_set_y, pos1, ":var4"),
          (overlay_set_position, reg1, pos1),
          (troop_set_slot, "trp_temp_array_b", ":var2", reg1),
          (create_text_overlay, reg1, "@*", tf_center_justify|tf_vertical_align_center),
          (store_add, ":var5", ":var0", 100),
          (store_add, ":var6", ":var1", 40),
          (position_set_x, pos1, ":var5"),
          (position_set_y, pos1, ":var6"),
          (overlay_set_position, reg1, pos1),
          (create_number_box_overlay, reg1, 0, 5),
          (store_add, ":var7", ":var0", 115),
          (store_add, ":var8", ":var1", 30),
          (position_set_x, pos1, ":var7"),
          (position_set_y, pos1, ":var8"),
          (overlay_set_position, reg1, pos1),
          (item_get_slot, ":var9", ":var2", 8),
          (overlay_set_val, reg1, ":var9"),
          (troop_set_slot, "trp_temp_array_c", ":var2", reg1),
          (val_add, ":var0", 240),
          (try_begin),
            (eq, ":var0", 1020),
            (assign, ":var0", 60),
            (val_sub, ":var1", 120),
          (try_end),
        (try_end),
      (try_end),
    ]),
    (ti_on_presentation_mouse_enter_leave,
    [
      (store_trigger_param_1, ":var0"),
      (store_trigger_param_2, ":var1"),
      (try_begin),
        (eq, ":var1", 0),
        (try_begin),
          (is_between, "$current_town", "p_town_1", "p_castle_1"),
          (party_get_slot, ":var2", "$current_town", 23),
        (else_try),
          (is_between, "$current_town", "p_village_1", "p_salt_mine"),
          (party_get_slot, ":var2", "$current_town", 25),
        (else_try),
          (assign, ":var2", -1),
        (try_end),
        (try_for_range, ":var3", "itm_wine", "itm_siege_supply"),
          (troop_slot_eq, "trp_temp_array_a", ":var3", ":var0"),
          (troop_get_slot, ":var4", "trp_temp_array_b", ":var3"),
          (overlay_get_position, 0, ":var4"),
          (try_begin),
            (le, ":var2", 0),
            (show_item_details, ":var3", pos0, 100),
          (else_try),
            (call_script, "script_dplmc_get_item_buy_price_factor", ":var3", "$current_town", "trp_player", ":var2"),
            (show_item_details, ":var3", pos0, reg0),
          (try_end),
          (assign, "$g_current_opened_item_details", ":var3"),
        (try_end),
      (else_try),
        (try_for_range, ":var3", "itm_wine", "itm_siege_supply"),
          (troop_slot_eq, "trp_temp_array_a", ":var3", ":var0"),
          (try_begin),
            (eq, "$g_current_opened_item_details", ":var3"),
            (close_item_details),
          (try_end),
        (try_end),
      (try_end),
    ]),
    (ti_on_presentation_event_state_change,
    [
      (store_trigger_param_1, ":var0"),
      (store_trigger_param_2, ":var1"),
      (try_for_range, ":var2", "itm_wine", "itm_siege_supply"),
        (troop_slot_eq, "trp_temp_array_c", ":var2", ":var0"),
        (item_set_slot, ":var2", 8, ":var1"),
      (try_end),
      (try_begin),
        (eq, ":var0", "$g_presentation_obj_2"),
        (assign, "$g_dplmc_buy_food_when_leaving", ":var1"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_1"),
        (presentation_set_duration, 0),
      (try_end),
    ]),
  ]),

  ("dplmc_autoloot_upgrade_management", 0, mesh_load_window,
  [
    (ti_on_presentation_load,
    [
      (set_fixed_point_multiplier, 1000),
      (presentation_set_duration, 999999),
      (create_game_button_overlay, "$g_presentation_obj_10", "str_done"),
      (position_set_x, pos1, 900),
      (position_set_y, pos1, 25),
      (overlay_set_position, "$g_presentation_obj_10", pos1),
      (create_mesh_overlay_with_tableau_material, reg0, -1, "tableau_troop_note_mesh", "$temp"),
      (position_set_x, pos1, 500),
      (position_set_y, pos1, 500),
      (overlay_set_size, reg0, pos1),
      (position_set_x, pos1, 200),
      (position_set_y, pos1, 560),
      (overlay_set_position, reg0, pos1),
      (str_store_troop_name, s1, "$temp"),
      (store_character_level, reg2, "$temp"),
      (store_troop_health, reg1, "$temp", 1),
      (call_script, "script_dplmc_get_troop_max_hp", "$temp"),
      (str_store_string, s1, "@Name: {s1}^Level: {reg2}^HP: {reg1}/{reg0}"),
      (create_text_overlay, reg1, "@{s1}", tf_double_space),
      (position_set_x, pos1, 380),
      (position_set_y, pos1, 560),
      (overlay_set_position, reg1, pos1),
      (create_text_overlay, reg1, "@Weapon upgrade settings:", tf_center_justify|tf_vertical_align_center),
      (position_set_x, pos1, 445),
      (position_set_y, pos1, 530),
      (overlay_set_position, reg1, pos1),
      (assign, ":var0", 0),
      (try_for_range_backwards, ":var1", 0, 19),
        (this_or_next|is_between, ":var1", 2, 11),
        (this_or_next|is_between, ":var1", 16, 19),
        (eq, ":var1", 0),
        (troop_set_slot, "trp_temp_array_c", ":var0", ":var1"),
        (val_add, ":var0", 1),
      (try_end),
      (call_script, "script_create_wpn_slot_overlay", 0, 450),
      (assign, "$g_presentation_obj_1", reg1),
      (call_script, "script_create_wpn_slot_overlay", 1, 420),
      (assign, "$g_presentation_obj_2", reg1),
      (call_script, "script_create_wpn_slot_overlay", 2, 390),
      (assign, "$g_presentation_obj_3", reg1),
      (call_script, "script_create_wpn_slot_overlay", 3, 360),
      (assign, "$g_presentation_obj_4", reg1),
      (create_combo_label_overlay, "$g_presentation_obj_sliders_1"),
      (overlay_add_item, "$g_presentation_obj_sliders_1", "str_dplmc_none"),
      (position_set_x, pos1, 600),
      (position_set_y, pos1, 420),
      (overlay_set_position, "$g_presentation_obj_sliders_1", pos1),
      (position_set_x, pos1, 800),
      (position_set_y, pos1, 750),
      (overlay_set_size, "$g_presentation_obj_sliders_1", pos1),
      (overlay_set_val, "$g_presentation_obj_sliders_1", 0),
      (position_set_x, pos1, 600),
      (position_set_y, pos1, 360),
      (create_combo_label_overlay, "$g_presentation_obj_sliders_2"),
      (overlay_set_position, "$g_presentation_obj_sliders_2", pos1),
      (position_set_x, pos1, 800),
      (position_set_y, pos1, 750),
      (overlay_set_size, "$g_presentation_obj_sliders_2", pos1),
      (overlay_add_item, "$g_presentation_obj_sliders_2", "str_dplmc_hero_wpn_slot_no_metatype"),
      (overlay_set_val, "$g_presentation_obj_sliders_2", 0),
      (assign, ":var2", -1),
      (assign, ":var3", -1),
      (assign, ":var4", -1),
      (try_begin),
        (neq, "$temp_2", -1),
        (troop_get_slot, ":var2", "$temp", "$temp_2"),
        (store_div, ":var5", ":var2", 1000),
        (store_mod, ":var3", ":var2", 1000),
        (val_mod, ":var2", 100),
        (try_begin),
          (call_script, "script_cf_item_type_has_advanced_autoloot", ":var2"),
          (overlay_add_item, "$g_presentation_obj_sliders_1", "@cut"),
          (overlay_add_item, "$g_presentation_obj_sliders_1", "@pierce"),
          (overlay_add_item, "$g_presentation_obj_sliders_1", "@blunt"),
        (try_end),
        (overlay_set_val, "$g_presentation_obj_sliders_1", ":var5"),
        (create_text_overlay, reg1, "@Damage preference", tf_single_line),
        (position_set_x, pos1, 465),
        (position_set_y, pos1, 450),
        (overlay_set_position, reg1, pos1),
      (else_try),
        (overlay_set_display, "$g_presentation_obj_sliders_1", 0),
      (try_end),
      (position_set_x, pos1, 465),
      (position_set_y, pos1, 390),
      (create_text_overlay, reg1, "@Item meta-type", tf_single_line),
      (overlay_set_position, reg1, pos1),
      (try_begin),
        (eq, ":var2", 4),
        (overlay_add_item, "$g_presentation_obj_sliders_2", "str_dplmc_hero_wpn_slot_lance"),
        (overlay_add_item, "$g_presentation_obj_sliders_2", "str_dplmc_hero_wpn_slot_pikes"),
        (overlay_add_item, "$g_presentation_obj_sliders_2", "str_dplmc_hero_wpn_slot_halberd"),
        (try_begin),
          (eq, ":var3", 104),
          (overlay_set_val, "$g_presentation_obj_sliders_2", 1),
          (assign, ":var4", "mesh_icon_lance"),
        (else_try),
          (eq, ":var3", 204),
          (overlay_set_val, "$g_presentation_obj_sliders_2", 2),
          (assign, ":var4", "mesh_icon_spear"),
        (else_try),
          (eq, ":var3", 304),
          (overlay_set_val, "$g_presentation_obj_sliders_2", 3),
          (assign, ":var4", "mesh_icon_bardiche"),
        (try_end),
      (else_try),
        (eq, ":var2", 3),
        (overlay_add_item, "$g_presentation_obj_sliders_2", "str_dplmc_hero_wpn_slot_morningstar"),
        (try_begin),
          (eq, ":var3", 103),
          (assign, ":var4", "mesh_icon_morningstar"),
          (overlay_set_val, "$g_presentation_obj_sliders_2", 1),
        (try_end),
      (else_try),
        (overlay_set_display, "$g_presentation_obj_sliders_2", 0),
        (overlay_set_display, reg1, 0),
      (try_end),
      (try_begin),
        (neq, ":var4", -1),
        (create_mesh_overlay, "$g_presentation_obj_sliders_2_val", ":var4"),
        (position_set_x, pos1, 560),
        (position_set_y, pos1, 325),
        (overlay_set_position, "$g_presentation_obj_sliders_2_val", pos1),
      (else_try),
        (create_mesh_overlay, "$g_presentation_obj_sliders_2_val", "mesh_white_plane"),
        (overlay_set_alpha, "$g_presentation_obj_sliders_2_val", 0x00),
      (try_end),
      (init_position, pos2),
      (init_position, pos3),
      (assign, ":var6", 75),
      (position_set_y, pos1, 200),
      (position_set_x, pos2, 600),
      (position_set_y, pos2, 600),
      (position_set_x, pos3, 750),
      (position_set_y, pos3, 750),
      (try_for_range, ":var7", 4, 9),
        (assign, ":var8", "mesh_mp_inventory_choose"),
        (try_begin),
          (eq, ":var7", 8),
          (troop_slot_ge, "$temp", 215, 1),
          (assign, ":var8", "mesh_mp_inventory_slot_horse"),
        (else_try),
          (troop_slot_ge, "$temp", 214, 1),
          (try_begin),
            (eq, ":var7", 4),
            (assign, ":var8", "mesh_mp_inventory_slot_helmet"),
          (else_try),
            (eq, ":var7", 5),
            (assign, ":var8", "mesh_mp_inventory_slot_armor"),
          (else_try),
            (eq, ":var7", 6),
            (assign, ":var8", "mesh_mp_inventory_slot_boot"),
          (else_try),
            (eq, ":var7", 7),
            (assign, ":var8", "mesh_mp_inventory_slot_glove"),
          (try_end),
        (try_end),
        (create_mesh_overlay, reg1, ":var8"),
        (position_set_x, pos1, ":var6"),
        (position_set_y, pos1, 200),
        (overlay_set_position, reg1, pos1),
        (overlay_set_size, reg1, pos2),
        (overlay_set_alpha, reg1, 0x99),
        (try_begin),
          (troop_get_inventory_slot, ":var9", "$temp", ":var7"),
          (gt, ":var9", 0),
          (create_mesh_overlay_with_item_id, reg1, ":var9"),
          (store_add, ":var10", ":var6", 37),
          (position_set_x, pos1, ":var10"),
          (position_set_y, pos1, 237),
          (overlay_set_position, reg1, pos1),
          (overlay_set_size, reg1, pos3),
          (troop_set_slot, "trp_stack_selection_ids", ":var7", reg1),
        (try_end),
        (val_add, ":var6", 75),
      (try_end),
      (position_set_x, pos1, 1000),
      (position_set_y, pos1, 800),
      (overlay_set_size, "$g_presentation_obj_1", pos1),
      (overlay_set_size, "$g_presentation_obj_2", pos1),
      (overlay_set_size, "$g_presentation_obj_3", pos1),
      (overlay_set_size, "$g_presentation_obj_4", pos1),
      (position_set_x, pos1, 128),
      (position_set_y, pos1, 310),
      (create_image_button_overlay, "$g_presentation_obj_11", "mesh_longer_button", "mesh_longer_button_down"),
      (overlay_set_position, "$g_presentation_obj_11", pos1),
      (position_set_x, pos1, 270),
      (position_set_y, pos1, 325),
      (create_text_overlay, reg1, "@Apply to everyone", tf_center_justify|tf_vertical_align_center),
      (overlay_set_position, reg1, pos1),
      (position_set_x, pos1, 300),
      (position_set_y, pos1, 155),
      (create_text_overlay, reg1, "@Upgrade armor", tf_center_justify|tf_vertical_align_center),
      (overlay_set_position, reg1, pos1),
      (position_set_y, pos1, 105),
      (create_text_overlay, reg1, "@Upgrade horse", tf_center_justify|tf_vertical_align_center),
      (overlay_set_position, reg1, pos1),
      (position_set_x, pos1, 180),
      (position_set_y, pos1, 148),
      (create_check_box_overlay, "$g_presentation_obj_13", "mesh_checkbox_off", "mesh_checkbox_on"),
      (overlay_set_position, "$g_presentation_obj_13", pos1),
      (troop_get_slot, ":var11", "$temp", 214),
      (overlay_set_val, "$g_presentation_obj_13", ":var11"),
      (position_set_y, pos1, 98),
      (create_check_box_overlay, "$g_presentation_obj_14", "mesh_checkbox_off", "mesh_checkbox_on"),
      (overlay_set_position, "$g_presentation_obj_14", pos1),
      (troop_get_slot, ":var12", "$temp", 215),
      (overlay_set_val, "$g_presentation_obj_14", ":var12"),
      (position_set_x, pos1, 418),
      (position_set_y, pos1, 140),
      (create_image_button_overlay, "$g_presentation_obj_15", "mesh_longer_button", "mesh_longer_button_down"),
      (overlay_set_position, "$g_presentation_obj_15", pos1),
      (position_set_y, pos1, 90),
      (create_image_button_overlay, "$g_presentation_obj_16", "mesh_longer_button", "mesh_longer_button_down"),
      (overlay_set_position, "$g_presentation_obj_16", pos1),
      (position_set_x, pos1, 560),
      (position_set_y, pos1, 155),
      (create_text_overlay, reg1, "@Apply to everyone", tf_center_justify|tf_vertical_align_center),
      (overlay_set_position, reg1, pos1),
      (position_set_y, pos1, 105),
      (create_text_overlay, reg1, "@Apply to everyone", tf_center_justify|tf_vertical_align_center),
      (overlay_set_position, reg1, pos1),
      (assign, ":var13", 900),
      (assign, ":var14", 600),
      (assign, ":var15", 0),
      (party_get_num_companion_stacks, ":var16", "p_main_party"),
      (try_for_range, ":var17", 1, ":var16"),
        (party_stack_get_troop_id, ":var18", "p_main_party", ":var17"),
        (call_script, "script_cf_troop_can_autoloot", ":var18"),
        (str_store_troop_name, s1, ":var18"),
        (position_set_x, pos1, ":var13"),
        (position_set_y, pos1, ":var14"),
        (val_sub, ":var14", 30),
        (create_button_overlay, reg0, s1, tf_center_justify|tf_vertical_align_center),
        (overlay_set_position, reg0, pos1),
        (assign, ":var19", ":var15"),
        (troop_set_slot, "trp_temp_array_a", ":var19", reg0),
        (troop_set_slot, "trp_temp_array_b", ":var19", ":var18"),
        (val_add, ":var15", 1),
      (try_end),
    ]),
    (ti_on_presentation_mouse_enter_leave,
    [
      (store_trigger_param_1, ":var0"),
      (store_trigger_param_2, ":var1"),
      (try_for_range, ":var2", 0, 9),
        (troop_slot_eq, "trp_stack_selection_ids", ":var2", ":var0"),
        (try_begin),
          (eq, ":var1", 0),
          (troop_get_inventory_slot, ":var3", "$temp", ":var2"),
          (gt, ":var3", -1),
          (troop_get_inventory_slot_modifier, ":var4", "$temp", ":var2"),
          (set_fixed_point_multiplier, 1000),
          (position_set_x, pos1, 560),
          (position_set_y, pos1, 310),
          (show_item_details_with_modifier, ":var3", ":var4", pos1, 100),
        (else_try),
          (eq, ":var1", 1),
          (close_item_details),
        (try_end),
      (try_end),
    ]),
    (ti_on_presentation_event_state_change,
    [
      (store_trigger_param_1, ":var0"),
      (store_trigger_param_2, ":var1"),
      (try_begin),
        (eq, ":var0", "$g_presentation_obj_1"),
        (call_script, "script_update_wpn_slot_itp", 216, ":var1"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_2"),
        (call_script, "script_update_wpn_slot_itp", 217, ":var1"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_3"),
        (call_script, "script_update_wpn_slot_itp", 218, ":var1"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_4"),
        (call_script, "script_update_wpn_slot_itp", 219, ":var1"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_10"),
        (presentation_set_duration, 0),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_11"),
        (call_script, "script_dplmc_copy_upgrade_to_all_heroes", "$temp", 1),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_13"),
        (troop_set_slot, "$temp", 214, ":var1"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_14"),
        (troop_set_slot, "$temp", 215, ":var1"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_15"),
        (call_script, "script_dplmc_copy_upgrade_to_all_heroes", "$temp", 3),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_16"),
        (call_script, "script_dplmc_copy_upgrade_to_all_heroes", "$temp", 4),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_sliders_1"),
        (is_between, "$temp_2", 216, 220),
        (store_mul, ":var2", ":var1", 1000),
        (troop_get_slot, ":var3", "$temp", "$temp_2"),
        (val_mod, ":var3", 1000),
        (val_add, ":var2", ":var3"),
        (troop_set_slot, "$temp", "$temp_2", ":var2"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_sliders_2"),
        (is_between, "$temp_2", 216, 220),
        (store_mul, ":var2", ":var1", 100),
        (troop_get_slot, ":var3", "$temp", "$temp_2"),
        (store_mod, ":var4", ":var3", 100),
        (call_script, "script_cf_item_type_has_advanced_autoloot", ":var4"),
        (val_add, ":var2", ":var4"),
        (overlay_set_alpha, "$g_presentation_obj_sliders_2_val", 0x00),
        (try_begin),
          (eq, ":var2", 103),
          (assign, ":var5", "mesh_icon_morningstar"),
        (else_try),
          (this_or_next|eq, ":var2", 104),
          (this_or_next|eq, ":var2", 204),
          (eq, ":var2", 304),
          (store_add, ":var5", "mesh_icon_morningstar", ":var1"),
        (else_try),
          (assign, ":var5", -1),
        (try_end),
        (val_div, ":var3", 1000),
        (val_mul, ":var3", 1000),
        (val_add, ":var2", ":var3"),
        (troop_set_slot, "$temp", "$temp_2", ":var2"),
        (try_begin),
          (gt, ":var5", 0),
          (set_fixed_point_multiplier, 1000),
          (create_mesh_overlay, reg1, ":var5"),
          (position_set_x, pos1, 560),
          (position_set_y, pos1, 325),
          (overlay_set_position, reg1, pos1),
          (assign, "$g_presentation_obj_sliders_2_val", reg1),
        (try_end),
      (try_end),
      (assign, ":var6", 0),
      (party_get_num_companion_stacks, ":var7", "p_main_party"),
      (try_for_range, ":var8", 1, ":var7"),
        (party_stack_get_troop_id, ":var9", "p_main_party", ":var8"),
        (troop_is_hero, ":var9"),
        (call_script, "script_cf_troop_can_autoloot", ":var9"),
        (assign, ":var10", ":var6"),
        (val_add, ":var6", 1),
        (troop_slot_eq, "trp_temp_array_a", ":var10", ":var0"),
        (troop_get_slot, ":var11", "trp_temp_array_b", ":var10"),
        (assign, "$lord_selected", ":var11"),
        (assign, "$temp", ":var11"),
        (set_player_troop, ":var11"),
        (start_presentation, "prsnt_dplmc_autoloot_upgrade_management"),
      (try_end),
    ]),
  ]),

  ("dplmc_policy_management", 0, mesh_load_window,
  [
    (ti_on_presentation_load,
    [
      (set_fixed_point_multiplier, 1000),
      (presentation_set_duration, 999999),
      (faction_get_slot, ":var0", "fac_player_supporters_faction", 241),
      (faction_get_slot, ":var1", "fac_player_supporters_faction", 242),
      (faction_get_slot, ":var2", "fac_player_supporters_faction", 243),
      (faction_get_slot, ":var3", "fac_player_supporters_faction", 244),
      (faction_get_slot, ":var4", "fac_player_supporters_faction", 244),
      (create_game_button_overlay, "$g_presentation_obj_12", "str_done"),
      (position_set_x, pos1, 900),
      (position_set_y, pos1, 25),
      (overlay_set_position, "$g_presentation_obj_12", pos1),
      (create_game_button_overlay, "$g_presentation_obj_11", "str_randomize"),
      (position_set_x, pos1, 900),
      (position_set_y, pos1, 125),
      (overlay_set_position, "$g_presentation_obj_11", pos1),
      (create_text_overlay, reg1, "@Select your domestic policy", tf_center_justify|tf_vertical_align_center),
      (position_set_x, pos1, 445),
      (position_set_y, pos1, 700),
      (overlay_set_position, reg1, pos1),
      (create_slider_overlay, "$g_presentation_obj_sliders_1", -3, 3),
      (create_slider_overlay, "$g_presentation_obj_sliders_2", -3, 3),
      (create_slider_overlay, "$g_presentation_obj_sliders_3", -3, 3),
      (create_slider_overlay, "$g_presentation_obj_sliders_4", -3, 3),
      (create_slider_overlay, "$g_presentation_obj_sliders_5", -3, 3),
      (assign, reg1, 25),
      (store_add, ":var5", "str_dplmc_neither_centralize_nor_decentralized", ":var0"),
      (create_text_overlay, "$g_presentation_obj_sliders_6", ":var5"),
      (store_add, ":var5", "str_dplmc_neither_aristocratic_nor_plutocratic", ":var1"),
      (create_text_overlay, "$g_presentation_obj_sliders_7", ":var5"),
      (store_add, ":var5", "str_dplmc_mixture_serfs", ":var2"),
      (create_text_overlay, "$g_presentation_obj_sliders_8", ":var5"),
      (store_add, ":var5", "str_dplmc_mediocre_quality", ":var3"),
      (create_text_overlay, "$g_presentation_obj_sliders_9", ":var5"),
      (store_add, ":var5", "str_dplmc_neither_mercantilist_nor_laissez_faire", ":var4"),
      (create_text_overlay, "$g_presentation_obj_sliders_10", ":var5"),
      (create_text_overlay, "$g_presentation_obj_1", "@Centralization:"),
      (create_text_overlay, "$g_presentation_obj_2", "@Aristocracy:"),
      (create_text_overlay, "$g_presentation_obj_3", "@Serfdom:"),
      (create_text_overlay, "$g_presentation_obj_4", "@Troop quality:"),
      (create_text_overlay, "$g_presentation_obj_5", "@Mercantilism:"),
      (create_text_overlay, "$g_presentation_obj_6", "@High centralization reduces tax inefficiency for the king and raises it for vassals. This will interfere with relations between ruler and vassals."),
      (create_text_overlay, "$g_presentation_obj_7", "@High aristocracy will improve the relations between the king and his vassals who will be able to raise bigger armies but it will decreased trade."),
      (create_text_overlay, "$g_presentation_obj_8", "@High serfdom reduces tax inefficiency for the king and his vassals and vassals can maintain bigger armies but troops lose morale."),
      (create_text_overlay, "$g_presentation_obj_9", "@High troop quality increases the combat strength of troops but decreases army size."),
      (create_text_overlay, "$g_presentation_obj_10", "@High mercantilistic policies maximize exports while minimizing imports, and increase government regulation of industry."),
      (overlay_set_val, "$g_presentation_obj_sliders_1", ":var0"),
      (overlay_set_val, "$g_presentation_obj_sliders_2", ":var1"),
      (overlay_set_val, "$g_presentation_obj_sliders_3", ":var2"),
      (overlay_set_val, "$g_presentation_obj_sliders_4", ":var3"),
      (overlay_set_val, "$g_presentation_obj_sliders_5", ":var4"),
      (position_set_x, pos1, 200),
      (position_set_y, pos1, 575),
      (overlay_set_position, "$g_presentation_obj_sliders_1", pos1),
      (position_set_y, pos1, 450),
      (overlay_set_position, "$g_presentation_obj_sliders_2", pos1),
      (position_set_y, pos1, 325),
      (overlay_set_position, "$g_presentation_obj_sliders_3", pos1),
      (position_set_y, pos1, 200),
      (overlay_set_position, "$g_presentation_obj_sliders_4", pos1),
      (position_set_y, pos1, 75),
      (overlay_set_position, "$g_presentation_obj_sliders_5", pos1),
      (position_set_x, pos1, 100),
      (position_set_y, pos1, 625),
      (overlay_set_position, "$g_presentation_obj_1", pos1),
      (position_set_y, pos1, 500),
      (overlay_set_position, "$g_presentation_obj_2", pos1),
      (position_set_y, pos1, 375),
      (overlay_set_position, "$g_presentation_obj_3", pos1),
      (position_set_y, pos1, 250),
      (overlay_set_position, "$g_presentation_obj_4", pos1),
      (position_set_y, pos1, 125),
      (overlay_set_position, "$g_presentation_obj_5", pos1),
      (position_set_x, pos1, 50),
      (position_set_y, pos1, 550),
      (overlay_set_position, "$g_presentation_obj_6", pos1),
      (position_set_y, pos1, 425),
      (overlay_set_position, "$g_presentation_obj_7", pos1),
      (position_set_y, pos1, 300),
      (overlay_set_position, "$g_presentation_obj_8", pos1),
      (position_set_y, pos1, 175),
      (overlay_set_position, "$g_presentation_obj_9", pos1),
      (position_set_y, pos1, 50),
      (overlay_set_position, "$g_presentation_obj_10", pos1),
      (position_set_x, pos1, 775),
      (position_set_y, pos1, 775),
      (overlay_set_size, "$g_presentation_obj_6", pos1),
      (overlay_set_size, "$g_presentation_obj_7", pos1),
      (overlay_set_size, "$g_presentation_obj_8", pos1),
      (overlay_set_size, "$g_presentation_obj_9", pos1),
      (overlay_set_size, "$g_presentation_obj_10", pos1),
      (position_set_x, pos1, 400),
      (position_set_y, pos1, 575),
      (overlay_set_position, "$g_presentation_obj_sliders_6", pos1),
      (position_set_y, pos1, 450),
      (overlay_set_position, "$g_presentation_obj_sliders_7", pos1),
      (position_set_y, pos1, 325),
      (overlay_set_position, "$g_presentation_obj_sliders_8", pos1),
      (position_set_y, pos1, 200),
      (overlay_set_position, "$g_presentation_obj_sliders_9", pos1),
      (position_set_y, pos1, 75),
      (overlay_set_position, "$g_presentation_obj_sliders_10", pos1),
      (position_set_x, pos1, 925),
      (position_set_y, pos1, 925),
      (overlay_set_size, "$g_presentation_obj_sliders_6", pos1),
      (overlay_set_size, "$g_presentation_obj_sliders_7", pos1),
      (overlay_set_size, "$g_presentation_obj_sliders_8", pos1),
      (overlay_set_size, "$g_presentation_obj_sliders_9", pos1),
      (overlay_set_size, "$g_presentation_obj_sliders_10", pos1),
    ]),
    (ti_on_presentation_event_state_change,
    [
      (store_trigger_param_1, ":var0"),
      (store_trigger_param_2, ":var1"),
      (try_begin),
        (eq, ":var0", "$g_presentation_obj_sliders_1"),
        (faction_set_slot, "fac_player_supporters_faction", 241, ":var1"),
        (val_add, ":var1", "str_dplmc_neither_centralize_nor_decentralized"),
        (overlay_set_text, "$g_presentation_obj_sliders_6", ":var1"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_sliders_2"),
        (faction_set_slot, "fac_player_supporters_faction", 242, ":var1"),
        (val_add, ":var1", "str_dplmc_neither_aristocratic_nor_plutocratic"),
        (overlay_set_text, "$g_presentation_obj_sliders_7", ":var1"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_sliders_3"),
        (faction_set_slot, "fac_player_supporters_faction", 243, ":var1"),
        (val_add, ":var1", "str_dplmc_mixture_serfs"),
        (overlay_set_text, "$g_presentation_obj_sliders_8", ":var1"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_sliders_4"),
        (faction_set_slot, "fac_player_supporters_faction", 244, ":var1"),
        (val_add, ":var1", "str_dplmc_mediocre_quality"),
        (overlay_set_text, "$g_presentation_obj_sliders_9", ":var1"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_sliders_5"),
        (faction_set_slot, "fac_player_supporters_faction", 246, ":var1"),
        (val_add, ":var1", "str_dplmc_neither_mercantilist_nor_laissez_faire"),
        (overlay_set_text, "$g_presentation_obj_sliders_10", ":var1"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_12"),
        (assign, "$g_players_policy_set", 1),
        (presentation_set_duration, 0),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_11"),
        (call_script, "script_dplmc_randomize_faction_domestic_policy", "fac_player_supporters_faction"),
        (start_presentation, "prsnt_dplmc_policy_management"),
      (try_end),
    ]),
  ]),

  ("dplmc_peace_terms", 0, mesh_load_window,
  [
    (ti_on_presentation_load,
    [
      (set_fixed_point_multiplier, 1000),
      (presentation_set_duration, 999999),
      (create_game_button_overlay, "$g_presentation_obj_10", "str_done"),
      (position_set_x, pos1, 900),
      (position_set_y, pos1, 25),
      (overlay_set_position, "$g_presentation_obj_10", pos1),
      (create_game_button_overlay, "$g_presentation_obj_9", "@Cancel"),
      (position_set_x, pos1, 100),
      (overlay_set_position, "$g_presentation_obj_9", pos1),
      (create_text_overlay, reg1, "@Dictate the peace terms", tf_center_justify|tf_vertical_align_center),
      (position_set_x, pos1, 445),
      (position_set_y, pos1, 700),
      (overlay_set_position, reg1, pos1),
      (position_set_y, pos1, 550),
      (create_text_overlay, "$g_presentation_obj_2", "@Select the castle and the amount of money and check the boxes to activate the demand. The demands are combined if both boxes are checked."),
      (position_set_x, pos1, 50),
      (overlay_set_position, "$g_presentation_obj_2", pos1),
      (create_slider_overlay, "$g_presentation_obj_sliders_1", 1, 10),
      (overlay_set_val, "$g_presentation_obj_sliders_1", 1),
      (position_set_x, pos1, 300),
      (position_set_y, pos1, 350),
      (overlay_set_position, "$g_presentation_obj_sliders_1", pos1),
      (assign, "$demanded_money", 1000),
      (assign, "$diplomacy_var", 1),
      (create_text_overlay, "$g_presentation_obj_sliders_2", "@1000 denars"),
      (position_set_x, pos1, 500),
      (overlay_set_position, "$g_presentation_obj_sliders_2", pos1),
      (create_check_box_overlay, "$g_presentation_obj_battle_check0", "mesh_checkbox_off", "mesh_checkbox_on"),
      (position_set_x, pos1, 700),
      (overlay_set_position, "$g_presentation_obj_battle_check0", pos1),
      (overlay_set_val, "$g_presentation_obj_battle_check0", 1),
      (assign, "$demanded_castle", 0),
      (assign, ":var0", 0),
      (create_combo_button_overlay, "$g_presentation_obj_1"),
      (try_for_range, ":var1", "p_castle_1", "p_village_1"),
        (party_slot_eq, ":var1", 0, 2),
        (store_faction_of_party, ":var2", ":var1"),
        (eq, ":var2", "$g_notification_menu_var1"),
        (str_store_party_name, s2, ":var1"),
        (overlay_add_item, "$g_presentation_obj_1", s2),
        (assign, "$demanded_castle", ":var1"),
        (val_add, ":var0", 1),
      (try_end),
      (assign, "$diplomacy_var2", 0),
      (position_set_x, pos1, 300),
      (position_set_y, pos1, 250),
      (overlay_set_position, "$g_presentation_obj_1", pos1),
      (overlay_set_val, "$g_presentation_obj_1", ":var0"),
      (create_check_box_overlay, "$g_presentation_obj_battle_check1", "mesh_checkbox_off", "mesh_checkbox_on"),
      (position_set_x, pos1, 700),
      (overlay_set_position, "$g_presentation_obj_battle_check1", pos1),
    ]),
    (ti_on_presentation_run,
    [
    ]),
    (ti_on_presentation_event_state_change,
    [
      (store_trigger_param_1, ":var0"),
      (store_trigger_param_2, ":var1"),
      (try_begin),
        (eq, ":var0", "$g_presentation_obj_1"),
        (assign, ":var2", 0),
        (try_for_range, ":var3", "p_castle_1", "p_village_1"),
          (store_faction_of_party, ":var4", ":var3"),
          (eq, ":var4", "$g_notification_menu_var1"),
          (try_begin),
            (eq, ":var2", ":var1"),
            (assign, "$demanded_castle", ":var3"),
          (try_end),
          (val_add, ":var2", 1),
        (try_end),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_battle_check0"),
        (assign, "$diplomacy_var", ":var1"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_battle_check1"),
        (assign, "$diplomacy_var2", ":var1"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_sliders_1"),
        (store_mul, "$demanded_money", ":var1", 1000),
        (assign, reg1, "$demanded_money"),
        (overlay_set_text, "$g_presentation_obj_sliders_2", "str_reg1_denars"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_9"),
        (presentation_set_duration, 0),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_10"),
        (presentation_set_duration, 0),
        (try_begin),
          (eq, "$diplomacy_var", 0),
          (assign, "$demanded_money", 0),
        (try_end),
        (try_begin),
          (eq, "$diplomacy_var2", 0),
          (assign, "$demanded_castle", 0),
        (try_end),
        (assign, ":var5", 0),
        (try_begin),
          (gt, "$demanded_money", 0),
          (store_div, ":var5", "$demanded_money", 1000),
        (try_end),
        (assign, ":var6", "$g_notification_menu_var1"),
        (assign, ":var7", "fac_player_supporters_faction"),
        (try_begin),
          (neg|faction_slot_eq, ":var7", 21, 0),
          (is_between, "$players_kingdom", "fac_kingdom_1", "fac_kingdoms_end"),
          (assign, ":var7", "$players_kingdom"),
        (try_end),
        (assign, ":var8", 0),
        (assign, ":var9", 0),
        (assign, ":var10", 100),
        (try_begin),
          (is_between, "$demanded_castle", "p_castle_1", "p_village_1"),
          (try_begin),
            (neg|party_slot_eq, "$demanded_castle", 583, 0),
            (store_current_hours, ":var11"),
            (party_get_slot, reg0, "$demanded_castle", 583),
            (val_sub, ":var11", reg0),
            (try_begin),
              (lt, ":var11", 744),
              (assign, ":var8", 1),
            (else_try),
              (neg|party_slot_eq, "$demanded_castle", 61, ":var6"),
              (lt, ":var11", 2184),
              (assign, ":var8", 1),
            (else_try),
              (assign, ":var8", 0),
            (try_end),
          (else_try),
            (this_or_next|party_slot_eq, "$demanded_castle", 61, "$players_kingdom"),
            (this_or_next|party_slot_eq, "$demanded_castle", 62, "$players_kingdom"),
            (party_slot_eq, "$demanded_castle", 62, "fac_player_supporters_faction"),
            (assign, ":var8", 1),
          (else_try),
            (neg|party_slot_eq, "$demanded_castle", 61, ":var6"),
            (party_get_slot, ":var12", "$demanded_castle", 61),
            (is_between, ":var12", "fac_player_supporters_faction", "fac_kingdoms_end"),
            (faction_slot_eq, ":var12", 21, 0),
            (store_relation, reg0, ":var6", ":var12"),
            (lt, reg0, 0),
            (assign, ":var8", 1),
          (else_try),
            (neg|party_slot_eq, "$demanded_castle", 62, ":var6"),
            (party_get_slot, ":var12", "$demanded_castle", 62),
            (is_between, ":var12", "fac_player_supporters_faction", "fac_kingdoms_end"),
            (faction_slot_eq, ":var12", 21, 0),
            (store_relation, reg0, ":var6", ":var12"),
            (lt, reg0, 0),
            (assign, ":var8", 1),
          (else_try),
            (neg|party_slot_ge, "$demanded_castle", 7, 0),
            (assign, ":var8", 1),
          (try_end),
          (party_slot_ge, "$demanded_castle", 7, 1),
          (party_get_slot, ":var13", "$demanded_castle", 7),
          (assign, ":var14", -1),
          (assign, ":var9", 1),
          (assign, ":var15", 10000),
          (assign, ":var16", 10000),
          (try_for_range, ":var17", "p_town_1", "p_salt_mine"),
            (neq, ":var17", "$demanded_castle"),
            (try_begin),
              (party_slot_eq, ":var17", 120, "$demanded_castle"),
              (neg|party_slot_eq, ":var17", 7, ":var13"),
              (party_slot_ge, ":var17", 7, 1),
              (party_get_slot, ":var14", ":var17", 7),
            (else_try),
              (party_slot_eq, ":var17", 7, ":var13"),
              (neg|party_slot_eq, ":var17", 120, "$demanded_castle"),
              (assign, ":var9", 0),
            (try_end),
            (this_or_next|party_slot_eq, ":var17", 0, 3),
            (this_or_next|party_slot_eq, ":var17", 0, 2),
            (store_faction_of_party, ":var18", ":var17"),
            (store_distance_to_party_from_party, ":var19", ":var17", "$demanded_castle"),
            (call_script, "script_dplmc_get_faction_truce_length_with_faction", ":var18", ":var6"),
            (try_begin),
              (this_or_next|gt, reg0, 40),
              (eq, ":var18", ":var6"),
              (val_min, ":var15", ":var19"),
            (else_try),
              (store_relation, reg0, ":var18", ":var6"),
              (val_min, ":var16", ":var19"),
            (try_end),
          (try_end),
          (assign, ":var10", 100),
          (try_begin),
            (this_or_next|ge, ":var15", 10000),
            (ge, ":var16", 10000),
          (else_try),
            (lt, ":var15", ":var16"),
            (gt, ":var16", 25),
            (val_max, ":var15", 1),
            (store_mul, ":var10", ":var16", 100),
            (val_div, ":var10", ":var15"),
            (try_begin),
              (le, ":var16", 50),
              (val_min, ":var10", 200),
            (try_end),
          (else_try),
            (lt, ":var16", ":var15"),
            (gt, ":var15", 25),
            (val_max, ":var16", 1),
            (store_mul, ":var10", ":var15", 100),
            (val_div, ":var10", ":var16"),
            (try_begin),
              (le, ":var15", 50),
              (val_min, ":var10", 200),
            (try_end),
            (val_mul, ":var10", -1),
          (try_end),
          (neq, ":var9", 1),
          (ge, ":var14", 1),
          (assign, ":var9", 1),
          (try_for_range, ":var17", "p_town_1", "p_salt_mine"),
            (party_slot_eq, ":var17", 7, ":var14"),
            (neg|this_or_next|is_between, ":var17", "p_village_1", "p_salt_mine"),
            (neg|party_slot_eq, ":var17", 120, "$demanded_castle"),
            (assign, ":var9", 0),
          (try_end),
        (try_end),
        (assign, ":var20", 100),
        (assign, ":var21", 150),
        (try_begin),
          (is_between, "$demanded_castle", "p_castle_1", "p_village_1"),
          (assign, ":var22", 0),
          (assign, ":var21", 0),
          (try_for_range, ":var17", "p_castle_1", "p_village_1"),
            (try_begin),
              (eq, "$g_dplmc_terrain_advantage", 0),
              (call_script, "script_dplmc_party_calculate_strength_in_terrain", ":var17", -2, 0, 1),
              (assign, reg0, reg1),
            (else_try),
              (call_script, "script_party_calculate_strength", ":var17", -2, 0),
            (try_end),
            (val_max, reg0, 250),
            (val_add, ":var22", reg0),
            (val_max, ":var21", reg0),
            (eq, ":var17", "$demanded_castle"),
            (assign, ":var20", reg0),
          (try_end),
          (try_begin),
            (gt, "p_village_1", "p_castle_1"),
            (store_sub, reg0, "p_village_1", "p_castle_1"),
            (val_div, ":var22", reg0),
          (try_end),
          (val_max, ":var22", 300),
          (val_mul, ":var20", 100),
          (val_mul, ":var21", 100),
          (store_div, reg0, ":var22", 2),
          (val_add, ":var20", reg0),
          (val_add, ":var21", reg0),
          (val_div, ":var20", ":var22"),
          (val_div, ":var21", ":var22"),
          (assign, reg0, ":var20"),
          (val_max, reg0, 100),
          (val_mul, reg0, 12),
          (val_add, reg0, 50),
          (val_div, reg0, 100),
          (val_add, ":var5", reg0),
          (val_sub, ":var21", 100),
          (val_div, ":var21", 2),
          (val_add, ":var21", 100),
          (val_clamp, ":var21", 110, 400),
        (try_end),
        (call_script, "script_npc_decision_checklist_peace_or_war", "$g_notification_menu_var1", ":var7", -1),
        (assign, ":var23", reg0),
        (assign, ":var24", reg0),
        (val_mul, ":var24", 2),
        (store_random_in_range, ":var25", 0, ":var5"),
        (val_div, ":var5", -2),
        (call_script, "script_change_player_relation_with_faction", "$g_notification_menu_var1", ":var5"),
        (assign, ":var26", 0),
        (try_for_range, ":var12", "fac_player_supporters_faction", "fac_kingdoms_end"),
          (faction_slot_eq, ":var12", 21, 0),
          (neq, ":var12", ":var6"),
          (neq, ":var12", "fac_player_supporters_faction"),
          (neq, ":var12", "$players_kingdom"),
          (call_script, "script_dplmc_get_faction_truce_length_with_faction", ":var12", ":var6"),
          (le, reg0, 40),
          (call_script, "script_dplmc_get_faction_truce_length_with_faction", ":var12", "$players_kingdom"),
          (le, reg0, 40),
          (val_add, ":var26", 1),
        (try_end),
        (game_get_reduce_campaign_ai, ":var27"),
        (val_clamp, ":var27", 0, 3),
        (try_begin),
          (lt, ":var23", 0),
          (this_or_next|is_between, "$demanded_castle", "p_castle_1", "p_village_1"),
          (gt, "$demanded_money", 0),
          (jump_to_menu, "mnu_dplmc_deny_terms"),
        (else_try),
          (is_between, "$demanded_castle", "p_castle_1", "p_village_1"),
          (lt, ":var23", 2),
          (this_or_next|party_slot_eq, "$demanded_castle", 61, ":var6"),
          (this_or_next|eq, ":var9", 1),
          (this_or_next|ge, ":var20", ":var21"),
          (this_or_next|eq, ":var8", 0),
          (eq, ":var26", 0),
          (jump_to_menu, "mnu_dplmc_deny_terms"),
        (else_try),
          (is_between, "$demanded_castle", "p_castle_1", "p_village_1"),
          (assign, reg0, 1),
          (val_sub, reg0, ":var8"),
          (val_max, reg0, 0),
          (try_begin),
            (party_slot_eq, "$demanded_castle", 61, ":var6"),
            (val_add, reg0, 1),
          (try_end),
          (val_max, ":var9", 0),
          (val_add, reg0, ":var9"),
          (try_begin),
            (ge, ":var20", ":var21"),
            (val_add, reg0, 1),
          (try_end),
          (try_begin),
            (eq, ":var26", 0),
            (val_add, reg0, 1),
          (try_end),
          (try_begin),
            (ge, ":var10", 190),
            (val_add, reg0, 1),
          (try_end),
          (val_add, ":var25", reg0),
          (ge, reg0, 3),
          (jump_to_menu, "mnu_dplmc_deny_terms"),
        (else_try),
          (eq, ":var26", 0),
          (this_or_next|is_between, "$demanded_castle", "p_castle_1", "p_village_1"),
          (gt, "$demanded_money", 0),
          (is_between, ":var6", "fac_player_supporters_faction", "fac_kingdoms_end"),
          (assign, ":var28", 2),
          (try_begin),
            (eq, ":var27", 0),
            (store_add, ":var28", ":var23", 1),
            (val_max, ":var28", 4),
          (else_try),
            (eq, ":var27", 1),
            (is_between, "$demanded_castle", "p_castle_1", "p_village_1"),
            (store_add, ":var28", ":var23", 1),
            (val_max, ":var28", 4),
          (else_try),
            (eq, ":var27", 2),
          (try_end),
          (lt, ":var23", ":var28"),
          (jump_to_menu, "mnu_dplmc_deny_terms"),
        (else_try),
          (le, ":var25", ":var24"),
          (try_begin),
            (is_between, "$demanded_castle", "p_castle_1", "p_village_1"),
            (try_begin),
              (party_slot_ge, "$demanded_castle", 7, 1),
              (party_get_slot, reg0, ":var17", 7),
              (call_script, "script_change_player_relation_with_troop", reg0, -1),
            (try_end),
            (try_for_range, ":var17", "p_village_1", "p_salt_mine"),
              (party_slot_eq, ":var17", 120, "$demanded_castle"),
              (party_slot_ge, ":var17", 7, 1),
              (party_get_slot, reg0, ":var17", 7),
              (call_script, "script_change_player_relation_with_troop", reg0, -1),
            (try_end),
            (call_script, "script_give_center_to_faction", "$demanded_castle", ":var7"),
          (try_end),
          (try_begin),
            (gt, "$demanded_money", 0),
            (call_script, "script_dplmc_pay_into_treasury", "$demanded_money"),
            (faction_get_slot, ":var29", "$g_notification_menu_var1", 11),
            (try_begin),
              (ge, ":var29", 1),
              (neq, "$g_notification_menu_var1", "$players_kingdom"),
              (neq, "$g_notification_menu_var1", "fac_player_supporters_faction"),
              (ge, "$demanded_money", 1),
              (assign, ":var30", "$demanded_money"),
              (ge, ":var30", 1),
              (call_script, "script_dplmc_remove_gold_from_lord_and_holdings", ":var30", ":var29"),
              (store_random_in_range, reg0, 0, 1000),
              (val_add, reg0, ":var30"),
              (val_div, reg0, 1000),
              (ge, reg0, 1),
              (val_mul, reg0, -1),
              (call_script, "script_change_player_relation_with_troop", ":var29", reg0),
            (try_end),
          (try_end),
          (call_script, "script_diplomacy_start_peace_between_kingdoms", "$g_notification_menu_var1", ":var7", 1),
          (presentation_set_duration, 0),
          (change_screen_return),
        (else_try),
          (jump_to_menu, "mnu_dplmc_deny_terms"),
        (try_end),
      (try_end),
    ]),
  ]),

  ("multiplayer_flag_projection_display_ccoop", prsntf_read_only|prsntf_manual_end_only, mesh_pic_bandits,
  [
    (ti_on_presentation_load,
    [
      (set_fixed_point_multiplier, 1000),
      (create_mesh_overlay, "$g_presentation_obj_flag_projection_display_1", "mesh_prison_cart_pos"),
      (position_set_x, pos1, 69),
      (position_set_y, pos1, 92),
      (overlay_set_size, "$g_presentation_obj_flag_projection_display_1", pos1),
      (overlay_set_display, "$g_presentation_obj_flag_projection_display_1", 0),
      (presentation_set_duration, 999999),
    ]),
    (ti_on_presentation_run,
    [
      (try_begin),
        (overlay_set_display, "$g_presentation_obj_flag_projection_display_1", 0),
        (gt, "$g_prison_cart_point", 0),
        (scene_prop_get_instance, ":var0", "spr_prison_cart_door_left", 0),
        (scene_prop_get_instance, ":var1", "spr_prison_cart_door_right", 0),
        (prop_instance_get_position, pos1, ":var0"),
        (prop_instance_get_position, pos2, ":var1"),
        (call_script, "script_avarage_of_two_points"),
        (position_move_z, pos1, 50, 1),
        (position_get_screen_projection, pos3, pos1),
        (position_get_x, ":var2", pos3),
        (position_get_y, ":var3", pos3),
        (try_begin),
          (is_between, ":var2", -100, 1100),
          (is_between, ":var3", -100, 850),
          (overlay_set_position, "$g_presentation_obj_flag_projection_display_1", pos3),
          (overlay_set_display, "$g_presentation_obj_flag_projection_display_1", 1),
        (try_end),
      (try_end),
    ]),
  ]),

  ("multiplayer_flag_projection_display_ccoop_wave", prsntf_read_only|prsntf_manual_end_only, mesh_pic_bandits,
  [
    (ti_on_presentation_load,
    [
      (set_fixed_point_multiplier, 1000),
      (assign, ":var0", -1),
      (assign, ":var1", -1),
      (troop_get_slot, ":var2", "trp_multiplayer_data", 186),
      (try_for_range, ":var3", 0, ":var2"),
        (store_mul, ":var4", ":var3", 3),
        (val_add, ":var4", 188),
        (troop_get_slot, ":var5", "trp_multiplayer_data", ":var4"),
        (val_add, ":var4", 1),
        (troop_get_slot, ":var6", "trp_multiplayer_data", ":var4"),
        (gt, ":var5", 0),
        (try_begin),
          (neq, ":var0", -1),
          (neq, ":var0", ":var6"),
          (assign, ":var1", ":var6"),
        (else_try),
          (assign, ":var0", ":var6"),
        (try_end),
      (try_end),
      (try_begin),
        (gt, ":var0", 0),
        (create_mesh_overlay, "$g_presentation_obj_flag_projection_display_1", "mesh_incoming_enemy"),
        (position_set_x, pos1, 250),
        (position_set_y, pos1, 250),
        (overlay_set_size, "$g_presentation_obj_flag_projection_display_1", pos1),
        (overlay_set_display, "$g_presentation_obj_flag_projection_display_1", 0),
      (try_end),
      (try_begin),
        (gt, ":var1", 0),
        (create_mesh_overlay, "$g_presentation_obj_flag_projection_display_2", "mesh_incoming_enemy"),
        (position_set_x, pos1, 250),
        (position_set_y, pos1, 250),
        (overlay_set_size, "$g_presentation_obj_flag_projection_display_2", pos1),
        (overlay_set_display, "$g_presentation_obj_flag_projection_display_2", 0),
      (try_end),
      (presentation_set_duration, 999999),
    ]),
    (ti_on_presentation_run,
    [
      (assign, ":var0", -1),
      (assign, ":var1", -1),
      (troop_get_slot, ":var2", "trp_multiplayer_data", 186),
      (try_for_range, ":var3", 0, ":var2"),
        (store_mul, ":var4", ":var3", 3),
        (val_add, ":var4", 188),
        (troop_get_slot, ":var5", "trp_multiplayer_data", ":var4"),
        (val_add, ":var4", 1),
        (troop_get_slot, ":var6", "trp_multiplayer_data", ":var4"),
        (gt, ":var5", 0),
        (try_begin),
          (neq, ":var0", -1),
          (neq, ":var0", ":var6"),
          (assign, ":var1", ":var6"),
        (else_try),
          (assign, ":var0", ":var6"),
        (try_end),
      (try_end),
      (try_begin),
        (this_or_next|gt, ":var0", 0),
        (gt, ":var1", 0),
        (try_begin),
          (gt, ":var0", 0),
          (overlay_set_display, "$g_presentation_obj_flag_projection_display_1", 0),
          (entry_point_get_position, pos1, ":var0"),
          (position_move_z, pos1, 150, 1),
          (position_get_screen_projection, pos3, pos1),
          (position_get_x, ":var7", pos3),
          (position_get_y, ":var8", pos3),
          (is_between, ":var7", -100, 1100),
          (is_between, ":var8", -100, 850),
          (overlay_set_position, "$g_presentation_obj_flag_projection_display_1", pos3),
          (overlay_set_display, "$g_presentation_obj_flag_projection_display_1", 1),
        (try_end),
        (try_begin),
          (gt, ":var1", 0),
          (overlay_set_display, "$g_presentation_obj_flag_projection_display_2", 0),
          (entry_point_get_position, pos1, ":var1"),
          (position_move_z, pos1, 50, 1),
          (position_get_screen_projection, pos3, pos1),
          (position_get_x, ":var7", pos3),
          (position_get_y, ":var8", pos3),
          (is_between, ":var7", -100, 1100),
          (is_between, ":var8", -100, 850),
          (overlay_set_position, "$g_presentation_obj_flag_projection_display_2", pos3),
          (overlay_set_display, "$g_presentation_obj_flag_projection_display_2", 1),
        (try_end),
      (else_try),
        (presentation_set_duration, 0),
      (try_end),
    ]),
  ]),

  ("coop_assign_drop_to_group_member", prsntf_manual_end_only, mesh_pic_bandits,
  [
    (ti_on_presentation_load,
    [
      (set_fixed_point_multiplier, 1000),
      (assign, ":var0", reg0),
      (assign, ":var1", reg1),
      (assign, ":var2", reg2),
      (play_sound, "snd_draw_shield"),
      (create_mesh_overlay, reg0, "mesh_mp_ingame_menu"),
      (position_set_x, pos1, 250),
      (position_set_y, pos1, 80),
      (overlay_set_position, reg0, pos1),
      (position_set_x, pos1, 1000),
      (position_set_y, pos1, 1000),
      (overlay_set_size, reg0, pos1),
      (create_mesh_overlay, reg0, "mesh_ccoop_drop_chest_top"),
      (position_set_x, pos1, 387),
      (position_set_y, pos1, 474),
      (overlay_set_position, reg0, pos1),
      (position_set_x, pos1, 562),
      (position_set_y, pos1, 374),
      (overlay_set_size, reg0, pos1),
      (create_mesh_overlay_with_item_id, reg0, ":var0"),
      (position_set_x, pos1, 500),
      (position_set_y, pos1, 450),
      (overlay_set_position, reg0, pos1),
      (position_set_y, pos1, 528),
      (overlay_animate_to_position, reg0, 400, pos1),
      (position_set_x, pos1, 900),
      (position_set_y, pos1, 1200),
      (overlay_set_size, reg0, pos1),
      (position_set_x, pos1, 900),
      (position_set_y, pos1, 1200),
      (create_mesh_overlay, reg0, "mesh_ccoop_drop_chest_bottom"),
      (position_set_x, pos1, 387),
      (position_set_y, pos1, 375),
      (overlay_set_position, reg0, pos1),
      (position_set_x, pos1, 562),
      (position_set_y, pos1, 250),
      (overlay_set_size, reg0, pos1),
      (str_clear, s0),
      (create_text_overlay, "$g_presentation_obj_assign_drop_container", s0, tf_scrollable_style_2),
      (position_set_x, pos1, 285),
      (position_set_y, pos1, 75),
      (overlay_set_position, "$g_presentation_obj_assign_drop_container", pos1),
      (position_set_x, pos1, 405),
      (position_set_y, pos1, 550),
      (overlay_set_area_size, "$g_presentation_obj_assign_drop_container", pos1),
      (set_container_overlay, "$g_presentation_obj_assign_drop_container"),
      (create_text_overlay, reg0, "str_ccoop_assign_drop", 0),
      (overlay_set_color, reg0, 0xFFFFFF),
      (position_set_x, pos1, 0),
      (position_set_y, pos1, 500),
      (overlay_set_position, reg0, pos1),
      (set_container_overlay, -1),
      (assign, ":var3", 355),
      (str_store_item_name_plural, s0, ":var0"),
      (val_sub, ":var3", 3),
      (create_text_overlay, reg0, s0, tf_center_justify),
      (overlay_set_color, reg0, 0xFFFFFF),
      (position_set_x, pos1, 500),
      (position_set_y, pos1, ":var3"),
      (overlay_set_position, reg0, pos1),
      (val_sub, ":var3", 25),
      (store_sub, ":var4", ":var0", "itm_hunting_bow"),
      (val_add, ":var4", "str_javelin_bow"),
      (try_begin),
        (is_between, ":var4", "str_javelin_bow", "str_npc1_1"),
        (str_store_string, s0, ":var4"),
      (else_try),
        (str_clear, s0),
      (try_end),
      (create_text_overlay, reg0, s0, tf_center_justify),
      (overlay_set_color, reg0, 0xFFFFFF),
      (position_set_x, pos1, 750),
      (position_set_y, pos1, 750),
      (overlay_set_size, reg0, pos1),
      (position_set_x, pos1, 500),
      (position_set_y, pos1, ":var3"),
      (overlay_set_position, reg0, pos1),
      (multiplayer_get_my_player, ":var5"),
      (str_store_player_username, s0, ":var5"),
      (val_sub, ":var3", 176),
      (try_begin),
        (ge, ":var1", 0),
        (ge, ":var2", 0),
        (assign, ":var6", 270),
      (else_try),
        (this_or_next|ge, ":var1", 0),
        (ge, ":var2", 0),
        (assign, ":var6", 331),
      (else_try),
        (assign, ":var6", 393),
      (try_end),
      (create_image_button_overlay_with_tableau_material, "$g_presentation_obj_coop_assign_drop_player", -1, "tableau_coop_companion_select_0", -1),
      (overlay_set_tooltip, "$g_presentation_obj_coop_assign_drop_player", s0),
      (overlay_set_color, "$g_presentation_obj_coop_assign_drop_player", 0xFFFFFF),
      (position_set_x, pos1, ":var6"),
      (position_set_y, pos1, ":var3"),
      (overlay_set_position, "$g_presentation_obj_coop_assign_drop_player", pos1),
      (position_set_x, pos1, 563),
      (position_set_y, pos1, 750),
      (overlay_set_size, "$g_presentation_obj_coop_assign_drop_player", pos1),
      (try_begin),
        (ge, ":var1", 0),
        (val_add, ":var6", 123),
        (assign, "$g_coop_assign_drop_companion_1", ":var1"),
        (agent_get_troop_id, ":var7", ":var1"),
        (str_store_troop_name, s0, ":var7"),
        (create_image_button_overlay_with_tableau_material, "$g_presentation_obj_coop_assign_drop_companion_1", -1, "tableau_coop_companion_select_0", ":var7"),
        (overlay_set_tooltip, "$g_presentation_obj_coop_assign_drop_companion_1", s0),
        (position_set_x, pos1, ":var6"),
        (position_set_y, pos1, ":var3"),
        (overlay_set_position, "$g_presentation_obj_coop_assign_drop_companion_1", pos1),
        (position_set_x, pos1, 563),
        (position_set_y, pos1, 750),
        (overlay_set_size, "$g_presentation_obj_coop_assign_drop_companion_1", pos1),
      (try_end),
      (try_begin),
        (ge, ":var2", 0),
        (val_add, ":var6", 123),
        (assign, "$g_coop_assign_drop_companion_2", ":var2"),
        (agent_get_troop_id, ":var7", ":var2"),
        (str_store_troop_name, s0, ":var7"),
        (create_image_button_overlay_with_tableau_material, "$g_presentation_obj_coop_assign_drop_companion_2", -1, "tableau_coop_companion_select_0", ":var7"),
        (overlay_set_tooltip, "$g_presentation_obj_coop_assign_drop_companion_2", s0),
        (position_set_x, pos1, ":var6"),
        (position_set_y, pos1, ":var3"),
        (overlay_set_position, "$g_presentation_obj_coop_assign_drop_companion_2", pos1),
        (position_set_x, pos1, 563),
        (position_set_y, pos1, 750),
        (overlay_set_size, "$g_presentation_obj_coop_assign_drop_companion_2", pos1),
      (try_end),
      (val_sub, ":var3", 40),
      (val_sub, ":var3", 2),
      (create_button_overlay, "$g_presentation_obj_coop_assign_drop_noone", "str_noone", 0),
      (overlay_set_color, "$g_presentation_obj_coop_assign_drop_noone", 0xFFFFFF),
      (position_set_x, pos1, 645),
      (position_set_y, pos1, ":var3"),
      (overlay_set_position, "$g_presentation_obj_coop_assign_drop_noone", pos1),
      (presentation_set_duration, 999999),
    ]),
    (ti_on_presentation_event_state_change,
    [
      (store_trigger_param_1, ":var0"),
      (try_begin),
        (eq, ":var0", "$g_presentation_obj_coop_assign_drop_player"),
        (multiplayer_send_2_int_to_server, 48, 17, 0),
        (presentation_set_duration, 0),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_coop_assign_drop_companion_1"),
        (multiplayer_send_2_int_to_server, 48, 17, "$g_coop_assign_drop_companion_1"),
        (presentation_set_duration, 0),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_coop_assign_drop_companion_2"),
        (multiplayer_send_2_int_to_server, 48, 17, "$g_coop_assign_drop_companion_2"),
        (presentation_set_duration, 0),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_coop_assign_drop_noone"),
        (multiplayer_send_2_int_to_server, 48, 17, -1),
        (presentation_set_duration, 0),
      (try_end),
    ]),
    (ti_on_presentation_run,
    [
      (store_trigger_param_1, ":var0"),
      (close_item_details),
      (try_begin),
        (this_or_next|key_clicked, key_escape),
        (key_clicked, key_xbox_start),
        (gt, ":var0", 200),
        (presentation_set_duration, 0),
        (multiplayer_send_2_int_to_server, 48, 17, -1),
      (try_end),
    ]),
  ]),

  ("multiplayer_ccoop_next_wave_time_counter", prsntf_read_only|prsntf_manual_end_only, mesh_pic_bandits,
  [
    (ti_on_presentation_load,
    [
      (set_fixed_point_multiplier, 1000),
      (assign, "$g_multiplayer_respawn_counter_overlay", -1),
      (assign, "$g_multiplayer_respawn_remained_overlay", -1),
      (assign, "$g_multiplayer_last_respawn_counter_value", -1),
      (str_clear, s0),
      (create_text_overlay, "$g_multiplayer_respawn_counter_overlay", s0, tf_center_justify|tf_with_outline),
      (overlay_set_color, "$g_multiplayer_respawn_counter_overlay", 0xFFFFFF),
      (position_set_x, pos1, 500),
      (position_set_y, pos1, 600),
      (overlay_set_position, "$g_multiplayer_respawn_counter_overlay", pos1),
      (position_set_x, pos1, 2000),
      (position_set_y, pos1, 2000),
      (overlay_set_size, "$g_multiplayer_respawn_counter_overlay", pos1),
      (str_clear, s0),
      (create_text_overlay, "$g_multiplayer_respawn_remained_overlay", s0, tf_center_justify|tf_with_outline),
      (overlay_set_color, "$g_multiplayer_respawn_remained_overlay", 0xFFFFFF),
      (position_set_x, pos1, 500),
      (position_set_y, pos1, 570),
      (overlay_set_position, "$g_multiplayer_respawn_remained_overlay", pos1),
      (position_set_x, pos1, 1400),
      (position_set_y, pos1, 1400),
      (overlay_set_size, "$g_multiplayer_respawn_remained_overlay", pos1),
      (str_clear, s0),
      (create_text_overlay, "$g_multiplayer_respawn_wave_hint_overlay", s0, tf_center_justify|tf_with_outline),
      (overlay_set_color, "$g_multiplayer_respawn_wave_hint_overlay", 0xFFFFFF),
      (position_set_x, pos1, 500),
      (position_set_y, pos1, 480),
      (overlay_set_position, "$g_multiplayer_respawn_wave_hint_overlay", pos1),
      (position_set_x, pos1, 1400),
      (position_set_y, pos1, 1400),
      (overlay_set_size, "$g_multiplayer_respawn_wave_hint_overlay", pos1),
      (presentation_set_duration, 999999),
    ]),
    (ti_on_presentation_run,
    [
      (ge, "$g_multiplayer_respawn_counter_overlay", 0),
      (store_mission_timer_a, ":var0"),
      (store_sub, ":var1", "$g_multiplayer_ccoop_next_wave_start_time", ":var0"),
      (try_begin),
        (gt, ":var1", 0),
        (gt, "$g_multiplayer_ccoop_wave_no", 0),
        (assign, reg0, ":var1"),
        (store_sub, reg1, "$g_multiplayer_ccoop_wave_no", "$g_mp_coop_last_king_wave"),
        (str_store_string, s1, "str_blank_string"),
        (try_begin),
          (troop_get_slot, ":var2", "trp_multiplayer_data", 187),
          (try_begin),
            (this_or_next|is_between, ":var2", "trp_knight_1_1", "trp_kingdom_1_pretender"),
            (is_between, ":var2", "trp_quick_battle_troop_1", "trp_quick_battle_troops_end"),
            (str_store_troop_name, s0, ":var2"),
            (str_store_string, s1, "str_ccoop_lord_s0_wave_hint"),
          (else_try),
            (is_between, ":var2", "trp_kingdom_1_lord", "trp_knight_1_1"),
            (str_store_troop_name, s0, ":var2"),
            (str_store_string, s1, "str_ccoop_king_s0_wave_hint"),
          (try_end),
          (str_store_string, s0, "str_ccoop_wave_reg1_is_coming_in_reg0_seconds"),
        (else_try),
          (ge, "$g_mp_coop_king_waves", 1),
          (assign, reg2, "$g_mp_coop_king_waves"),
          (str_store_string, s0, "str_ccoop_elite_wave_reg1_is_coming_in_reg0_seconds"),
          (try_begin),
            (gt, reg1, 0),
            (lt, reg1, 4),
            (str_store_string, s1, "str_elite_wave_hint"),
          (try_end),
        (try_end),
        (overlay_set_text, "$g_multiplayer_respawn_counter_overlay", s0),
        (overlay_set_text, "$g_multiplayer_respawn_wave_hint_overlay", s1),
      (else_try),
        (multiplayer_get_my_player, ":var3"),
        (player_is_active, ":var3"),
        (player_get_agent_id, ":var4", ":var3"),
        (ge, ":var4", 0),
        (agent_get_team, ":var5", ":var4"),
        (lt, ":var5", 2),
        (neg|agent_is_alive, ":var4"),
        (player_get_slot, ":var6", ":var3", 24),
        (try_begin),
          (ge, ":var6", 0),
          (str_store_string, s0, "str_ask_for_help_to_respawn_hint"),
        (else_try),
          (str_store_string, s0, "str_wait_for_next_turn_to_respawn_hint"),
        (try_end),
        (overlay_set_text, "$g_multiplayer_respawn_counter_overlay", s0),
      (else_try),
        (presentation_set_duration, 0),
      (try_end),
    ]),
  ]),

  ("multiplayer_ccoop_victory_message", prsntf_read_only|prsntf_manual_end_only, mesh_pic_bandits,
  [
    (ti_on_presentation_load,
    [
      (set_fixed_point_multiplier, 1000),
      (team_get_faction, ":var0", 1),
      (str_store_faction_name, s0, ":var0"),
      (try_begin),
        (is_between, ":var0", "fac_player_supporters_faction", "fac_kingdoms_end"),
        (assign, reg1, 0),
      (else_try),
        (assign, reg1, 1),
      (try_end),
      (try_begin),
        (ge, "$g_multiplayer_ccoop_difficulty_string_i", 0),
        (str_store_string, s1, "$g_multiplayer_ccoop_difficulty_string_i"),
        (str_store_string, s2, "str_ccoop_s0_enemy_defeated_s1"),
      (else_try),
        (str_store_string, s2, "str_ccoop_s0_enemy_defeated_endless_reg0"),
      (try_end),
      (create_text_overlay, "$g_multiplayer_ccoop_victory_overlay", "str_ccoop_victory", tf_center_justify|tf_with_outline),
      (overlay_set_color, "$g_multiplayer_ccoop_victory_overlay", 0x68EB4E),
      (position_set_x, pos1, 500),
      (position_set_y, pos1, 600),
      (overlay_set_position, "$g_multiplayer_ccoop_victory_overlay", pos1),
      (position_set_x, pos1, 2000),
      (position_set_y, pos1, 2000),
      (overlay_set_size, "$g_multiplayer_ccoop_victory_overlay", pos1),
      (create_text_overlay, "$g_multiplayer_ccoop_victory_subtitle_overlay", s2, tf_center_justify|tf_with_outline),
      (overlay_set_color, "$g_multiplayer_ccoop_victory_subtitle_overlay", 0x68EB4E),
      (position_set_x, pos1, 500),
      (position_set_y, pos1, 480),
      (overlay_set_position, "$g_multiplayer_ccoop_victory_subtitle_overlay", pos1),
      (position_set_x, pos1, 1400),
      (position_set_y, pos1, 1400),
      (overlay_set_size, "$g_multiplayer_ccoop_victory_subtitle_overlay", pos1),
      (presentation_set_duration, 2000),
    ]),
    (ti_on_presentation_run,
    [
      (is_presentation_active, "prsnt_multiplayer_ccoop_next_wave_time_counter"),
      (presentation_set_duration, 0),
    ]),
  ]),

  ("change_all_factions_color", 0, mesh_load_window,
  [
    (ti_on_presentation_load,
    [
      (presentation_set_duration, 999999),
      (set_fixed_point_multiplier, 1000),
      (create_combo_button_overlay, "$g_presentation_obj_1"),
      (position_set_x, pos1, 500),
      (position_set_y, pos1, 680),
      (overlay_set_position, "$g_presentation_obj_1", pos1),
      (troop_set_slot, "trp_temp_array_a", 0, "fac_deserters"),
      (troop_set_slot, "trp_temp_array_a", 1, "fac_outlaws"),
      (troop_set_slot, "trp_temp_array_a", 2, "fac_player_supporters_faction"),
      (troop_set_slot, "trp_temp_array_a", 3, "fac_kingdom_6"),
      (troop_set_slot, "trp_temp_array_a", 4, "fac_kingdom_5"),
      (troop_set_slot, "trp_temp_array_a", 5, "fac_kingdom_4"),
      (troop_set_slot, "trp_temp_array_a", 6, "fac_kingdom_3"),
      (troop_set_slot, "trp_temp_array_a", 7, "fac_kingdom_2"),
      (troop_set_slot, "trp_temp_array_a", 8, "fac_kingdom_1"),
      (troop_set_slot, "trp_temp_array_b", 0, 16744576),
      (troop_set_slot, "trp_temp_array_b", 1, 13395660),
      (troop_set_slot, "trp_temp_array_b", 2, 16729139),
      (troop_set_slot, "trp_temp_array_b", 3, 14540083),
      (troop_set_slot, "trp_temp_array_b", 7, 3398963),
      (troop_set_slot, "trp_temp_array_b", 5, 3399133),
      (troop_set_slot, "trp_temp_array_b", 6, 13408767),
      (troop_set_slot, "trp_temp_array_b", 7, 3359999),
      (troop_set_slot, "trp_temp_array_b", 8, 15628100),
      (try_for_range, ":var0", 0, 9),
        (troop_get_slot, ":var1", "trp_temp_array_a", ":var0"),
        (str_store_faction_name, s0, ":var1"),
        (overlay_add_item, "$g_presentation_obj_1", s0),
      (try_end),
      (val_clamp, "$temp", 0, 9),
      (overlay_set_val, "$g_presentation_obj_1", "$temp"),
      (troop_get_slot, ":var1", "trp_temp_array_a", "$temp"),
      (str_store_faction_name, s0, ":var1"),
      (create_text_overlay, reg1, "@Sovereign color of the {s0}:", tf_center_justify),
      (position_set_x, pos1, 500),
      (position_set_y, pos1, 600),
      (overlay_set_position, reg1, pos1),
      (create_mesh_overlay, "$g_presentation_obj_2", "mesh_white_plane"),
      (position_set_x, pos1, 450),
      (position_set_y, pos1, 480),
      (overlay_set_position, "$g_presentation_obj_2", pos1),
      (position_set_x, pos1, 5000),
      (position_set_y, pos1, 5000),
      (overlay_set_size, "$g_presentation_obj_2", pos1),
      (faction_get_color, ":var2", ":var1"),
      (overlay_set_color, "$g_presentation_obj_2", ":var2"),
      (position_set_x, pos1, 500),
      (create_slider_overlay, "$g_presentation_obj_3", 0, 255),
      (position_set_y, pos1, 400),
      (overlay_set_position, "$g_presentation_obj_3", pos1),
      (create_slider_overlay, "$g_presentation_obj_4", 0, 255),
      (position_set_y, pos1, 350),
      (overlay_set_position, "$g_presentation_obj_4", pos1),
      (create_slider_overlay, "$g_presentation_obj_5", 0, 255),
      (position_set_y, pos1, 300),
      (overlay_set_position, "$g_presentation_obj_5", pos1),
      (store_mod, ":var3", ":var2", 256),
      (val_div, ":var2", 256),
      (store_mod, ":var4", ":var2", 256),
      (val_div, ":var2", 256),
      (store_mod, ":var5", ":var2", 256),
      (overlay_set_val, "$g_presentation_obj_3", ":var5"),
      (overlay_set_val, "$g_presentation_obj_4", ":var4"),
      (overlay_set_val, "$g_presentation_obj_5", ":var3"),
      (position_set_x, pos1, 650),
      (create_number_box_overlay, "$g_presentation_obj_6", 0, 256),
      (position_set_y, pos1, 400),
      (overlay_set_position, "$g_presentation_obj_6", pos1),
      (create_number_box_overlay, "$g_presentation_obj_7", 0, 256),
      (position_set_y, pos1, 350),
      (overlay_set_position, "$g_presentation_obj_7", pos1),
      (create_number_box_overlay, "$g_presentation_obj_8", 0, 256),
      (position_set_y, pos1, 300),
      (overlay_set_position, "$g_presentation_obj_8", pos1),
      (overlay_set_val, "$g_presentation_obj_6", ":var5"),
      (overlay_set_val, "$g_presentation_obj_7", ":var4"),
      (overlay_set_val, "$g_presentation_obj_8", ":var3"),
      (assign, reg2, ":var5"),
      (assign, reg3, ":var4"),
      (assign, reg4, ":var3"),
      (position_set_x, pos1, 330),
      (create_text_overlay, reg1, "@Red:", tf_center_justify),
      (position_set_y, pos1, 400),
      (overlay_set_position, reg1, pos1),
      (create_text_overlay, reg1, "@Green:", tf_center_justify),
      (position_set_y, pos1, 350),
      (overlay_set_position, reg1, pos1),
      (create_text_overlay, reg1, "@Blue:", tf_center_justify),
      (position_set_y, pos1, 300),
      (overlay_set_position, reg1, pos1),
      (create_text_overlay, "$g_presentation_obj_9", "@ ", tf_center_justify),
      (position_set_x, pos1, 500),
      (position_set_y, pos1, 450),
      (overlay_set_position, "$g_presentation_obj_9", pos1),
      (call_script, "script_convert_rgb_code_to_html_code", reg2, reg3, reg4),
      (overlay_set_text, "$g_presentation_obj_9", "@HTML code: {s0}"),
      (create_game_button_overlay, "$g_presentation_obj_11", "@Default"),
      (position_set_x, pos1, 420),
      (position_set_y, pos1, 230),
      (overlay_set_position, "$g_presentation_obj_11", pos1),
      (create_game_button_overlay, "$g_presentation_obj_12", "@Randomize"),
      (position_set_x, pos1, 580),
      (position_set_y, pos1, 230),
      (overlay_set_position, "$g_presentation_obj_12", pos1),
      (create_mesh_overlay, reg1, "mesh_white_plane"),
      (position_set_x, pos1, 138),
      (position_set_y, pos1, 78),
      (overlay_set_position, reg1, pos1),
      (position_set_x, pos1, 36100),
      (position_set_y, pos1, 6100),
      (overlay_set_size, reg1, pos1),
      (overlay_set_color, reg1, 0x000000),
      (assign, ":var6", 140),
      (assign, ":var7", 80),
      (try_for_range, ":var0", 0, 216),
        (create_image_button_overlay, reg1, "mesh_white_plane", "mesh_white_plane"),
        (position_set_x, pos1, ":var6"),
        (position_set_y, pos1, ":var7"),
        (overlay_set_position, reg1, pos1),
        (position_set_x, pos1, 900),
        (position_set_y, pos1, 900),
        (overlay_set_size, reg1, pos1),
        (assign, ":var8", ":var0"),
        (call_script, "script_convert_slot_no_to_color", ":var8"),
        (assign, ":var9", reg0),
        (overlay_set_color, reg1, ":var9"),
        (val_add, ":var6", 20),
        (try_begin),
          (eq, ":var6", 860),
          (assign, ":var6", 140),
          (val_add, ":var7", 20),
        (try_end),
        (troop_set_slot, "trp_temp_array_c", ":var0", reg1),
      (try_end),
      (create_game_button_overlay, "$g_presentation_obj_10", "@Done"),
      (position_set_x, pos1, 900),
      (position_set_y, pos1, 25),
      (overlay_set_position, "$g_presentation_obj_10", pos1),
    ]),
    (ti_on_presentation_event_state_change,
    [
      (store_trigger_param_1, ":var0"),
      (store_trigger_param_2, ":var1"),
      (try_for_range, ":var2", 0, 216),
        (troop_slot_eq, "trp_temp_array_c", ":var2", ":var0"),
        (assign, ":var3", ":var2"),
        (call_script, "script_convert_slot_no_to_color", ":var3"),
        (assign, ":var4", reg0),
        (troop_get_slot, ":var5", "trp_temp_array_a", "$temp"),
        (faction_set_color, ":var5", ":var4"),
        (try_begin),
          (eq, "$temp", 1),
          (faction_set_color, "fac_mountain_bandits", ":var4"),
          (faction_set_color, "fac_forest_bandits", ":var4"),
          (display_message, "@DEBUG: Additional outlaw factions have been recolored.", 0xFFAAD8FF),
        (try_end),
        (overlay_set_color, "$g_presentation_obj_2", ":var4"),
        (store_mod, ":var6", ":var4", 256),
        (val_div, ":var4", 256),
        (store_mod, ":var7", ":var4", 256),
        (val_div, ":var4", 256),
        (store_mod, ":var8", ":var4", 256),
        (overlay_set_val, "$g_presentation_obj_3", ":var8"),
        (overlay_set_val, "$g_presentation_obj_4", ":var7"),
        (overlay_set_val, "$g_presentation_obj_5", ":var6"),
        (overlay_set_val, "$g_presentation_obj_6", ":var8"),
        (overlay_set_val, "$g_presentation_obj_7", ":var7"),
        (overlay_set_val, "$g_presentation_obj_8", ":var6"),
        (assign, reg2, ":var8"),
        (assign, reg3, ":var7"),
        (assign, reg4, ":var6"),
        (call_script, "script_convert_rgb_code_to_html_code", reg2, reg3, reg4),
        (overlay_set_text, "$g_presentation_obj_9", "@HTML code: {s0}"),
      (try_end),
      (try_begin),
        (eq, ":var0", "$g_presentation_obj_1"),
        (assign, "$temp", ":var1"),
        (start_presentation, "prsnt_change_all_factions_color"),
      (else_try),
        (this_or_next|eq, ":var0", "$g_presentation_obj_3"),
        (eq, ":var0", "$g_presentation_obj_6"),
        (overlay_set_val, "$g_presentation_obj_3", ":var1"),
        (overlay_set_val, "$g_presentation_obj_6", ":var1"),
        (assign, reg2, ":var1"),
        (call_script, "script_get_dest_color_from_rgb", reg2, reg3, reg4),
        (assign, ":var3", reg0),
        (overlay_set_color, "$g_presentation_obj_2", ":var3"),
        (troop_get_slot, ":var5", "trp_temp_array_a", "$temp"),
        (faction_set_color, ":var5", ":var3"),
        (call_script, "script_convert_rgb_code_to_html_code", reg2, reg3, reg4),
        (overlay_set_text, "$g_presentation_obj_9", "@HTML code: {s0}"),
      (else_try),
        (this_or_next|eq, ":var0", "$g_presentation_obj_4"),
        (eq, ":var0", "$g_presentation_obj_7"),
        (overlay_set_val, "$g_presentation_obj_4", ":var1"),
        (overlay_set_val, "$g_presentation_obj_7", ":var1"),
        (assign, reg3, ":var1"),
        (call_script, "script_get_dest_color_from_rgb", reg2, reg3, reg4),
        (assign, ":var3", reg0),
        (overlay_set_color, "$g_presentation_obj_2", ":var3"),
        (troop_get_slot, ":var5", "trp_temp_array_a", "$temp"),
        (faction_set_color, ":var5", ":var3"),
        (call_script, "script_convert_rgb_code_to_html_code", reg2, reg3, reg4),
        (overlay_set_text, "$g_presentation_obj_9", "@HTML code: {s0}"),
      (else_try),
        (this_or_next|eq, ":var0", "$g_presentation_obj_5"),
        (eq, ":var0", "$g_presentation_obj_8"),
        (overlay_set_val, "$g_presentation_obj_5", ":var1"),
        (overlay_set_val, "$g_presentation_obj_8", ":var1"),
        (assign, reg4, ":var1"),
        (call_script, "script_get_dest_color_from_rgb", reg2, reg3, reg4),
        (assign, ":var3", reg0),
        (overlay_set_color, "$g_presentation_obj_2", ":var3"),
        (troop_get_slot, ":var5", "trp_temp_array_a", "$temp"),
        (faction_set_color, ":var5", ":var3"),
        (call_script, "script_convert_rgb_code_to_html_code", reg2, reg3, reg4),
        (overlay_set_text, "$g_presentation_obj_9", "@HTML code: {s0}"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_11"),
        (troop_get_slot, ":var5", "trp_temp_array_a", "$temp"),
        (troop_get_slot, ":var9", "trp_temp_array_b", "$temp"),
        (faction_set_color, ":var5", ":var9"),
        (overlay_set_color, "$g_presentation_obj_2", ":var9"),
        (store_mod, ":var6", ":var9", 256),
        (val_div, ":var9", 256),
        (store_mod, ":var7", ":var9", 256),
        (val_div, ":var9", 256),
        (store_mod, ":var8", ":var9", 256),
        (overlay_set_val, "$g_presentation_obj_3", ":var8"),
        (overlay_set_val, "$g_presentation_obj_4", ":var7"),
        (overlay_set_val, "$g_presentation_obj_5", ":var6"),
        (overlay_set_val, "$g_presentation_obj_6", ":var8"),
        (overlay_set_val, "$g_presentation_obj_7", ":var7"),
        (overlay_set_val, "$g_presentation_obj_8", ":var6"),
        (assign, reg2, ":var8"),
        (assign, reg3, ":var7"),
        (assign, reg4, ":var6"),
        (call_script, "script_convert_rgb_code_to_html_code", reg2, reg3, reg4),
        (overlay_set_text, "$g_presentation_obj_9", "@HTML code: {s0}"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_12"),
        (store_random_in_range, reg2, 0, 256),
        (store_random_in_range, reg3, 0, 256),
        (store_random_in_range, reg4, 0, 256),
        (overlay_set_val, "$g_presentation_obj_3", reg2),
        (overlay_set_val, "$g_presentation_obj_4", reg3),
        (overlay_set_val, "$g_presentation_obj_5", reg4),
        (overlay_set_val, "$g_presentation_obj_6", reg2),
        (overlay_set_val, "$g_presentation_obj_7", reg3),
        (overlay_set_val, "$g_presentation_obj_8", reg4),
        (call_script, "script_get_dest_color_from_rgb", reg2, reg3, reg4),
        (assign, ":var3", reg0),
        (overlay_set_color, "$g_presentation_obj_2", ":var3"),
        (troop_get_slot, ":var5", "trp_temp_array_a", "$temp"),
        (faction_set_color, ":var5", ":var3"),
        (call_script, "script_convert_rgb_code_to_html_code", reg2, reg3, reg4),
        (overlay_set_text, "$g_presentation_obj_9", "@HTML code: {s0}"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_10"),
        (presentation_set_duration, 0),
      (try_end),
      (try_begin),
        (eq, "$temp", 1),
        (call_script, "script_get_dest_color_from_rgb", reg2, reg3, reg4),
        (assign, ":var4", reg0),
        (faction_set_color, "fac_mountain_bandits", ":var4"),
        (faction_set_color, "fac_forest_bandits", ":var4"),
      (try_end),
    ]),
  ]),

  ("sort_the_defenders", 0, mesh_load_window,
  [
    (ti_on_presentation_load,
    [
      (presentation_set_duration, 999999),
      (set_fixed_point_multiplier, 1000),
      (assign, "$g_presentation_next_presentation", -1),
      (str_clear, s0),
      (create_text_overlay, "$g_presentation_obj_1", s0, tf_scrollable),
      (position_set_x, pos1, 50),
      (position_set_y, pos1, 50),
      (overlay_set_position, "$g_presentation_obj_1", pos1),
      (position_set_x, pos1, 350),
      (position_set_y, pos1, 600),
      (overlay_set_area_size, "$g_presentation_obj_1", pos1),
      (set_container_overlay, "$g_presentation_obj_1"),
      (assign, ":var0", 150),
      (party_get_num_companion_stacks, ":var1", "$current_town"),
      (store_mul, ":var2", ":var1", 40),
      (val_sub, ":var2", 40),
      (val_max, ":var2", 560),
      (try_for_range, ":var3", 0, ":var1"),
        (party_stack_get_troop_id, ":var4", "$current_town", ":var3"),
        (party_stack_get_size, ":var5", "$current_town", ":var3"),
        (party_stack_get_num_wounded, ":var6", "$current_town", ":var3"),
        (str_store_troop_name, s1, ":var4"),
        (assign, reg2, ":var5"),
        (try_begin),
          (gt, ":var6", 0),
          (store_sub, reg3, ":var5", ":var6"),
          (str_store_string, s1, "@{s1}({reg3}/{reg2})"),
        (else_try),
          (str_store_string, s1, "@{s1}({reg2})"),
        (try_end),
        (create_game_button_overlay, reg1, "@{s1}"),
        (position_set_x, pos1, ":var0"),
        (position_set_y, pos1, ":var2"),
        (overlay_set_position, reg1, pos1),
        (position_set_x, pos1, 240),
        (position_set_y, pos1, 32),
        (overlay_set_size, reg1, pos1),
        (troop_set_slot, "trp_temp_array_a", ":var3", reg1),
        (val_sub, ":var2", 40),
      (try_end),
      (try_begin),
        (gt, "$g_cur_stack", -1),
        (troop_get_slot, ":var7", "trp_temp_array_a", "$g_cur_stack"),
        (overlay_set_alpha, ":var7", 0x80),
      (try_end),
      (set_container_overlay, -1),
      (position_set_x, pos1, 750),
      (create_button_overlay, "$g_presentation_obj_2", "@Move to Top", tf_center_justify),
      (position_set_y, pos1, 600),
      (overlay_set_position, "$g_presentation_obj_2", pos1),
      (create_button_overlay, "$g_presentation_obj_3", "@Move Up", tf_center_justify),
      (position_set_y, pos1, 525),
      (overlay_set_position, "$g_presentation_obj_3", pos1),
      (create_button_overlay, "$g_presentation_obj_4", "@Move Down", tf_center_justify),
      (position_set_y, pos1, 450),
      (overlay_set_position, "$g_presentation_obj_4", pos1),
      (create_button_overlay, "$g_presentation_obj_5", "@Move to Bottom", tf_center_justify),
      (position_set_y, pos1, 375),
      (overlay_set_position, "$g_presentation_obj_5", pos1),
      (try_begin),
        (gt, "$g_cur_stack", -1),
        (party_stack_get_troop_id, ":var4", "$current_town", "$g_cur_stack"),
        (store_mul, ":var8", ":var4", 2),
        (create_image_button_overlay_with_tableau_material, "$g_presentation_obj_6", -1, "tableau_game_party_window", ":var8"),
        (position_set_x, pos1, 400),
        (position_set_y, pos1, 300),
        (overlay_set_position, "$g_presentation_obj_6", pos1),
      (else_try),
        (create_mesh_overlay, "$g_presentation_obj_6", "mesh_white_plane"),
        (overlay_set_display, "$g_presentation_obj_6", 0),
      (try_end),
      (create_game_button_overlay, "$g_presentation_obj_10", "@Done"),
      (position_set_x, pos1, 900),
      (position_set_y, pos1, 25),
      (overlay_set_position, "$g_presentation_obj_10", pos1),
    ]),
    (ti_on_presentation_event_state_change,
    [
      (store_trigger_param_1, ":var0"),
      (party_get_num_companion_stacks, ":var1", "$current_town"),
      (try_for_range, ":var2", 0, ":var1"),
        (troop_slot_eq, "trp_temp_array_a", ":var2", ":var0"),
        (assign, "$g_cur_stack", ":var2"),
        (start_presentation, "prsnt_sort_the_defenders"),
      (try_end),
      (try_begin),
        (eq, ":var0", "$g_presentation_obj_2"),
        (try_begin),
          (gt, "$g_cur_stack", 0),
          (store_sub, ":var3", ":var1", 1),
          (call_script, "script_move_one_stack_to_the_bottom", "$current_town", "$g_cur_stack", 1),
          (call_script, "script_move_one_stack_to_the_bottom", "$current_town", 0, ":var3"),
          (assign, "$g_cur_stack", 0),
          (start_presentation, "prsnt_sort_the_defenders"),
        (try_end),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_3"),
        (try_begin),
          (gt, "$g_cur_stack", 0),
          (store_sub, ":var4", "$g_cur_stack", 1),
          (store_sub, ":var3", ":var1", "$g_cur_stack"),
          (call_script, "script_move_one_stack_to_the_bottom", "$current_town", "$g_cur_stack", 1),
          (call_script, "script_move_one_stack_to_the_bottom", "$current_town", ":var4", ":var3"),
          (val_sub, "$g_cur_stack", 1),
          (start_presentation, "prsnt_sort_the_defenders"),
        (try_end),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_4"),
        (try_begin),
          (store_sub, ":var5", ":var1", 1),
          (lt, "$g_cur_stack", ":var5"),
          (gt, "$g_cur_stack", -1),
          (store_add, ":var6", "$g_cur_stack", 1),
          (store_sub, ":var3", ":var5", "$g_cur_stack"),
          (call_script, "script_move_one_stack_to_the_bottom", "$current_town", ":var6", 1),
          (call_script, "script_move_one_stack_to_the_bottom", "$current_town", "$g_cur_stack", ":var3"),
          (val_add, "$g_cur_stack", 1),
          (start_presentation, "prsnt_sort_the_defenders"),
        (try_end),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_5"),
        (try_begin),
          (store_sub, ":var5", ":var1", 1),
          (lt, "$g_cur_stack", ":var5"),
          (gt, "$g_cur_stack", -1),
          (call_script, "script_move_one_stack_to_the_bottom", "$current_town", "$g_cur_stack", 1),
          (assign, "$g_cur_stack", ":var5"),
          (start_presentation, "prsnt_sort_the_defenders"),
        (try_end),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_6"),
        (assign, "$g_presentation_next_presentation", "prsnt_sort_the_defenders"),
        (party_stack_get_troop_id, "$temp", "$current_town", "$g_cur_stack"),
        (start_presentation, "prsnt_troop_note"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_10"),
        (presentation_set_duration, 0),
      (try_end),
    ]),
  ]),

  ("recruiter_troops_available", 0, mesh_message_window,
  [
    (ti_on_presentation_load,
    [
      (presentation_set_duration, 999999),
      (set_fixed_point_multiplier, 1000),
      (call_script, "script_list_clear_deep", "trp_list_06b"),
      (store_faction_of_party, ":var0", "$current_town"),
      (assign, ":var1", 0),
      (try_for_range, ":var2", 200, 215),
        (party_get_slot, ":var3", "$current_town", ":var2"),
        (gt, ":var3", 0),
        (val_add, ":var1", 1),
        (call_script, "script_list_add", "trp_list_06b", ":var3"),
        (store_faction_of_party, ":var4", ":var3"),
        (call_script, "script_list_add", "trp_list_06b", ":var4"),
        (store_relation, ":var5", ":var0", ":var4"),
        (call_script, "script_list_add", "trp_list_06b", ":var5"),
        (assign, ":var6", reg1),
        (call_script, "script_evaluate_faction_prejudice", "p_main_party", ":var4"),
        (assign, ":var7", reg1),
        (assign, reg1, ":var6"),
        (call_script, "script_list_add", "trp_list_06b", ":var7"),
        (store_distance_to_party_from_party, ":var8", "$current_town", ":var3"),
        (call_script, "script_list_add", "trp_list_06b", ":var8"),
        (assign, ":var9", 0),
        (try_begin),
          (ge, ":var5", 0),
          (assign, ":var9", 30),
          (try_begin),
            (lt, ":var7", 0),
            (assign, ":var10", ":var7"),
            (val_abs, ":var10"),
            (store_random_in_range, ":var11", 2, 6),
            (store_random_in_range, ":var12", 2, 5),
            (store_mul, ":var13", ":var11", ":var12"),
            (val_div, ":var10", ":var13"),
            (val_min, ":var10", ":var9"),
            (val_sub, ":var9", ":var10"),
          (else_try),
            (ge, ":var7", 0),
            (try_begin),
              (is_between, ":var7", 70, 301),
              (val_add, ":var9", 10),
            (else_try),
              (gt, ":var7", 300),
              (val_add, ":var9", 20),
            (try_end),
          (try_end),
        (try_end),
        (call_script, "script_list_count", "trp_list_06"),
        (assign, ":var14", reg1),
        (val_div, ":var14", 6),
        (try_begin),
          (gt, ":var14", 1),
          (try_for_range, ":var15", 0, ":var14"),
            (store_mul, ":var16", ":var15", 6),
            (store_add, ":var17", ":var16", 1),
            (call_script, "script_list_at_nc", "trp_list_06", ":var17"),
            (assign, ":var18", reg1),
            (eq, ":var18", ":var3"),
            (val_div, ":var9", 3),
            (store_add, ":var17", ":var16", 5),
            (call_script, "script_list_at_nc", "trp_list_06", ":var17"),
            (assign, ":var19", reg1),
            (eq, ":var19", "$current_town"),
            (assign, ":var9", 0),
            (assign, ":var15", ":var14"),
          (try_end),
        (try_end),
        (call_script, "script_list_add", "trp_list_06b", ":var9"),
        (call_script, "script_list_add", "trp_list_06b", 0),
        (store_div, ":var20", ":var8", 25),
        (val_add, ":var20", 3),
        (call_script, "script_list_add", "trp_list_06b", ":var20"),
        (call_script, "script_list_add", "trp_list_06b", "$current_town"),
        (assign, ":var21", 100),
        (val_mul, ":var21", 16),
        (val_div, ":var21", 100),
        (store_mul, ":var22", ":var20", 3),
        (val_div, ":var22", 2),
        (val_add, ":var21", ":var22"),
        (call_script, "script_list_add", "trp_list_06b", ":var21"),
      (try_end),
      (create_mesh_overlay, reg1, "mesh_pic_castledes"),
      (position_set_x, pos1, 180),
      (position_set_y, pos1, 180),
      (overlay_set_size, reg1, pos1),
      (position_set_x, pos1, 795),
      (position_set_y, pos1, 600),
      (overlay_set_position, reg1, pos1),
      (create_mesh_overlay, reg1, "mesh_pic_looted_village"),
      (position_set_x, pos1, 170),
      (position_set_y, pos1, 170),
      (overlay_set_size, reg1, pos1),
      (position_set_x, pos1, -15),
      (position_set_y, pos1, 600),
      (overlay_set_position, reg1, pos1),
      (create_text_overlay, reg1, "@ Recruiter Report ", tf_center_justify),
      (position_set_x, pos1, 500),
      (position_set_y, pos1, 670),
      (overlay_set_position, reg1, pos1),
      (position_set_x, pos1, 1500),
      (position_set_y, pos1, 1500),
      (overlay_set_size, reg1, pos1),
      (create_game_button_overlay, reg1, "@ Update Order "),
      (position_set_x, pos1, 350),
      (position_set_y, pos1, 23),
      (overlay_set_position, reg1, pos1),
      (assign, "$g_jrider_faction_report_return_to_menu", reg1),
      (create_game_button_overlay, reg2, "@ Quit "),
      (position_set_x, pos2, 650),
      (position_set_y, pos2, 23),
      (overlay_set_position, reg2, pos2),
      (troop_set_slot, "trp_multiplayer_end", 24, reg2),
      (assign, ":var23", 250),
      (assign, ":var24", 620),
      (position_set_y, pos1, ":var24"),
      (try_for_range, ":var25", 1, 6),
        (try_begin),
          (eq, ":var25", 1),
          (str_store_string, s1, "@Diplomacy"),
        (else_try),
          (eq, ":var25", 2),
          (str_store_string, s1, "@Available"),
        (else_try),
          (eq, ":var25", 3),
          (str_store_string, s1, "@Distance"),
        (else_try),
          (eq, ":var25", 4),
          (str_store_string, s1, "@Ordered"),
        (else_try),
          (eq, ":var25", 5),
          (str_store_string, s1, "@In Progress"),
        (try_end),
        (create_text_overlay, reg10, s1, tf_left_align|tf_with_outline),
        (position_set_x, pos3, 650),
        (position_set_y, pos3, 800),
        (overlay_set_size, reg10, pos3),
        (position_set_x, pos1, ":var23"),
        (overlay_set_position, reg10, pos1),
        (val_add, ":var23", 90),
      (try_end),
      (assign, ":var23", 215),
      (assign, ":var24", 597),
      (assign, ":var26", 0),
      (position_set_x, ":var26", 720),
      (position_set_y, ":var26", 775),
      (assign, ":var27", 50),
      (position_set_x, ":var27", 60),
      (position_set_y, ":var27", 28000),
      (create_text_overlay, reg2, "@trade^Town", tf_center_justify),
      (overlay_set_size, reg2, ":var26"),
      (position_set_x, pos1, ":var23"),
      (position_set_y, pos1, ":var24"),
      (overlay_set_position, reg2, pos1),
      (val_add, ":var23", 45),
      (try_for_range, ":var28", 0, 5),
        (create_mesh_overlay, reg1, "mesh_white_plane"),
        (overlay_set_color, reg1, 0x000000),
        (overlay_set_size, reg1, ":var27"),
        (store_sub, ":var29", ":var23", 15),
        (store_sub, ":var30", ":var24", 500),
        (position_set_x, pos2, ":var29"),
        (position_set_y, pos2, ":var30"),
        (overlay_set_position, reg1, pos2),
        (val_add, ":var23", 90),
        (try_begin),
          (eq, "$cheat_mode", 1),
          (assign, reg20, ":var28"),
          (display_message, "@{!}DEBUG - Drawing line {reg20}"),
        (try_end),
      (try_end),
      (str_clear, s9),
      (str_clear, s8),
      (str_clear, s3),
      (str_clear, s60),
      (str_clear, s61),
      (str_clear, s0),
      (create_text_overlay, reg1, s0, tf_scrollable_style_2),
      (position_set_x, pos1, 50),
      (position_set_y, pos1, 70),
      (overlay_set_position, reg1, pos1),
      (position_set_x, pos1, 860),
      (position_set_y, pos1, 527),
      (overlay_set_area_size, reg1, pos1),
      (set_container_overlay, reg1),
      (assign, ":var31", 0),
      (assign, ":var24", 0),
      (store_troop_gold, ":var32", "trp_household_possessions"),
      (store_troop_gold, ":var33", "trp_player"),
      (store_add, ":var34", ":var32", ":var33"),
      (call_script, "script_list_count", "trp_list_06b"),
      (assign, ":var35", reg1),
      (val_div, ":var35", 10),
      (gt, ":var35", 0),
      (try_for_range, ":var36", 0, ":var35"),
        (str_clear, s10),
        (store_mul, ":var37", ":var36", 10),
        (store_add, ":var38", ":var37", 1),
        (call_script, "script_list_at_nc", "trp_list_06b", ":var38"),
        (assign, ":var39", reg1),
        (str_store_party_name, s10, ":var39"),
        (store_add, ":var38", ":var37", 2),
        (call_script, "script_list_at_nc", "trp_list_06b", ":var38"),
        (assign, ":var40", reg1),
        (try_begin),
          (is_between, ":var40", "fac_kingdom_1", "fac_kingdoms_end"),
          (store_sub, ":var41", ":var40", "fac_kingdom_1"),
          (val_add, ":var41", "str_swadians"),
          (str_store_string, s1, ":var41"),
        (else_try),
          (str_store_string, s1, "@Your kingdom"),
        (try_end),
        (assign, ":var42", 220),
        (assign, ":var43", ":var40"),
        (assign, ":var44", -1),
        (try_for_range, ":var25", 1, 6),
          (try_begin),
            (eq, ":var25", 1),
            (create_text_overlay, reg9, "@{s1}", tf_center_justify),
            (store_sub, ":var29", ":var42", 60),
            (store_add, ":var45", ":var24", 24),
            (position_set_x, pos3, ":var29"),
            (position_set_y, pos3, ":var45"),
            (overlay_set_size, reg9, ":var31"),
            (overlay_set_position, reg9, pos3),
            (store_add, ":var38", ":var37", 3),
            (store_add, ":var38", ":var37", 4),
            (try_begin),
              (call_script, "script_diplomacy_faction_get_diplomatic_status_with_faction", ":var43", ":var0"),
              (assign, ":var46", reg0),
              (assign, ":var47", reg1),
              (try_begin),
                (eq, ":var46", -2),
                (str_store_string, s60, "@War"),
                (assign, reg60, 14483456),
                (assign, reg59, 0),
              (else_try),
                (eq, ":var46", -1),
                (str_store_string, s60, "@Casus Belli"),
                (assign, reg60, 14516224),
                (assign, reg59, ":var47"),
              (else_try),
                (eq, ":var46", 0),
                (str_store_string, s60, "@Peace"),
                (assign, reg60, 16777215),
                (assign, reg59, 0),
              (else_try),
                (eq, ":var46", 1),
                (str_store_string, s60, "@Truce"),
                (assign, reg60, 14540253),
                (assign, reg59, ":var47"),
                (try_begin),
                  (ge, ":var47", 61),
                  (str_store_string, s60, "@Alliance"),
                  (assign, reg60, 65280),
                (else_try),
                  (ge, ":var47", 41),
                  (str_store_string, s60, "@Defense"),
                  (assign, reg60, 65450),
                (else_try),
                  (ge, ":var47", 21),
                  (str_store_string, s60, "@Trade"),
                  (assign, reg60, 65484),
                (try_end),
              (try_end),
            (try_end),
            (val_add, ":var23", 50),
            (create_text_overlay, reg11, s60, tf_left_align|tf_with_outline),
            (overlay_set_color, reg11, reg60),
            (overlay_set_size, reg11, ":var31"),
            (store_add, ":var45", ":var24", 36),
            (store_add, ":var29", ":var42", 0),
            (position_set_x, pos3, ":var29"),
            (position_set_y, pos3, ":var45"),
            (overlay_set_position, reg11, pos3),
            (store_relation, ":var5", ":var43", ":var0"),
            (assign, reg61, ":var5"),
            (create_text_overlay, reg12, "@{reg61}", tf_center_justify),
            (overlay_set_size, reg12, ":var31"),
            (store_add, ":var45", ":var24", 18),
            (store_add, ":var29", ":var42", 10),
            (position_set_x, pos3, ":var29"),
            (position_set_y, pos3, ":var45"),
            (overlay_set_position, reg12, pos3),
          (else_try),
            (eq, ":var25", 2),
            (store_add, ":var38", ":var37", 6),
            (call_script, "script_list_at_nc", "trp_list_06b", ":var38"),
            (assign, ":var44", reg1),
            (val_add, ":var23", 60),
            (store_add, ":var38", ":var37", 10),
            (call_script, "script_list_at_nc", "trp_list_06b", ":var38"),
            (assign, ":var48", reg1),
            (store_mul, ":var49", ":var48", ":var44"),
            (try_begin),
              (gt, ":var49", ":var34"),
              (store_div, ":var44", ":var34", ":var48"),
            (try_end),
            (assign, reg59, ":var44"),
            (create_text_overlay, reg13, "@avail {reg59}", tf_center_justify),
            (overlay_set_size, reg13, ":var31"),
            (store_sub, ":var29", ":var42", 0),
            (store_add, ":var45", ":var24", 54),
            (position_set_x, pos3, ":var29"),
            (position_set_y, pos3, ":var45"),
            (overlay_set_position, reg13, pos3),
            (assign, ":var50", "trp_merc_halfling_militia"),
            (party_get_slot, ":var51", ":var39", 19),
            (try_begin),
              (is_between, ":var51", "fac_culture_1", "fac_player_faction"),
              (store_sub, ":var41", "fac_kingdom_1", "fac_culture_1"),
              (store_add, ":var52", ":var51", ":var41"),
              (faction_get_slot, ":var50", ":var52", 41),
            (try_end),
            (str_store_troop_name, s60, ":var50"),
            (create_text_overlay, reg14, s60, tf_left_align|tf_with_outline),
            (overlay_set_size, reg14, ":var31"),
            (store_add, ":var45", ":var24", 36),
            (store_sub, ":var29", ":var42", 26),
            (position_set_x, pos3, ":var29"),
            (position_set_y, pos3, ":var45"),
            (assign, ":var53", 2565927),
            (try_begin),
              (is_between, ":var52", "fac_kingdom_1", "fac_kingdoms_end"),
              (faction_get_color, ":var53", ":var52"),
            (try_end),
            (overlay_set_color, reg14, ":var53"),
            (overlay_set_position, reg14, pos3),
          (else_try),
            (eq, ":var25", 3),
            (store_add, ":var38", ":var37", 5),
            (call_script, "script_list_at_nc", "trp_list_06b", ":var38"),
            (assign, reg59, reg1),
            (val_add, ":var23", 60),
            (create_text_overlay, reg15, "@dist {reg59}", tf_center_justify),
            (overlay_set_size, reg15, ":var31"),
            (overlay_set_color, reg15, reg60),
            (store_sub, ":var29", ":var42", 0),
            (store_add, ":var45", ":var24", 54),
            (position_set_x, pos3, ":var29"),
            (position_set_y, pos3, ":var45"),
            (overlay_set_position, reg15, pos3),
            (store_add, ":var38", ":var37", 8),
            (call_script, "script_list_at_nc", "trp_list_06b", ":var38"),
            (assign, reg60, reg1),
            (val_add, ":var23", 45),
            (str_store_string, s60, "@days {reg60}"),
            (create_text_overlay, reg16, s60, tf_left_align|tf_with_outline),
            (overlay_set_size, reg16, ":var31"),
            (store_add, ":var45", ":var24", 36),
            (store_add, ":var29", ":var42", 0),
            (position_set_x, pos3, ":var29"),
            (position_set_y, pos3, ":var45"),
            (overlay_set_color, reg16, 0x684848),
            (overlay_set_position, reg16, pos3),
          (else_try),
            (eq, ":var25", 4),
            (store_add, ":var38", ":var37", 7),
            (call_script, "script_list_at_nc", "trp_list_06b", ":var38"),
            (assign, reg59, reg1),
            (val_add, ":var23", 65),
            (store_add, ":var38", ":var37", 6),
            (call_script, "script_list_at_nc", "trp_list_06b", ":var38"),
            (assign, ":var44", reg1),
            (store_add, ":var38", ":var37", 10),
            (call_script, "script_list_at_nc", "trp_list_06b", ":var38"),
            (assign, ":var48", reg1),
            (store_mul, ":var49", ":var48", ":var44"),
            (try_begin),
              (gt, ":var49", ":var34"),
              (store_div, ":var44", ":var34", ":var48"),
            (try_end),
            (try_begin),
              (gt, ":var44", 0),
              (create_text_overlay, reg17, "@ready ", tf_center_justify),
              (overlay_set_size, reg17, ":var31"),
              (store_sub, ":var29", ":var42", 0),
              (store_add, ":var45", ":var24", 54),
              (position_set_x, pos3, ":var29"),
              (position_set_y, pos3, ":var45"),
              (overlay_set_position, reg17, pos3),
            (else_try),
              (lt, ":var44", 1),
              (create_text_overlay, reg17, "@none", tf_center_justify),
              (overlay_set_size, reg17, ":var31"),
              (store_sub, ":var29", ":var42", 0),
              (store_add, ":var45", ":var24", 54),
              (position_set_x, pos3, ":var29"),
              (position_set_y, pos3, ":var45"),
              (overlay_set_position, reg17, pos3),
            (try_end),
            (store_add, ":var38", ":var37", 10),
            (call_script, "script_list_at_nc", "trp_list_06b", ":var38"),
            (assign, ":var48", reg1),
            (assign, reg60, ":var48"),
            (val_add, ":var23", 50),
            (str_store_string, s60, "@cost {reg60}"),
            (create_text_overlay, reg18, s60, tf_left_align|tf_center_justify),
            (overlay_set_size, reg18, ":var31"),
            (store_add, ":var45", ":var24", 36),
            (store_sub, ":var29", ":var42", 5),
            (position_set_x, pos3, ":var29"),
            (position_set_y, pos3, ":var45"),
            (overlay_set_position, reg18, pos3),
          (else_try),
            (eq, ":var25", 5),
            (call_script, "script_list_count", "trp_list_06"),
            (assign, ":var14", reg1),
            (val_div, ":var14", 6),
            (try_begin),
              (gt, ":var14", 1),
              (try_for_range, ":var15", 0, ":var14"),
                (store_mul, ":var16", ":var15", 6),
                (store_add, ":var17", ":var16", 1),
                (call_script, "script_list_at_nc", "trp_list_06", ":var17"),
                (assign, ":var18", reg1),
                (eq, ":var18", ":var39"),
                (store_add, ":var17", ":var16", 5),
                (call_script, "script_list_at_nc", "trp_list_06", ":var17"),
                (assign, ":var19", reg1),
                (eq, ":var19", "$current_town"),
                (store_add, ":var17", ":var16", 3),
                (call_script, "script_list_at_nc", "trp_list_06", ":var17"),
                (assign, reg59, reg1),
                (val_add, ":var23", 65),
                (create_text_overlay, reg17, "@order {reg59}", tf_center_justify),
                (overlay_set_size, reg17, ":var31"),
                (store_sub, ":var29", ":var42", 0),
                (store_add, ":var45", ":var24", 54),
                (position_set_x, pos3, ":var29"),
                (position_set_y, pos3, ":var45"),
                (overlay_set_position, reg17, pos3),
                (store_add, ":var17", ":var16", 4),
                (call_script, "script_list_at_nc", "trp_list_06", ":var17"),
                (assign, reg60, reg1),
                (val_add, ":var23", 45),
                (str_store_string, s60, "@days {reg60}"),
                (create_text_overlay, reg16, s60, tf_left_align|tf_with_outline),
                (overlay_set_size, reg16, ":var31"),
                (store_add, ":var45", ":var24", 36),
                (store_add, ":var29", ":var42", 0),
                (position_set_x, pos3, ":var29"),
                (position_set_y, pos3, ":var45"),
                (overlay_set_color, reg16, 0x684848),
                (overlay_set_position, reg16, pos3),
                (assign, ":var15", ":var14"),
              (try_end),
            (try_end),
          (try_end),
          (val_add, ":var42", 90),
        (try_end),
        (assign, ":var23", 165),
        (val_add, ":var24", 54),
        (create_mesh_overlay, reg1, "mesh_white_plane"),
        (overlay_set_color, reg1, 0x000000),
        (position_set_x, pos1, 42000),
        (position_set_y, pos1, 60),
        (overlay_set_size, reg1, pos1),
        (position_set_x, pos1, 17),
        (store_add, ":var45", ":var24", 20),
        (position_set_y, pos1, ":var45"),
        (overlay_set_position, reg1, pos1),
        (str_store_party_name, s9, ":var39"),
        (str_store_string, s1, "@{s9}"),
        (create_text_overlay, reg10, s1, tf_left_align|tf_with_outline),
        (faction_get_color, ":var54", ":var43"),
        (overlay_set_color, reg10, ":var54"),
        (position_set_x, pos3, 750),
        (position_set_y, pos3, 850),
        (overlay_set_size, reg10, pos3),
        (position_set_x, pos3, 10),
        (position_set_y, pos3, ":var24"),
        (overlay_set_position, reg10, pos3),
        (assign, ":var23", 165),
        (assign, ":var31", 0),
        (position_set_x, ":var31", 700),
        (position_set_y, ":var31", 800),
        (call_script, "script_evaluate_faction_prejudice", "p_main_party", ":var43"),
        (create_text_overlay, reg19, "@{reg1}", tf_right_align),
        (try_begin),
          (lt, reg1, 0),
          (overlay_animate_to_color, reg19, 200, 0xFF2222),
        (try_end),
        (overlay_set_size, reg19, ":var31"),
        (store_add, ":var29", ":var23", 20),
        (position_set_x, pos1, ":var29"),
        (position_set_y, pos1, ":var24"),
        (overlay_set_position, reg19, pos1),
        (val_add, ":var24", 18),
      (try_end),
      (set_container_overlay, -1),
    ]),
    (ti_on_presentation_event_state_change,
    [
      (store_trigger_param_1, ":var0"),
      (troop_get_slot, ":var1", "trp_multiplayer_end", 24),
      (try_begin),
        (eq, ":var0", "$g_jrider_faction_report_return_to_menu"),
        (presentation_set_duration, 0),
        (jump_to_menu, "mnu_caravan_town_troops_recruiting2"),
      (else_try),
        (eq, ":var0", ":var1"),
        (presentation_set_duration, 0),
        (jump_to_menu, "mnu_town"),
      (else_try),
      (try_end),
    ]),
    (ti_on_presentation_run,
    [
      (try_begin),
        (this_or_next|key_clicked, key_escape),
        (key_clicked, key_right_mouse_button),
        (presentation_set_duration, 0),
        (jump_to_menu, "mnu_town"),
      (try_end),
    ]),
  ]),

  ("jrider_character_relation_report", 0, mesh_message_window,
  [
    (ti_on_presentation_load,
    [
      (presentation_set_duration, 999999),
      (set_fixed_point_multiplier, 1000),
      (str_clear, s0),
      (str_clear, s1),
      (try_begin),
        (eq, "$g_character_presentation_type", 0),
        (str_store_string, s0, "@ Courtships in progress "),
        (assign, ":var0", 160),
        (assign, ":var1", 480),
        (assign, ":var2", 0),
        (assign, "$g_base_character_presentation_storage_index", 1000),
        (call_script, "script_generate_known_poems_string"),
        (create_text_overlay, reg1, s1, tf_left_align),
        (position_set_x, pos1, 590),
        (position_set_y, pos1, 55),
        (overlay_set_position, reg1, pos1),
        (position_set_x, pos1, 750),
        (position_set_y, pos1, 850),
        (overlay_set_size, reg1, pos1),
        (overlay_set_color, reg1, 0xFF66CC),
      (else_try),
        (eq, "$g_character_presentation_type", 1),
        (str_store_string, s0, "@ Known Lords by Relation "),
        (assign, ":var0", 110),
        (assign, ":var1", 550),
        (assign, ":var2", 0),
        (assign, "$g_base_character_presentation_storage_index", 2000),
      (else_try),
        (eq, "$g_character_presentation_type", 2),
        (str_store_string, s0, "@ Character & Companions "),
        (assign, ":var0", 110),
        (assign, ":var1", 550),
        (assign, ":var2", 0),
        (assign, "$g_base_character_presentation_storage_index", 3000),
        (assign, ":var3", 0),
        (position_set_x, ":var3", 400),
        (position_set_y, ":var3", 400),
        (create_mesh_overlay, reg1, "mesh_mp_inventory_left"),
        (position_set_x, pos1, 67),
        (position_set_y, pos1, 300),
        (overlay_set_position, reg1, pos1),
        (overlay_set_size, reg1, ":var3"),
        (create_mesh_overlay, reg1, "mesh_mp_inventory_right"),
        (position_set_x, pos1, 450),
        (position_set_y, pos1, 330),
        (overlay_set_position, reg1, pos1),
        (overlay_set_size, reg1, ":var3"),
      (try_end),
      (create_mesh_overlay, reg1, "mesh_face_gen_window"),
      (position_set_x, pos1, 0),
      (position_set_y, pos1, 0),
      (overlay_set_position, reg1, pos1),
      (position_set_x, pos1, 1000),
      (position_set_y, pos1, 1000),
      (overlay_set_size, reg1, pos1),
      (create_text_overlay, reg1, s0, tf_center_justify),
      (overlay_set_color, reg1, 0xDDDDDD),
      (position_set_x, pos1, 740),
      (position_set_y, pos1, 680),
      (overlay_set_position, reg1, pos1),
      (position_set_x, pos1, 1200),
      (position_set_y, pos1, 1200),
      (overlay_set_size, reg1, pos1),
      (create_game_button_overlay, "$g_jrider_faction_report_return_to_menu", "@ Done "),
      (position_set_x, pos1, 290),
      (position_set_y, pos1, 10),
      (overlay_set_position, "$g_jrider_faction_report_return_to_menu", pos1),
      (create_text_overlay, "$g_jrider_character_information_text", "str_space", tf_left_align),
      (overlay_set_color, "$g_jrider_character_information_text", 0xFFFFFF),
      (position_set_x, pos1, 55),
      (position_set_y, pos1, 60),
      (overlay_set_position, "$g_jrider_character_information_text", pos1),
      (position_set_x, pos1, 700),
      (position_set_y, pos1, 800),
      (overlay_set_size, "$g_jrider_character_information_text", pos1),
      (create_text_overlay, "$g_jrider_character_relation_listbox", "str_empty_string", tf_scrollable_style_2),
      (position_set_x, pos1, 590),
      (position_set_y, pos1, ":var0"),
      (overlay_set_position, "$g_jrider_character_relation_listbox", pos1),
      (position_set_x, pos1, 335),
      (position_set_y, pos1, ":var1"),
      (overlay_set_area_size, "$g_jrider_character_relation_listbox", pos1),
      (create_combo_button_overlay, "$g_jrider_character_faction_filter", "str_empty_string", 0),
      (position_set_x, pos1, 507),
      (position_set_y, pos1, 709),
      (overlay_set_position, "$g_jrider_character_faction_filter", pos1),
      (position_set_x, pos1, 550),
      (position_set_y, pos1, 650),
      (overlay_set_size, "$g_jrider_character_faction_filter", pos1),
      (overlay_add_item, "$g_jrider_character_faction_filter", "@Your supporters"),
      (try_for_range, ":var4", "fac_kingdom_1", "fac_kingdoms_end"),
        (call_script, "script_faction_get_adjective_to_s10", ":var4"),
        (overlay_add_item, "$g_jrider_character_faction_filter", "@{s10}s"),
      (try_end),
      (overlay_add_item, "$g_jrider_character_faction_filter", "@All Factions"),
      (try_begin),
        (this_or_next|eq, "$g_jrider_pres_called_from_menu", 1),
        (eq, "$g_jrider_faction_filter", -1),
        (assign, "$g_jrider_faction_filter", -1),
        (overlay_set_val, "$g_jrider_character_faction_filter", 7),
      (else_try),
        (overlay_set_val, "$g_jrider_character_faction_filter", "$g_jrider_faction_filter"),
      (try_end),
      (assign, "$num_charinfo_candidates", 0),
      (call_script, "script_fill_relation_canditate_list_for_presentation", "$g_character_presentation_type", ":var2"),
      (assign, "$g_jrider_reset_selected_on_faction", 0),
      (gt, "$num_charinfo_candidates", 0),
      (store_add, ":var5", "$g_base_character_presentation_storage_index", "$g_latest_character_relation_entry"),
      (troop_get_slot, "$character_info_id", "trp_temp_array_c", ":var5"),
      (call_script, "script_generate_extended_troop_relation_information_string", "$character_info_id"),
      (overlay_set_text, "$g_jrider_character_information_text", s1),
      (overlay_set_color, "$g_jrider_last_checked_indicator", 0xFF6666FF),
      (overlay_set_alpha, "$g_jrider_last_checked_indicator", 0x44),
      (create_image_button_overlay_with_tableau_material, "$g_jrider_character_portrait", -1, "tableau_troop_note_mesh", "$character_info_id"),
      (position_set_x, pos2, 100),
      (position_set_y, pos2, 280),
      (overlay_set_position, "$g_jrider_character_portrait", pos2),
      (position_set_x, pos2, 1100),
      (position_set_y, pos2, 1100),
      (overlay_set_size, "$g_jrider_character_portrait", pos2),
      (try_begin),
        (store_faction_of_troop, ":var6", "$character_info_id"),
        (neq, ":var6", "fac_player_supporters_faction"),
        (is_between, ":var6", "fac_player_supporters_faction", "fac_kingdoms_end"),
        (store_sub, ":var7", ":var6", "fac_player_supporters_faction"),
        (val_add, ":var7", "mesh_pic_recruits"),
        (create_mesh_overlay, "$g_jrider_faction_coat_of_arms", ":var7"),
        (position_set_x, pos3, 150),
        (position_set_y, pos3, 600),
        (overlay_set_position, "$g_jrider_faction_coat_of_arms", pos3),
        (position_set_x, pos3, 250),
        (position_set_y, pos3, 250),
        (overlay_set_size, "$g_jrider_faction_coat_of_arms", pos3),
      (try_end),
      (try_begin),
        (eq, "$g_character_presentation_type", 2),
        (assign, ":var8", 452),
        (assign, ":var9", 536),
        (try_for_range, ":var10", 0, 9),
          (troop_get_inventory_slot, reg1, "$character_info_id", ":var10"),
          (try_begin),
            (eq, ":var10", 4),
            (assign, ":var8", 68),
            (assign, ":var9", 557),
          (try_end),
          (try_begin),
            (lt, reg1, 1),
            (try_begin),
              (lt, ":var10", 4),
              (assign, ":var11", "mesh_mp_inventory_slot_equip"),
            (else_try),
              (eq, ":var10", 4),
              (assign, ":var11", "mesh_mp_inventory_slot_helmet"),
            (else_try),
              (eq, ":var10", 5),
              (assign, ":var11", "mesh_mp_inventory_slot_armor"),
            (else_try),
              (eq, ":var10", 6),
              (assign, ":var11", "mesh_mp_inventory_slot_boot"),
            (else_try),
              (eq, ":var10", 7),
              (assign, ":var11", "mesh_mp_inventory_slot_glove"),
            (else_try),
              (eq, ":var10", 8),
              (assign, ":var11", "mesh_mp_inventory_slot_horse"),
            (try_end),
            (create_mesh_overlay, reg11, ":var11"),
            (overlay_set_size, reg11, ":var3"),
            (position_set_x, pos1, ":var8"),
            (position_set_y, pos1, ":var9"),
            (overlay_set_position, reg11, pos1),
            (troop_set_slot, "trp_temp_array_a", ":var10", -1),
            (store_add, ":var12", ":var10", 10),
            (troop_set_slot, "trp_temp_array_a", ":var12", -1),
          (else_try),
            (create_mesh_overlay_with_item_id, reg10, reg1),
            (position_set_x, pos1, 450),
            (position_set_y, pos1, 450),
            (overlay_set_size, reg10, pos1),
            (store_add, ":var13", ":var8", 25),
            (store_add, ":var14", ":var9", 25),
            (position_set_x, pos1, ":var13"),
            (position_set_y, pos1, ":var14"),
            (overlay_set_position, reg10, pos1),
            (troop_set_slot, "trp_temp_array_a", ":var10", reg10),
            (store_add, ":var12", ":var10", 10),
            (troop_set_slot, "trp_temp_array_a", ":var12", reg1),
          (try_end),
          (val_sub, ":var9", 51),
        (try_end),
      (try_end),
      (try_begin),
        (eq, "$g_jrider_pres_called_from_menu", 1),
        (assign, "$g_jrider_pres_called_from_menu", 0),
      (try_end),
    ]),
    (ti_on_presentation_mouse_enter_leave,
    [
      (store_trigger_param_1, ":var0"),
      (store_trigger_param_2, ":var1"),
      (try_begin),
        (eq, "$g_character_presentation_type", 2),
        (try_begin),
          (eq, ":var1", 0),
          (try_for_range, ":var2", 0, 9),
            (troop_slot_eq, "trp_temp_array_a", ":var2", ":var0"),
            (store_add, ":var3", ":var2", 10),
            (troop_get_slot, ":var4", "trp_temp_array_a", ":var3"),
            (set_fixed_point_multiplier, 1000),
            (position_set_x, pos0, 740),
            (position_set_y, pos0, 235),
            (show_item_details, ":var4", pos0, 100),
          (try_end),
        (else_try),
          (try_for_range, ":var2", 0, 9),
            (troop_slot_eq, "trp_temp_array_a", ":var2", ":var0"),
            (close_item_details),
          (try_end),
        (try_end),
      (try_end),
    ]),
    (ti_on_presentation_event_state_change,
    [
      (store_trigger_param_1, ":var0"),
      (store_trigger_param_2, ":var1"),
      (try_begin),
        (eq, ":var0", "$g_jrider_faction_report_return_to_menu"),
        (try_begin),
          (neq, "$num_charinfo_candidates", 0),
          (overlay_set_text, "$g_jrider_character_information_text", "str_empty_string"),
          (overlay_set_alpha, "$g_jrider_last_checked_indicator", 0x00),
        (try_end),
        (presentation_set_duration, 0),
      (else_try),
        (eq, ":var0", "$g_jrider_character_faction_filter"),
        (try_begin),
          (eq, ":var1", 7),
          (assign, "$g_jrider_faction_filter", -1),
        (else_try),
          (assign, "$g_jrider_faction_filter", ":var1"),
        (try_end),
        (assign, "$g_jrider_reset_selected_on_faction", 1000),
        (start_presentation, "prsnt_jrider_character_relation_report"),
      (else_try),
        (neq, ":var0", "$g_jrider_character_information_text"),
        (neq, ":var0", "$g_jrider_character_portrait"),
        (neq, ":var0", "$g_jrider_character_relation_listbox"),
        (store_add, ":var2", ":var0", "$g_base_character_presentation_storage_index"),
        (troop_get_slot, ":var3", "trp_temp_array_b", ":var2"),
        (overlay_set_alpha, "$g_jrider_last_checked_indicator", 0x00),
        (overlay_set_color, "$g_jrider_last_checked_indicator", 0xDDDDDD),
        (assign, "$g_latest_character_relation_entry", ":var3"),
        (assign, "$g_jrider_last_checked_indicator", ":var0"),
        (overlay_set_color, "$g_jrider_last_checked_indicator", 0xFF6666FF),
        (overlay_set_alpha, "$g_jrider_last_checked_indicator", 0x44),
        (val_add, ":var3", "$g_base_character_presentation_storage_index"),
        (troop_get_slot, "$character_info_id", "trp_temp_array_c", ":var3"),
        (start_presentation, "prsnt_jrider_character_relation_report"),
      (try_end),
    ]),
    (ti_on_presentation_run,
    [
      (try_begin),
        (this_or_next|key_clicked, key_escape),
        (key_clicked, key_right_mouse_button),
        (presentation_set_duration, 0),
        (jump_to_menu, "mnu_reports"),
      (try_end),
    ]),
  ]),

  ("companion_overview", 0, mesh_load_window,
  [
    (ti_on_presentation_load,
    [
      (presentation_set_duration, 999999),
      (set_fixed_point_multiplier, 1000),
      (create_in_game_button_overlay, "$g_presentation_obj_2", "str_done"),
      (position_set_x, pos1, 870),
      (position_set_y, pos1, 15),
      (overlay_set_position, "$g_presentation_obj_2", pos1),
      (overlay_set_color, "$g_presentation_obj_2", 0xFFFFFF),
      (try_begin),
        (neq, "$g_player_troop", "trp_player"),
        (create_in_game_button_overlay, "$g_presentation_obj_3", "@Export/Import"),
        (position_set_x, pos1, 650),
        (position_set_y, pos1, 15),
        (overlay_set_position, "$g_presentation_obj_3", pos1),
        (overlay_set_color, "$g_presentation_obj_3", 0xFFFFFF),
      (else_try),
        (assign, "$g_presentation_obj_3", 0),
      (try_end),
      (try_begin),
        (this_or_next|ge, "$cheat_mode", 1),
        (troop_slot_ge, "$g_player_troop", 13, "spr_banner_a"),
        (create_in_game_button_overlay, "$g_presentation_obj_4", "@Reselect Banner"),
        (position_set_x, pos1, 440),
        (position_set_y, pos1, 15),
        (overlay_set_position, "$g_presentation_obj_4", pos1),
        (overlay_set_color, "$g_presentation_obj_4", 0xFFFFFF),
      (else_try),
        (assign, "$g_presentation_obj_4", 0),
      (try_end),
      (assign, ":var0", 900),
      (assign, ":var1", 600),
      (try_for_range, ":var2", "trp_kingdom_heroes_including_player_begin", "trp_kingdom_1_lord"),
        (this_or_next|eq, ":var2", "trp_kingdom_heroes_including_player_begin"),
        (this_or_next|troop_slot_eq, ":var2", 2, 2),
        (this_or_next|troop_slot_eq, ":var2", 2, 6),
        (troop_slot_eq, ":var2", 2, 5),
        (try_begin),
          (eq, ":var2", "trp_kingdom_heroes_including_player_begin"),
          (assign, ":var2", "trp_player"),
        (try_end),
        (str_store_troop_name, s1, ":var2"),
        (position_set_x, pos1, ":var0"),
        (position_set_y, pos1, ":var1"),
        (val_sub, ":var1", 30),
        (try_begin),
          (eq, ":var2", "$g_player_troop"),
          (create_button_overlay, reg0, s1, tf_center_justify|tf_vertical_align_center),
          (overlay_set_alpha, reg0, 0xCC),
        (else_try),
          (create_button_overlay, reg0, s1, tf_center_justify|tf_vertical_align_center),
          (overlay_set_alpha, reg0, 0x99),
        (try_end),
        (assign, ":var3", reg0),
        (overlay_set_position, ":var3", pos1),
        (try_begin),
          (troop_is_wounded, ":var2"),
          (overlay_set_color, ":var3", 0xFF0000),
        (try_end),
        (troop_set_slot, ":var2", 213, ":var3"),
      (try_end),
      (store_mul, ":var4", "$g_player_troop", 2),
      (create_image_button_overlay_with_tableau_material, "$g_presentation_obj_1", -1, "tableau_game_party_window", ":var4"),
      (position_set_x, pos1, 675),
      (position_set_y, pos1, 900),
      (overlay_set_size, "$g_presentation_obj_1", pos1),
      (position_set_x, pos1, -25),
      (position_set_y, pos1, 50),
      (overlay_set_position, "$g_presentation_obj_1", pos1),
      (try_begin),
        (eq, "$g_player_troop", "trp_player"),
        (troop_get_slot, reg1, "trp_player", 7),
        (assign, reg2, "$player_honor"),
        (assign, reg3, "$player_right_to_rule"),
        (str_store_string, s0, "@ Renown: {reg1}^ Honor: {reg2}^ Right to rule: {reg3}"),
      (else_try),
        (troop_slot_eq, "$g_player_troop", 2, 5),
        (call_script, "script_dplmc_npc_morale", "$g_player_troop", 0),
        (assign, reg1, reg0),
        (str_store_string, s2, "str_morale_reg1"),
        (call_script, "script_companion_get_mission_string", "$g_player_troop"),
        (str_store_string, s0, "@{s2}^{s8}^({s5})"),
      (else_try),
        (this_or_next|troop_slot_eq, "$g_player_troop", 2, 2),
        (troop_slot_eq, "$g_player_troop", 2, 6),
        (call_script, "script_troop_get_player_relation", "$g_player_troop"),
        (assign, reg1, reg0),
        (str_store_string, s2, "str_relation_reg1"),
        (str_clear, s0),
        (try_begin),
          (call_script, "script_cf_dplmc_troop_is_female", "$g_player_troop"),
          (str_store_string, s1, "str_faction_title_female_player"),
        (else_try),
          (str_store_string, s1, "str_faction_title_male_player"),
        (try_end),
        (call_script, "script_print_troop_owned_centers_in_numbers_to_s0", "$g_player_troop"),
        (assign, ":var5", reg0),
        (try_begin),
          (eq, ":var5", 0),
          (try_begin),
            (troop_slot_eq, "$g_player_troop", 2, 6),
            (troop_get_slot, ":var6", "$g_player_troop", 12),
            (is_between, ":var6", "p_town_1", "p_village_1"),
            (str_store_party_name, s0, ":var6"),
          (else_try),
            (store_faction_of_troop, ":var7", "$g_player_troop"),
            (str_store_faction_name, s0, ":var7"),
          (try_end),
        (try_end),
        (troop_get_slot, reg2, "$g_player_troop", 7),
        (str_store_string, s0, "@ Renown: {reg2}^{s2}^{s1}of {s0}"),
      (else_try),
        (str_clear, s0),
      (try_end),
      (str_store_troop_name, s4, "$g_player_troop"),
      (store_character_level, reg3, "$g_player_troop"),
      (store_troop_health, reg2, "$g_player_troop", 1),
      (call_script, "script_dplmc_get_troop_max_hp", "$g_player_troop"),
      (str_store_string, s1, "@Name: {s4}^Level: {reg3}^HP: {reg2}/{reg0}^^{s0}"),
      (create_text_overlay, reg0, s1, tf_double_space),
      (position_set_x, pos1, 130),
      (position_set_y, pos1, 90),
      (overlay_set_position, reg0, pos1),
      (create_mesh_overlay, reg1, "mesh_inventory_equipment_panel"),
      (position_set_x, pos1, 960),
      (position_set_y, pos1, 960),
      (overlay_set_size, reg1, pos1),
      (position_set_x, pos1, 10),
      (position_set_y, pos1, 15),
      (overlay_set_position, reg1, pos1),
      (assign, ":var8", 219),
      (assign, ":var9", 683),
      (assign, ":var4", "$g_player_troop"),
      (store_add, ":var0", ":var8", 140),
      (store_add, ":var1", ":var9", 2),
      (position_set_x, pos1, 259),
      (position_set_y, pos1, ":var9"),
      (create_text_overlay, reg1, "@Arms", tf_center_justify),
      (overlay_set_position, reg1, pos1),
      (create_text_overlay, reg1, "@Outfit", tf_center_justify),
      (store_add, ":var0", ":var8", -98),
      (store_add, ":var1", ":var9", 2),
      (position_set_x, pos1, ":var0"),
      (position_set_y, pos1, ":var1"),
      (overlay_set_position, reg1, pos1),
      (create_text_overlay, reg1, "@Horse", tf_center_justify),
      (store_add, ":var0", ":var8", -140),
      (store_add, ":var1", ":var9", -278),
      (position_set_x, pos1, ":var0"),
      (position_set_y, pos1, ":var1"),
      (overlay_set_position, reg1, pos1),
      (assign, "$g_current_opened_item_details", -1),
      (assign, ":var0", ":var8"),
      (assign, ":var1", ":var9"),
      (try_for_range, ":var10", 0, 9),
        (try_begin),
          (eq, ":var10", 4),
          (val_sub, ":var0", 96),
          (assign, ":var1", ":var9"),
        (else_try),
          (eq, ":var10", 7),
          (val_sub, ":var0", 84),
          (store_sub, ":var1", ":var9", 85),
        (else_try),
          (eq, ":var10", 8),
          (val_sub, ":var1", 108),
        (try_end),
        (val_sub, ":var1", 85),
        (troop_get_inventory_slot, ":var11", ":var4", ":var10"),
        (position_set_x, pos1, ":var0"),
        (position_set_y, pos1, ":var1"),
        (try_begin),
          (lt, ":var11", 0),
          (assign, ":var11", 0),
          (troop_set_slot, "trp_temp_array_c", ":var10", -1),
        (else_try),
          (create_mesh_overlay_with_item_id, reg1, ":var11"),
          (position_set_x, pos1, 850),
          (position_set_y, pos1, 850),
          (overlay_set_size, reg1, pos1),
          (store_add, ":var12", ":var0", 42),
          (store_add, ":var13", ":var1", 42),
          (position_set_x, pos1, ":var12"),
          (position_set_y, pos1, ":var13"),
          (overlay_set_position, reg1, pos1),
          (troop_set_slot, "trp_temp_array_c", ":var10", reg1),
        (try_end),
      (try_end),
      (try_begin),
        (str_clear, s19),
        (troop_get_slot, ":var14", "$g_player_troop", 59),
        (str_store_party_name, s20, ":var14"),
        (troop_get_slot, ":var15", "$g_player_troop", 60),
        (str_store_party_name, s21, ":var15"),
        (troop_get_slot, ":var16", "$g_player_troop", 129),
        (str_store_string, s5, ":var16"),
        (troop_get_slot, ":var17", "$g_player_troop", 105),
        (str_store_string, s6, ":var17"),
        (troop_get_slot, ":var18", "$g_player_troop", 111),
        (str_store_string, s7, ":var18"),
        (create_text_overlay, ":var3", "@{s5}^^{s6}^^{s7}", tf_scrollable_style_2),
      (try_end),
      (position_set_x, pos1, 330),
      (position_set_y, pos1, 530),
      (overlay_set_position, ":var3", pos1),
      (position_set_x, pos1, 420),
      (position_set_y, pos1, 190),
      (overlay_set_area_size, ":var3", pos1),
      (position_set_x, pos1, 850),
      (position_set_y, pos1, 850),
      (overlay_set_size, ":var3", pos1),
      (str_store_string, s3, "@Attributes:"),
      (store_attribute_level, reg1, "$g_player_troop", ca_strength),
      (store_attribute_level, reg2, "$g_player_troop", ca_agility),
      (store_attribute_level, reg3, "$g_player_troop", ca_intelligence),
      (store_attribute_level, reg4, "$g_player_troop", ca_charisma),
      (str_store_string, s3, "@{s3}^STR: {reg1}^AGI: {reg2}^INT: {reg3}^CHA: {reg4}"),
      (store_proficiency_level, reg1, "$g_player_troop", ca_strength),
      (store_proficiency_level, reg2, "$g_player_troop", ca_agility),
      (store_proficiency_level, reg3, "$g_player_troop", ca_intelligence),
      (store_proficiency_level, reg4, "$g_player_troop", ca_charisma),
      (store_proficiency_level, reg5, "$g_player_troop", 4),
      (store_proficiency_level, reg6, "$g_player_troop", 5),
      (str_store_string, s13, "str_dplmc_hero_wpn_slot_polearm_all"),
      (str_store_string, s14, "str_dplmc_hero_wpn_slot_bow"),
      (str_store_string, s15, "str_dplmc_hero_wpn_slot_crossbow"),
      (str_store_string, s3, "@{s3}^^Proficiencies:^1H Weapons: {reg1}^2H Weapons: {reg2}^{s13}: {reg3}^{s14}: {reg4}^{s15}: {reg5}^Throwing: {reg6}"),
      (create_text_overlay, reg0, s3, tf_double_space),
      (position_set_x, pos1, 330),
      (position_set_y, pos1, 100),
      (overlay_set_position, reg0, pos1),
      (str_store_string, s4, "@Skills:"),
      (try_for_range_backwards, ":var19", 0, 37),
        (store_skill_level, reg1, ":var19", "$g_player_troop"),
        (gt, reg1, 0),
        (store_add, ":var20", "str_skl_trade", ":var19"),
        (str_store_string, s1, ":var20"),
        (str_store_string, s4, "@{s4}^{s1} : {reg1}"),
      (try_end),
      (create_text_overlay, reg0, s4, tf_right_align|tf_double_space),
      (position_set_x, pos1, 800),
      (position_set_y, pos1, 100),
      (overlay_set_position, reg0, pos1),
    ]),
    (ti_on_presentation_mouse_enter_leave,
    [
      (store_trigger_param_1, ":var0"),
      (store_trigger_param_2, ":var1"),
      (try_for_range, ":var2", 0, 9),
        (troop_slot_eq, "trp_temp_array_c", ":var2", ":var0"),
        (try_begin),
          (eq, ":var1", 0),
          (troop_get_inventory_slot, ":var3", "$g_player_troop", ":var2"),
          (gt, ":var3", -1),
          (troop_get_inventory_slot_modifier, ":var4", "$g_player_troop", ":var2"),
          (overlay_get_position, 1, ":var0"),
          (show_item_details_with_modifier, ":var3", ":var4", pos1, 100),
        (else_try),
          (eq, ":var1", 1),
          (close_item_details),
        (try_end),
      (try_end),
    ]),
    (ti_on_presentation_event_state_change,
    [
      (store_trigger_param_1, ":var0"),
      (try_begin),
        (eq, ":var0", "$g_presentation_obj_1"),
        (change_screen_notes, 1, "$g_player_troop"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_2"),
        (presentation_set_duration, 0),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_3"),
        (assign, "$g_next_menu", "mnu_companion_report"),
        (jump_to_menu, "mnu_export_import"),
        (set_player_troop, "$g_player_troop"),
        (presentation_set_duration, 0),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_4"),
        (assign, "$g_presentation_next_presentation", "prsnt_companion_overview"),
        (start_presentation, "prsnt_banner_selection"),
      (try_end),
      (try_for_range, ":var1", "trp_kingdom_heroes_including_player_begin", "trp_kingdom_1_lord"),
        (this_or_next|eq, ":var1", "trp_kingdom_heroes_including_player_begin"),
        (this_or_next|troop_slot_eq, ":var1", 2, 2),
        (troop_slot_eq, ":var1", 2, 5),
        (try_begin),
          (eq, ":var1", "trp_kingdom_heroes_including_player_begin"),
          (assign, ":var1", "trp_player"),
        (try_end),
        (troop_slot_eq, ":var1", 213, ":var0"),
        (assign, "$g_player_troop", ":var1"),
        (start_presentation, "prsnt_companion_overview"),
      (try_end),
    ]),
  ]),

  ("recruiter_troops_available2", 0, mesh_message_window,
  [
    (ti_on_presentation_load,
    [
      (presentation_set_duration, 999999),
      (set_fixed_point_multiplier, 1000),
      (store_faction_of_party, ":var0", "$current_town"),
      (create_mesh_overlay, reg1, "mesh_pic_castledes"),
      (position_set_x, pos1, 180),
      (position_set_y, pos1, 180),
      (overlay_set_size, reg1, pos1),
      (position_set_x, pos1, 795),
      (position_set_y, pos1, 600),
      (overlay_set_position, reg1, pos1),
      (create_mesh_overlay, reg1, "mesh_pic_looted_village"),
      (position_set_x, pos1, 170),
      (position_set_y, pos1, 170),
      (overlay_set_size, reg1, pos1),
      (position_set_x, pos1, -15),
      (position_set_y, pos1, 600),
      (overlay_set_position, reg1, pos1),
      (create_text_overlay, reg1, "@ Recruiter Report ", tf_center_justify),
      (position_set_x, pos1, 500),
      (position_set_y, pos1, 670),
      (overlay_set_position, reg1, pos1),
      (position_set_x, pos1, 1500),
      (position_set_y, pos1, 1500),
      (overlay_set_size, reg1, pos1),
      (create_game_button_overlay, reg1, "@ Place Request "),
      (position_set_x, pos1, 350),
      (position_set_y, pos1, 23),
      (overlay_set_position, reg1, pos1),
      (assign, "$g_jrider_faction_report_return_to_menu", reg1),
      (create_game_button_overlay, reg2, "@ Quit "),
      (position_set_x, pos2, 650),
      (position_set_y, pos2, 23),
      (overlay_set_position, reg2, pos2),
      (troop_set_slot, "trp_multiplayer_end", 24, reg2),
      (assign, ":var1", 250),
      (assign, ":var2", 620),
      (position_set_y, pos1, ":var2"),
      (try_for_range, ":var3", 1, 5),
        (try_begin),
          (eq, ":var3", 1),
          (str_store_string, s1, "@Diplomacy"),
        (else_try),
          (eq, ":var3", 2),
          (str_store_string, s1, "@Available"),
        (else_try),
          (eq, ":var3", 3),
          (str_store_string, s1, "@Distance"),
        (else_try),
          (eq, ":var3", 4),
          (str_store_string, s1, "@Ordered"),
        (try_end),
        (create_text_overlay, reg10, s1, tf_left_align|tf_with_outline),
        (position_set_x, pos3, 650),
        (position_set_y, pos3, 800),
        (overlay_set_size, reg10, pos3),
        (position_set_x, pos1, ":var1"),
        (overlay_set_position, reg10, pos1),
        (val_add, ":var1", 90),
      (try_end),
      (assign, ":var1", 215),
      (assign, ":var2", 597),
      (assign, ":var4", 0),
      (position_set_x, ":var4", 720),
      (position_set_y, ":var4", 775),
      (assign, ":var5", 50),
      (position_set_x, ":var5", 60),
      (position_set_y, ":var5", 28000),
      (create_text_overlay, reg2, "@trade^Town", tf_center_justify),
      (overlay_set_size, reg2, ":var4"),
      (position_set_x, pos1, ":var1"),
      (position_set_y, pos1, ":var2"),
      (overlay_set_position, reg2, pos1),
      (val_add, ":var1", 45),
      (try_for_range, ":var6", 0, 5),
        (create_mesh_overlay, reg1, "mesh_white_plane"),
        (overlay_set_color, reg1, 0x000000),
        (overlay_set_size, reg1, ":var5"),
        (store_sub, ":var7", ":var1", 15),
        (store_sub, ":var8", ":var2", 500),
        (position_set_x, pos2, ":var7"),
        (position_set_y, pos2, ":var8"),
        (overlay_set_position, reg1, pos2),
        (val_add, ":var1", 90),
        (try_begin),
          (eq, "$cheat_mode", 1),
          (assign, reg20, ":var6"),
          (display_message, "@{!}DEBUG - Drawing line {reg20}"),
        (try_end),
      (try_end),
      (str_clear, s9),
      (str_clear, s8),
      (str_clear, s3),
      (str_clear, s60),
      (str_clear, s61),
      (str_clear, s0),
      (create_text_overlay, reg1, s0, tf_scrollable_style_2),
      (position_set_x, pos1, 50),
      (position_set_y, pos1, 70),
      (overlay_set_position, reg1, pos1),
      (position_set_x, pos1, 860),
      (position_set_y, pos1, 527),
      (overlay_set_area_size, reg1, pos1),
      (set_container_overlay, reg1),
      (assign, ":var9", 0),
      (assign, ":var2", 0),
      (assign, ":var10", 0),
      (store_troop_gold, ":var11", "trp_household_possessions"),
      (store_troop_gold, ":var12", "trp_player"),
      (store_add, ":var13", ":var11", ":var12"),
      (call_script, "script_list_count", "trp_list_06b"),
      (assign, ":var14", reg1),
      (val_div, ":var14", 10),
      (gt, ":var14", 0),
      (try_for_range, ":var15", 0, ":var14"),
        (str_clear, s10),
        (store_mul, ":var16", ":var15", 10),
        (store_add, ":var17", ":var16", 1),
        (call_script, "script_list_at_nc", "trp_list_06b", ":var17"),
        (assign, ":var18", reg1),
        (str_store_party_name, s10, ":var18"),
        (store_add, ":var17", ":var16", 2),
        (call_script, "script_list_at_nc", "trp_list_06b", ":var17"),
        (assign, ":var19", reg1),
        (try_begin),
          (is_between, ":var19", "fac_kingdom_1", "fac_kingdoms_end"),
          (store_sub, ":var20", ":var19", "fac_kingdom_1"),
          (val_add, ":var20", "str_swadians"),
          (str_store_string, s1, ":var20"),
        (else_try),
          (str_store_string, s1, "@Your kingdom"),
        (try_end),
        (assign, ":var21", 220),
        (assign, ":var22", ":var19"),
        (assign, ":var23", -1),
        (try_for_range, ":var3", 1, 5),
          (try_begin),
            (eq, ":var3", 1),
            (create_text_overlay, reg9, "@{s1}", tf_center_justify),
            (store_sub, ":var7", ":var21", 60),
            (store_add, ":var24", ":var2", 24),
            (position_set_x, pos3, ":var7"),
            (position_set_y, pos3, ":var24"),
            (overlay_set_size, reg9, ":var9"),
            (overlay_set_position, reg9, pos3),
            (store_add, ":var17", ":var16", 3),
            (store_add, ":var17", ":var16", 4),
            (try_begin),
              (call_script, "script_diplomacy_faction_get_diplomatic_status_with_faction", ":var22", ":var0"),
              (assign, ":var25", reg0),
              (assign, ":var26", reg1),
              (try_begin),
                (eq, ":var25", -2),
                (str_store_string, s60, "@War"),
                (assign, reg60, 14483456),
                (assign, reg59, 0),
              (else_try),
                (eq, ":var25", -1),
                (str_store_string, s60, "@Casus Belli"),
                (assign, reg60, 14516224),
                (assign, reg59, ":var26"),
              (else_try),
                (eq, ":var25", 0),
                (str_store_string, s60, "@Peace"),
                (assign, reg60, 16777215),
                (assign, reg59, 0),
              (else_try),
                (eq, ":var25", 1),
                (str_store_string, s60, "@Truce"),
                (assign, reg60, 14540253),
                (assign, reg59, ":var26"),
                (try_begin),
                  (ge, ":var26", 61),
                  (str_store_string, s60, "@Alliance"),
                  (assign, reg60, 65280),
                (else_try),
                  (ge, ":var26", 41),
                  (str_store_string, s60, "@Defense"),
                  (assign, reg60, 65450),
                (else_try),
                  (ge, ":var26", 21),
                  (str_store_string, s60, "@Trade"),
                  (assign, reg60, 65484),
                (try_end),
              (try_end),
            (try_end),
            (val_add, ":var1", 50),
            (create_text_overlay, reg11, s60, tf_left_align|tf_with_outline),
            (overlay_set_color, reg11, reg60),
            (overlay_set_size, reg11, ":var9"),
            (store_add, ":var24", ":var2", 36),
            (store_add, ":var7", ":var21", 0),
            (position_set_x, pos3, ":var7"),
            (position_set_y, pos3, ":var24"),
            (overlay_set_position, reg11, pos3),
            (store_relation, ":var27", ":var22", ":var0"),
            (assign, reg61, ":var27"),
            (create_text_overlay, reg12, "@{reg61}", tf_center_justify),
            (overlay_set_size, reg12, ":var9"),
            (store_add, ":var24", ":var2", 18),
            (store_add, ":var7", ":var21", 10),
            (position_set_x, pos3, ":var7"),
            (position_set_y, pos3, ":var24"),
            (overlay_set_position, reg12, pos3),
          (else_try),
            (eq, ":var3", 2),
            (store_add, ":var17", ":var16", 6),
            (call_script, "script_list_at_nc", "trp_list_06b", ":var17"),
            (assign, ":var23", reg1),
            (val_add, ":var1", 60),
            (store_add, ":var17", ":var16", 10),
            (call_script, "script_list_at_nc", "trp_list_06b", ":var17"),
            (assign, ":var28", reg1),
            (store_mul, ":var29", ":var28", ":var23"),
            (try_begin),
              (gt, ":var29", ":var13"),
              (store_div, ":var23", ":var13", ":var28"),
            (try_end),
            (assign, reg59, ":var23"),
            (create_text_overlay, reg13, "@avail {reg59}", tf_center_justify),
            (overlay_set_size, reg13, ":var9"),
            (store_sub, ":var7", ":var21", 0),
            (store_add, ":var24", ":var2", 54),
            (position_set_x, pos3, ":var7"),
            (position_set_y, pos3, ":var24"),
            (overlay_set_position, reg13, pos3),
            (assign, ":var30", "trp_merc_halfling_militia"),
            (party_get_slot, ":var31", ":var18", 19),
            (try_begin),
              (is_between, ":var31", "fac_culture_1", "fac_player_faction"),
              (store_sub, ":var20", "fac_kingdom_1", "fac_culture_1"),
              (store_add, ":var32", ":var31", ":var20"),
              (faction_get_slot, ":var30", ":var32", 41),
            (try_end),
            (str_store_troop_name, s60, ":var30"),
            (create_text_overlay, reg14, s60, tf_left_align|tf_with_outline),
            (overlay_set_size, reg14, ":var9"),
            (store_add, ":var24", ":var2", 36),
            (store_sub, ":var7", ":var21", 26),
            (position_set_x, pos3, ":var7"),
            (position_set_y, pos3, ":var24"),
            (assign, ":var33", 2565927),
            (try_begin),
              (is_between, ":var32", "fac_kingdom_1", "fac_kingdoms_end"),
              (faction_get_color, ":var33", ":var32"),
            (try_end),
            (overlay_set_color, reg14, ":var33"),
            (overlay_set_position, reg14, pos3),
          (else_try),
            (eq, ":var3", 3),
            (store_add, ":var17", ":var16", 5),
            (call_script, "script_list_at_nc", "trp_list_06b", ":var17"),
            (assign, reg59, reg1),
            (val_add, ":var1", 60),
            (create_text_overlay, reg15, "@dist {reg59}", tf_center_justify),
            (overlay_set_size, reg15, ":var9"),
            (overlay_set_color, reg15, reg60),
            (store_sub, ":var7", ":var21", 0),
            (store_add, ":var24", ":var2", 54),
            (position_set_x, pos3, ":var7"),
            (position_set_y, pos3, ":var24"),
            (overlay_set_position, reg15, pos3),
            (store_add, ":var17", ":var16", 8),
            (call_script, "script_list_at_nc", "trp_list_06b", ":var17"),
            (assign, reg60, reg1),
            (val_add, ":var1", 45),
            (str_store_string, s60, "@days {reg60}"),
            (create_text_overlay, reg16, s60, tf_left_align|tf_with_outline),
            (overlay_set_size, reg16, ":var9"),
            (store_add, ":var24", ":var2", 36),
            (store_add, ":var7", ":var21", 0),
            (position_set_x, pos3, ":var7"),
            (position_set_y, pos3, ":var24"),
            (overlay_set_color, reg16, 0x684848),
            (overlay_set_position, reg16, pos3),
          (else_try),
            (eq, ":var3", 4),
            (val_add, ":var1", 65),
            (store_add, ":var17", ":var16", 7),
            (call_script, "script_list_at_nc", "trp_list_06b", ":var17"),
            (assign, ":var34", reg1),
            (store_add, ":var17", ":var16", 6),
            (call_script, "script_list_at_nc", "trp_list_06b", ":var17"),
            (assign, ":var23", reg1),
            (try_begin),
              (gt, ":var23", 0),
              (try_begin),
                (gt, ":var34", 0),
                (val_add, ":var10", 1),
                (assign, reg57, ":var34"),
                (create_text_overlay, reg17, "@order {reg57}", tf_center_justify),
                (store_sub, ":var7", ":var21", 0),
                (store_add, ":var24", ":var2", 54),
                (position_set_x, pos3, ":var7"),
                (position_set_y, pos3, ":var24"),
                (overlay_set_position, reg17, pos3),
              (else_try),
                (le, ":var34", 0),
                (create_text_overlay, reg17, "@none", tf_center_justify),
                (overlay_set_size, reg17, ":var9"),
                (overlay_set_size, reg17, ":var9"),
                (store_sub, ":var7", ":var21", 0),
                (store_add, ":var24", ":var2", 54),
                (position_set_x, pos3, ":var7"),
                (position_set_y, pos3, ":var24"),
                (overlay_set_position, reg17, pos3),
              (try_end),
            (else_try),
              (lt, ":var23", 1),
              (create_text_overlay, reg17, "@none", tf_center_justify),
              (overlay_set_size, reg17, ":var9"),
              (overlay_set_size, reg17, ":var9"),
              (store_sub, ":var7", ":var21", 0),
              (store_add, ":var24", ":var2", 54),
              (position_set_x, pos3, ":var7"),
              (position_set_y, pos3, ":var24"),
              (overlay_set_position, reg17, pos3),
            (try_end),
            (store_add, ":var17", ":var16", 10),
            (call_script, "script_list_at_nc", "trp_list_06b", ":var17"),
            (assign, ":var28", reg1),
            (val_mul, ":var28", ":var34"),
            (assign, reg61, ":var28"),
            (val_add, ":var1", 50),
            (str_store_string, s60, "@cost {reg61}"),
            (create_text_overlay, reg18, s60, tf_left_align|tf_center_justify),
            (overlay_set_size, reg18, ":var9"),
            (store_add, ":var24", ":var2", 36),
            (store_sub, ":var7", ":var21", 5),
            (position_set_x, pos3, ":var7"),
            (position_set_y, pos3, ":var24"),
            (overlay_set_position, reg18, pos3),
          (try_end),
          (val_add, ":var21", 90),
        (try_end),
        (assign, ":var1", 165),
        (val_add, ":var2", 54),
        (create_mesh_overlay, reg1, "mesh_white_plane"),
        (overlay_set_color, reg1, 0x000000),
        (position_set_x, pos1, 42000),
        (position_set_y, pos1, 60),
        (overlay_set_size, reg1, pos1),
        (position_set_x, pos1, 17),
        (store_add, ":var24", ":var2", 20),
        (position_set_y, pos1, ":var24"),
        (overlay_set_position, reg1, pos1),
        (str_store_party_name, s9, ":var18"),
        (str_store_string, s1, "@{s9}"),
        (create_text_overlay, reg10, s1, tf_left_align|tf_with_outline),
        (faction_get_color, ":var35", ":var22"),
        (overlay_set_color, reg10, ":var35"),
        (position_set_x, pos3, 750),
        (position_set_y, pos3, 850),
        (overlay_set_size, reg10, pos3),
        (position_set_x, pos3, 10),
        (position_set_y, pos3, ":var2"),
        (overlay_set_position, reg10, pos3),
        (assign, ":var1", 165),
        (assign, ":var9", 0),
        (position_set_x, ":var9", 700),
        (position_set_y, ":var9", 800),
        (call_script, "script_evaluate_faction_prejudice", "p_main_party", ":var22"),
        (create_text_overlay, reg19, "@{reg1}", tf_right_align),
        (try_begin),
          (lt, reg1, 0),
          (overlay_animate_to_color, reg19, 200, 0xFF2222),
        (try_end),
        (overlay_set_size, reg19, ":var9"),
        (store_add, ":var7", ":var1", 20),
        (position_set_x, pos1, ":var7"),
        (position_set_y, pos1, ":var2"),
        (overlay_set_position, reg19, pos1),
        (val_add, ":var2", 18),
      (try_end),
      (set_container_overlay, -1),
    ]),
    (ti_on_presentation_event_state_change,
    [
      (store_trigger_param_1, ":var0"),
      (troop_get_slot, ":var1", "trp_multiplayer_end", 24),
      (try_begin),
        (eq, ":var0", "$g_jrider_faction_report_return_to_menu"),
        (presentation_set_duration, 0),
        (mission_enable_talk),
        (start_mission_conversation, "trp_dplmc_constable"),
      (else_try),
        (eq, ":var0", ":var1"),
        (presentation_set_duration, 0),
        (mission_enable_talk),
        (start_mission_conversation, "trp_dplmc_constable"),
      (try_end),
    ]),
    (ti_on_presentation_run,
    [
      (try_begin),
        (this_or_next|key_clicked, key_escape),
        (key_clicked, key_right_mouse_button),
        (presentation_set_duration, 0),
        (mission_enable_talk),
        (start_mission_conversation, "trp_dplmc_constable"),
      (try_end),
    ]),
  ]),

  ("dplmc_set_vassal_title", 0, mesh_load_window,
  [
    (ti_on_presentation_load,
    [
      (set_fixed_point_multiplier, 1000),
      (str_clear, s1),
      (str_clear, s2),
      (create_text_overlay, reg0, "@How will your male vassals be known?", tf_center_justify),
      (position_set_x, pos1, 500),
      (position_set_y, pos1, 600),
      (overlay_set_position, reg0, pos1),
      (create_text_overlay, reg0, "@How will your female vassals be known?", tf_center_justify),
      (position_set_x, pos1, 500),
      (position_set_y, pos1, 400),
      (overlay_set_position, reg0, pos1),
      (create_simple_text_box_overlay, "$g_presentation_obj_name_kingdom_1"),
      (position_set_x, pos1, 400),
      (position_set_y, pos1, 500),
      (overlay_set_position, "$g_presentation_obj_name_kingdom_1", pos1),
      (try_begin),
        (troop_slot_eq, "trp_heroes_end", 0, 1),
        (str_store_troop_name, s0, "trp_heroes_end"),
      (else_try),
        (str_clear, s0),
        (store_sub, ":var0", "$players_kingdom", "fac_player_supporters_faction"),
        (val_add, ":var0", "str_faction_title_male_player"),
        (str_store_string, s0, ":var0"),
      (try_end),
      (overlay_set_text, "$g_presentation_obj_name_kingdom_1", s0),
      (create_simple_text_box_overlay, reg0),
      (position_set_x, pos1, 400),
      (position_set_y, pos1, 300),
      (overlay_set_position, reg0, pos1),
      (try_begin),
        (troop_slot_eq, "trp_heroes_end", 1, 1),
        (str_store_troop_name_plural, s0, "trp_heroes_end"),
      (else_try),
        (str_clear, s0),
        (store_sub, ":var0", "$players_kingdom", "fac_player_supporters_faction"),
        (val_add, ":var0", "str_faction_title_female_player"),
        (str_store_string, s0, ":var0"),
      (try_end),
      (overlay_set_text, reg0, s0),
      (create_game_button_overlay, reg0, "str_done", 16),
      (position_set_x, pos1, 500),
      (position_set_y, pos1, 150),
      (overlay_set_position, reg0, pos1),
      (create_game_button_overlay, reg0, "str_reset_to_default", 16),
      (position_set_x, pos1, 500),
      (position_set_y, pos1, 100),
      (overlay_set_position, reg0, pos1),
      (assign, ":var1", "trp_temporary_minister"),
      (assign, ":var2", "trp_list_06"),
      (assign, ":var3", 0),
      (assign, ":var4", 0),
      (assign, "$lord_selected", 0),
      (try_begin),
        (troop_get_slot, ":var5", "trp_player", 30),
        (is_between, ":var5", "trp_npc1", "trp_heroes_end"),
        (try_begin),
          (call_script, "script_cf_dplmc_troop_is_female", ":var5"),
          (assign, ":var2", ":var5"),
          (assign, ":var4", 9999),
        (else_try),
          (assign, ":var1", ":var5"),
          (assign, ":var3", 9999),
        (try_end),
      (try_end),
      (try_for_range, ":var6", "trp_npc1", "trp_heroes_end"),
        (store_faction_of_troop, ":var7", ":var6"),
        (eq, ":var7", "$players_kingdom"),
        (troop_get_slot, ":var8", ":var6", 2),
        (try_begin),
          (eq, ":var8", 2),
          (troop_get_slot, ":var9", ":var6", 7),
          (try_begin),
            (call_script, "script_cf_dplmc_troop_is_female", ":var6"),
            (lt, ":var4", ":var9"),
            (assign, ":var2", ":var6"),
          (else_try),
            (lt, ":var3", ":var9"),
            (assign, ":var1", ":var6"),
          (try_end),
        (else_try),
          (eq, ":var8", 6),
          (troop_get_slot, ":var9", ":var6", 18),
          (lt, ":var4", ":var9"),
          (assign, ":var2", ":var6"),
        (try_end),
      (try_end),
      (init_position, pos1),
      (create_mesh_overlay_with_tableau_material, reg1, -1, "tableau_dplmc_lord_profile", ":var1"),
      (position_set_x, pos1, 10),
      (position_set_y, pos1, 100),
      (overlay_set_position, reg1, pos1),
      (position_set_x, pos1, 750),
      (position_set_y, pos1, 750),
      (overlay_set_size, reg1, pos1),
      (create_mesh_overlay_with_tableau_material, reg1, -1, "tableau_dplmc_lord_profile", ":var2"),
      (position_set_x, pos1, 750),
      (position_set_y, pos1, 100),
      (overlay_set_position, reg1, pos1),
      (position_set_x, pos1, 750),
      (position_set_y, pos1, 750),
      (overlay_set_size, reg1, pos1),
      (presentation_set_duration, 999999),
    ]),
    (ti_on_presentation_event_state_change,
    [
      (store_trigger_param_1, ":var0"),
      (try_begin),
        (eq, ":var0", "$g_presentation_obj_name_kingdom_1"),
        (str_store_string, s1, s0),
      (else_try),
        (store_add, ":var1", "$g_presentation_obj_name_kingdom_1", 1),
        (eq, ":var0", ":var1"),
        (str_store_string, s2, s0),
      (else_try),
        (val_add, ":var1", 1),
        (eq, ":var0", ":var1"),
        (try_begin),
          (neg|str_is_empty, s1),
          (troop_set_name, "trp_heroes_end", s1),
          (troop_set_slot, "trp_heroes_end", 0, 1),
          (try_for_range, ":var2", "trp_knight_1_1", "trp_kingdom_1_pretender"),
            (store_faction_of_troop, ":var3", ":var2"),
            (eq, ":var3", "$players_kingdom"),
            (call_script, "script_troop_set_title_according_to_faction", ":var2", "fac_player_supporters_faction"),
          (try_end),
        (try_end),
        (try_begin),
          (neg|str_is_empty, s2),
          (troop_set_plural_name, "trp_heroes_end", s2),
          (troop_set_slot, "trp_heroes_end", 1, 1),
          (try_for_range, ":var2", "trp_knight_1_1_wife", "trp_heroes_end"),
            (store_faction_of_troop, ":var3", ":var2"),
            (eq, ":var3", "$players_kingdom"),
            (call_script, "script_troop_set_title_according_to_faction", ":var2", "fac_player_supporters_faction"),
          (try_end),
        (try_end),
        (try_begin),
          (neg|this_or_next|str_is_empty, s1),
          (neg|str_is_empty, s2),
          (try_for_range, ":var2", "trp_npc1", "trp_kingdom_1_lord"),
            (store_faction_of_troop, ":var3", ":var2"),
            (eq, ":var3", "$players_kingdom"),
            (troop_slot_eq, ":var2", 2, 2),
            (call_script, "script_troop_set_title_according_to_faction", ":var2", "fac_player_supporters_faction"),
          (try_end),
        (try_end),
        (presentation_set_duration, 0),
      (else_try),
        (val_add, ":var1", 1),
        (eq, ":var0", ":var1"),
        (troop_set_slot, "trp_heroes_end", 0, 0),
        (troop_set_slot, "trp_heroes_end", 1, 0),
        (try_for_range, ":var2", "trp_knight_1_1", "trp_heroes_end"),
          (neg|is_between, ":var2", "trp_kingdom_1_pretender", "trp_knight_1_1_wife"),
          (store_faction_of_troop, ":var3", ":var2"),
          (eq, ":var3", "$players_kingdom"),
          (call_script, "script_troop_set_title_according_to_faction", ":var2", ":var3"),
        (try_end),
        (try_for_range, ":var2", "trp_npc1", "trp_kingdom_1_lord"),
          (store_faction_of_troop, ":var3", ":var2"),
          (eq, ":var3", "$players_kingdom"),
          (troop_slot_eq, ":var2", 2, 2),
          (call_script, "script_troop_set_title_according_to_faction", ":var2", ":var3"),
        (try_end),
        (presentation_set_duration, 0),
      (try_end),
    ]),
  ]),

  ("gpu_dialog", 0, mesh_pic_bandits,
  [
    (ti_on_presentation_load,
    [
      (set_fixed_point_multiplier, 1000),
      (assign, "$gpu_storage", "trp_tpe_presobj"),
      (assign, "$gpu_data", "trp_tpe_presobj"),
      (presentation_set_duration, 3000),
    ]),
    (ti_on_presentation_event_state_change,
    [
    ]),
    (ti_on_presentation_run,
    [
      (store_trigger_param_1, ":var0"),
      (try_begin),
        (troop_slot_eq, "$gpu_storage", 24, 1),
        (troop_get_slot, ":var1", "$gpu_storage", 28),
        (store_sub, reg21, ":var0", ":var1"),
        (store_mod, reg22, reg21, 1000),
        (eq, reg22, 0),
        (val_div, reg21, 1000),
        (str_store_string, s21, "@{reg21} sec"),
        (troop_get_slot, ":var2", "$gpu_storage", 30),
        (overlay_set_text, ":var2", "@{s21}"),
      (try_end),
      (try_begin),
        (troop_slot_eq, "$gpu_storage", 124, 1),
        (troop_get_slot, ":var1", "$gpu_storage", 128),
        (store_sub, reg21, ":var0", ":var1"),
        (store_mod, reg22, reg21, 1000),
        (eq, reg22, 0),
        (val_div, reg21, 1000),
        (str_store_string, s21, "@{reg21} sec"),
        (troop_get_slot, ":var2", "$gpu_storage", 130),
        (overlay_set_text, ":var2", "@{s21}"),
      (try_end),
    ]),
  ]),

  ("prebattle_custom_deployment", 0, mesh_load_window,
  [
    (ti_on_presentation_load,
    [
      (set_fixed_point_multiplier, 1000),
      (assign, "$g_presentation_credits_obj_1", 0),
      (party_get_slot, ":var0", "p_main_party", 48),
      (set_show_messages, 0),
      (call_script, "script_calculate_battle_advantage"),
      (assign, ":var1", reg0),
      (set_show_messages, 1),
      (call_script, "script_party_count_members_with_full_health", "p_collective_friends"),
      (assign, ":var2", reg0),
      (call_script, "script_party_count_members_with_full_health", "p_main_party"),
      (assign, ":var3", reg0),
      (store_mul, ":var4", ":var3", 100),
      (val_div, ":var4", ":var2"),
      (store_sub, ":var5", ":var0", 30),
      (val_mul, ":var5", 100),
      (val_div, ":var5", 120),
      (assign, ":var6", 12),
      (try_begin),
        (this_or_next|party_slot_eq, "$g_encountered_party", 0, 2),
        (party_slot_eq, "$g_encountered_party", 0, 3),
        (val_mul, ":var1", 2),
        (val_div, ":var1", 3),
        (val_add, ":var6", 6),
        (eq, "$g_next_menu", "mnu_siege_started_defender"),
        (party_slot_eq, "$g_encountered_party", 27, 1),
        (val_add, ":var6", 2),
      (try_end),
      (val_mul, ":var6", 100),
      (store_mul, ":var7", ":var5", 4),
      (val_add, ":var7", 125),
      (val_add, ":var1", 15),
      (val_mul, ":var1", 100),
      (val_div, ":var1", 15),
      (val_clamp, ":var1", 20, 250),
      (val_mul, ":var7", ":var1"),
      (val_mul, ":var7", ":var6"),
      (val_div, ":var7", 1000000),
      (val_add, ":var7", 1),
      (store_mul, ":var8", ":var7", ":var4"),
      (val_div, ":var8", 100),
      (val_min, ":var8", ":var3"),
      (party_set_slot, "p_main_party", 49, ":var8"),
      (create_text_overlay, reg0, "@Plan Deployment", tf_center_justify|tf_single_line|tf_with_outline),
      (overlay_set_color, reg0, 0xFFFFFFFF),
      (position_set_x, pos1, 1500),
      (position_set_y, pos1, 1500),
      (overlay_set_size, reg0, pos1),
      (position_set_x, pos1, 500),
      (position_set_y, pos1, 680),
      (overlay_set_position, reg0, pos1),
      (party_get_slot, ":var9", "p_main_party", 49),
      (assign, reg1, ":var9"),
      (create_text_overlay, reg0, "@You will have {reg1} troops available at the battle's start", tf_center_justify|tf_single_line),
      (position_set_x, pos1, 500),
      (position_set_y, pos1, 650),
      (overlay_set_position, reg0, pos1),
      (create_text_overlay, reg0, "@Troop", tf_center_justify),
      (position_set_x, pos1, 105),
      (position_set_y, pos1, 600),
      (overlay_set_position, reg0, pos1),
      (create_text_overlay, reg0, "@# at start  / # in party", tf_center_justify),
      (position_set_x, pos1, 385),
      (position_set_y, pos1, 600),
      (overlay_set_position, reg0, pos1),
      (str_clear, s0),
      (create_text_overlay, "$g_presentation_obj_bugdet_report_container", s0, tf_scrollable_style_2),
      (position_set_x, pos1, 50),
      (position_set_y, pos1, 100),
      (overlay_set_position, "$g_presentation_obj_bugdet_report_container", pos1),
      (position_set_x, pos1, 385),
      (position_set_y, pos1, 500),
      (overlay_set_area_size, "$g_presentation_obj_bugdet_report_container", pos1),
      (set_container_overlay, "$g_presentation_obj_bugdet_report_container"),
      (assign, ":var10", 0),
      (assign, ":var11", 40),
      (party_get_num_companion_stacks, ":var12", "p_main_party"),
      (store_mul, ":var13", ":var12", ":var11"),
      (try_for_range, ":var14", 0, ":var12"),
        (party_stack_get_troop_id, ":var15", "p_main_party", ":var14"),
        (neq, ":var15", "trp_player"),
        (party_stack_get_size, ":var16", "p_main_party", ":var14"),
        (party_stack_get_num_wounded, ":var17", "p_main_party", ":var14"),
        (val_sub, ":var16", ":var17"),
        (troop_get_slot, ":var18", ":var15", 37),
        (val_min, ":var18", ":var16"),
        (troop_set_slot, ":var15", 37, ":var18"),
        (val_add, ":var10", ":var18"),
        (str_store_troop_name, s1, ":var15"),
        (create_text_overlay, reg0, s1),
        (position_set_x, pos1, 800),
        (position_set_y, pos1, 800),
        (overlay_set_size, reg0, pos1),
        (position_set_x, pos1, 25),
        (position_set_y, pos1, ":var13"),
        (overlay_set_position, reg0, pos1),
        (assign, reg0, ":var16"),
        (str_store_string, s1, "@/ {reg0}"),
        (create_text_overlay, reg0, s1),
        (position_set_x, pos1, 325),
        (position_set_y, pos1, ":var13"),
        (overlay_set_position, reg0, pos1),
        (val_add, ":var16", 1),
        (create_number_box_overlay, reg0, 0, ":var16"),
        (overlay_set_val, reg0, ":var18"),
        (position_set_x, pos1, 250),
        (position_set_y, pos1, ":var13"),
        (overlay_set_position, reg0, pos1),
        (troop_set_slot, "trp_temp_array_a", ":var15", reg0),
        (val_sub, ":var13", ":var11"),
      (try_end),
      (set_container_overlay, -1),
      (party_set_slot, "p_main_party", 50, ":var10"),
      (assign, reg0, ":var10"),
      (create_text_overlay, reg60, "@{reg0}", tf_with_outline),
      (try_begin),
        (gt, ":var10", ":var9"),
        (overlay_set_color, reg60, 0xFF1100),
      (else_try),
        (overlay_set_color, reg60, 0xFFFFFF),
      (try_end),
      (position_set_x, pos1, 290),
      (position_set_y, pos1, 50),
      (overlay_set_position, reg60, pos1),
      (assign, reg0, ":var9"),
      (create_text_overlay, reg0, "@of {reg0} troops", 0),
      (position_set_x, pos1, 330),
      (position_set_y, pos1, 50),
      (overlay_set_position, reg0, pos1),
      (create_mesh_overlay, reg0, "mesh_pic_charge"),
      (position_set_x, pos1, 700),
      (position_set_y, pos1, 700),
      (overlay_set_size, reg0, pos1),
      (position_set_x, pos1, 225),
      (position_set_y, pos1, 50),
      (overlay_set_position, reg0, pos1),
      (create_game_button_overlay, "$g_presentation_obj_custom_battle_designer_19", "@Ready Troops", 0),
      (position_set_x, pos1, 880),
      (position_set_y, pos1, 15),
      (overlay_set_position, "$g_presentation_obj_custom_battle_designer_19", pos1),
      (create_game_button_overlay, "$g_presentation_obj_custom_battle_designer_20", "@Reassess", 0),
      (position_set_x, pos1, 722),
      (position_set_y, pos1, 15),
      (overlay_set_position, "$g_presentation_obj_custom_battle_designer_20", pos1),
      (create_game_button_overlay, "$g_presentation_obj_custom_battle_designer_18", "@Scrap All", 0),
      (position_set_x, pos1, 565),
      (position_set_y, pos1, 15),
      (overlay_set_position, "$g_presentation_obj_custom_battle_designer_18", pos1),
      (presentation_set_duration, 999999),
    ]),
    (ti_on_presentation_run,
    [
      (try_begin),
        (key_clicked, key_escape),
        (presentation_set_duration, 0),
      (try_end),
      (party_get_slot, ":var0", "p_main_party", 48),
      (this_or_next|lt, ":var0", 30),
      (gt, ":var0", 1000),
      (assign, "$g_presentation_credits_obj_1", 1),
      (start_presentation, "prsnt_prebattle_record_battle_size"),
    ]),
    (ti_on_presentation_event_state_change,
    [
      (store_trigger_param_1, ":var0"),
      (store_trigger_param_2, ":var1"),
      (try_begin),
        (eq, ":var0", "$g_presentation_obj_custom_battle_designer_20"),
        (jump_to_menu, "$g_next_menu"),
        (presentation_set_duration, 0),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_custom_battle_designer_18"),
        (party_get_num_companion_stacks, ":var2", "p_main_party"),
        (try_for_range, ":var3", 0, ":var2"),
          (party_stack_get_troop_id, ":var4", "p_main_party", ":var3"),
          (neq, ":var4", "trp_player"),
          (troop_get_slot, ":var5", "trp_temp_array_a", ":var4"),
          (troop_set_slot, ":var4", 37, 0),
          (overlay_set_val, ":var5", 0),
        (try_end),
        (party_set_slot, "p_main_party", 50, 0),
        (overlay_set_text, reg60, "@0"),
        (overlay_set_color, reg60, 0xFFFFFF),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_custom_battle_designer_19"),
        (party_get_slot, ":var6", "p_main_party", 50),
        (party_get_slot, ":var7", "p_main_party", 49),
        (try_begin),
          (gt, ":var6", ":var7"),
          (create_text_overlay, reg0, "@Too many troops^Check number available", tf_center_justify|tf_with_outline),
          (overlay_set_color, reg0, 0xFF1100),
          (position_set_x, pos1, 600),
          (position_set_y, pos1, 500),
          (overlay_set_position, reg0, pos1),
          (position_set_x, pos1, 0),
          (position_set_y, pos1, 0),
          (overlay_animate_to_size, reg0, 3000, pos1),
        (else_try),
          (party_set_slot, "p_main_party", 47, 1),
          (jump_to_menu, "$g_next_menu"),
          (presentation_set_duration, 0),
        (try_end),
      (else_try),
        (party_get_num_companion_stacks, ":var2", "p_main_party"),
        (try_for_range, ":var3", 0, ":var2"),
          (party_stack_get_troop_id, ":var4", "p_main_party", ":var3"),
          (neq, ":var4", "trp_player"),
          (troop_slot_eq, "trp_temp_array_a", ":var4", ":var0"),
          (troop_get_slot, ":var8", ":var4", 37),
          (assign, ":var2", 0),
        (try_end),
        (party_get_slot, ":var6", "p_main_party", 50),
        (party_get_slot, ":var7", "p_main_party", 49),
        (store_sub, ":var9", ":var1", ":var8"),
        (store_add, ":var10", ":var6", ":var9"),
        (try_begin),
          (gt, ":var10", ":var7"),
          (ge, ":var10", ":var6"),
          (try_begin),
            (ge, ":var6", ":var7"),
            (assign, ":var11", ":var8"),
            (assign, ":var10", ":var6"),
          (else_try),
            (store_sub, ":var12", ":var10", ":var7"),
            (val_sub, ":var9", ":var12"),
            (val_max, ":var9", 0),
            (store_add, ":var11", ":var1", ":var9"),
            (store_add, ":var10", ":var6", ":var9"),
          (try_end),
          (overlay_set_val, ":var0", ":var11"),
          (troop_set_slot, ":var4", 37, ":var11"),
        (else_try),
          (troop_set_slot, ":var4", 37, ":var1"),
        (try_end),
        (assign, reg0, ":var10"),
        (overlay_set_text, reg60, "@{reg0}"),
        (try_begin),
          (gt, ":var10", ":var7"),
          (overlay_set_color, reg60, 0xFF1100),
        (else_try),
          (overlay_set_color, reg60, 0xFFFFFF),
        (try_end),
        (party_set_slot, "p_main_party", 50, ":var10"),
      (try_end),
    ]),
  ]),

  ("prebattle_orders", 0, mesh_note_window_bottom,
  [
    (ti_on_presentation_load,
    [
      (set_fixed_point_multiplier, 1000),
      (assign, "$g_formation_group0_selected", 0),
      (assign, "$g_formation_group1_selected", 0),
      (assign, "$g_formation_group2_selected", 0),
      (assign, "$g_formation_group3_selected", 0),
      (assign, "$g_formation_group4_selected", 0),
      (assign, "$g_formation_group5_selected", 0),
      (assign, "$g_formation_group6_selected", 0),
      (assign, "$g_formation_group7_selected", 0),
      (assign, "$g_formation_group8_selected", 0),
      (assign, "$g_presentation_obj_battle_but0", -1),
      (assign, "$g_presentation_obj_battle_but1", -1),
      (assign, "$g_presentation_obj_battle_but2", -1),
      (assign, "$g_presentation_obj_battle_but3", -1),
      (assign, "$g_presentation_obj_battle_but4", -1),
      (assign, "$g_presentation_obj_battle_but5", -1),
      (assign, "$g_presentation_obj_battle_but6", -1),
      (assign, "$g_presentation_obj_battle_but7", -1),
      (assign, "$g_presentation_obj_battle_but8", -1),
      (str_clear, s7),
      (position_set_y, pos1, 700),
      (create_text_overlay, "$g_presentation_credits_obj_2", "@Initial", tf_center_justify|tf_single_line|tf_with_outline),
      (overlay_set_color, "$g_presentation_credits_obj_2", 0xFFAAAAAA),
      (position_set_x, pos1, 225),
      (overlay_set_position, "$g_presentation_credits_obj_2", pos1),
      (create_text_overlay, "$g_presentation_credits_obj_3", "@Movement 1", tf_center_justify|tf_single_line|tf_with_outline),
      (overlay_set_color, "$g_presentation_credits_obj_3", 0xFFAAAAAA),
      (position_set_x, pos1, 357),
      (overlay_set_position, "$g_presentation_credits_obj_3", pos1),
      (create_text_overlay, "$g_presentation_credits_obj_4", "@Movement 2", tf_center_justify|tf_single_line|tf_with_outline),
      (overlay_set_color, "$g_presentation_credits_obj_4", 0xFFAAAAAA),
      (position_set_x, pos1, 487),
      (overlay_set_position, "$g_presentation_credits_obj_4", pos1),
      (create_text_overlay, "$g_presentation_credits_obj_5", "@Formation", tf_center_justify|tf_single_line|tf_with_outline),
      (overlay_set_color, "$g_presentation_credits_obj_5", 0xFFAAAAAA),
      (position_set_x, pos1, 610),
      (overlay_set_position, "$g_presentation_credits_obj_5", pos1),
      (create_text_overlay, "$g_presentation_credits_obj_6", "@Attack", tf_center_justify|tf_single_line|tf_with_outline),
      (overlay_set_color, "$g_presentation_credits_obj_6", 0xFFAAAAAA),
      (position_set_x, pos1, 225),
      (overlay_set_position, "$g_presentation_credits_obj_6", pos1),
      (overlay_set_display, "$g_presentation_credits_obj_6", 0),
      (create_text_overlay, "$g_presentation_credits_obj_7", "@Weapon Type", tf_center_justify|tf_single_line|tf_with_outline),
      (overlay_set_color, "$g_presentation_credits_obj_7", 0xFFAAAAAA),
      (position_set_x, pos1, 360),
      (overlay_set_position, "$g_presentation_credits_obj_7", pos1),
      (overlay_set_display, "$g_presentation_credits_obj_7", 0),
      (create_text_overlay, "$g_presentation_credits_obj_8", "@Shield", tf_center_justify|tf_single_line|tf_with_outline),
      (overlay_set_color, "$g_presentation_credits_obj_8", 0xFFAAAAAA),
      (position_set_x, pos1, 485),
      (overlay_set_position, "$g_presentation_credits_obj_8", pos1),
      (overlay_set_display, "$g_presentation_credits_obj_8", 0),
      (create_text_overlay, "$g_presentation_credits_obj_9", "@Skirmish", tf_center_justify|tf_single_line|tf_with_outline),
      (overlay_set_color, "$g_presentation_credits_obj_9", 0xFFAAAAAA),
      (position_set_x, pos1, 600),
      (overlay_set_position, "$g_presentation_credits_obj_9", pos1),
      (overlay_set_display, "$g_presentation_credits_obj_9", 0),
      (assign, "$group0_has_troops", 0),
      (assign, "$group1_has_troops", 0),
      (assign, "$group2_has_troops", 0),
      (assign, "$group3_has_troops", 0),
      (assign, "$group4_has_troops", 0),
      (assign, "$group5_has_troops", 0),
      (assign, "$group6_has_troops", 0),
      (assign, "$group7_has_troops", 0),
      (assign, "$group8_has_troops", 0),
      (party_get_num_companion_stacks, ":var0", "p_main_party"),
      (assign, "$num_classes", 0),
      (try_for_range, ":var1", 0, ":var0"),
        (party_stack_get_troop_id, ":var2", "p_main_party", ":var1"),
        (troop_get_class, ":var3", ":var2"),
        (neq, "trp_player", ":var2"),
        (try_begin),
          (eq, ":var3", 0),
          (try_begin),
            (neq, "$group0_has_troops", 1),
            (val_add, "$num_classes", 1),
          (try_end),
          (assign, "$group0_has_troops", 1),
        (else_try),
          (eq, ":var3", 1),
          (try_begin),
            (neq, "$group1_has_troops", 1),
            (val_add, "$num_classes", 1),
          (try_end),
          (assign, "$group1_has_troops", 1),
        (else_try),
          (eq, ":var3", 2),
          (try_begin),
            (neq, "$group2_has_troops", 1),
            (val_add, "$num_classes", 1),
          (try_end),
          (assign, "$group2_has_troops", 1),
        (else_try),
          (eq, ":var3", 3),
          (try_begin),
            (neq, "$group3_has_troops", 1),
            (val_add, "$num_classes", 1),
          (try_end),
          (assign, "$group3_has_troops", 1),
        (else_try),
          (eq, ":var3", 4),
          (try_begin),
            (neq, "$group4_has_troops", 1),
            (val_add, "$num_classes", 1),
          (try_end),
          (assign, "$group4_has_troops", 1),
        (else_try),
          (eq, ":var3", 5),
          (try_begin),
            (neq, "$group5_has_troops", 1),
            (val_add, "$num_classes", 1),
          (try_end),
          (assign, "$group5_has_troops", 1),
        (else_try),
          (eq, ":var3", 6),
          (try_begin),
            (neq, "$group6_has_troops", 1),
            (val_add, "$num_classes", 1),
          (try_end),
          (assign, "$group6_has_troops", 1),
        (else_try),
          (eq, ":var3", 7),
          (try_begin),
            (neq, "$group7_has_troops", 1),
            (val_add, "$num_classes", 1),
          (try_end),
          (assign, "$group7_has_troops", 1),
        (else_try),
          (eq, ":var3", 8),
          (try_begin),
            (neq, "$group8_has_troops", 1),
            (val_add, "$num_classes", 1),
          (try_end),
          (assign, "$group8_has_troops", 1),
        (try_end),
      (try_end),
      (try_for_range, ":var1", 0, ":var0"),
        (party_stack_get_troop_id, ":var2", "p_main_party", ":var1"),
        (troop_get_class, ":var3", ":var2"),
        (neq, "trp_player", ":var2"),
        (neg|troop_is_hero, ":var2"),
        (troop_slot_ge, ":var2", 49, 1),
        (troop_get_slot, ":var4", ":var2", 48),
        (is_between, ":var4", 0, 9),
        (neq, ":var3", ":var4"),
        (assign, ":var3", ":var4"),
        (try_begin),
          (eq, ":var3", 0),
          (try_begin),
            (neq, "$group0_has_troops", 1),
            (val_add, "$num_classes", 1),
          (try_end),
          (assign, "$group0_has_troops", 1),
        (else_try),
          (eq, ":var3", 1),
          (try_begin),
            (neq, "$group1_has_troops", 1),
            (val_add, "$num_classes", 1),
          (try_end),
          (assign, "$group1_has_troops", 1),
        (else_try),
          (eq, ":var3", 2),
          (try_begin),
            (neq, "$group2_has_troops", 1),
            (val_add, "$num_classes", 1),
          (try_end),
          (assign, "$group2_has_troops", 1),
        (else_try),
          (eq, ":var3", 3),
          (try_begin),
            (neq, "$group3_has_troops", 1),
            (val_add, "$num_classes", 1),
          (try_end),
          (assign, "$group3_has_troops", 1),
        (else_try),
          (eq, ":var3", 4),
          (try_begin),
            (neq, "$group4_has_troops", 1),
            (val_add, "$num_classes", 1),
          (try_end),
          (assign, "$group4_has_troops", 1),
        (else_try),
          (eq, ":var3", 5),
          (try_begin),
            (neq, "$group5_has_troops", 1),
            (val_add, "$num_classes", 1),
          (try_end),
          (assign, "$group5_has_troops", 1),
        (else_try),
          (eq, ":var3", 6),
          (try_begin),
            (neq, "$group6_has_troops", 1),
            (val_add, "$num_classes", 1),
          (try_end),
          (assign, "$group6_has_troops", 1),
        (else_try),
          (eq, ":var3", 7),
          (try_begin),
            (neq, "$group7_has_troops", 1),
            (val_add, "$num_classes", 1),
          (try_end),
          (assign, "$group7_has_troops", 1),
        (else_try),
          (eq, ":var3", 8),
          (try_begin),
            (neq, "$group8_has_troops", 1),
            (val_add, "$num_classes", 1),
          (try_end),
          (assign, "$group8_has_troops", 1),
        (try_end),
      (try_end),
      (assign, ":var5", 0),
      (assign, ":var6", 653),
      (assign, ":var7", 20),
      (assign, ":var8", 662),
      (assign, ":var9", 50),
      (assign, ":var10", 660),
      (assign, ":var11", 660),
      (try_begin),
        (eq, "$group0_has_troops", 1),
        (create_image_button_overlay, "$g_presentation_obj_battle_but0", "mesh_white_plane", "mesh_white_plane"),
        (val_add, ":var5", 15),
        (position_set_x, pos1, ":var5"),
        (position_set_y, pos1, ":var6"),
        (overlay_set_position, "$g_presentation_obj_battle_but0", pos1),
        (val_add, ":var5", -15),
        (val_add, ":var6", -40),
        (position_set_x, pos1, 32650),
        (position_set_y, pos1, 2000),
        (overlay_set_size, "$g_presentation_obj_battle_but0", pos1),
        (overlay_set_alpha, "$g_presentation_obj_battle_but0", 0x00),
        (overlay_set_color, "$g_presentation_obj_battle_but0", 0xFFFF00),
        (create_check_box_overlay, "$g_presentation_obj_battle_check0", "mesh_checkbox_off", "mesh_checkbox_on"),
        (position_set_x, pos2, ":var7"),
        (position_set_y, pos2, ":var8"),
        (overlay_set_position, "$g_presentation_obj_battle_check0", pos2),
        (val_add, ":var8", -40),
        (str_store_class_name, 7, 0),
        (create_text_overlay, "$g_presentation_obj_battle_name0", s7, 0),
        (position_set_x, pos3, ":var9"),
        (position_set_y, pos3, ":var10"),
        (overlay_set_position, "$g_presentation_obj_battle_name0", pos3),
        (val_add, ":var10", -40),
        (create_text_overlay, "$g_presentation_but0_movement", "str_space", tf_center_justify),
        (create_text_overlay, "$g_presentation_but0_riding", "str_space", tf_center_justify),
        (create_text_overlay, "$g_presentation_but0_weapon_usage", "str_space", tf_center_justify),
        (create_text_overlay, reg6, "str_space", tf_center_justify),
        (create_text_overlay, reg15, "str_space", tf_center_justify),
        (create_text_overlay, reg24, "str_space", tf_center_justify),
        (create_text_overlay, reg33, "str_space", tf_center_justify),
        (create_text_overlay, reg42, "str_space", tf_center_justify),
        (position_set_x, pos1, 950),
        (position_set_y, pos1, 950),
        (overlay_set_size, "$g_presentation_but0_movement", pos1),
        (overlay_set_size, "$g_presentation_but0_riding", pos1),
        (overlay_set_size, "$g_presentation_but0_weapon_usage", pos1),
        (overlay_set_size, reg6, pos1),
        (overlay_set_size, reg15, pos1),
        (overlay_set_size, reg24, pos1),
        (overlay_set_size, reg33, pos1),
        (overlay_set_size, reg42, pos1),
        (overlay_set_display, reg15, 0),
        (overlay_set_display, reg24, 0),
        (overlay_set_display, reg33, 0),
        (overlay_set_display, reg42, 0),
        (position_set_y, pos1, ":var11"),
        (position_set_x, pos1, 225),
        (overlay_set_position, "$g_presentation_but0_movement", pos1),
        (position_set_x, pos1, 355),
        (overlay_set_position, "$g_presentation_but0_riding", pos1),
        (position_set_x, pos1, 485),
        (overlay_set_position, "$g_presentation_but0_weapon_usage", pos1),
        (position_set_x, pos1, 605),
        (overlay_set_position, reg6, pos1),
        (position_set_x, pos1, 225),
        (overlay_set_position, reg15, pos1),
        (position_set_x, pos1, 355),
        (overlay_set_position, reg24, pos1),
        (position_set_x, pos1, 485),
        (overlay_set_position, reg33, pos1),
        (position_set_x, pos1, 605),
        (overlay_set_position, reg42, pos1),
        (val_add, ":var11", -40),
        (create_text_overlay, "$g_presentation_obj_custom_battle_designer_1", "str_space"),
        (position_set_x, pos1, 600),
        (position_set_y, pos1, 600),
        (overlay_set_size, "$g_presentation_obj_custom_battle_designer_1", pos1),
        (create_text_overlay, "$g_presentation_obj_custom_battle_designer_11", "str_space"),
        (position_set_x, pos1, 600),
        (position_set_y, pos1, 600),
        (overlay_set_size, "$g_presentation_obj_custom_battle_designer_11", pos1),
      (try_end),
      (try_begin),
        (eq, "$group1_has_troops", 1),
        (create_image_button_overlay, "$g_presentation_obj_battle_but1", "mesh_white_plane", "mesh_white_plane"),
        (val_add, ":var5", 15),
        (position_set_x, pos1, ":var5"),
        (position_set_y, pos1, ":var6"),
        (overlay_set_position, "$g_presentation_obj_battle_but1", pos1),
        (val_add, ":var6", -40),
        (val_add, ":var5", -15),
        (position_set_x, pos1, 32650),
        (position_set_y, pos1, 2000),
        (overlay_set_size, "$g_presentation_obj_battle_but1", pos1),
        (overlay_set_alpha, "$g_presentation_obj_battle_but1", 0x00),
        (overlay_set_color, "$g_presentation_obj_battle_but1", 0xFFFF00),
        (create_check_box_overlay, "$g_presentation_obj_battle_check1", "mesh_checkbox_off", "mesh_checkbox_on"),
        (position_set_x, pos2, ":var7"),
        (position_set_y, pos2, ":var8"),
        (overlay_set_position, "$g_presentation_obj_battle_check1", pos2),
        (val_add, ":var8", -40),
        (str_store_class_name, 7, 1),
        (create_text_overlay, "$g_presentation_obj_battle_name1", s7, 0),
        (position_set_x, pos3, ":var9"),
        (position_set_y, pos3, ":var10"),
        (overlay_set_position, "$g_presentation_obj_battle_name1", pos3),
        (val_add, ":var10", -40),
        (create_text_overlay, "$g_presentation_but1_movement", "str_space", tf_center_justify),
        (create_text_overlay, "$g_presentation_but1_riding", "str_space", tf_center_justify),
        (create_text_overlay, "$g_presentation_but1_weapon_usage", "str_space", tf_center_justify),
        (create_text_overlay, reg7, "str_space", tf_center_justify),
        (create_text_overlay, reg16, "str_space", tf_center_justify),
        (create_text_overlay, reg25, "str_space", tf_center_justify),
        (create_text_overlay, reg34, "str_space", tf_center_justify),
        (create_text_overlay, reg43, "str_space", tf_center_justify),
        (position_set_x, pos1, 950),
        (position_set_y, pos1, 950),
        (overlay_set_size, "$g_presentation_but1_movement", pos1),
        (overlay_set_size, "$g_presentation_but1_riding", pos1),
        (overlay_set_size, "$g_presentation_but1_weapon_usage", pos1),
        (overlay_set_size, reg7, pos1),
        (overlay_set_size, reg16, pos1),
        (overlay_set_size, reg25, pos1),
        (overlay_set_size, reg34, pos1),
        (overlay_set_size, reg43, pos1),
        (overlay_set_display, reg16, 0),
        (overlay_set_display, reg25, 0),
        (overlay_set_display, reg34, 0),
        (overlay_set_display, reg43, 0),
        (position_set_y, pos1, ":var11"),
        (position_set_x, pos1, 225),
        (overlay_set_position, "$g_presentation_but1_movement", pos1),
        (position_set_x, pos1, 355),
        (overlay_set_position, "$g_presentation_but1_riding", pos1),
        (position_set_x, pos1, 485),
        (overlay_set_position, "$g_presentation_but1_weapon_usage", pos1),
        (position_set_x, pos1, 605),
        (overlay_set_position, reg7, pos1),
        (position_set_x, pos1, 225),
        (overlay_set_position, reg16, pos1),
        (position_set_x, pos1, 355),
        (overlay_set_position, reg25, pos1),
        (position_set_x, pos1, 485),
        (overlay_set_position, reg34, pos1),
        (position_set_x, pos1, 605),
        (overlay_set_position, reg43, pos1),
        (val_add, ":var11", -40),
        (create_text_overlay, "$g_presentation_obj_custom_battle_designer_2", "str_space"),
        (position_set_x, pos1, 600),
        (position_set_y, pos1, 600),
        (overlay_set_size, "$g_presentation_obj_custom_battle_designer_2", pos1),
        (create_text_overlay, "$g_presentation_obj_custom_battle_designer_12", "str_space"),
        (position_set_x, pos1, 600),
        (position_set_y, pos1, 600),
        (overlay_set_size, "$g_presentation_obj_custom_battle_designer_12", pos1),
      (try_end),
      (try_begin),
        (eq, "$group2_has_troops", 1),
        (create_image_button_overlay, "$g_presentation_obj_battle_but2", "mesh_white_plane", "mesh_white_plane"),
        (val_add, ":var5", 15),
        (position_set_x, pos1, ":var5"),
        (position_set_y, pos1, ":var6"),
        (overlay_set_position, "$g_presentation_obj_battle_but2", pos1),
        (val_add, ":var6", -40),
        (val_add, ":var5", -15),
        (position_set_x, pos1, 32650),
        (position_set_y, pos1, 2000),
        (overlay_set_size, "$g_presentation_obj_battle_but2", pos1),
        (overlay_set_alpha, "$g_presentation_obj_battle_but2", 0x00),
        (overlay_set_color, "$g_presentation_obj_battle_but2", 0xFFFF00),
        (create_check_box_overlay, "$g_presentation_obj_battle_check2", "mesh_checkbox_off", "mesh_checkbox_on"),
        (position_set_x, pos2, ":var7"),
        (position_set_y, pos2, ":var8"),
        (overlay_set_position, "$g_presentation_obj_battle_check2", pos2),
        (val_add, ":var8", -40),
        (str_store_class_name, 7, 2),
        (create_text_overlay, "$g_presentation_obj_battle_name2", s7, 0),
        (position_set_x, pos3, ":var9"),
        (position_set_y, pos3, ":var10"),
        (overlay_set_position, "$g_presentation_obj_battle_name2", pos3),
        (val_add, ":var10", -40),
        (create_text_overlay, "$g_presentation_but2_movement", "str_space", tf_center_justify),
        (create_text_overlay, "$g_presentation_but2_riding", "str_space", tf_center_justify),
        (create_text_overlay, "$g_presentation_but2_weapon_usage", "str_space", tf_center_justify),
        (create_text_overlay, reg8, "str_space", tf_center_justify),
        (create_text_overlay, reg17, "str_space", tf_center_justify),
        (create_text_overlay, reg26, "str_space", tf_center_justify),
        (create_text_overlay, reg35, "str_space", tf_center_justify),
        (create_text_overlay, reg44, "str_space", tf_center_justify),
        (position_set_x, pos1, 950),
        (position_set_y, pos1, 950),
        (overlay_set_size, "$g_presentation_but2_movement", pos1),
        (overlay_set_size, "$g_presentation_but2_riding", pos1),
        (overlay_set_size, "$g_presentation_but2_weapon_usage", pos1),
        (overlay_set_size, reg8, pos1),
        (overlay_set_size, reg17, pos1),
        (overlay_set_size, reg26, pos1),
        (overlay_set_size, reg35, pos1),
        (overlay_set_size, reg44, pos1),
        (overlay_set_display, reg17, 0),
        (overlay_set_display, reg26, 0),
        (overlay_set_display, reg35, 0),
        (overlay_set_display, reg44, 0),
        (position_set_y, pos1, ":var11"),
        (position_set_x, pos1, 225),
        (overlay_set_position, "$g_presentation_but2_movement", pos1),
        (position_set_x, pos1, 355),
        (overlay_set_position, "$g_presentation_but2_riding", pos1),
        (position_set_x, pos1, 485),
        (overlay_set_position, "$g_presentation_but2_weapon_usage", pos1),
        (position_set_x, pos1, 605),
        (overlay_set_position, reg8, pos1),
        (position_set_x, pos1, 225),
        (overlay_set_position, reg17, pos1),
        (position_set_x, pos1, 355),
        (overlay_set_position, reg26, pos1),
        (position_set_x, pos1, 485),
        (overlay_set_position, reg35, pos1),
        (position_set_x, pos1, 605),
        (overlay_set_position, reg44, pos1),
        (val_add, ":var11", -40),
        (create_text_overlay, "$g_presentation_obj_custom_battle_designer_3", "str_space"),
        (position_set_x, pos1, 600),
        (position_set_y, pos1, 600),
        (overlay_set_size, "$g_presentation_obj_custom_battle_designer_3", pos1),
        (create_text_overlay, "$g_presentation_obj_custom_battle_designer_13", "str_space"),
        (position_set_x, pos1, 600),
        (position_set_y, pos1, 600),
        (overlay_set_size, "$g_presentation_obj_custom_battle_designer_13", pos1),
      (try_end),
      (try_begin),
        (eq, "$group3_has_troops", 1),
        (create_image_button_overlay, "$g_presentation_obj_battle_but3", "mesh_white_plane", "mesh_white_plane"),
        (val_add, ":var5", 15),
        (position_set_x, pos1, ":var5"),
        (position_set_y, pos1, ":var6"),
        (overlay_set_position, "$g_presentation_obj_battle_but3", pos1),
        (val_add, ":var6", -40),
        (val_add, ":var5", -15),
        (position_set_x, pos1, 32650),
        (position_set_y, pos1, 2000),
        (overlay_set_size, "$g_presentation_obj_battle_but3", pos1),
        (overlay_set_alpha, "$g_presentation_obj_battle_but3", 0x00),
        (overlay_set_color, "$g_presentation_obj_battle_but3", 0xFFFF00),
        (create_check_box_overlay, "$g_presentation_obj_battle_check3", "mesh_checkbox_off", "mesh_checkbox_on"),
        (position_set_x, pos2, ":var7"),
        (position_set_y, pos2, ":var8"),
        (overlay_set_position, "$g_presentation_obj_battle_check3", pos2),
        (val_add, ":var8", -40),
        (str_store_class_name, 7, 3),
        (create_text_overlay, "$g_presentation_obj_battle_name3", s7, 0),
        (position_set_x, pos3, ":var9"),
        (position_set_y, pos3, ":var10"),
        (overlay_set_position, "$g_presentation_obj_battle_name3", pos3),
        (val_add, ":var10", -40),
        (create_text_overlay, "$g_presentation_but3_movement", "str_space", tf_center_justify),
        (create_text_overlay, "$g_presentation_but3_riding", "str_space", tf_center_justify),
        (create_text_overlay, "$g_presentation_but3_weapon_usage", "str_space", tf_center_justify),
        (create_text_overlay, reg9, "str_space", tf_center_justify),
        (create_text_overlay, reg18, "str_space", tf_center_justify),
        (create_text_overlay, reg27, "str_space", tf_center_justify),
        (create_text_overlay, reg36, "str_space", tf_center_justify),
        (create_text_overlay, reg45, "str_space", tf_center_justify),
        (position_set_x, pos1, 950),
        (position_set_y, pos1, 950),
        (overlay_set_size, "$g_presentation_but3_movement", pos1),
        (overlay_set_size, "$g_presentation_but3_riding", pos1),
        (overlay_set_size, "$g_presentation_but3_weapon_usage", pos1),
        (overlay_set_size, reg9, pos1),
        (overlay_set_size, reg18, pos1),
        (overlay_set_size, reg27, pos1),
        (overlay_set_size, reg36, pos1),
        (overlay_set_size, reg45, pos1),
        (overlay_set_display, reg18, 0),
        (overlay_set_display, reg27, 0),
        (overlay_set_display, reg36, 0),
        (overlay_set_display, reg45, 0),
        (position_set_y, pos1, ":var11"),
        (position_set_x, pos1, 225),
        (overlay_set_position, "$g_presentation_but3_movement", pos1),
        (position_set_x, pos1, 355),
        (overlay_set_position, "$g_presentation_but3_riding", pos1),
        (position_set_x, pos1, 485),
        (overlay_set_position, "$g_presentation_but3_weapon_usage", pos1),
        (position_set_x, pos1, 605),
        (overlay_set_position, reg9, pos1),
        (position_set_x, pos1, 225),
        (overlay_set_position, reg18, pos1),
        (position_set_x, pos1, 355),
        (overlay_set_position, reg27, pos1),
        (position_set_x, pos1, 485),
        (overlay_set_position, reg36, pos1),
        (position_set_x, pos1, 605),
        (overlay_set_position, reg45, pos1),
        (val_add, ":var11", -40),
        (create_text_overlay, "$g_presentation_obj_custom_battle_designer_4", "str_space"),
        (position_set_x, pos1, 600),
        (position_set_y, pos1, 600),
        (overlay_set_size, "$g_presentation_obj_custom_battle_designer_4", pos1),
        (create_text_overlay, "$g_presentation_obj_custom_battle_designer_14", "str_space"),
        (position_set_x, pos1, 600),
        (position_set_y, pos1, 600),
        (overlay_set_size, "$g_presentation_obj_custom_battle_designer_14", pos1),
      (try_end),
      (try_begin),
        (eq, "$group4_has_troops", 1),
        (create_image_button_overlay, "$g_presentation_obj_battle_but4", "mesh_white_plane", "mesh_white_plane"),
        (val_add, ":var5", 15),
        (position_set_x, pos1, ":var5"),
        (position_set_y, pos1, ":var6"),
        (overlay_set_position, "$g_presentation_obj_battle_but4", pos1),
        (val_add, ":var6", -40),
        (val_add, ":var5", -15),
        (position_set_x, pos1, 32650),
        (position_set_y, pos1, 2000),
        (overlay_set_size, "$g_presentation_obj_battle_but4", pos1),
        (overlay_set_alpha, "$g_presentation_obj_battle_but4", 0x00),
        (overlay_set_color, "$g_presentation_obj_battle_but4", 0xFFFF00),
        (create_check_box_overlay, "$g_presentation_obj_battle_check4", "mesh_checkbox_off", "mesh_checkbox_on"),
        (position_set_x, pos2, ":var7"),
        (position_set_y, pos2, ":var8"),
        (overlay_set_position, "$g_presentation_obj_battle_check4", pos2),
        (val_add, ":var8", -40),
        (str_store_class_name, 7, 4),
        (create_text_overlay, "$g_presentation_obj_battle_name4", s7, 0),
        (position_set_x, pos3, ":var9"),
        (position_set_y, pos3, ":var10"),
        (overlay_set_position, "$g_presentation_obj_battle_name4", pos3),
        (val_add, ":var10", -40),
        (create_text_overlay, "$g_presentation_but4_movement", "str_space", tf_center_justify),
        (create_text_overlay, "$g_presentation_but4_riding", "str_space", tf_center_justify),
        (create_text_overlay, "$g_presentation_but4_weapon_usage", "str_space", tf_center_justify),
        (create_text_overlay, reg10, "str_space", tf_center_justify),
        (create_text_overlay, reg19, "str_space", tf_center_justify),
        (create_text_overlay, reg28, "str_space", tf_center_justify),
        (create_text_overlay, reg37, "str_space", tf_center_justify),
        (create_text_overlay, reg46, "str_space", tf_center_justify),
        (position_set_x, pos1, 950),
        (position_set_y, pos1, 950),
        (overlay_set_size, "$g_presentation_but4_movement", pos1),
        (overlay_set_size, "$g_presentation_but4_riding", pos1),
        (overlay_set_size, "$g_presentation_but4_weapon_usage", pos1),
        (overlay_set_size, reg10, pos1),
        (overlay_set_size, reg19, pos1),
        (overlay_set_size, reg28, pos1),
        (overlay_set_size, reg37, pos1),
        (overlay_set_size, reg46, pos1),
        (overlay_set_display, reg19, 0),
        (overlay_set_display, reg28, 0),
        (overlay_set_display, reg37, 0),
        (overlay_set_display, reg46, 0),
        (position_set_y, pos1, ":var11"),
        (position_set_x, pos1, 225),
        (overlay_set_position, "$g_presentation_but4_movement", pos1),
        (position_set_x, pos1, 355),
        (overlay_set_position, "$g_presentation_but4_riding", pos1),
        (position_set_x, pos1, 485),
        (overlay_set_position, "$g_presentation_but4_weapon_usage", pos1),
        (position_set_x, pos1, 605),
        (overlay_set_position, reg10, pos1),
        (position_set_x, pos1, 225),
        (overlay_set_position, reg19, pos1),
        (position_set_x, pos1, 355),
        (overlay_set_position, reg28, pos1),
        (position_set_x, pos1, 485),
        (overlay_set_position, reg37, pos1),
        (position_set_x, pos1, 605),
        (overlay_set_position, reg46, pos1),
        (val_add, ":var11", -40),
        (create_text_overlay, "$g_presentation_obj_custom_battle_designer_5", "str_space"),
        (position_set_x, pos1, 600),
        (position_set_y, pos1, 600),
        (overlay_set_size, "$g_presentation_obj_custom_battle_designer_5", pos1),
        (create_text_overlay, "$g_presentation_obj_custom_battle_designer_15", "str_space"),
        (position_set_x, pos1, 600),
        (position_set_y, pos1, 600),
        (overlay_set_size, "$g_presentation_obj_custom_battle_designer_15", pos1),
      (try_end),
      (try_begin),
        (eq, "$group5_has_troops", 1),
        (create_image_button_overlay, "$g_presentation_obj_battle_but5", "mesh_white_plane", "mesh_white_plane"),
        (val_add, ":var5", 15),
        (position_set_x, pos1, ":var5"),
        (position_set_y, pos1, ":var6"),
        (overlay_set_position, "$g_presentation_obj_battle_but5", pos1),
        (val_add, ":var6", -40),
        (val_add, ":var5", -15),
        (position_set_x, pos1, 32650),
        (position_set_y, pos1, 2000),
        (overlay_set_size, "$g_presentation_obj_battle_but5", pos1),
        (overlay_set_alpha, "$g_presentation_obj_battle_but5", 0x00),
        (overlay_set_color, "$g_presentation_obj_battle_but5", 0xFFFF00),
        (create_check_box_overlay, "$g_presentation_obj_battle_check5", "mesh_checkbox_off", "mesh_checkbox_on"),
        (position_set_x, pos2, ":var7"),
        (position_set_y, pos2, ":var8"),
        (overlay_set_position, "$g_presentation_obj_battle_check5", pos2),
        (val_add, ":var8", -40),
        (str_store_class_name, 7, 5),
        (create_text_overlay, "$g_presentation_obj_battle_name5", s7, 0),
        (position_set_x, pos3, ":var9"),
        (position_set_y, pos3, ":var10"),
        (overlay_set_position, "$g_presentation_obj_battle_name5", pos3),
        (val_add, ":var10", -40),
        (create_text_overlay, "$g_presentation_but5_movement", "str_space", tf_center_justify),
        (create_text_overlay, "$g_presentation_but5_riding", "str_space", tf_center_justify),
        (create_text_overlay, "$g_presentation_but5_weapon_usage", "str_space", tf_center_justify),
        (create_text_overlay, reg11, "str_space", tf_center_justify),
        (create_text_overlay, reg20, "str_space", tf_center_justify),
        (create_text_overlay, reg29, "str_space", tf_center_justify),
        (create_text_overlay, reg38, "str_space", tf_center_justify),
        (create_text_overlay, reg47, "str_space", tf_center_justify),
        (position_set_x, pos1, 950),
        (position_set_y, pos1, 950),
        (overlay_set_size, "$g_presentation_but5_movement", pos1),
        (overlay_set_size, "$g_presentation_but5_riding", pos1),
        (overlay_set_size, "$g_presentation_but5_weapon_usage", pos1),
        (overlay_set_size, reg11, pos1),
        (overlay_set_size, reg20, pos1),
        (overlay_set_size, reg29, pos1),
        (overlay_set_size, reg38, pos1),
        (overlay_set_size, reg47, pos1),
        (overlay_set_display, reg20, 0),
        (overlay_set_display, reg29, 0),
        (overlay_set_display, reg38, 0),
        (overlay_set_display, reg47, 0),
        (position_set_y, pos1, ":var11"),
        (position_set_x, pos1, 225),
        (overlay_set_position, "$g_presentation_but5_movement", pos1),
        (position_set_x, pos1, 355),
        (overlay_set_position, "$g_presentation_but5_riding", pos1),
        (position_set_x, pos1, 485),
        (overlay_set_position, "$g_presentation_but5_weapon_usage", pos1),
        (position_set_x, pos1, 605),
        (overlay_set_position, reg11, pos1),
        (position_set_x, pos1, 225),
        (overlay_set_position, reg20, pos1),
        (position_set_x, pos1, 355),
        (overlay_set_position, reg29, pos1),
        (position_set_x, pos1, 485),
        (overlay_set_position, reg38, pos1),
        (position_set_x, pos1, 605),
        (overlay_set_position, reg47, pos1),
        (val_add, ":var11", -40),
        (create_text_overlay, "$g_presentation_obj_custom_battle_designer_6", "str_space"),
        (position_set_x, pos1, 600),
        (position_set_y, pos1, 600),
        (overlay_set_size, "$g_presentation_obj_custom_battle_designer_6", pos1),
        (create_text_overlay, "$g_presentation_obj_custom_battle_designer_16", "str_space"),
        (position_set_x, pos1, 600),
        (position_set_y, pos1, 600),
        (overlay_set_size, "$g_presentation_obj_custom_battle_designer_16", pos1),
      (try_end),
      (try_begin),
        (eq, "$group6_has_troops", 1),
        (create_image_button_overlay, "$g_presentation_obj_battle_but6", "mesh_white_plane", "mesh_white_plane"),
        (val_add, ":var5", 15),
        (position_set_x, pos1, ":var5"),
        (position_set_y, pos1, ":var6"),
        (overlay_set_position, "$g_presentation_obj_battle_but6", pos1),
        (val_add, ":var6", -40),
        (val_add, ":var5", -15),
        (position_set_x, pos1, 32650),
        (position_set_y, pos1, 2000),
        (overlay_set_size, "$g_presentation_obj_battle_but6", pos1),
        (overlay_set_alpha, "$g_presentation_obj_battle_but6", 0x00),
        (overlay_set_color, "$g_presentation_obj_battle_but6", 0xFFFF00),
        (create_check_box_overlay, "$g_presentation_obj_battle_check6", "mesh_checkbox_off", "mesh_checkbox_on"),
        (position_set_x, pos2, ":var7"),
        (position_set_y, pos2, ":var8"),
        (overlay_set_position, "$g_presentation_obj_battle_check6", pos2),
        (val_add, ":var8", -40),
        (str_store_class_name, 7, 6),
        (create_text_overlay, "$g_presentation_obj_battle_name6", s7, 0),
        (position_set_x, pos3, ":var9"),
        (position_set_y, pos3, ":var10"),
        (overlay_set_position, "$g_presentation_obj_battle_name6", pos3),
        (val_add, ":var10", -40),
        (create_text_overlay, "$g_presentation_but6_movement", "str_space", tf_center_justify),
        (create_text_overlay, "$g_presentation_but6_riding", "str_space", tf_center_justify),
        (create_text_overlay, "$g_presentation_but6_weapon_usage", "str_space", tf_center_justify),
        (create_text_overlay, reg12, "str_space", tf_center_justify),
        (create_text_overlay, reg21, "str_space", tf_center_justify),
        (create_text_overlay, reg30, "str_space", tf_center_justify),
        (create_text_overlay, reg39, "str_space", tf_center_justify),
        (create_text_overlay, reg48, "str_space", tf_center_justify),
        (position_set_x, pos1, 950),
        (position_set_y, pos1, 950),
        (overlay_set_size, "$g_presentation_but6_movement", pos1),
        (overlay_set_size, "$g_presentation_but6_riding", pos1),
        (overlay_set_size, "$g_presentation_but6_weapon_usage", pos1),
        (overlay_set_size, reg12, pos1),
        (overlay_set_size, reg21, pos1),
        (overlay_set_size, reg30, pos1),
        (overlay_set_size, reg39, pos1),
        (overlay_set_size, reg48, pos1),
        (overlay_set_display, reg21, 0),
        (overlay_set_display, reg30, 0),
        (overlay_set_display, reg39, 0),
        (overlay_set_display, reg48, 0),
        (position_set_y, pos1, ":var11"),
        (position_set_x, pos1, 225),
        (overlay_set_position, "$g_presentation_but6_movement", pos1),
        (position_set_x, pos1, 355),
        (overlay_set_position, "$g_presentation_but6_riding", pos1),
        (position_set_x, pos1, 485),
        (overlay_set_position, "$g_presentation_but6_weapon_usage", pos1),
        (position_set_x, pos1, 605),
        (overlay_set_position, reg12, pos1),
        (position_set_x, pos1, 225),
        (overlay_set_position, reg21, pos1),
        (position_set_x, pos1, 355),
        (overlay_set_position, reg30, pos1),
        (position_set_x, pos1, 485),
        (overlay_set_position, reg39, pos1),
        (position_set_x, pos1, 605),
        (overlay_set_position, reg48, pos1),
        (val_add, ":var11", -40),
        (create_text_overlay, "$g_presentation_obj_custom_battle_designer_7", "str_space"),
        (position_set_x, pos1, 600),
        (position_set_y, pos1, 600),
        (overlay_set_size, "$g_presentation_obj_custom_battle_designer_7", pos1),
        (create_text_overlay, "$g_presentation_obj_custom_battle_designer_17", "str_space"),
        (position_set_x, pos1, 600),
        (position_set_y, pos1, 600),
        (overlay_set_size, "$g_presentation_obj_custom_battle_designer_17", pos1),
      (try_end),
      (try_begin),
        (eq, "$group7_has_troops", 1),
        (create_image_button_overlay, "$g_presentation_obj_battle_but7", "mesh_white_plane", "mesh_white_plane"),
        (val_add, ":var5", 15),
        (position_set_x, pos1, ":var5"),
        (position_set_y, pos1, ":var6"),
        (overlay_set_position, "$g_presentation_obj_battle_but7", pos1),
        (val_add, ":var6", -40),
        (val_add, ":var5", -15),
        (position_set_x, pos1, 32650),
        (position_set_y, pos1, 2000),
        (overlay_set_size, "$g_presentation_obj_battle_but7", pos1),
        (overlay_set_alpha, "$g_presentation_obj_battle_but7", 0x00),
        (overlay_set_color, "$g_presentation_obj_battle_but7", 0xFFFF00),
        (create_check_box_overlay, "$g_presentation_obj_battle_check7", "mesh_checkbox_off", "mesh_checkbox_on"),
        (position_set_x, pos2, ":var7"),
        (position_set_y, pos2, ":var8"),
        (overlay_set_position, "$g_presentation_obj_battle_check7", pos2),
        (val_add, ":var8", -40),
        (str_store_class_name, 7, 7),
        (create_text_overlay, "$g_presentation_obj_battle_name7", s7, 0),
        (position_set_x, pos3, ":var9"),
        (position_set_y, pos3, ":var10"),
        (overlay_set_position, "$g_presentation_obj_battle_name7", pos3),
        (val_add, ":var10", -40),
        (create_text_overlay, "$g_presentation_but7_movement", "str_space", tf_center_justify),
        (create_text_overlay, "$g_presentation_but7_riding", "str_space", tf_center_justify),
        (create_text_overlay, "$g_presentation_but7_weapon_usage", "str_space", tf_center_justify),
        (create_text_overlay, reg13, "str_space", tf_center_justify),
        (create_text_overlay, reg22, "str_space", tf_center_justify),
        (create_text_overlay, reg31, "str_space", tf_center_justify),
        (create_text_overlay, reg40, "str_space", tf_center_justify),
        (create_text_overlay, reg49, "str_space", tf_center_justify),
        (position_set_x, pos1, 950),
        (position_set_y, pos1, 950),
        (overlay_set_size, "$g_presentation_but7_movement", pos1),
        (overlay_set_size, "$g_presentation_but7_riding", pos1),
        (overlay_set_size, "$g_presentation_but7_weapon_usage", pos1),
        (overlay_set_size, reg13, pos1),
        (overlay_set_size, reg22, pos1),
        (overlay_set_size, reg31, pos1),
        (overlay_set_size, reg40, pos1),
        (overlay_set_size, reg49, pos1),
        (overlay_set_display, reg22, 0),
        (overlay_set_display, reg31, 0),
        (overlay_set_display, reg40, 0),
        (overlay_set_display, reg49, 0),
        (position_set_y, pos1, ":var11"),
        (position_set_x, pos1, 225),
        (overlay_set_position, "$g_presentation_but7_movement", pos1),
        (position_set_x, pos1, 355),
        (overlay_set_position, "$g_presentation_but7_riding", pos1),
        (position_set_x, pos1, 485),
        (overlay_set_position, "$g_presentation_but7_weapon_usage", pos1),
        (position_set_x, pos1, 605),
        (overlay_set_position, reg13, pos1),
        (position_set_x, pos1, 225),
        (overlay_set_position, reg22, pos1),
        (position_set_x, pos1, 355),
        (overlay_set_position, reg31, pos1),
        (position_set_x, pos1, 485),
        (overlay_set_position, reg40, pos1),
        (position_set_x, pos1, 605),
        (overlay_set_position, reg49, pos1),
        (val_add, ":var11", -40),
        (create_text_overlay, "$g_presentation_obj_custom_battle_designer_8", "str_space"),
        (position_set_x, pos1, 600),
        (position_set_y, pos1, 600),
        (overlay_set_size, "$g_presentation_obj_custom_battle_designer_8", pos1),
        (create_text_overlay, "$g_presentation_obj_custom_battle_designer_18", "str_space"),
        (position_set_x, pos1, 600),
        (position_set_y, pos1, 600),
        (overlay_set_size, "$g_presentation_obj_custom_battle_designer_18", pos1),
      (try_end),
      (try_begin),
        (eq, "$group8_has_troops", 1),
        (create_image_button_overlay, "$g_presentation_obj_battle_but8", "mesh_white_plane", "mesh_white_plane"),
        (val_add, ":var5", 15),
        (position_set_x, pos1, ":var5"),
        (position_set_y, pos1, ":var6"),
        (overlay_set_position, "$g_presentation_obj_battle_but8", pos1),
        (val_add, ":var6", -40),
        (val_add, ":var5", -15),
        (position_set_x, pos1, 32650),
        (position_set_y, pos1, 2000),
        (overlay_set_size, "$g_presentation_obj_battle_but8", pos1),
        (overlay_set_alpha, "$g_presentation_obj_battle_but8", 0x00),
        (overlay_set_color, "$g_presentation_obj_battle_but8", 0xFFFF00),
        (create_check_box_overlay, "$g_presentation_obj_battle_check8", "mesh_checkbox_off", "mesh_checkbox_on"),
        (position_set_x, pos2, ":var7"),
        (position_set_y, pos2, ":var8"),
        (overlay_set_position, "$g_presentation_obj_battle_check8", pos2),
        (val_add, ":var8", -40),
        (str_store_class_name, 7, 8),
        (create_text_overlay, "$g_presentation_obj_battle_name8", s7, 0),
        (position_set_x, pos3, ":var9"),
        (position_set_y, pos3, ":var10"),
        (overlay_set_position, "$g_presentation_obj_battle_name8", pos3),
        (val_add, ":var10", -40),
        (create_text_overlay, "$g_presentation_but8_movement", "str_space", tf_center_justify),
        (create_text_overlay, "$g_presentation_but8_riding", "str_space", tf_center_justify),
        (create_text_overlay, "$g_presentation_but8_weapon_usage", "str_space", tf_center_justify),
        (create_text_overlay, reg14, "str_space", tf_center_justify),
        (create_text_overlay, reg23, "str_space", tf_center_justify),
        (create_text_overlay, reg32, "str_space", tf_center_justify),
        (create_text_overlay, reg41, "str_space", tf_center_justify),
        (create_text_overlay, reg50, "str_space", tf_center_justify),
        (position_set_x, pos1, 950),
        (position_set_y, pos1, 950),
        (overlay_set_size, "$g_presentation_but8_movement", pos1),
        (overlay_set_size, "$g_presentation_but8_riding", pos1),
        (overlay_set_size, "$g_presentation_but8_weapon_usage", pos1),
        (overlay_set_size, reg14, pos1),
        (overlay_set_size, reg23, pos1),
        (overlay_set_size, reg32, pos1),
        (overlay_set_size, reg41, pos1),
        (overlay_set_size, reg50, pos1),
        (overlay_set_display, reg23, 0),
        (overlay_set_display, reg32, 0),
        (overlay_set_display, reg41, 0),
        (overlay_set_display, reg50, 0),
        (position_set_y, pos1, ":var11"),
        (position_set_x, pos1, 225),
        (overlay_set_position, "$g_presentation_but8_movement", pos1),
        (position_set_x, pos1, 355),
        (overlay_set_position, "$g_presentation_but8_riding", pos1),
        (position_set_x, pos1, 485),
        (overlay_set_position, "$g_presentation_but8_weapon_usage", pos1),
        (position_set_x, pos1, 605),
        (overlay_set_position, reg14, pos1),
        (position_set_x, pos1, 225),
        (overlay_set_position, reg23, pos1),
        (position_set_x, pos1, 355),
        (overlay_set_position, reg32, pos1),
        (position_set_x, pos1, 485),
        (overlay_set_position, reg41, pos1),
        (position_set_x, pos1, 605),
        (overlay_set_position, reg50, pos1),
        (val_add, ":var11", -40),
        (create_text_overlay, "$g_presentation_obj_custom_battle_designer_9", "str_space"),
        (position_set_x, pos1, 600),
        (position_set_y, pos1, 600),
        (overlay_set_size, "$g_presentation_obj_custom_battle_designer_9", pos1),
        (create_text_overlay, "$g_presentation_obj_custom_battle_designer_19", "str_space"),
        (position_set_x, pos1, 600),
        (position_set_y, pos1, 600),
        (overlay_set_size, "$g_presentation_obj_custom_battle_designer_19", pos1),
      (try_end),
      (assign, ":var12", 640),
      (assign, ":var13", "$num_classes"),
      (val_mul, ":var13", -40),
      (val_add, ":var12", ":var13"),
      (val_sub, ":var12", 50),
      (create_listbox_overlay, "$g_presentation_obj_battle_10", "str_space", 0),
      (create_listbox_overlay, "$g_presentation_obj_battle_11", "str_space", 0),
      (create_listbox_overlay, "$g_presentation_obj_battle_12", "str_space", 0),
      (create_listbox_overlay, "$g_presentation_obj_battle_17", "str_space", 0),
      (create_listbox_overlay, "$g_presentation_obj_battle_13", "str_space", 0),
      (create_listbox_overlay, "$g_presentation_obj_battle_14", "str_space", 0),
      (create_listbox_overlay, "$g_presentation_obj_battle_15", "str_space", 0),
      (create_listbox_overlay, "$g_presentation_obj_battle_16", "str_space", 0),
      (overlay_add_item, "$g_presentation_obj_battle_10", "@Stand Ground"),
      (overlay_add_item, "$g_presentation_obj_battle_10", "@Charge"),
      (overlay_add_item, "$g_presentation_obj_battle_10", "@Follow Me"),
      (overlay_add_item, "$g_presentation_obj_battle_10", "@Hold Position"),
      (overlay_add_item, "$g_presentation_obj_battle_10", "@None"),
      (position_set_x, pos1, 500),
      (position_set_y, pos1, 600),
      (overlay_set_size, "$g_presentation_obj_battle_10", pos1),
      (position_set_x, pos1, 170),
      (position_set_y, pos1, ":var12"),
      (overlay_set_position, "$g_presentation_obj_battle_10", pos1),
      (overlay_set_color, "$g_presentation_obj_battle_10", 0xFF0000),
      (overlay_set_alpha, "$g_presentation_obj_battle_10", 0x60),
      (overlay_set_val, "$g_presentation_obj_battle_10", 4),
      (overlay_add_item, "$g_presentation_obj_battle_11", "@Dismount"),
      (overlay_add_item, "$g_presentation_obj_battle_11", "@Mount"),
      (overlay_add_item, "$g_presentation_obj_battle_11", "@Spread Out"),
      (overlay_add_item, "$g_presentation_obj_battle_11", "@Stand Closer"),
      (overlay_add_item, "$g_presentation_obj_battle_11", "@Back 10"),
      (overlay_add_item, "$g_presentation_obj_battle_11", "@Forward 10"),
      (overlay_add_item, "$g_presentation_obj_battle_11", "@None"),
      (position_set_x, pos1, 500),
      (position_set_y, pos1, 600),
      (overlay_set_size, "$g_presentation_obj_battle_11", pos1),
      (position_set_x, pos1, 305),
      (val_add, ":var12", -35),
      (position_set_y, pos1, ":var12"),
      (overlay_set_position, "$g_presentation_obj_battle_11", pos1),
      (overlay_set_color, "$g_presentation_obj_battle_11", 0xFF6600),
      (overlay_set_alpha, "$g_presentation_obj_battle_11", 0x60),
      (overlay_set_val, "$g_presentation_obj_battle_11", 6),
      (val_add, ":var12", -50),
      (create_number_box_overlay, reg51, 1, 5),
      (create_number_box_overlay, reg52, 1, 5),
      (overlay_set_val, reg51, 1),
      (overlay_set_val, reg52, 1),
      (position_set_x, pos1, 320),
      (position_set_y, pos1, ":var12"),
      (overlay_set_position, reg51, pos1),
      (position_set_x, pos1, 452),
      (overlay_set_position, reg52, pos1),
      (assign, reg53, 0),
      (assign, reg54, 0),
      (create_text_overlay, reg0, "@Repeat x"),
      (position_set_x, pos1, 900),
      (position_set_y, pos1, 900),
      (overlay_set_size, reg0, pos1),
      (position_set_x, pos1, 295),
      (val_add, ":var12", 25),
      (position_set_y, pos1, ":var12"),
      (overlay_set_position, reg0, pos1),
      (create_text_overlay, reg0, "@Repeat x"),
      (position_set_x, pos1, 900),
      (position_set_y, pos1, 900),
      (overlay_set_size, reg0, pos1),
      (position_set_x, pos1, 422),
      (position_set_y, pos1, ":var12"),
      (overlay_set_position, reg0, pos1),
      (val_add, ":var12", 25),
      (overlay_add_item, "$g_presentation_obj_battle_12", "@Dismount"),
      (overlay_add_item, "$g_presentation_obj_battle_12", "@Mount"),
      (overlay_add_item, "$g_presentation_obj_battle_12", "@Spread Out"),
      (overlay_add_item, "$g_presentation_obj_battle_12", "@Stand Closer"),
      (overlay_add_item, "$g_presentation_obj_battle_12", "@Back 10"),
      (overlay_add_item, "$g_presentation_obj_battle_12", "@Forward 10"),
      (overlay_add_item, "$g_presentation_obj_battle_12", "@None"),
      (position_set_x, pos1, 500),
      (position_set_y, pos1, 600),
      (overlay_set_size, "$g_presentation_obj_battle_12", pos1),
      (position_set_x, pos1, 430),
      (position_set_y, pos1, ":var12"),
      (overlay_set_position, "$g_presentation_obj_battle_12", pos1),
      (overlay_set_color, "$g_presentation_obj_battle_12", 0xFF6600),
      (overlay_set_alpha, "$g_presentation_obj_battle_12", 0x60),
      (overlay_set_val, "$g_presentation_obj_battle_12", 6),
      (val_add, ":var12", 35),
      (overlay_add_item, "$g_presentation_obj_battle_17", "@Square"),
      (overlay_add_item, "$g_presentation_obj_battle_17", "@Wedge"),
      (overlay_add_item, "$g_presentation_obj_battle_17", "@Shieldwall"),
      (overlay_add_item, "$g_presentation_obj_battle_17", "@Ranks"),
      (overlay_add_item, "$g_presentation_obj_battle_17", "@None"),
      (position_set_x, pos1, 500),
      (position_set_y, pos1, 600),
      (overlay_set_size, "$g_presentation_obj_battle_17", pos1),
      (position_set_x, pos1, 555),
      (position_set_y, pos1, ":var12"),
      (overlay_set_position, "$g_presentation_obj_battle_17", pos1),
      (overlay_set_color, "$g_presentation_obj_battle_17", 0xFF6600),
      (overlay_set_alpha, "$g_presentation_obj_battle_17", 0x60),
      (overlay_set_val, "$g_presentation_obj_battle_17", 4),
      (overlay_add_item, "$g_presentation_obj_battle_13", "@Fire At Will"),
      (overlay_add_item, "$g_presentation_obj_battle_13", "@Hold Your Fire"),
      (overlay_add_item, "$g_presentation_obj_battle_13", "@Use Blunt Weapons"),
      (overlay_add_item, "$g_presentation_obj_battle_13", "@Use Any Weapon"),
      (overlay_add_item, "$g_presentation_obj_battle_13", "@None"),
      (position_set_x, pos1, 500),
      (position_set_y, pos1, 600),
      (overlay_set_size, "$g_presentation_obj_battle_13", pos1),
      (position_set_x, pos1, 175),
      (position_set_y, pos1, ":var12"),
      (overlay_set_position, "$g_presentation_obj_battle_13", pos1),
      (overlay_set_alpha, "$g_presentation_obj_battle_13", 0x60),
      (overlay_set_val, "$g_presentation_obj_battle_13", 4),
      (overlay_set_display, "$g_presentation_obj_battle_13", 0),
      (overlay_add_item, "$g_presentation_obj_battle_14", "@Ranged"),
      (overlay_add_item, "$g_presentation_obj_battle_14", "@Polearms"),
      (overlay_add_item, "$g_presentation_obj_battle_14", "@Two Handed"),
      (overlay_add_item, "$g_presentation_obj_battle_14", "@One Handed"),
      (overlay_add_item, "$g_presentation_obj_battle_14", "@None"),
      (position_set_x, pos1, 500),
      (position_set_y, pos1, 600),
      (overlay_set_size, "$g_presentation_obj_battle_14", pos1),
      (position_set_x, pos1, 305),
      (position_set_y, pos1, ":var12"),
      (overlay_set_position, "$g_presentation_obj_battle_14", pos1),
      (overlay_set_alpha, "$g_presentation_obj_battle_14", 0x60),
      (overlay_set_val, "$g_presentation_obj_battle_14", 4),
      (overlay_set_display, "$g_presentation_obj_battle_14", 0),
      (overlay_add_item, "$g_presentation_obj_battle_15", "@No Shields"),
      (overlay_add_item, "$g_presentation_obj_battle_15", "@Use Shields"),
      (overlay_add_item, "$g_presentation_obj_battle_15", "@None"),
      (val_add, ":var12", 35),
      (position_set_x, pos1, 500),
      (position_set_y, pos1, 600),
      (overlay_set_size, "$g_presentation_obj_battle_15", pos1),
      (position_set_x, pos1, 430),
      (position_set_y, pos1, ":var12"),
      (overlay_set_position, "$g_presentation_obj_battle_15", pos1),
      (overlay_set_alpha, "$g_presentation_obj_battle_15", 0x60),
      (overlay_set_val, "$g_presentation_obj_battle_15", 2),
      (overlay_set_display, "$g_presentation_obj_battle_15", 0),
      (overlay_add_item, "$g_presentation_obj_battle_16", "@Avoid Melee"),
      (overlay_add_item, "$g_presentation_obj_battle_16", "@None"),
      (val_add, ":var12", 18),
      (position_set_x, pos1, 500),
      (position_set_y, pos1, 600),
      (overlay_set_size, "$g_presentation_obj_battle_16", pos1),
      (position_set_x, pos1, 555),
      (position_set_y, pos1, ":var12"),
      (overlay_set_position, "$g_presentation_obj_battle_16", pos1),
      (overlay_set_alpha, "$g_presentation_obj_battle_16", 0x60),
      (overlay_set_val, "$g_presentation_obj_battle_16", 1),
      (overlay_set_display, "$g_presentation_obj_battle_16", 0),
      (val_sub, ":var12", 53),
      (val_sub, ":var12", 50),
      (create_button_overlay, "$g_presentation_obj_battle_24", "@Turn to weapon orders..."),
      (position_set_x, pos1, 900),
      (position_set_y, pos1, 900),
      (overlay_set_size, "$g_presentation_obj_battle_24", pos1),
      (position_set_x, pos1, 450),
      (position_set_y, pos1, 150),
      (overlay_set_position, "$g_presentation_obj_battle_24", pos1),
      (create_game_button_overlay, "$g_presentation_obj_battle_25", "@Reassess"),
      (position_set_x, pos1, 420),
      (position_set_y, pos1, 8),
      (overlay_set_position, "$g_presentation_obj_battle_25", pos1),
      (create_game_button_overlay, "$g_presentation_obj_battle_26", "@Scrap All"),
      (position_set_x, pos1, 580),
      (position_set_y, pos1, 8),
      (overlay_set_position, "$g_presentation_obj_battle_26", pos1),
      (create_game_button_overlay, "$g_presentation_obj_battle_27", "@Prepare Orders"),
      (position_set_x, pos1, 740),
      (position_set_y, pos1, 8),
      (overlay_set_position, "$g_presentation_obj_battle_27", pos1),
      (create_game_button_overlay, "$g_presentation_obj_battle_28", "@Dispatch Orders"),
      (position_set_x, pos1, 900),
      (position_set_y, pos1, 8),
      (overlay_set_position, "$g_presentation_obj_battle_28", pos1),
      (call_script, "script_prebattle_order_get_stored"),
      (presentation_set_duration, 999999),
    ]),
    (ti_on_presentation_event_state_change,
    [
      (store_trigger_param_1, ":var0"),
      (store_trigger_param_2, ":var1"),
      (try_begin),
        (eq, ":var0", "$g_presentation_obj_battle_25"),
        (jump_to_menu, "$g_next_menu"),
        (presentation_set_duration, 0),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_battle_26"),
        (party_set_slot, "p_main_party", 231, 0),
        (call_script, "script_prebattle_order_clear_all"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_battle_27"),
        (call_script, "script_prebattle_order_preview_orders"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_battle_28"),
        (party_set_slot, "p_main_party", 231, 1),
        (call_script, "script_prebattle_order_store_orders"),
        (jump_to_menu, "$g_next_menu"),
        (presentation_set_duration, 0),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_battle_24"),
        (overlay_get_position, 1, "$g_presentation_obj_battle_24"),
        (position_get_x, ":var2", pos1),
        (try_begin),
          (eq, ":var2", 450),
          (overlay_set_display, "$g_presentation_obj_battle_10", 0),
          (overlay_set_display, "$g_presentation_obj_battle_11", 0),
          (overlay_set_display, "$g_presentation_obj_battle_12", 0),
          (overlay_set_display, "$g_presentation_obj_battle_17", 0),
          (overlay_set_display, reg51, 0),
          (overlay_set_display, reg52, 0),
          (overlay_set_display, "$g_presentation_credits_obj_2", 0),
          (overlay_set_display, "$g_presentation_credits_obj_3", 0),
          (overlay_set_display, "$g_presentation_credits_obj_4", 0),
          (overlay_set_display, "$g_presentation_credits_obj_5", 0),
          (store_add, ":var3", reg51, 2),
          (overlay_set_display, ":var3", 0),
          (val_add, ":var3", 1),
          (overlay_set_display, ":var3", 0),
          (overlay_set_display, "$g_presentation_obj_battle_13", 1),
          (overlay_set_display, "$g_presentation_obj_battle_14", 1),
          (overlay_set_display, "$g_presentation_obj_battle_15", 1),
          (overlay_set_display, "$g_presentation_obj_battle_16", 1),
          (overlay_set_display, "$g_presentation_credits_obj_6", 1),
          (overlay_set_display, "$g_presentation_credits_obj_7", 1),
          (overlay_set_display, "$g_presentation_credits_obj_8", 1),
          (overlay_set_display, "$g_presentation_credits_obj_9", 1),
          (try_begin),
            (eq, "$group0_has_troops", 1),
            (overlay_set_display, "$g_presentation_but0_movement", 0),
            (overlay_set_display, "$g_presentation_but0_riding", 0),
            (overlay_set_display, "$g_presentation_but0_weapon_usage", 0),
            (overlay_set_display, reg6, 0),
            (overlay_set_display, reg15, 1),
            (overlay_set_display, reg24, 1),
            (overlay_set_display, reg33, 1),
            (overlay_set_display, reg42, 1),
          (try_end),
          (try_begin),
            (eq, "$group1_has_troops", 1),
            (overlay_set_display, "$g_presentation_but1_movement", 0),
            (overlay_set_display, "$g_presentation_but1_riding", 0),
            (overlay_set_display, "$g_presentation_but1_weapon_usage", 0),
            (overlay_set_display, reg7, 0),
            (overlay_set_display, reg16, 1),
            (overlay_set_display, reg25, 1),
            (overlay_set_display, reg34, 1),
            (overlay_set_display, reg43, 1),
          (try_end),
          (try_begin),
            (eq, "$group2_has_troops", 1),
            (overlay_set_display, "$g_presentation_but2_movement", 0),
            (overlay_set_display, "$g_presentation_but2_riding", 0),
            (overlay_set_display, "$g_presentation_but2_weapon_usage", 0),
            (overlay_set_display, reg8, 0),
            (overlay_set_display, reg17, 1),
            (overlay_set_display, reg26, 1),
            (overlay_set_display, reg35, 1),
            (overlay_set_display, reg44, 1),
          (try_end),
          (try_begin),
            (eq, "$group3_has_troops", 1),
            (overlay_set_display, "$g_presentation_but3_movement", 0),
            (overlay_set_display, "$g_presentation_but3_riding", 0),
            (overlay_set_display, "$g_presentation_but3_weapon_usage", 0),
            (overlay_set_display, reg9, 0),
            (overlay_set_display, reg18, 1),
            (overlay_set_display, reg27, 1),
            (overlay_set_display, reg36, 1),
            (overlay_set_display, reg45, 1),
          (try_end),
          (try_begin),
            (eq, "$group4_has_troops", 1),
            (overlay_set_display, "$g_presentation_but4_movement", 0),
            (overlay_set_display, "$g_presentation_but4_riding", 0),
            (overlay_set_display, "$g_presentation_but4_weapon_usage", 0),
            (overlay_set_display, reg10, 0),
            (overlay_set_display, reg19, 1),
            (overlay_set_display, reg28, 1),
            (overlay_set_display, reg37, 1),
            (overlay_set_display, reg46, 1),
          (try_end),
          (try_begin),
            (eq, "$group5_has_troops", 1),
            (overlay_set_display, "$g_presentation_but5_movement", 0),
            (overlay_set_display, "$g_presentation_but5_riding", 0),
            (overlay_set_display, "$g_presentation_but5_weapon_usage", 0),
            (overlay_set_display, reg11, 0),
            (overlay_set_display, reg20, 1),
            (overlay_set_display, reg29, 1),
            (overlay_set_display, reg38, 1),
            (overlay_set_display, reg47, 1),
          (try_end),
          (try_begin),
            (eq, "$group6_has_troops", 1),
            (overlay_set_display, "$g_presentation_but6_movement", 0),
            (overlay_set_display, "$g_presentation_but6_riding", 0),
            (overlay_set_display, "$g_presentation_but6_weapon_usage", 0),
            (overlay_set_display, reg12, 0),
            (overlay_set_display, reg21, 1),
            (overlay_set_display, reg30, 1),
            (overlay_set_display, reg39, 1),
            (overlay_set_display, reg48, 1),
          (try_end),
          (try_begin),
            (eq, "$group7_has_troops", 1),
            (overlay_set_display, "$g_presentation_but7_movement", 0),
            (overlay_set_display, "$g_presentation_but7_riding", 0),
            (overlay_set_display, "$g_presentation_but7_weapon_usage", 0),
            (overlay_set_display, reg13, 0),
            (overlay_set_display, reg22, 1),
            (overlay_set_display, reg31, 1),
            (overlay_set_display, reg40, 1),
            (overlay_set_display, reg49, 1),
          (try_end),
          (try_begin),
            (eq, "$group8_has_troops", 1),
            (overlay_set_display, "$g_presentation_but8_movement", 0),
            (overlay_set_display, "$g_presentation_but8_riding", 0),
            (overlay_set_display, "$g_presentation_but8_weapon_usage", 0),
            (overlay_set_display, reg14, 0),
            (overlay_set_display, reg23, 1),
            (overlay_set_display, reg32, 1),
            (overlay_set_display, reg41, 1),
            (overlay_set_display, reg50, 1),
          (try_end),
          (position_set_x, pos1, 150),
          (overlay_set_text, "$g_presentation_obj_battle_24", "@...Turn to positioning orders"),
          (overlay_set_position, "$g_presentation_obj_battle_24", pos1),
        (else_try),
          (eq, ":var2", 150),
          (overlay_set_display, "$g_presentation_obj_battle_13", 0),
          (overlay_set_display, "$g_presentation_obj_battle_14", 0),
          (overlay_set_display, "$g_presentation_obj_battle_15", 0),
          (overlay_set_display, "$g_presentation_obj_battle_16", 0),
          (overlay_set_display, "$g_presentation_credits_obj_6", 0),
          (overlay_set_display, "$g_presentation_credits_obj_7", 0),
          (overlay_set_display, "$g_presentation_credits_obj_8", 0),
          (overlay_set_display, "$g_presentation_credits_obj_9", 0),
          (overlay_set_display, "$g_presentation_obj_battle_10", 1),
          (overlay_set_display, "$g_presentation_obj_battle_11", 1),
          (overlay_set_display, "$g_presentation_obj_battle_12", 1),
          (overlay_set_display, "$g_presentation_obj_battle_17", 1),
          (overlay_set_display, reg51, 1),
          (overlay_set_display, reg52, 1),
          (overlay_set_display, "$g_presentation_credits_obj_2", 1),
          (overlay_set_display, "$g_presentation_credits_obj_3", 1),
          (overlay_set_display, "$g_presentation_credits_obj_4", 1),
          (overlay_set_display, "$g_presentation_credits_obj_5", 1),
          (store_add, ":var3", reg51, 2),
          (overlay_set_display, ":var3", 1),
          (val_add, ":var3", 1),
          (overlay_set_display, ":var3", 1),
          (try_begin),
            (eq, "$group0_has_troops", 1),
            (overlay_set_display, "$g_presentation_but0_movement", 1),
            (overlay_set_display, "$g_presentation_but0_riding", 1),
            (overlay_set_display, "$g_presentation_but0_weapon_usage", 1),
            (overlay_set_display, reg6, 1),
            (overlay_set_display, reg15, 0),
            (overlay_set_display, reg24, 0),
            (overlay_set_display, reg33, 0),
            (overlay_set_display, reg42, 0),
          (try_end),
          (try_begin),
            (eq, "$group1_has_troops", 1),
            (overlay_set_display, "$g_presentation_but1_movement", 1),
            (overlay_set_display, "$g_presentation_but1_riding", 1),
            (overlay_set_display, "$g_presentation_but1_weapon_usage", 1),
            (overlay_set_display, reg7, 1),
            (overlay_set_display, reg16, 0),
            (overlay_set_display, reg25, 0),
            (overlay_set_display, reg34, 0),
            (overlay_set_display, reg43, 0),
          (try_end),
          (try_begin),
            (eq, "$group2_has_troops", 1),
            (overlay_set_display, "$g_presentation_but2_movement", 1),
            (overlay_set_display, "$g_presentation_but2_riding", 1),
            (overlay_set_display, "$g_presentation_but2_weapon_usage", 1),
            (overlay_set_display, reg8, 1),
            (overlay_set_display, reg17, 0),
            (overlay_set_display, reg26, 0),
            (overlay_set_display, reg35, 0),
            (overlay_set_display, reg44, 0),
          (try_end),
          (try_begin),
            (eq, "$group3_has_troops", 1),
            (overlay_set_display, "$g_presentation_but3_movement", 1),
            (overlay_set_display, "$g_presentation_but3_riding", 1),
            (overlay_set_display, "$g_presentation_but3_weapon_usage", 1),
            (overlay_set_display, reg9, 1),
            (overlay_set_display, reg18, 0),
            (overlay_set_display, reg27, 0),
            (overlay_set_display, reg36, 0),
            (overlay_set_display, reg45, 0),
          (try_end),
          (try_begin),
            (eq, "$group4_has_troops", 1),
            (overlay_set_display, "$g_presentation_but4_movement", 1),
            (overlay_set_display, "$g_presentation_but4_riding", 1),
            (overlay_set_display, "$g_presentation_but4_weapon_usage", 1),
            (overlay_set_display, reg10, 1),
            (overlay_set_display, reg19, 0),
            (overlay_set_display, reg28, 0),
            (overlay_set_display, reg37, 0),
            (overlay_set_display, reg46, 0),
          (try_end),
          (try_begin),
            (eq, "$group5_has_troops", 1),
            (overlay_set_display, "$g_presentation_but5_movement", 1),
            (overlay_set_display, "$g_presentation_but5_riding", 1),
            (overlay_set_display, "$g_presentation_but5_weapon_usage", 1),
            (overlay_set_display, reg11, 1),
            (overlay_set_display, reg20, 0),
            (overlay_set_display, reg29, 0),
            (overlay_set_display, reg38, 0),
            (overlay_set_display, reg47, 0),
          (try_end),
          (try_begin),
            (eq, "$group6_has_troops", 1),
            (overlay_set_display, "$g_presentation_but6_movement", 1),
            (overlay_set_display, "$g_presentation_but6_riding", 1),
            (overlay_set_display, "$g_presentation_but6_weapon_usage", 1),
            (overlay_set_display, reg12, 1),
            (overlay_set_display, reg21, 0),
            (overlay_set_display, reg30, 0),
            (overlay_set_display, reg39, 0),
            (overlay_set_display, reg48, 0),
          (try_end),
          (try_begin),
            (eq, "$group7_has_troops", 1),
            (overlay_set_display, "$g_presentation_but7_movement", 1),
            (overlay_set_display, "$g_presentation_but7_riding", 1),
            (overlay_set_display, "$g_presentation_but7_weapon_usage", 1),
            (overlay_set_display, reg13, 1),
            (overlay_set_display, reg22, 0),
            (overlay_set_display, reg31, 0),
            (overlay_set_display, reg40, 0),
            (overlay_set_display, reg49, 0),
          (try_end),
          (try_begin),
            (eq, "$group8_has_troops", 1),
            (overlay_set_display, "$g_presentation_but8_movement", 1),
            (overlay_set_display, "$g_presentation_but8_riding", 1),
            (overlay_set_display, "$g_presentation_but8_weapon_usage", 1),
            (overlay_set_display, reg14, 1),
            (overlay_set_display, reg23, 0),
            (overlay_set_display, reg32, 0),
            (overlay_set_display, reg41, 0),
            (overlay_set_display, reg50, 0),
          (try_end),
          (position_set_x, pos1, 450),
          (overlay_set_text, "$g_presentation_obj_battle_24", "@Turn to weapon orders..."),
          (overlay_set_position, "$g_presentation_obj_battle_24", pos1),
        (try_end),
      (else_try),
        (eq, "$group0_has_troops", 1),
        (eq, ":var0", "$g_presentation_obj_battle_check0"),
        (assign, "$g_formation_group0_selected", ":var1"),
        (try_begin),
          (eq, ":var1", 1),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but0", 250, 0x000044),
        (else_try),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but0", 250, 0x000000),
        (try_end),
      (else_try),
        (eq, "$group1_has_troops", 1),
        (eq, ":var0", "$g_presentation_obj_battle_check1"),
        (assign, "$g_formation_group1_selected", ":var1"),
        (try_begin),
          (eq, ":var1", 1),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but1", 250, 0x000044),
        (else_try),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but1", 250, 0x000000),
        (try_end),
      (else_try),
        (eq, "$group2_has_troops", 1),
        (eq, ":var0", "$g_presentation_obj_battle_check2"),
        (assign, "$g_formation_group2_selected", ":var1"),
        (try_begin),
          (eq, ":var1", 1),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but2", 250, 0x000044),
        (else_try),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but2", 250, 0x000000),
        (try_end),
      (else_try),
        (eq, "$group3_has_troops", 1),
        (eq, ":var0", "$g_presentation_obj_battle_check3"),
        (assign, "$g_formation_group3_selected", ":var1"),
        (try_begin),
          (eq, ":var1", 1),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but3", 250, 0x000044),
        (else_try),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but3", 250, 0x000000),
        (try_end),
      (else_try),
        (eq, "$group4_has_troops", 1),
        (eq, ":var0", "$g_presentation_obj_battle_check4"),
        (assign, "$g_formation_group4_selected", ":var1"),
        (try_begin),
          (eq, ":var1", 1),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but4", 250, 0x000044),
        (else_try),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but4", 250, 0x000000),
        (try_end),
      (else_try),
        (eq, "$group5_has_troops", 1),
        (eq, ":var0", "$g_presentation_obj_battle_check5"),
        (assign, "$g_formation_group5_selected", ":var1"),
        (try_begin),
          (eq, ":var1", 1),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but5", 250, 0x000044),
        (else_try),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but5", 250, 0x000000),
        (try_end),
      (else_try),
        (eq, "$group6_has_troops", 1),
        (eq, ":var0", "$g_presentation_obj_battle_check6"),
        (assign, "$g_formation_group6_selected", ":var1"),
        (try_begin),
          (eq, ":var1", 1),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but6", 250, 0x000044),
        (else_try),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but6", 250, 0x000000),
        (try_end),
      (else_try),
        (eq, "$group7_has_troops", 1),
        (eq, ":var0", "$g_presentation_obj_battle_check7"),
        (assign, "$g_formation_group7_selected", ":var1"),
        (try_begin),
          (eq, ":var1", 1),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but7", 250, 0x000044),
        (else_try),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but7", 250, 0x000000),
        (try_end),
      (else_try),
        (eq, "$group8_has_troops", 1),
        (eq, ":var0", "$g_presentation_obj_battle_check8"),
        (assign, "$g_formation_group8_selected", ":var1"),
        (try_begin),
          (eq, ":var1", 1),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but8", 250, 0x000044),
        (else_try),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but8", 250, 0x000000),
        (try_end),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_battle_but0"),
        (assign, "$g_formation_group0_selected", 1),
        (overlay_animate_to_alpha, "$g_presentation_obj_battle_but0", 250, 0x000044),
        (overlay_set_val, "$g_presentation_obj_battle_check0", 1),
        (try_begin),
          (eq, "$group1_has_troops", 1),
          (assign, "$g_formation_group1_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check1", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but1", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group2_has_troops", 1),
          (assign, "$g_formation_group2_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check2", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but2", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group3_has_troops", 1),
          (assign, "$g_formation_group3_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check3", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but3", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group4_has_troops", 1),
          (assign, "$g_formation_group4_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check4", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but4", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group5_has_troops", 1),
          (assign, "$g_formation_group5_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check5", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but5", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group6_has_troops", 1),
          (assign, "$g_formation_group6_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check6", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but6", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group7_has_troops", 1),
          (assign, "$g_formation_group7_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check7", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but7", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group8_has_troops", 1),
          (assign, "$g_formation_group8_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check8", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but8", 250, 0x000000),
        (try_end),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_battle_but1"),
        (assign, "$g_formation_group1_selected", 1),
        (overlay_animate_to_alpha, "$g_presentation_obj_battle_but1", 250, 0x000044),
        (overlay_set_val, "$g_presentation_obj_battle_check1", 1),
        (try_begin),
          (eq, "$group0_has_troops", 1),
          (assign, "$g_formation_group0_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check0", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but0", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group2_has_troops", 1),
          (assign, "$g_formation_group2_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check2", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but2", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group3_has_troops", 1),
          (assign, "$g_formation_group3_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check3", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but3", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group4_has_troops", 1),
          (assign, "$g_formation_group4_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check4", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but4", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group5_has_troops", 1),
          (assign, "$g_formation_group5_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check5", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but5", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group6_has_troops", 1),
          (assign, "$g_formation_group6_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check6", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but6", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group7_has_troops", 1),
          (assign, "$g_formation_group7_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check7", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but7", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group8_has_troops", 1),
          (assign, "$g_formation_group8_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check8", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but8", 250, 0x000000),
        (try_end),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_battle_but2"),
        (assign, "$g_formation_group2_selected", 1),
        (overlay_animate_to_alpha, "$g_presentation_obj_battle_but2", 250, 0x000044),
        (overlay_set_val, "$g_presentation_obj_battle_check2", 1),
        (try_begin),
          (eq, "$group0_has_troops", 1),
          (assign, "$g_formation_group0_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check0", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but0", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group1_has_troops", 1),
          (assign, "$g_formation_group1_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check1", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but1", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group3_has_troops", 1),
          (assign, "$g_formation_group3_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check3", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but3", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group4_has_troops", 1),
          (assign, "$g_formation_group4_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check4", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but4", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group5_has_troops", 1),
          (assign, "$g_formation_group5_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check5", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but5", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group6_has_troops", 1),
          (assign, "$g_formation_group6_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check6", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but6", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group7_has_troops", 1),
          (assign, "$g_formation_group7_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check7", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but7", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group8_has_troops", 1),
          (assign, "$g_formation_group8_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check8", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but8", 250, 0x000000),
        (try_end),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_battle_but3"),
        (assign, "$g_formation_group3_selected", 1),
        (overlay_animate_to_alpha, "$g_presentation_obj_battle_but3", 250, 0x000044),
        (overlay_set_val, "$g_presentation_obj_battle_check3", 1),
        (try_begin),
          (eq, "$group0_has_troops", 1),
          (assign, "$g_formation_group0_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check0", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but0", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group1_has_troops", 1),
          (assign, "$g_formation_group1_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check1", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but1", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group2_has_troops", 1),
          (assign, "$g_formation_group2_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check2", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but2", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group4_has_troops", 1),
          (assign, "$g_formation_group4_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check4", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but4", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group5_has_troops", 1),
          (assign, "$g_formation_group5_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check5", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but5", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group6_has_troops", 1),
          (assign, "$g_formation_group6_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check6", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but6", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group7_has_troops", 1),
          (assign, "$g_formation_group7_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check7", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but7", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group8_has_troops", 1),
          (assign, "$g_formation_group8_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check8", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but8", 250, 0x000000),
        (try_end),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_battle_but4"),
        (assign, "$g_formation_group4_selected", 1),
        (overlay_animate_to_alpha, "$g_presentation_obj_battle_but4", 250, 0x000044),
        (overlay_set_val, "$g_presentation_obj_battle_check4", 1),
        (try_begin),
          (eq, "$group0_has_troops", 1),
          (assign, "$g_formation_group0_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check0", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but0", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group1_has_troops", 1),
          (assign, "$g_formation_group1_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check1", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but1", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group2_has_troops", 1),
          (assign, "$g_formation_group2_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check2", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but2", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group3_has_troops", 1),
          (assign, "$g_formation_group3_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check3", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but3", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group5_has_troops", 1),
          (assign, "$g_formation_group5_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check5", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but5", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group6_has_troops", 1),
          (assign, "$g_formation_group6_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check6", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but6", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group7_has_troops", 1),
          (assign, "$g_formation_group7_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check7", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but7", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group8_has_troops", 1),
          (assign, "$g_formation_group8_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check8", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but8", 250, 0x000000),
        (try_end),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_battle_but5"),
        (assign, "$g_formation_group5_selected", 1),
        (overlay_animate_to_alpha, "$g_presentation_obj_battle_but5", 250, 0x000044),
        (overlay_set_val, "$g_presentation_obj_battle_check5", 1),
        (try_begin),
          (eq, "$group0_has_troops", 1),
          (assign, "$g_formation_group0_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check0", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but0", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group1_has_troops", 1),
          (assign, "$g_formation_group1_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check1", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but1", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group2_has_troops", 1),
          (assign, "$g_formation_group2_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check2", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but2", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group3_has_troops", 1),
          (assign, "$g_formation_group3_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check3", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but3", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group4_has_troops", 1),
          (assign, "$g_formation_group4_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check4", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but4", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group6_has_troops", 1),
          (assign, "$g_formation_group6_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check6", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but6", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group7_has_troops", 1),
          (assign, "$g_formation_group7_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check7", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but7", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group8_has_troops", 1),
          (assign, "$g_formation_group8_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check8", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but8", 250, 0x000000),
        (try_end),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_battle_but6"),
        (assign, "$g_formation_group6_selected", 1),
        (overlay_animate_to_alpha, "$g_presentation_obj_battle_but6", 250, 0x000044),
        (overlay_set_val, "$g_presentation_obj_battle_check6", 1),
        (try_begin),
          (eq, "$group0_has_troops", 1),
          (assign, "$g_formation_group0_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check0", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but0", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group1_has_troops", 1),
          (assign, "$g_formation_group1_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check1", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but1", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group2_has_troops", 1),
          (assign, "$g_formation_group2_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check2", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but2", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group3_has_troops", 1),
          (assign, "$g_formation_group3_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check3", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but3", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group4_has_troops", 1),
          (assign, "$g_formation_group4_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check4", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but4", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group5_has_troops", 1),
          (assign, "$g_formation_group5_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check5", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but5", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group7_has_troops", 1),
          (assign, "$g_formation_group7_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check7", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but7", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group8_has_troops", 1),
          (assign, "$g_formation_group8_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check8", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but8", 250, 0x000000),
        (try_end),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_battle_but7"),
        (assign, "$g_formation_group7_selected", 1),
        (overlay_animate_to_alpha, "$g_presentation_obj_battle_but7", 250, 0x000044),
        (overlay_set_val, "$g_presentation_obj_battle_check7", 1),
        (try_begin),
          (eq, "$group0_has_troops", 1),
          (assign, "$g_formation_group0_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check0", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but0", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group1_has_troops", 1),
          (assign, "$g_formation_group1_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check1", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but1", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group2_has_troops", 1),
          (assign, "$g_formation_group2_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check2", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but2", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group3_has_troops", 1),
          (assign, "$g_formation_group3_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check3", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but3", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group4_has_troops", 1),
          (assign, "$g_formation_group4_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check4", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but4", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group5_has_troops", 1),
          (assign, "$g_formation_group5_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check5", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but5", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group6_has_troops", 1),
          (assign, "$g_formation_group6_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check6", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but6", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group8_has_troops", 1),
          (assign, "$g_formation_group8_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check8", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but8", 250, 0x000000),
        (try_end),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_battle_but8"),
        (assign, "$g_formation_group8_selected", 1),
        (overlay_animate_to_alpha, "$g_presentation_obj_battle_but8", 250, 0x000044),
        (overlay_set_val, "$g_presentation_obj_battle_check8", 1),
        (try_begin),
          (eq, "$group0_has_troops", 1),
          (assign, "$g_formation_group0_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check0", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but0", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group1_has_troops", 1),
          (assign, "$g_formation_group1_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check1", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but1", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group2_has_troops", 1),
          (assign, "$g_formation_group2_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check2", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but2", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group3_has_troops", 1),
          (assign, "$g_formation_group3_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check3", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but3", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group4_has_troops", 1),
          (assign, "$g_formation_group4_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check4", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but4", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group5_has_troops", 1),
          (assign, "$g_formation_group5_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check5", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but5", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group6_has_troops", 1),
          (assign, "$g_formation_group6_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check6", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but6", 250, 0x000000),
        (try_end),
        (try_begin),
          (eq, "$group7_has_troops", 1),
          (assign, "$g_formation_group7_selected", 0),
          (overlay_set_val, "$g_presentation_obj_battle_check7", 0),
          (overlay_animate_to_alpha, "$g_presentation_obj_battle_but7", 250, 0x000000),
        (try_end),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_battle_10"),
        (try_begin),
          (eq, ":var1", 4),
          (call_script, "script_prebattle_order_update_text_slot", 0, -1, 0),
        (else_try),
          (eq, ":var1", 3),
          (call_script, "script_prebattle_order_update_text_slot", 0, 0, 0),
        (else_try),
          (eq, ":var1", 2),
          (call_script, "script_prebattle_order_update_text_slot", 0, 1, 0),
        (else_try),
          (eq, ":var1", 1),
          (call_script, "script_prebattle_order_update_text_slot", 0, 2, 0),
        (else_try),
          (eq, ":var1", 0),
          (call_script, "script_prebattle_order_update_text_slot", 0, 3, 0),
        (try_end),
      (else_try),
        (this_or_next|eq, ":var0", "$g_presentation_obj_battle_11"),
        (eq, ":var0", "$g_presentation_obj_battle_12"),
        (try_begin),
          (eq, ":var0", "$g_presentation_obj_battle_11"),
          (assign, ":var4", 1),
          (assign, ":var5", reg53),
        (else_try),
          (eq, ":var0", "$g_presentation_obj_battle_12"),
          (assign, ":var4", 2),
          (assign, ":var5", reg54),
        (try_end),
        (try_begin),
          (eq, ":var1", 6),
          (call_script, "script_prebattle_order_update_text_slot", ":var4", -1, 0),
        (else_try),
          (eq, ":var1", 1),
          (call_script, "script_prebattle_order_update_text_slot", ":var4", 3, 0),
        (else_try),
          (eq, ":var1", 0),
          (call_script, "script_prebattle_order_update_text_slot", ":var4", 4, 0),
        (else_try),
          (eq, ":var1", 5),
          (call_script, "script_prebattle_order_update_text_slot", ":var4", 5, ":var5"),
          (call_script, "script_prebattle_order_update_text_slot", 0, 0, 0),
        (else_try),
          (eq, ":var1", 4),
          (call_script, "script_prebattle_order_update_text_slot", ":var4", 6, ":var5"),
          (call_script, "script_prebattle_order_update_text_slot", 0, 0, 0),
        (else_try),
          (eq, ":var1", 3),
          (call_script, "script_prebattle_order_update_text_slot", ":var4", 7, ":var5"),
        (else_try),
          (eq, ":var1", 2),
          (call_script, "script_prebattle_order_update_text_slot", ":var4", 8, ":var5"),
        (try_end),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_battle_17"),
        (try_begin),
          (eq, ":var1", 4),
          (call_script, "script_prebattle_order_update_text_slot", 3, -1, 0),
        (else_try),
          (eq, ":var1", 3),
          (call_script, "script_prebattle_order_update_text_slot", 3, 2, 0),
          (call_script, "script_prebattle_order_update_text_slot", 0, 0, 0),
        (else_try),
          (eq, ":var1", 2),
          (call_script, "script_prebattle_order_update_text_slot", 3, 3, 0),
          (call_script, "script_prebattle_order_update_text_slot", 0, 0, 0),
        (else_try),
          (eq, ":var1", 1),
          (call_script, "script_prebattle_order_update_text_slot", 3, 4, 0),
          (call_script, "script_prebattle_order_update_text_slot", 0, 0, 0),
        (else_try),
          (eq, ":var1", 0),
          (call_script, "script_prebattle_order_update_text_slot", 3, 5, 0),
          (call_script, "script_prebattle_order_update_text_slot", 0, 0, 0),
        (try_end),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_battle_13"),
        (try_begin),
          (eq, ":var1", 4),
          (call_script, "script_prebattle_order_update_text_slot", 4, -1, 0),
        (else_try),
          (eq, ":var1", 1),
          (call_script, "script_prebattle_order_update_text_slot", 4, 2, 0),
        (else_try),
          (eq, ":var1", 0),
          (call_script, "script_prebattle_order_update_text_slot", 4, 3, 0),
        (else_try),
          (eq, ":var1", 3),
          (call_script, "script_prebattle_order_update_text_slot", 4, 0, 0),
        (else_try),
          (eq, ":var1", 2),
          (call_script, "script_prebattle_order_update_text_slot", 4, 9, 0),
        (try_end),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_battle_14"),
        (try_begin),
          (eq, ":var1", 4),
          (call_script, "script_prebattle_order_update_text_slot", 5, -1, 0),
        (else_try),
          (eq, ":var1", 3),
          (call_script, "script_prebattle_order_update_text_slot", 5, 1, 0),
        (else_try),
          (eq, ":var1", 2),
          (call_script, "script_prebattle_order_update_text_slot", 5, 2, 0),
        (else_try),
          (eq, ":var1", 1),
          (call_script, "script_prebattle_order_update_text_slot", 5, 3, 0),
        (else_try),
          (eq, ":var1", 0),
          (call_script, "script_prebattle_order_update_text_slot", 5, 0, 0),
        (try_end),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_battle_15"),
        (try_begin),
          (eq, ":var1", 2),
          (call_script, "script_prebattle_order_update_text_slot", 6, -1, 0),
        (else_try),
          (eq, ":var1", 1),
          (call_script, "script_prebattle_order_update_text_slot", 6, 4, 0),
        (else_try),
          (eq, ":var1", 0),
          (call_script, "script_prebattle_order_update_text_slot", 6, 5, 0),
        (try_end),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_battle_16"),
        (try_begin),
          (eq, ":var1", 1),
          (call_script, "script_prebattle_order_update_text_slot", 7, -1, 0),
        (else_try),
          (eq, ":var1", 0),
          (call_script, "script_prebattle_order_update_text_slot", 7, 1, 0),
        (try_end),
      (else_try),
        (eq, ":var0", reg51),
        (assign, reg53, ":var1"),
      (else_try),
        (eq, ":var0", reg52),
        (assign, reg54, ":var1"),
      (try_end),
    ]),
    (ti_on_presentation_mouse_enter_leave,
    [
      (store_trigger_param_1, ":var0"),
      (store_trigger_param_2, ":var1"),
      (try_begin),
        (eq, ":var0", "$g_presentation_obj_battle_but0"),
        (try_begin),
          (eq, ":var1", 0),
          (overlay_animate_to_color, "$g_presentation_but0_movement", 250, 0xFFFFFF),
          (overlay_animate_to_color, "$g_presentation_but0_riding", 250, 0xFFFFFF),
          (overlay_animate_to_color, "$g_presentation_but0_weapon_usage", 250, 0xFFFFFF),
          (overlay_animate_to_color, reg6, 250, 0xFFFFFF),
          (overlay_animate_to_color, reg15, 250, 0xFFFFFF),
          (overlay_animate_to_color, reg24, 250, 0xFFFFFF),
          (overlay_animate_to_color, reg33, 250, 0xFFFFFF),
          (overlay_animate_to_color, reg42, 250, 0xFFFFFF),
          (overlay_animate_to_color, "$g_presentation_obj_battle_name0", 250, 0xFFFFFF),
        (else_try),
          (overlay_animate_to_color, "$g_presentation_but0_movement", 250, 0x000000),
          (overlay_animate_to_color, "$g_presentation_but0_riding", 250, 0x000000),
          (overlay_animate_to_color, "$g_presentation_but0_weapon_usage", 250, 0x000000),
          (overlay_animate_to_color, reg6, 250, 0x000000),
          (overlay_animate_to_color, reg15, 250, 0x000000),
          (overlay_animate_to_color, reg24, 250, 0x000000),
          (overlay_animate_to_color, reg33, 250, 0x000000),
          (overlay_animate_to_color, reg42, 250, 0x000000),
          (overlay_animate_to_color, "$g_presentation_obj_battle_name0", 250, 0x000000),
        (try_end),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_battle_but1"),
        (try_begin),
          (eq, ":var1", 0),
          (overlay_animate_to_color, "$g_presentation_but1_movement", 250, 0xFFFFFF),
          (overlay_animate_to_color, "$g_presentation_but1_riding", 250, 0xFFFFFF),
          (overlay_animate_to_color, "$g_presentation_but1_weapon_usage", 250, 0xFFFFFF),
          (overlay_animate_to_color, reg7, 250, 0xFFFFFF),
          (overlay_animate_to_color, reg16, 250, 0xFFFFFF),
          (overlay_animate_to_color, reg25, 250, 0xFFFFFF),
          (overlay_animate_to_color, reg34, 250, 0xFFFFFF),
          (overlay_animate_to_color, reg43, 250, 0xFFFFFF),
          (overlay_animate_to_color, "$g_presentation_obj_battle_name1", 250, 0xFFFFFF),
        (else_try),
          (overlay_animate_to_color, "$g_presentation_but1_movement", 250, 0x000000),
          (overlay_animate_to_color, "$g_presentation_but1_riding", 250, 0x000000),
          (overlay_animate_to_color, "$g_presentation_but1_weapon_usage", 250, 0x000000),
          (overlay_animate_to_color, reg7, 250, 0x000000),
          (overlay_animate_to_color, reg16, 250, 0x000000),
          (overlay_animate_to_color, reg25, 250, 0x000000),
          (overlay_animate_to_color, reg34, 250, 0x000000),
          (overlay_animate_to_color, reg43, 250, 0x000000),
          (overlay_animate_to_color, "$g_presentation_obj_battle_name1", 250, 0x000000),
        (try_end),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_battle_but2"),
        (try_begin),
          (eq, ":var1", 0),
          (overlay_animate_to_color, "$g_presentation_but2_movement", 250, 0xFFFFFF),
          (overlay_animate_to_color, "$g_presentation_but2_riding", 250, 0xFFFFFF),
          (overlay_animate_to_color, "$g_presentation_but2_weapon_usage", 250, 0xFFFFFF),
          (overlay_animate_to_color, reg8, 250, 0xFFFFFF),
          (overlay_animate_to_color, reg17, 250, 0xFFFFFF),
          (overlay_animate_to_color, reg26, 250, 0xFFFFFF),
          (overlay_animate_to_color, reg35, 250, 0xFFFFFF),
          (overlay_animate_to_color, reg44, 250, 0xFFFFFF),
          (overlay_animate_to_color, "$g_presentation_obj_battle_name2", 250, 0xFFFFFF),
        (else_try),
          (overlay_animate_to_color, "$g_presentation_but2_movement", 250, 0x000000),
          (overlay_animate_to_color, "$g_presentation_but2_riding", 250, 0x000000),
          (overlay_animate_to_color, "$g_presentation_but2_weapon_usage", 250, 0x000000),
          (overlay_animate_to_color, reg8, 250, 0x000000),
          (overlay_animate_to_color, reg17, 250, 0x000000),
          (overlay_animate_to_color, reg26, 250, 0x000000),
          (overlay_animate_to_color, reg35, 250, 0x000000),
          (overlay_animate_to_color, reg44, 250, 0x000000),
          (overlay_animate_to_color, "$g_presentation_obj_battle_name2", 250, 0x000000),
        (try_end),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_battle_but3"),
        (try_begin),
          (eq, ":var1", 0),
          (overlay_animate_to_color, "$g_presentation_but3_movement", 250, 0xFFFFFF),
          (overlay_animate_to_color, "$g_presentation_but3_riding", 250, 0xFFFFFF),
          (overlay_animate_to_color, "$g_presentation_but3_weapon_usage", 250, 0xFFFFFF),
          (overlay_animate_to_color, reg9, 250, 0xFFFFFF),
          (overlay_animate_to_color, reg18, 250, 0xFFFFFF),
          (overlay_animate_to_color, reg27, 250, 0xFFFFFF),
          (overlay_animate_to_color, reg36, 250, 0xFFFFFF),
          (overlay_animate_to_color, reg45, 250, 0xFFFFFF),
          (overlay_animate_to_color, "$g_presentation_obj_battle_name3", 250, 0xFFFFFF),
        (else_try),
          (overlay_animate_to_color, "$g_presentation_but3_movement", 250, 0x000000),
          (overlay_animate_to_color, "$g_presentation_but3_riding", 250, 0x000000),
          (overlay_animate_to_color, "$g_presentation_but3_weapon_usage", 250, 0x000000),
          (overlay_animate_to_color, reg9, 250, 0x000000),
          (overlay_animate_to_color, reg18, 250, 0x000000),
          (overlay_animate_to_color, reg27, 250, 0x000000),
          (overlay_animate_to_color, reg36, 250, 0x000000),
          (overlay_animate_to_color, reg45, 250, 0x000000),
          (overlay_animate_to_color, "$g_presentation_obj_battle_name3", 250, 0x000000),
        (try_end),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_battle_but4"),
        (try_begin),
          (eq, ":var1", 0),
          (overlay_animate_to_color, "$g_presentation_but4_movement", 250, 0xFFFFFF),
          (overlay_animate_to_color, "$g_presentation_but4_riding", 250, 0xFFFFFF),
          (overlay_animate_to_color, "$g_presentation_but4_weapon_usage", 250, 0xFFFFFF),
          (overlay_animate_to_color, reg10, 250, 0xFFFFFF),
          (overlay_animate_to_color, reg19, 250, 0xFFFFFF),
          (overlay_animate_to_color, reg28, 250, 0xFFFFFF),
          (overlay_animate_to_color, reg37, 250, 0xFFFFFF),
          (overlay_animate_to_color, reg46, 250, 0xFFFFFF),
          (overlay_animate_to_color, "$g_presentation_obj_battle_name4", 250, 0xFFFFFF),
        (else_try),
          (overlay_animate_to_color, "$g_presentation_but4_movement", 250, 0x000000),
          (overlay_animate_to_color, "$g_presentation_but4_riding", 250, 0x000000),
          (overlay_animate_to_color, "$g_presentation_but4_weapon_usage", 250, 0x000000),
          (overlay_animate_to_color, reg10, 250, 0x000000),
          (overlay_animate_to_color, reg19, 250, 0x000000),
          (overlay_animate_to_color, reg28, 250, 0x000000),
          (overlay_animate_to_color, reg37, 250, 0x000000),
          (overlay_animate_to_color, reg46, 250, 0x000000),
          (overlay_animate_to_color, "$g_presentation_obj_battle_name4", 250, 0x000000),
        (try_end),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_battle_but5"),
        (try_begin),
          (eq, ":var1", 0),
          (overlay_animate_to_color, "$g_presentation_but5_movement", 250, 0xFFFFFF),
          (overlay_animate_to_color, "$g_presentation_but5_riding", 250, 0xFFFFFF),
          (overlay_animate_to_color, "$g_presentation_but5_weapon_usage", 250, 0xFFFFFF),
          (overlay_animate_to_color, reg11, 250, 0xFFFFFF),
          (overlay_animate_to_color, reg20, 250, 0xFFFFFF),
          (overlay_animate_to_color, reg29, 250, 0xFFFFFF),
          (overlay_animate_to_color, reg38, 250, 0xFFFFFF),
          (overlay_animate_to_color, reg47, 250, 0xFFFFFF),
          (overlay_animate_to_color, "$g_presentation_obj_battle_name5", 250, 0xFFFFFF),
        (else_try),
          (overlay_animate_to_color, "$g_presentation_but5_movement", 250, 0x000000),
          (overlay_animate_to_color, "$g_presentation_but5_riding", 250, 0x000000),
          (overlay_animate_to_color, "$g_presentation_but5_weapon_usage", 250, 0x000000),
          (overlay_animate_to_color, reg11, 250, 0x000000),
          (overlay_animate_to_color, reg20, 250, 0x000000),
          (overlay_animate_to_color, reg29, 250, 0x000000),
          (overlay_animate_to_color, reg38, 250, 0x000000),
          (overlay_animate_to_color, reg47, 250, 0x000000),
          (overlay_animate_to_color, "$g_presentation_obj_battle_name5", 250, 0x000000),
        (try_end),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_battle_but6"),
        (try_begin),
          (eq, ":var1", 0),
          (overlay_animate_to_color, "$g_presentation_but6_movement", 250, 0xFFFFFF),
          (overlay_animate_to_color, "$g_presentation_but6_riding", 250, 0xFFFFFF),
          (overlay_animate_to_color, "$g_presentation_but6_weapon_usage", 250, 0xFFFFFF),
          (overlay_animate_to_color, reg12, 250, 0xFFFFFF),
          (overlay_animate_to_color, reg21, 250, 0xFFFFFF),
          (overlay_animate_to_color, reg30, 250, 0xFFFFFF),
          (overlay_animate_to_color, reg39, 250, 0xFFFFFF),
          (overlay_animate_to_color, reg48, 250, 0xFFFFFF),
          (overlay_animate_to_color, "$g_presentation_obj_battle_name6", 250, 0xFFFFFF),
        (else_try),
          (overlay_animate_to_color, "$g_presentation_but6_movement", 250, 0x000000),
          (overlay_animate_to_color, "$g_presentation_but6_riding", 250, 0x000000),
          (overlay_animate_to_color, "$g_presentation_but6_weapon_usage", 250, 0x000000),
          (overlay_animate_to_color, reg12, 250, 0x000000),
          (overlay_animate_to_color, reg21, 250, 0x000000),
          (overlay_animate_to_color, reg30, 250, 0x000000),
          (overlay_animate_to_color, reg39, 250, 0x000000),
          (overlay_animate_to_color, reg48, 250, 0x000000),
          (overlay_animate_to_color, "$g_presentation_obj_battle_name6", 250, 0x000000),
        (try_end),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_battle_but7"),
        (try_begin),
          (eq, ":var1", 0),
          (overlay_animate_to_color, "$g_presentation_but7_movement", 250, 0xFFFFFF),
          (overlay_animate_to_color, "$g_presentation_but7_riding", 250, 0xFFFFFF),
          (overlay_animate_to_color, "$g_presentation_but7_weapon_usage", 250, 0xFFFFFF),
          (overlay_animate_to_color, reg13, 250, 0xFFFFFF),
          (overlay_animate_to_color, reg22, 250, 0xFFFFFF),
          (overlay_animate_to_color, reg31, 250, 0xFFFFFF),
          (overlay_animate_to_color, reg40, 250, 0xFFFFFF),
          (overlay_animate_to_color, reg49, 250, 0xFFFFFF),
          (overlay_animate_to_color, "$g_presentation_obj_battle_name7", 250, 0xFFFFFF),
        (else_try),
          (overlay_animate_to_color, "$g_presentation_but7_movement", 250, 0x000000),
          (overlay_animate_to_color, "$g_presentation_but7_riding", 250, 0x000000),
          (overlay_animate_to_color, "$g_presentation_but7_weapon_usage", 250, 0x000000),
          (overlay_animate_to_color, reg13, 250, 0x000000),
          (overlay_animate_to_color, reg22, 250, 0x000000),
          (overlay_animate_to_color, reg31, 250, 0x000000),
          (overlay_animate_to_color, reg40, 250, 0x000000),
          (overlay_animate_to_color, reg49, 250, 0x000000),
          (overlay_animate_to_color, "$g_presentation_obj_battle_name7", 250, 0x000000),
        (try_end),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_battle_but8"),
        (try_begin),
          (eq, ":var1", 0),
          (overlay_animate_to_color, "$g_presentation_but8_movement", 250, 0xFFFFFF),
          (overlay_animate_to_color, "$g_presentation_but8_riding", 250, 0xFFFFFF),
          (overlay_animate_to_color, "$g_presentation_but8_weapon_usage", 250, 0xFFFFFF),
          (overlay_animate_to_color, reg14, 250, 0xFFFFFF),
          (overlay_animate_to_color, reg23, 250, 0xFFFFFF),
          (overlay_animate_to_color, reg32, 250, 0xFFFFFF),
          (overlay_animate_to_color, reg41, 250, 0xFFFFFF),
          (overlay_animate_to_color, reg50, 250, 0xFFFFFF),
          (overlay_animate_to_color, "$g_presentation_obj_battle_name8", 250, 0xFFFFFF),
        (else_try),
          (overlay_animate_to_color, "$g_presentation_but8_movement", 250, 0x000000),
          (overlay_animate_to_color, "$g_presentation_but8_riding", 250, 0x000000),
          (overlay_animate_to_color, "$g_presentation_but8_weapon_usage", 250, 0x000000),
          (overlay_animate_to_color, reg14, 250, 0x000000),
          (overlay_animate_to_color, reg23, 250, 0x000000),
          (overlay_animate_to_color, reg32, 250, 0x000000),
          (overlay_animate_to_color, reg41, 250, 0x000000),
          (overlay_animate_to_color, reg50, 250, 0x000000),
          (overlay_animate_to_color, "$g_presentation_obj_battle_name8", 250, 0x000000),
        (try_end),
      (try_end),
    ]),
    (ti_on_presentation_run,
    [
      (try_begin),
        (key_clicked, key_escape),
        (party_set_slot, "p_main_party", 231, 0),
        (jump_to_menu, "$g_next_menu"),
        (presentation_set_duration, 0),
      (try_end),
    ]),
  ]),

  ("prebattle_record_battle_size", 0, mesh_load_window,
  [
    (ti_on_presentation_load,
    [
      (set_fixed_point_multiplier, 1000),
      (str_store_string, s1, "@Record Battle Size as set in Options"),
      (create_text_overlay, reg1, s1, tf_center_justify),
      (position_set_x, pos1, 500),
      (position_set_y, pos1, 500),
      (overlay_set_position, reg1, pos1),
      (overlay_set_text, reg1, s1),
      (create_number_box_overlay, "$g_presentation_obj_name_kingdom_1", 30, 1001),
      (position_set_x, pos1, 400),
      (position_set_y, pos1, 400),
      (overlay_set_position, "$g_presentation_obj_name_kingdom_1", pos1),
      (party_get_slot, ":var0", "p_main_party", 48),
      (overlay_set_val, "$g_presentation_obj_name_kingdom_1", ":var0"),
      (create_button_overlay, "$g_presentation_obj_name_kingdom_2", "@Continue...", tf_center_justify),
      (position_set_x, pos1, 500),
      (position_set_y, pos1, 300),
      (overlay_set_position, "$g_presentation_obj_name_kingdom_2", pos1),
      (presentation_set_duration, 999999),
    ]),
    (ti_on_presentation_event_state_change,
    [
      (store_trigger_param_1, ":var0"),
      (store_trigger_param_2, ":var1"),
      (try_begin),
        (eq, ":var0", "$g_presentation_obj_name_kingdom_1"),
        (party_set_slot, "p_main_party", 48, ":var1"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_name_kingdom_2"),
        (party_get_slot, ":var2", "p_main_party", 48),
        (val_clamp, ":var2", 30, 1001),
        (party_set_slot, "p_main_party", 48, ":var2"),
        (try_begin),
          (eq, "$g_presentation_credits_obj_1", 1),
          (start_presentation, "prsnt_prebattle_custom_deployment"),
        (else_try),
          (presentation_set_duration, 0),
        (try_end),
      (try_end),
    ]),
  ]),

  ("pbod_preferences", 0, mesh_load_window,
  [
    (ti_on_presentation_load,
    [
      (presentation_set_duration, 999999),
      (set_fixed_point_multiplier, 1000),
      (try_begin),
        (party_slot_eq, "p_main_party", 72, 0),
        (call_script, "script_prebattle_set_default_prefs"),
        (party_set_slot, "p_main_party", 72, 1),
      (try_end),
      (str_clear, s0),
      (create_text_overlay, reg0, s0, tf_scrollable),
      (position_set_x, pos1, 50),
      (position_set_y, pos1, 50),
      (overlay_set_position, reg0, pos1),
      (position_set_x, pos1, 550),
      (position_set_y, pos1, 630),
      (overlay_set_area_size, reg0, pos1),
      (set_container_overlay, reg0),
      (assign, ":var0", 15),
      (val_add, ":var0", 2),
      (assign, ":var1", 50),
      (store_div, ":var2", ":var1", 2),
      (store_mul, ":var3", ":var1", ":var0"),
      (store_sub, ":var4", ":var3", 5),
      (position_set_x, pos1, 50),
      (create_text_overlay, reg0, "@Record Battle Size as set in Options:", tf_vertical_align_center),
      (position_set_y, pos1, ":var3"),
      (overlay_set_position, reg0, pos1),
      (store_sub, ":var5", ":var3", ":var2"),
      (val_sub, ":var3", ":var1"),
      (val_sub, ":var3", 30),
      (create_text_overlay, reg0, "@The 'Weapon Use Fixes' change NPC decision-^making with the following weapon types.^Un-tick the boxes if you dislike the behavior.", tf_vertical_align_center),
      (position_set_y, pos1, ":var3"),
      (overlay_set_position, reg0, pos1),
      (val_sub, ":var3", ":var1"),
      (val_sub, ":var3", 20),
      (create_text_overlay, reg0, "@Use NPC Lancer Fix:", tf_vertical_align_center),
      (position_set_y, pos1, ":var3"),
      (overlay_set_position, reg0, pos1),
      (val_sub, ":var3", ":var1"),
      (assign, "$g_presentation_obj_banner_selection_2", reg0),
      (create_text_overlay, reg0, "@Use NPC Horse Archer Fix:", tf_vertical_align_center),
      (position_set_y, pos1, ":var3"),
      (overlay_set_position, reg0, pos1),
      (val_sub, ":var3", ":var1"),
      (create_text_overlay, reg0, "@Use NPC Spear/Polearm Fix:", tf_vertical_align_center),
      (position_set_y, pos1, ":var3"),
      (overlay_set_position, reg0, pos1),
      (val_sub, ":var3", ":var1"),
      (store_add, ":var6", ":var3", ":var2"),
      (create_text_overlay, reg0, "@Use Pike/Horse Damage Tweaks:", tf_vertical_align_center),
      (position_set_y, pos1, ":var3"),
      (overlay_set_position, reg0, pos1),
      (val_sub, ":var3", ":var1"),
      (create_text_overlay, reg0, "@Reassign De-horsed Cavalry to:", tf_vertical_align_center),
      (position_set_y, pos1, ":var3"),
      (overlay_set_position, reg0, pos1),
      (val_sub, ":var3", ":var1"),
      (create_text_overlay, reg0, "@Reassign No-Ammo Archers to:", tf_vertical_align_center),
      (position_set_y, pos1, ":var3"),
      (overlay_set_position, reg0, pos1),
      (val_sub, ":var3", ":var1"),
      (create_text_overlay, reg0, "@Enable Battle Continuation:", tf_vertical_align_center),
      (position_set_y, pos1, ":var3"),
      (overlay_set_position, reg0, pos1),
      (val_sub, ":var3", ":var1"),
      (create_text_overlay, reg0, "@Batt. Cont., Charge after KO:", tf_vertical_align_center),
      (position_set_y, pos1, ":var3"),
      (overlay_set_position, reg0, pos1),
      (val_sub, ":var3", ":var1"),
      (create_text_overlay, reg0, "@Formations Battle AI:", tf_vertical_align_center),
      (position_set_y, pos1, ":var3"),
      (overlay_set_position, reg0, pos1),
      (val_sub, ":var3", ":var1"),
      (create_text_overlay, reg0, "@Enable AI to use Special Orders:", tf_vertical_align_center),
      (position_set_y, pos1, ":var3"),
      (overlay_set_position, reg0, pos1),
      (val_sub, ":var3", ":var1"),
      (create_text_overlay, reg0, "@Enable Bodyguards in Towns/Villages:", tf_vertical_align_center),
      (position_set_y, pos1, ":var3"),
      (overlay_set_position, reg0, pos1),
      (val_sub, ":var3", ":var1"),
      (create_text_overlay, reg0, "@Enable ranged penalty from weather:", tf_vertical_align_center),
      (position_set_y, pos1, ":var3"),
      (overlay_set_position, reg0, pos1),
      (val_sub, ":var3", ":var1"),
      (store_add, ":var7", ":var3", ":var2"),
      (create_text_overlay, reg0, "@Disable Companions' complaints:", tf_vertical_align_center),
      (position_set_y, pos1, ":var3"),
      (overlay_set_position, reg0, pos1),
      (val_sub, ":var3", ":var1"),
      (create_text_overlay, reg0, "@Enable the cheat menu:", tf_vertical_align_center),
      (position_set_y, pos1, ":var3"),
      (overlay_set_position, reg0, pos1),
      (val_sub, ":var3", ":var1"),
      (create_mesh_overlay, reg0, "mesh_white_plane"),
      (position_set_x, pos1, 23500),
      (position_set_y, pos1, 100),
      (overlay_set_size, reg0, pos1),
      (position_set_x, pos1, 50),
      (position_set_y, pos1, ":var5"),
      (overlay_set_position, reg0, pos1),
      (overlay_set_color, reg0, 0x000000),
      (create_mesh_overlay, reg0, "mesh_white_plane"),
      (position_set_x, pos1, 23500),
      (position_set_y, pos1, 100),
      (overlay_set_size, reg0, pos1),
      (position_set_x, pos1, 50),
      (position_set_y, pos1, ":var6"),
      (overlay_set_position, reg0, pos1),
      (overlay_set_color, reg0, 0x000000),
      (create_mesh_overlay, reg0, "mesh_white_plane"),
      (position_set_x, pos1, 23500),
      (position_set_y, pos1, 100),
      (overlay_set_size, reg0, pos1),
      (position_set_x, pos1, 50),
      (position_set_y, pos1, ":var7"),
      (overlay_set_position, reg0, pos1),
      (overlay_set_color, reg0, 0x000000),
      (position_set_x, pos1, 450),
      (val_sub, ":var4", 9),
      (create_number_box_overlay, "$g_presentation_obj_name_kingdom_1", 30, 1001),
      (position_set_y, pos1, ":var4"),
      (overlay_set_position, "$g_presentation_obj_name_kingdom_1", pos1),
      (party_get_slot, ":var8", "p_main_party", 48),
      (overlay_set_val, "$g_presentation_obj_name_kingdom_1", ":var8"),
      (val_sub, ":var4", ":var1"),
      (val_sub, ":var4", ":var1"),
      (val_sub, ":var4", 41),
      (create_check_box_overlay, reg0, "mesh_checkbox_off", "mesh_checkbox_on"),
      (position_set_y, pos1, ":var4"),
      (overlay_set_position, reg0, pos1),
      (val_sub, ":var4", ":var1"),
      (create_check_box_overlay, reg0, "mesh_checkbox_off", "mesh_checkbox_on"),
      (position_set_y, pos1, ":var4"),
      (overlay_set_position, reg0, pos1),
      (val_sub, ":var4", ":var1"),
      (create_check_box_overlay, reg0, "mesh_checkbox_off", "mesh_checkbox_on"),
      (position_set_y, pos1, ":var4"),
      (overlay_set_position, reg0, pos1),
      (val_sub, ":var4", ":var1"),
      (create_check_box_overlay, reg0, "mesh_checkbox_off", "mesh_checkbox_on"),
      (position_set_y, pos1, ":var4"),
      (overlay_set_position, reg0, pos1),
      (val_sub, ":var4", ":var1"),
      (create_combo_button_overlay, reg0),
      (position_set_x, pos1, 485),
      (val_sub, ":var4", 8),
      (position_set_y, pos1, ":var4"),
      (overlay_set_position, reg0, pos1),
      (position_set_x, pos1, 700),
      (position_set_y, pos1, 800),
      (overlay_set_size, reg0, pos1),
      (try_for_range, ":var9", 0, 9),
        (str_store_class_name, 1, ":var9"),
        (overlay_add_item, reg0, s1),
      (try_end),
      (overlay_add_item, reg0, "@{!}- Disabled -"),
      (position_set_x, pos1, 450),
      (val_add, ":var4", 8),
      (val_sub, ":var4", ":var1"),
      (create_combo_button_overlay, reg0),
      (position_set_x, pos1, 485),
      (val_sub, ":var4", 8),
      (position_set_y, pos1, ":var4"),
      (overlay_set_position, reg0, pos1),
      (position_set_x, pos1, 700),
      (position_set_y, pos1, 800),
      (overlay_set_size, reg0, pos1),
      (try_for_range, ":var9", 0, 9),
        (str_store_class_name, 1, ":var9"),
        (overlay_add_item, reg0, s1),
      (try_end),
      (overlay_add_item, reg0, "@{!}- Disabled -"),
      (position_set_x, pos1, 450),
      (val_add, ":var4", 8),
      (val_sub, ":var4", ":var1"),
      (create_check_box_overlay, reg0, "mesh_checkbox_off", "mesh_checkbox_on"),
      (position_set_y, pos1, ":var4"),
      (overlay_set_position, reg0, pos1),
      (val_sub, ":var4", ":var1"),
      (create_combo_button_overlay, reg0),
      (position_set_x, pos1, 485),
      (val_sub, ":var4", 8),
      (position_set_y, pos1, ":var4"),
      (overlay_set_position, reg0, pos1),
      (position_set_x, pos1, 700),
      (position_set_y, pos1, 800),
      (overlay_set_size, reg0, pos1),
      (overlay_add_item, reg0, "@{!}- Disabled -"),
      (overlay_add_item, reg0, "@Charge All"),
      (overlay_add_item, reg0, "@Formations AI"),
      (position_set_x, pos1, 450),
      (val_add, ":var4", 8),
      (val_sub, ":var4", ":var1"),
      (create_combo_button_overlay, reg0),
      (position_set_x, pos1, 485),
      (val_sub, ":var4", 8),
      (position_set_y, pos1, ":var4"),
      (overlay_set_position, reg0, pos1),
      (position_set_x, pos1, 700),
      (position_set_y, pos1, 800),
      (overlay_set_size, reg0, pos1),
      (overlay_add_item, reg0, "@{!}- Disabled -"),
      (overlay_add_item, reg0, "@Formations AI"),
      (overlay_add_item, reg0, "@Native AI, w/Formations"),
      (position_set_x, pos1, 450),
      (val_add, ":var4", 8),
      (val_sub, ":var4", ":var1"),
      (create_check_box_overlay, reg0, "mesh_checkbox_off", "mesh_checkbox_on"),
      (position_set_y, pos1, ":var4"),
      (overlay_set_position, reg0, pos1),
      (val_sub, ":var4", ":var1"),
      (create_check_box_overlay, reg0, "mesh_checkbox_off", "mesh_checkbox_on"),
      (position_set_y, pos1, ":var4"),
      (overlay_set_position, reg0, pos1),
      (val_sub, ":var4", ":var1"),
      (create_check_box_overlay, reg0, "mesh_checkbox_off", "mesh_checkbox_on"),
      (position_set_y, pos1, ":var4"),
      (overlay_set_position, reg0, pos1),
      (val_sub, ":var4", ":var1"),
      (create_check_box_overlay, reg0, "mesh_checkbox_off", "mesh_checkbox_on"),
      (position_set_y, pos1, ":var4"),
      (overlay_set_position, reg0, pos1),
      (overlay_set_val, reg0, "$disable_npc_complaints"),
      (val_sub, ":var4", ":var1"),
      (create_check_box_overlay, reg0, "mesh_checkbox_off", "mesh_checkbox_on"),
      (position_set_y, pos1, ":var4"),
      (overlay_set_position, reg0, pos1),
      (overlay_set_val, reg0, "$cheat_mode"),
      (val_sub, ":var4", ":var1"),
      (set_container_overlay, -1),
      (party_get_slot, ":var10", "p_main_party", 78),
      (party_get_slot, ":var11", "p_main_party", 79),
      (party_get_slot, ":var12", "p_main_party", 80),
      (party_get_slot, ":var13", "p_main_party", 81),
      (party_get_slot, ":var14", "p_main_party", 84),
      (party_get_slot, ":var15", "p_main_party", 85),
      (party_get_slot, ":var16", "p_main_party", 86),
      (party_get_slot, ":var17", "p_main_party", 76),
      (party_get_slot, ":var18", "p_main_party", 77),
      (party_get_slot, ":var19", "p_main_party", 83),
      (party_get_slot, ":var20", "p_main_party", 82),
      (party_get_slot, ":var21", "p_main_party", 87),
      (store_add, ":var22", "$g_presentation_obj_name_kingdom_1", 1),
      (overlay_set_val, ":var22", ":var10"),
      (val_add, ":var22", 1),
      (overlay_set_val, ":var22", ":var11"),
      (val_add, ":var22", 1),
      (overlay_set_val, ":var22", ":var12"),
      (val_add, ":var22", 1),
      (overlay_set_val, ":var22", ":var13"),
      (val_add, ":var22", 1),
      (overlay_set_val, ":var22", ":var17"),
      (val_add, ":var22", 1),
      (overlay_set_val, ":var22", ":var18"),
      (val_add, ":var22", 1),
      (overlay_set_val, ":var22", ":var15"),
      (val_add, ":var22", 1),
      (overlay_set_val, ":var22", ":var16"),
      (val_add, ":var22", 1),
      (overlay_set_val, ":var22", ":var19"),
      (val_add, ":var22", 1),
      (overlay_set_val, ":var22", ":var20"),
      (val_add, ":var22", 1),
      (overlay_set_val, ":var22", ":var14"),
      (val_add, ":var22", 1),
      (overlay_set_val, ":var22", ":var21"),
      (create_text_overlay, reg0, "@PBOD Mod^Options", tf_center_justify|tf_with_outline),
      (overlay_set_color, reg0, 0xFFFFFFFF),
      (position_set_x, pos1, 800),
      (position_set_y, pos1, 600),
      (overlay_set_position, reg0, pos1),
      (position_set_x, pos1, 2000),
      (position_set_y, pos1, 2000),
      (overlay_set_size, reg0, pos1),
      (str_store_string, s0, "@Mouse-over options for further information."),
      (create_text_overlay, "$g_presentation_obj_banner_selection_1", s0, tf_double_space|tf_scrollable),
      (position_set_x, pos1, 650),
      (position_set_y, pos1, 400),
      (overlay_set_position, "$g_presentation_obj_banner_selection_1", pos1),
      (position_set_x, pos1, 800),
      (position_set_y, pos1, 800),
      (overlay_set_size, "$g_presentation_obj_banner_selection_1", pos1),
      (position_set_x, pos1, 300),
      (position_set_y, pos1, 150),
      (overlay_set_area_size, "$g_presentation_obj_banner_selection_1", pos1),
      (position_set_x, pos1, 900),
      (position_set_y, pos1, 25),
      (create_game_button_overlay, "$g_presentation_obj_name_kingdom_2", "@Done", 16),
      (overlay_set_position, "$g_presentation_obj_name_kingdom_2", pos1),
      (position_set_x, pos1, 740),
      (create_game_button_overlay, reg0, "@Restore Defaults", 16),
      (overlay_set_position, reg0, pos1),
      (position_set_x, pos1, 900),
      (position_set_y, pos1, 75),
      (create_game_button_overlay, reg0, "@Key Settings", 16),
      (overlay_set_position, reg0, pos1),
    ]),
    (ti_on_presentation_event_state_change,
    [
      (store_trigger_param_1, ":var0"),
      (store_trigger_param_2, ":var1"),
      (try_begin),
        (eq, ":var0", "$g_presentation_obj_name_kingdom_1"),
        (party_set_slot, "p_main_party", 48, ":var1"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_name_kingdom_2"),
        (party_get_slot, ":var2", "p_main_party", 48),
        (val_clamp, ":var2", 30, 1001),
        (party_set_slot, "p_main_party", 48, ":var2"),
        (presentation_set_duration, 0),
      (else_try),
        (store_add, ":var3", "$g_presentation_obj_name_kingdom_2", 1),
        (eq, ":var0", ":var3"),
        (call_script, "script_prebattle_set_default_prefs"),
        (start_presentation, "prsnt_pbod_preferences"),
      (else_try),
        (val_add, ":var3", 1),
        (eq, ":var0", ":var3"),
        (start_presentation, "prsnt_pbod_redefine_keys"),
      (else_try),
        (store_add, ":var3", "$g_presentation_obj_name_kingdom_1", 1),
        (eq, ":var0", ":var3"),
        (party_set_slot, "p_main_party", 78, ":var1"),
      (else_try),
        (val_add, ":var3", 1),
        (eq, ":var0", ":var3"),
        (party_set_slot, "p_main_party", 79, ":var1"),
      (else_try),
        (val_add, ":var3", 1),
        (eq, ":var0", ":var3"),
        (party_set_slot, "p_main_party", 80, ":var1"),
      (else_try),
        (val_add, ":var3", 1),
        (eq, ":var0", ":var3"),
        (party_set_slot, "p_main_party", 81, ":var1"),
      (else_try),
        (val_add, ":var3", 1),
        (eq, ":var0", ":var3"),
        (party_set_slot, "p_main_party", 76, ":var1"),
      (else_try),
        (val_add, ":var3", 1),
        (eq, ":var0", ":var3"),
        (party_set_slot, "p_main_party", 77, ":var1"),
      (else_try),
        (val_add, ":var3", 1),
        (eq, ":var0", ":var3"),
        (party_set_slot, "p_main_party", 85, ":var1"),
      (else_try),
        (val_add, ":var3", 1),
        (eq, ":var0", ":var3"),
        (party_set_slot, "p_main_party", 86, ":var1"),
      (else_try),
        (val_add, ":var3", 1),
        (eq, ":var0", ":var3"),
        (party_set_slot, "p_main_party", 83, ":var1"),
      (else_try),
        (val_add, ":var3", 1),
        (eq, ":var0", ":var3"),
        (party_set_slot, "p_main_party", 82, ":var1"),
      (else_try),
        (val_add, ":var3", 1),
        (eq, ":var0", ":var3"),
        (party_set_slot, "p_main_party", 84, ":var1"),
      (else_try),
        (val_add, ":var3", 1),
        (eq, ":var0", ":var3"),
        (party_set_slot, "p_main_party", 87, ":var1"),
      (else_try),
        (val_add, ":var3", 1),
        (eq, ":var0", ":var3"),
        (assign, "$disable_npc_complaints", ":var1"),
      (else_try),
        (val_add, ":var3", 1),
        (eq, ":var0", ":var3"),
        (assign, "$cheat_mode", ":var1"),
      (try_end),
    ]),
    (ti_on_presentation_mouse_enter_leave,
    [
      (store_trigger_param_1, ":var0"),
      (store_trigger_param_2, ":var1"),
      (try_begin),
        (eq, ":var1", 1),
      (else_try),
        (eq, ":var1", 0),
        (store_add, ":var2", "$g_presentation_obj_name_kingdom_1", 1),
        (assign, ":var3", "$g_presentation_obj_banner_selection_2"),
        (try_begin),
          (lt, ":var0", ":var3"),
          (overlay_set_text, "$g_presentation_obj_banner_selection_1", "@Mouse-over options for further information."),
        (else_try),
          (this_or_next|eq, ":var0", ":var3"),
          (eq, ":var0", ":var2"),
          (overlay_set_text, "$g_presentation_obj_banner_selection_1", "@Weapon Use Fix for Lancers will force mounted bots with lances to use them unless they are surrounded by enemies."),
        (else_try),
          (val_add, ":var2", 1),
          (val_add, ":var3", 1),
          (this_or_next|eq, ":var0", ":var3"),
          (eq, ":var0", ":var2"),
          (overlay_set_text, "$g_presentation_obj_banner_selection_1", "@Weapon Use Fix for Horse Archers will force mounted bots with bows to use them until they run out of ammo."),
        (else_try),
          (val_add, ":var2", 1),
          (val_add, ":var3", 1),
          (this_or_next|eq, ":var0", ":var3"),
          (eq, ":var0", ":var2"),
          (overlay_set_text, "$g_presentation_obj_banner_selection_1", "@Weapon Use Fix for Spear/Polearms will force infantry bots with polearms to use them unless they are surrounded by enemies."),
        (else_try),
          (val_add, ":var2", 1),
          (val_add, ":var3", 1),
          (this_or_next|eq, ":var0", ":var3"),
          (eq, ":var0", ":var2"),
          (overlay_set_text, "$g_presentation_obj_banner_selection_1", "@Damage tweaks will give a flat boost to damage from spears to horses, and charge damage from horses to infantry, in an attempt to compensate for poor AI use of polearms and charges."),
        (else_try),
          (val_add, ":var2", 1),
          (val_add, ":var3", 1),
          (this_or_next|eq, ":var0", ":var3"),
          (eq, ":var0", ":var2"),
          (overlay_set_text, "$g_presentation_obj_banner_selection_1", "@Mounted bots, once their horse dies, can be re-assinged to a division of your choosing. If active, AI bots will be reassigned to infantry."),
        (else_try),
          (val_add, ":var2", 1),
          (val_add, ":var3", 1),
          (this_or_next|eq, ":var0", ":var3"),
          (eq, ":var0", ":var2"),
          (overlay_set_text, "$g_presentation_obj_banner_selection_1", "@Foot archer bots, once out of ammo, can be re-assinged to a division of your choosing. If active, AI bots will be reassigned to infantry."),
        (else_try),
          (val_add, ":var2", 1),
          (val_add, ":var3", 1),
          (this_or_next|eq, ":var0", ":var3"),
          (eq, ":var0", ":var2"),
          (overlay_set_text, "$g_presentation_obj_banner_selection_1", "@Battle Continuation allows your troops to continue fighting after you are knocked out."),
        (else_try),
          (val_add, ":var2", 1),
          (val_add, ":var3", 1),
          (this_or_next|eq, ":var0", ":var3"),
          (eq, ":var0", ":var2"),
          (overlay_set_text, "$g_presentation_obj_banner_selection_1", "@If Battle Continuation is active, you can select what your troops will do after you get knocked out: Disabled has them continue their previous orders; Charge all will give everyone a charge order; Formations AI (if active for the AI) will allow the new AI to take over for you."),
        (else_try),
          (val_add, ":var2", 1),
          (val_add, ":var3", 1),
          (this_or_next|eq, ":var0", ":var3"),
          (eq, ":var0", ":var2"),
          (overlay_set_text, "$g_presentation_obj_banner_selection_1", "@Select your prefered Battle AI: Disabled is Native AI; Formations AI both allows the AI to use formations and changes their battle decision-making; Native AI w/Formations is Native AI but carries out the Native AI with basic formations."),
        (else_try),
          (val_add, ":var2", 1),
          (val_add, ":var3", 1),
          (this_or_next|eq, ":var0", ":var3"),
          (eq, ":var0", ":var2"),
          (overlay_set_text, "$g_presentation_obj_banner_selection_1", "@Enabling AI Special Orders allows the AI teams to use volley fire (crossbows), skirmish mode (bow-users), and spear-bracing (polearm infantry)."),
        (else_try),
          (val_add, ":var2", 1),
          (val_add, ":var3", 1),
          (this_or_next|eq, ":var0", ":var3"),
          (eq, ":var0", ":var2"),
          (overlay_set_text, "$g_presentation_obj_banner_selection_1", "@Bodyguards allows your companions to serve as your character's bodyguards in town and village scenes. The number of bodyguards depends on your character's leadership and renown."),
        (else_try),
          (val_add, ":var2", 1),
          (val_add, ":var3", 1),
          (this_or_next|eq, ":var0", ":var3"),
          (eq, ":var0", ":var2"),
          (overlay_set_text, "$g_presentation_obj_banner_selection_1", "@The Weather Proficiency Penalties lowers the ranged weapons proficiencies of all troops while in battle in heavy fog, rain/snow, or at night to reflect the poor conditions for archery."),
        (else_try),
          (val_add, ":var2", 1),
          (val_add, ":var3", 1),
          (this_or_next|eq, ":var0", ":var3"),
          (eq, ":var0", ":var2"),
          (overlay_set_text, "$g_presentation_obj_banner_selection_1", "@Disabling NPC Complaints will mute your companion's complaints about eachother or your decisions. It will not remove the consequences of their opinions, however."),
        (else_try),
          (val_add, ":var2", 1),
          (val_add, ":var3", 1),
          (this_or_next|eq, ":var0", ":var3"),
          (eq, ":var0", ":var2"),
          (overlay_set_text, "$g_presentation_obj_banner_selection_1", "@The cheat/debug mode activates debug messages as well as the 'cheatmenu' in your Camp Menu and additional options under Reports."),
        (try_end),
      (try_end),
    ]),
  ]),

  ("pbod_redefine_keys", 0, mesh_load_window,
  [
    (ti_on_presentation_load,
    [
      (presentation_set_duration, 999999),
      (set_fixed_point_multiplier, 1000),
      (assign, "$g_presentation_obj_custom_battle_designer_1", 0),
      (call_script, "script_init_key_config"),
      (init_position, pos1),
      (position_set_y, pos1, 650),
      (position_set_x, pos1, 500),
      (position_set_x, pos2, 2000),
      (position_set_y, pos2, 2000),
      (create_text_overlay, reg0, "@Keys Configuration", tf_center_justify),
      (overlay_set_position, reg0, pos1),
      (overlay_set_size, reg0, pos2),
      (position_set_y, pos1, 25),
      (position_set_x, pos1, 50),
      (position_set_x, pos2, 750),
      (position_set_y, pos2, 750),
      (create_text_overlay, "$g_presentation_obj_custom_battle_designer_2", "@Press Esc to^^Disable a key", tf_left_align),
      (overlay_set_position, "$g_presentation_obj_custom_battle_designer_2", pos1),
      (overlay_set_size, "$g_presentation_obj_custom_battle_designer_2", pos2),
      (overlay_set_color, "$g_presentation_obj_custom_battle_designer_2", 0x600000),
      (overlay_set_alpha, "$g_presentation_obj_custom_battle_designer_2", 0x00),
      (position_set_y, pos1, 600),
      (try_begin),
        (le, 18, 20),
        (position_set_x, pos2, 1000),
        (position_set_y, pos2, 1000),
        (position_set_x, pos1, 50),
      (else_try),
        (position_set_x, pos2, 750),
        (position_set_y, pos2, 750),
        (position_set_x, pos1, 25),
      (try_end),
      (position_set_x, pos3, 120),
      (position_set_y, pos3, 30),
      (try_for_range, ":var0", 0, 18),
        (store_add, ":var1", ":var0", "str_key_no1"),
        (store_add, ":var2", ":var0", 36),
        (store_add, ":var3", ":var2", 18),
        (create_text_overlay, reg1, ":var1", tf_left_align),
        (troop_set_slot, "trp_key_config", ":var3", reg1),
        (overlay_set_position, reg1, pos1),
        (overlay_set_size, reg1, pos2),
        (try_begin),
          (le, 18, 20),
          (position_move_x, 1, 35),
        (else_try),
          (position_move_x, 1, 24),
        (try_end),
        (create_game_button_overlay, reg2, "str_no_string", 16),
        (troop_set_slot, "trp_key_config", ":var2", reg2),
        (overlay_set_position, reg2, pos1),
        (overlay_set_size, reg2, pos3),
        (try_begin),
          (le, 18, 20),
          (position_move_x, 1, -35),
        (else_try),
          (position_move_x, 1, -24),
        (try_end),
        (position_move_y, pos1, -4),
        (try_begin),
          (le, 18, 20),
          (try_begin),
            (eq, 9, ":var0"),
            (assign, ":var4", 10),
            (val_mul, ":var4", 4),
            (position_move_y, pos1, ":var4"),
            (position_move_x, 1, 50),
          (try_end),
        (else_try),
          (try_begin),
            (eq, 6, ":var0"),
            (assign, ":var4", 7),
            (val_mul, ":var4", 4),
            (position_move_y, pos1, ":var4"),
            (position_move_x, 1, 33),
          (try_end),
          (try_begin),
            (eq, 12, ":var0"),
            (assign, ":var4", 7),
            (val_mul, ":var4", 4),
            (position_move_y, pos1, ":var4"),
            (position_move_x, 1, 33),
          (try_end),
        (try_end),
      (try_end),
      (call_script, "script_set_config_slot_key_config"),
      (call_script, "script_update_key_config_buttons"),
      (create_text_overlay, reg1, "@DeathCam Mouse Sensitivity", tf_left_align),
      (try_begin),
        (le, 18, 20),
        (position_set_x, pos1, 50),
      (else_try),
        (position_set_x, pos1, 25),
      (try_end),
      (position_move_y, pos1, -8),
      (overlay_set_position, reg1, pos1),
      (overlay_set_size, reg1, pos2),
      (try_begin),
        (le, 18, 20),
        (position_move_x, 1, 38),
      (else_try),
        (position_move_x, 1, 27),
      (try_end),
      (create_slider_overlay, reg2, 1, 10),
      (overlay_set_position, reg2, pos1),
      (position_set_x, pos3, 700),
      (position_set_y, pos3, 700),
      (overlay_set_size, reg2, pos3),
      (try_begin),
        (neg|is_between, "$camera_mouse_deadzone", 1, 11),
        (assign, "$camera_mouse_deadzone", 3),
      (try_end),
      (store_sub, ":var5", 11, "$camera_mouse_deadzone"),
      (overlay_set_val, reg2, ":var5"),
      (position_set_y, pos1, 25),
      (position_set_x, pos1, 900),
      (create_game_button_overlay, "$g_presentation_obj_custom_battle_designer_3", "@OK", 16),
      (overlay_set_position, "$g_presentation_obj_custom_battle_designer_3", pos1),
      (position_move_x, 1, -16),
      (create_game_button_overlay, "$g_presentation_obj_custom_battle_designer_4", "@Reset", 16),
      (overlay_set_position, "$g_presentation_obj_custom_battle_designer_4", pos1),
      (position_move_x, 1, -16),
      (create_game_button_overlay, "$g_presentation_obj_custom_battle_designer_5", "@Default", 16),
      (overlay_set_position, "$g_presentation_obj_custom_battle_designer_5", pos1),
      (create_game_button_overlay, "$g_presentation_obj_custom_battle_designer_6", "@Mod Options"),
      (position_set_x, pos1, 900),
      (position_set_y, pos1, 75),
      (overlay_set_position, "$g_presentation_obj_custom_battle_designer_6", pos1),
    ]),
    (ti_on_presentation_event_state_change,
    [
      (store_trigger_param_1, ":var0"),
      (assign, ":var1", 0),
      (store_add, ":var2", 36, 18),
      (try_for_range, ":var3", 36, ":var2"),
        (troop_slot_eq, "trp_key_config", ":var3", ":var0"),
        (assign, "$g_presentation_obj_custom_battle_designer_1", 1),
        (assign, "$g_presentation_credits_obj_1", ":var0"),
        (overlay_set_text, "$g_presentation_credits_obj_1", "@Press a key", 16),
        (overlay_set_color, "$g_presentation_credits_obj_1", 0x0000FF),
        (overlay_set_hilight_color, "$g_presentation_credits_obj_1", 0x0000FF),
        (store_sub, "$g_presentation_credits_obj_2", ":var3", 18),
        (assign, ":var1", ":var3"),
        (assign, ":var2", ":var3"),
      (try_end),
      (try_begin),
        (gt, ":var1", 0),
      (else_try),
        (store_sub, ":var4", "$g_presentation_obj_custom_battle_designer_3", 1),
        (eq, ":var0", ":var4"),
        (store_trigger_param_2, ":var5"),
        (store_sub, "$camera_mouse_deadzone", 11, ":var5"),
        (overlay_set_val, ":var4", ":var5"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_custom_battle_designer_3"),
        (call_script, "script_set_global_var_key_config"),
        (call_script, "script_update_key_config_buttons"),
        (presentation_set_duration, 0),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_custom_battle_designer_4"),
        (call_script, "script_set_config_slot_key_config"),
        (call_script, "script_update_key_config_buttons"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_custom_battle_designer_5"),
        (call_script, "script_reset_to_default_keys"),
        (call_script, "script_update_key_config_buttons"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_custom_battle_designer_6"),
        (call_script, "script_set_global_var_key_config"),
        (start_presentation, "prsnt_pbod_preferences"),
      (try_end),
      (try_begin),
        (eq, "$g_presentation_obj_custom_battle_designer_1", 1),
        (overlay_set_alpha, "$g_presentation_obj_custom_battle_designer_2", 0xFF),
      (try_end),
    ]),
    (ti_on_presentation_run,
    [
      (eq, "$g_presentation_obj_custom_battle_designer_1", 1),
      (assign, "$g_presentation_obj_custom_battle_designer_1", 0),
      (assign, ":var0", 0),
      (store_add, ":var1", 72, 107),
      (try_for_range, ":var2", 72, ":var1"),
        (troop_get_slot, ":var3", "trp_key_config", ":var2"),
        (key_clicked, ":var3"),
        (troop_set_slot, "trp_key_config", "$g_presentation_credits_obj_2", ":var3"),
        (assign, ":var0", ":var3"),
        (assign, ":var1", ":var2"),
      (try_end),
      (try_begin),
        (gt, ":var0", 0),
      (else_try),
        (key_clicked, key_escape),
        (troop_set_slot, "trp_key_config", "$g_presentation_credits_obj_2", 255),
      (else_try),
        (assign, "$g_presentation_obj_custom_battle_designer_1", 1),
      (try_end),
      (try_begin),
        (eq, "$g_presentation_obj_custom_battle_designer_1", 0),
        (try_for_range, ":var2", 18, 36),
          (neq, ":var2", "$g_presentation_credits_obj_2"),
          (troop_slot_eq, "trp_key_config", ":var2", ":var0"),
          (troop_set_slot, "trp_key_config", ":var2", 255),
        (try_end),
        (overlay_set_hilight_color, "$g_presentation_credits_obj_1", 0x00FF00),
        (overlay_set_alpha, "$g_presentation_obj_custom_battle_designer_2", 0x00),
        (call_script, "script_update_key_config_buttons"),
      (try_end),
    ]),
  ]),

  ("caba_order_display", prsntf_read_only, mesh_pic_bandits,
  [
    (ti_on_presentation_load,
    [
      (set_fixed_point_multiplier, 1000),
      (try_for_range, ":var0", 0, 9),
        (troop_set_slot, "trp_bandit_leaders_end", ":var0", -1),
      (try_end),
      (call_script, "script_init_key_config"),
      (str_store_string, s10, "str_0x3e"),
      (str_store_string, s11, "str_0x3f"),
      (str_store_string, s12, "str_0x40"),
      (call_script, "script_str_store_key_name", 13, "$key_order_7"),
      (call_script, "script_str_store_key_name", 14, "$key_order_8"),
      (call_script, "script_str_store_key_name", 15, "$key_order_9"),
      (assign, ":var1", 560),
      (try_begin),
        (party_slot_eq, "p_main_party", 108, 0),
        (try_begin),
          (this_or_next|eq, "$g_next_menu", "mnu_simple_encounter"),
          (eq, "$g_next_menu", "mnu_join_battle"),
          (str_store_string, s1, "@{s10} - Formation type orders"),
          (str_store_string, s2, "@{s11} - Weapon orders"),
          (str_store_string, s3, "@{s12} - Shield orders"),
          (str_store_string, s4, "@{s13} - Attack orders"),
          (assign, ":var2", 4),
        (else_try),
          (str_store_string, s1, "@{s11} - Weapon orders"),
          (str_store_string, s2, "@{s12} - Shield orders"),
          (str_store_string, s3, "@{s13} - Attack orders"),
          (assign, ":var2", 3),
        (try_end),
        (assign, ":var1", 473),
      (else_try),
        (party_slot_eq, "p_main_party", 108, 26),
        (str_store_string, s1, "@{s10} - Ranks"),
        (str_store_string, s2, "@{s11} - Shieldwall"),
        (str_store_string, s3, "@{s12} - Wedge"),
        (str_store_string, s4, "@{s13} - Square"),
        (str_store_string, s5, "@{s14} - No Formation"),
        (str_store_string, s6, "@{s15} - Escape Menu"),
        (assign, ":var2", 6),
      (else_try),
        (party_slot_eq, "p_main_party", 108, 27),
        (str_store_string, s1, "@{s11} - One Handers"),
        (str_store_string, s2, "@{s12} - Two Handers"),
        (str_store_string, s3, "@{s13} - Polearms"),
        (str_store_string, s4, "@{s14} - Ranged"),
        (str_store_string, s5, "@{s15} - Escape Menu"),
        (assign, ":var2", 5),
      (else_try),
        (party_slot_eq, "p_main_party", 108, 28),
        (str_store_string, s1, "@{s11} - Use Shields"),
        (str_store_string, s2, "@{s12} - No Shields"),
        (str_store_string, s3, "@{s13} - Free"),
        (str_store_string, s4, "@{s15} - Escape Menu"),
        (assign, ":var2", 4),
      (else_try),
        (party_slot_eq, "p_main_party", 108, "$key_order_7"),
        (str_store_string, s1, "@{s10} - End Order"),
        (str_store_string, s2, "@{s11} - Skirmish"),
        (str_store_string, s3, "@{s12} - Volley Fire"),
        (str_store_string, s4, "@{s13} - Brace Polearms"),
        (str_store_string, s5, "@{s15} - Escape Menu"),
        (assign, ":var2", 5),
      (try_end),
      (party_get_slot, ":var3", "p_main_party", 108),
      (party_set_slot, "p_main_party_backup", 108, ":var3"),
      (try_for_range, ":var0", 0, ":var2"),
        (store_add, ":var4", ":var0", 1),
        (str_store_string_reg, s0, ":var4"),
        (create_text_overlay, ":var5", s0),
        (overlay_set_color, ":var5", 0xFFFFFF),
        (position_set_x, pos1, 1000),
        (position_set_y, pos1, 1000),
        (overlay_set_size, ":var5", pos1),
        (position_set_x, pos1, 0),
        (position_set_y, pos1, ":var1"),
        (overlay_set_position, ":var5", pos1),
        (troop_set_slot, "trp_bandit_leaders_end", ":var0", ":var5"),
        (val_sub, ":var1", 30),
      (try_end),
      (store_mul, ":var6", 30, ":var2"),
      (val_add, ":var1", ":var6"),
      (val_sub, ":var1", 3),
      (try_for_range, ":var0", 0, ":var2"),
        (create_mesh_overlay, ":var5", "mesh_order_frame"),
        (position_set_x, pos1, 700),
        (position_set_y, pos1, 700),
        (overlay_set_size, ":var5", pos1),
        (position_set_x, pos1, 0),
        (position_set_y, pos1, ":var1"),
        (overlay_set_position, ":var5", pos1),
        (val_sub, ":var1", 30),
      (try_end),
      (try_begin),
        (neg|party_slot_eq, "p_main_party", 108, 0),
        (create_mesh_overlay, ":var5", "mesh_white_plane"),
        (overlay_set_color, ":var5", 0x000000),
        (overlay_set_alpha, ":var5", 0x10),
        (position_set_x, pos1, 14000),
        (position_set_y, pos1, 4500),
        (overlay_set_size, ":var5", pos1),
        (position_set_x, pos1, 0),
        (position_set_y, pos1, 498),
        (overlay_set_position, ":var5", pos1),
      (try_end),
      (presentation_set_duration, 999999),
    ]),
    (ti_on_presentation_run,
    [
      (store_trigger_param_1, ":var0"),
      (gt, ":var0", 100),
      (try_begin),
        (this_or_next|key_clicked, "$key_order_9"),
        (this_or_next|game_key_clicked, gk_order_1),
        (this_or_next|game_key_clicked, gk_order_2),
        (this_or_next|game_key_clicked, gk_order_3),
        (this_or_next|game_key_clicked, gk_infantry_hear),
        (this_or_next|game_key_clicked, gk_archers_hear),
        (this_or_next|game_key_clicked, gk_cavalry_hear),
        (this_or_next|game_key_clicked, gk_group3_hear),
        (this_or_next|game_key_clicked, gk_group4_hear),
        (this_or_next|game_key_clicked, gk_group5_hear),
        (this_or_next|game_key_clicked, gk_group6_hear),
        (this_or_next|game_key_clicked, gk_group7_hear),
        (this_or_next|game_key_clicked, gk_group8_hear),
        (this_or_next|game_key_clicked, gk_everyone_hear),
        (this_or_next|game_key_clicked, gk_everyone_around_hear),
        (game_key_clicked, gk_reverse_order_group),
        (presentation_set_duration, 0),
      (else_try),
        (assign, ":var1", -1),
        (try_begin),
          (game_key_clicked, gk_order_4),
          (assign, ":var1", 4),
        (else_try),
          (game_key_clicked, gk_order_5),
          (assign, ":var1", 5),
        (else_try),
          (game_key_clicked, gk_order_6),
          (assign, ":var1", 6),
        (else_try),
          (key_clicked, "$key_order_7"),
          (assign, ":var1", 7),
        (else_try),
          (key_clicked, "$key_order_8"),
          (assign, ":var1", 8),
        (try_end),
        (neq, ":var1", -1),
        (try_begin),
          (party_slot_eq, "p_main_party_backup", 108, 0),
          (presentation_set_duration, 0),
        (else_try),
          (try_begin),
            (party_slot_eq, "p_main_party_backup", 108, 26),
            (assign, ":var2", 4),
            (assign, ":var3", 8),
          (else_try),
            (party_slot_eq, "p_main_party_backup", 108, 27),
            (assign, ":var2", 5),
            (assign, ":var3", 8),
          (else_try),
            (party_slot_eq, "p_main_party_backup", 108, 28),
            (assign, ":var2", 5),
            (assign, ":var3", 7),
          (else_try),
            (party_slot_eq, "p_main_party_backup", 108, "$key_order_7"),
            (assign, ":var2", 4),
            (assign, ":var3", 7),
          (try_end),
          (store_sub, ":var4", ":var3", ":var2"),
          (val_add, ":var4", 1),
          (store_sub, ":var5", ":var1", ":var2"),
          (is_between, ":var5", 0, ":var4"),
          (val_add, ":var4", 1),
          (try_for_range, ":var6", 0, ":var4"),
            (troop_get_slot, ":var7", "trp_bandit_leaders_end", ":var6"),
            (neq, ":var6", ":var5"),
            (overlay_animate_to_alpha, ":var7", 400, 0x000000),
            (val_add, ":var7", ":var4"),
            (overlay_animate_to_alpha, ":var7", 400, 0x000000),
          (else_try),
            (overlay_animate_to_alpha, ":var7", 1100, 0x000000),
            (val_add, ":var7", ":var4"),
            (overlay_animate_to_alpha, ":var7", 1100, 0x000000),
          (try_end),
          (presentation_set_duration, 200),
        (try_end),
      (try_end),
    ]),
  ]),

  ("caba_camera_mode_display", prsntf_read_only, mesh_pic_bandits,
  [
    (ti_on_presentation_load,
    [
      (set_fixed_point_multiplier, 1000),
      (presentation_set_duration, 200),
      (try_begin),
        (main_hero_fallen),
        (str_store_string, s0, "@DeathCam"),
      (else_try),
        (str_store_string, s0, "@Camera"),
      (try_end),
      (try_begin),
        (eq, "$cam_mode", 0),
        (str_store_string, s1, "@Default"),
      (else_try),
        (eq, "$cam_mode", 1),
        (str_store_string, s1, "@Follow"),
      (else_try),
        (eq, "$cam_mode", 2),
        (str_store_string, s1, "@Free"),
      (try_end),
      (str_store_string, s0, "@{!}{s0} Mode: {s1}"),
      (create_text_overlay, "$g_presentation_obj_name_kingdom_1", s0),
      (overlay_set_color, "$g_presentation_obj_name_kingdom_1", 0xFFFFFF),
      (position_set_x, pos1, 1000),
      (position_set_y, pos1, 1000),
      (overlay_set_size, "$g_presentation_obj_name_kingdom_1", pos1),
      (position_set_x, pos1, 750),
      (position_set_y, pos1, 625),
      (overlay_set_position, "$g_presentation_obj_name_kingdom_1", pos1),
      (create_mesh_overlay, "$g_presentation_obj_name_kingdom_2", "mesh_order_frame"),
      (position_set_x, pos1, 570),
      (position_set_y, pos1, 725),
      (overlay_set_size, "$g_presentation_obj_name_kingdom_2", pos1),
      (position_set_x, pos1, 745),
      (position_set_y, pos1, 622),
      (overlay_set_position, "$g_presentation_obj_name_kingdom_2", pos1),
    ]),
    (ti_on_presentation_run,
    [
      (store_trigger_param_1, ":var0"),
      (ge, ":var0", 1000),
      (overlay_animate_to_alpha, "$g_presentation_obj_name_kingdom_1", 400, 0x000000),
      (overlay_animate_to_alpha, "$g_presentation_obj_name_kingdom_2", 400, 0x000000),
    ]),
  ]),

  ("prebattle_custom_divisions", 0, mesh_load_window,
  [
    (ti_on_presentation_load,
    [
      (set_fixed_point_multiplier, 1000),
      (try_for_range, ":var0", "trp_farmer", "trp_town_walker_1"),
        (troop_set_slot, "trp_temp_array_a", ":var0", -1),
        (troop_set_slot, "trp_temp_array_b", ":var0", -1),
        (troop_set_slot, "trp_temp_array_c", ":var0", -1),
      (try_end),
      (create_text_overlay, reg0, "@Troop Assignments", tf_center_justify|tf_single_line|tf_with_outline),
      (overlay_set_color, reg0, 0xFFFFFFFF),
      (position_set_x, pos1, 1500),
      (position_set_y, pos1, 1500),
      (overlay_set_size, reg0, pos1),
      (position_set_x, pos1, 500),
      (position_set_y, pos1, 680),
      (overlay_set_position, reg0, pos1),
      (create_text_overlay, reg0, "@Split Troops into Secondary Divisions", tf_center_justify|tf_single_line),
      (position_set_x, pos1, 500),
      (position_set_y, pos1, 650),
      (overlay_set_position, reg0, pos1),
      (create_text_overlay, reg0, "@Troops by^ Primary Division", tf_center_justify),
      (position_set_x, pos1, 170),
      (position_set_y, pos1, 600),
      (overlay_set_position, reg0, pos1),
      (position_set_x, pos2, 800),
      (position_set_y, pos2, 800),
      (create_text_overlay, reg0, "@# in^Main Division", tf_center_justify),
      (position_set_x, pos1, 352),
      (overlay_set_position, reg0, pos1),
      (overlay_set_size, reg0, pos2),
      (create_text_overlay, reg0, "@Show/^Hide", tf_center_justify),
      (position_set_x, pos1, 425),
      (overlay_set_position, reg0, pos1),
      (overlay_set_size, reg0, pos2),
      (create_text_overlay, reg0, "@# in^Secondary Division", tf_center_justify),
      (position_set_x, pos1, 630),
      (overlay_set_position, reg0, pos1),
      (overlay_set_size, reg0, pos2),
      (create_text_overlay, reg0, "@Secondary^Division", tf_center_justify),
      (position_set_x, pos1, 755),
      (overlay_set_position, reg0, pos1),
      (overlay_set_size, reg0, pos2),
      (str_clear, s0),
      (create_text_overlay, "$g_presentation_obj_bugdet_report_container", s0, tf_scrollable_style_2),
      (position_set_x, pos1, 105),
      (position_set_y, pos1, 80),
      (overlay_set_position, "$g_presentation_obj_bugdet_report_container", pos1),
      (position_set_x, pos1, 750),
      (position_set_y, pos1, 500),
      (overlay_set_area_size, "$g_presentation_obj_bugdet_report_container", pos1),
      (set_container_overlay, "$g_presentation_obj_bugdet_report_container"),
      (party_get_num_companion_stacks, ":var1", "p_main_party"),
      (assign, ":var2", 0),
      (try_for_range, ":var3", 0, 9),
        (assign, ":var4", ":var1"),
        (try_for_range, ":var0", 0, ":var4"),
          (party_stack_get_troop_id, ":var5", "p_main_party", ":var0"),
          (neq, ":var5", "trp_player"),
          (neg|troop_is_hero, ":var5"),
          (troop_get_class, ":var6", ":var5"),
          (eq, ":var6", ":var3"),
          (val_add, ":var2", 1),
          (assign, ":var4", 0),
        (try_end),
      (try_end),
      (assign, ":var7", 20),
      (store_mul, ":var8", ":var1", ":var7"),
      (store_mul, ":var9", ":var2", 3),
      (val_mul, ":var9", ":var7"),
      (val_add, ":var8", ":var9"),
      (try_for_range, ":var3", 0, 9),
        (assign, ":var10", 0),
        (assign, ":var11", 0),
        (assign, ":var12", ":var8"),
        (try_for_range, ":var0", 0, ":var1"),
          (party_stack_get_troop_id, ":var5", "p_main_party", ":var0"),
          (neq, ":var5", "trp_player"),
          (neg|troop_is_hero, ":var5"),
          (troop_get_class, ":var6", ":var5"),
          (eq, ":var6", ":var3"),
          (party_stack_get_size, ":var13", "p_main_party", ":var0"),
          (party_stack_get_num_wounded, ":var14", "p_main_party", ":var0"),
          (val_sub, ":var13", ":var14"),
          (gt, ":var13", 0),
          (assign, ":var10", 1),
          (val_sub, ":var8", ":var7"),
          (try_begin),
            (eq, ":var11", 1),
            (create_mesh_overlay, reg0, "mesh_white_plane"),
            (position_set_x, pos1, 36200),
            (position_set_y, pos1, 1000),
            (overlay_set_size, reg0, pos1),
            (position_set_x, pos1, 15),
            (position_set_y, pos1, ":var8"),
            (overlay_set_position, reg0, pos1),
            (overlay_set_color, reg0, 0xFFFFFF),
            (overlay_set_alpha, reg0, 0x50),
            (assign, ":var11", 0),
          (else_try),
            (assign, ":var11", 1),
          (try_end),
          (str_store_troop_name, s1, ":var5"),
          (create_text_overlay, reg0, s1),
          (position_set_x, pos2, 900),
          (position_set_y, pos2, 900),
          (overlay_set_size, reg0, pos2),
          (position_set_x, pos1, 15),
          (position_set_y, pos1, ":var8"),
          (overlay_set_position, reg0, pos1),
          (assign, reg0, ":var13"),
          (str_store_string, s1, "str_reg0"),
          (create_text_overlay, reg0, s1),
          (position_set_x, pos1, 240),
          (position_set_y, pos1, ":var8"),
          (overlay_set_position, reg0, pos1),
          (overlay_set_size, reg0, pos2),
          (create_check_box_overlay, reg0, "mesh_checkbox_off", "mesh_checkbox_on"),
          (position_set_x, pos1, 315),
          (position_set_y, pos1, ":var8"),
          (overlay_set_position, reg0, pos1),
          (create_slider_overlay, reg0, 0, 51),
          (position_set_x, pos1, 465),
          (position_set_y, pos1, ":var8"),
          (overlay_set_position, reg0, pos1),
          (position_set_x, pos1, 500),
          (position_set_y, pos1, 500),
          (overlay_set_size, reg0, pos1),
          (troop_set_slot, "trp_temp_array_a", ":var5", reg0),
          (create_text_overlay, reg0, "@{!}% to split"),
          (position_set_x, pos1, 700),
          (position_set_y, pos1, 700),
          (overlay_set_size, reg0, pos1),
          (position_set_x, pos1, 465),
          (position_set_y, pos1, ":var8"),
          (overlay_set_position, reg0, pos1),
          (str_clear, s0),
          (create_text_overlay, reg0, s0),
          (overlay_set_size, reg0, pos2),
          (position_set_x, pos1, 520),
          (position_set_y, pos1, ":var8"),
          (overlay_set_position, reg0, pos1),
          (create_combo_button_overlay, reg0),
          (try_for_range, ":var15", 0, 9),
            (str_store_class_name, 0, ":var15"),
            (overlay_add_item, reg0, s0),
          (try_end),
          (overlay_add_item, reg0, "@{!}- Disabled -"),
          (position_set_x, pos1, 700),
          (position_set_y, pos1, ":var8"),
          (overlay_set_position, reg0, pos1),
          (position_set_x, pos1, 600),
          (position_set_y, pos1, 600),
          (overlay_set_size, reg0, pos1),
          (overlay_set_val, reg0, 9),
          (troop_get_slot, ":var16", ":var5", 49),
          (troop_get_slot, ":var17", ":var5", 48),
          (assign, ":var18", 0),
          (try_begin),
            (this_or_next|gt, ":var16", 0),
            (is_between, ":var17", 1, 9),
            (assign, ":var18", 1),
          (try_end),
          (troop_get_slot, ":var19", "trp_temp_array_a", ":var5"),
          (store_add, ":var4", ":var19", 4),
          (try_for_range, ":var20", ":var19", ":var4"),
            (overlay_set_display, ":var20", ":var18"),
          (try_end),
          (eq, ":var18", 1),
          (store_sub, ":var20", ":var19", 1),
          (overlay_set_val, ":var20", 1),
          (try_begin),
            (is_between, ":var17", 0, 9),
            (val_add, ":var20", 4),
            (overlay_set_val, ":var20", ":var17"),
          (try_end),
          (gt, ":var16", 0),
          (overlay_set_val, ":var19", ":var16"),
          (store_add, ":var20", ":var19", 1),
          (assign, reg0, ":var16"),
          (overlay_set_text, ":var20", "str_reg0_percent"),
          (store_mul, ":var21", ":var16", ":var13"),
          (val_div, ":var21", 100),
          (val_sub, ":var13", ":var21"),
          (val_sub, ":var20", 3),
          (assign, reg0, ":var13"),
          (overlay_set_text, ":var20", "str_reg0"),
          (val_add, ":var20", 4),
          (assign, reg0, ":var21"),
          (overlay_set_text, ":var20", "str_reg0"),
        (try_end),
        (eq, ":var10", 1),
        (str_store_class_name, 1, ":var3"),
        (create_text_overlay, reg0, s1, tf_with_outline),
        (position_set_x, pos1, 1000),
        (position_set_y, pos1, 1000),
        (overlay_set_size, reg0, pos1),
        (position_set_x, pos1, 25),
        (position_set_y, pos1, ":var12"),
        (overlay_set_position, reg0, pos1),
        (val_sub, ":var8", ":var7"),
        (create_mesh_overlay, reg0, "mesh_white_plane"),
        (position_set_x, pos1, 37000),
        (position_set_y, pos1, 150),
        (overlay_set_size, reg0, pos1),
        (position_set_x, pos1, 5),
        (position_set_y, pos1, ":var8"),
        (overlay_set_position, reg0, pos1),
        (overlay_set_color, reg0, 0x000000),
        (val_sub, ":var8", ":var7"),
        (val_sub, ":var8", ":var7"),
      (try_end),
      (set_container_overlay, -1),
      (create_check_box_overlay, "$g_presentation_obj_custom_battle_designer_20", "mesh_checkbox_off", "mesh_checkbox_on"),
      (position_set_x, pos1, 830),
      (position_set_y, pos1, 680),
      (overlay_set_position, "$g_presentation_obj_custom_battle_designer_20", pos1),
      (party_get_slot, ":var22", "p_main_party", 51),
      (overlay_set_val, "$g_presentation_obj_custom_battle_designer_20", ":var22"),
      (str_store_string, s0, "@Disabled"),
      (str_store_string, s1, "@Split Active"),
      (str_store_string_reg, s2, ":var22"),
      (create_text_overlay, reg0, s2),
      (position_set_x, pos1, 850),
      (position_set_y, pos1, 675),
      (overlay_set_position, reg0, pos1),
      (create_game_button_overlay, "$g_presentation_obj_battle_25", "@Clear All"),
      (position_set_x, pos1, 420),
      (position_set_y, pos1, 25),
      (overlay_set_position, "$g_presentation_obj_battle_25", pos1),
      (create_game_button_overlay, "$g_presentation_obj_battle_26", "@Discard Changes"),
      (position_set_x, pos1, 580),
      (position_set_y, pos1, 25),
      (overlay_set_position, "$g_presentation_obj_battle_26", pos1),
      (create_game_button_overlay, "$g_presentation_obj_battle_27", "@Save"),
      (position_set_x, pos1, 740),
      (position_set_y, pos1, 25),
      (overlay_set_position, "$g_presentation_obj_battle_27", pos1),
      (create_game_button_overlay, "$g_presentation_obj_battle_28", "@Done"),
      (position_set_x, pos1, 900),
      (position_set_y, pos1, 25),
      (overlay_set_position, "$g_presentation_obj_battle_28", pos1),
      (presentation_set_duration, 999999),
    ]),
    (ti_on_presentation_run,
    [
      (try_begin),
        (key_clicked, key_escape),
        (presentation_set_duration, 0),
        (party_set_slot, "p_main_party", 51, 0),
      (try_end),
    ]),
    (ti_on_presentation_event_state_change,
    [
      (store_trigger_param_1, ":var0"),
      (store_trigger_param_2, ":var1"),
      (try_begin),
        (eq, ":var0", "$g_presentation_obj_battle_28"),
        (presentation_set_duration, 0),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_battle_27"),
        (party_get_num_companion_stacks, ":var2", "p_main_party"),
        (try_for_range, ":var3", 0, ":var2"),
          (party_stack_get_troop_id, ":var4", "p_main_party", ":var3"),
          (troop_get_slot, ":var5", "trp_temp_array_b", ":var4"),
          (try_begin),
            (gt, ":var5", -1),
            (troop_set_slot, ":var4", 49, ":var5"),
          (try_end),
          (troop_get_slot, ":var6", "trp_temp_array_c", ":var4"),
          (try_begin),
            (gt, ":var6", -1),
            (troop_set_slot, ":var4", 48, ":var6"),
          (try_end),
        (try_end),
        (party_set_slot, "p_main_party", 51, 1),
        (overlay_set_val, "$g_presentation_obj_custom_battle_designer_20", 1),
        (store_add, ":var7", "$g_presentation_obj_custom_battle_designer_20", 1),
        (overlay_set_text, ":var7", "@Split Active"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_battle_26"),
        (start_presentation, "prsnt_prebattle_custom_divisions"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_battle_25"),
        (try_for_range, ":var4", "trp_farmer", "trp_town_walker_1"),
          (troop_set_slot, ":var4", 48, -1),
          (troop_set_slot, ":var4", 49, -1),
        (try_end),
        (party_set_slot, "p_main_party", 51, 0),
        (start_presentation, "prsnt_prebattle_custom_divisions"),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_custom_battle_designer_20"),
        (str_store_string, s1, "@Split Active"),
        (str_store_string, s0, "@Disabled"),
        (str_store_string_reg, s2, ":var1"),
        (store_add, ":var7", ":var0", 1),
        (overlay_set_text, ":var7", s2),
        (party_set_slot, "p_main_party", 51, ":var1"),
      (else_try),
        (party_get_num_companion_stacks, ":var2", "p_main_party"),
        (try_for_range, ":var3", 0, ":var2"),
          (party_stack_get_troop_id, ":var4", "p_main_party", ":var3"),
          (troop_get_slot, ":var7", "trp_temp_array_a", ":var4"),
          (eq, ":var0", ":var7"),
          (is_between, ":var1", 0, 51),
          (troop_set_slot, "trp_temp_array_b", ":var4", ":var1"),
          (overlay_set_val, ":var0", ":var1"),
          (store_add, ":var8", ":var7", 1),
          (assign, reg0, ":var1"),
          (overlay_set_text, ":var8", "str_reg0_percent"),
          (party_stack_get_size, ":var9", "p_main_party", ":var3"),
          (party_stack_get_num_wounded, ":var10", "p_main_party", ":var3"),
          (val_sub, ":var9", ":var10"),
          (store_mul, ":var11", ":var1", ":var9"),
          (val_div, ":var11", 100),
          (val_sub, ":var9", ":var11"),
          (val_sub, ":var8", 3),
          (assign, reg0, ":var9"),
          (overlay_set_text, ":var8", "str_reg0"),
          (val_add, ":var8", 4),
          (assign, reg0, ":var11"),
          (overlay_set_text, ":var8", "str_reg0"),
        (else_try),
          (val_sub, ":var7", 1),
          (eq, ":var0", ":var7"),
          (store_add, ":var12", ":var7", 1),
          (store_add, ":var13", ":var7", 5),
          (try_for_range, ":var8", ":var12", ":var13"),
            (overlay_set_display, ":var8", ":var1"),
          (try_end),
        (else_try),
          (val_add, ":var7", 4),
          (eq, ":var0", ":var7"),
          (troop_set_slot, "trp_temp_array_c", ":var4", ":var1"),
        (try_end),
      (try_end),
    ]),
  ]),

  ("troop_note", 0, mesh_load_window,
  [
    (ti_on_presentation_load,
    [
      (presentation_set_duration, 999999),
      (set_fixed_point_multiplier, 1000),
      (assign, "$gpu_storage", "trp_tpe_presobj"),
      (assign, "$gpu_data", "trp_tpe_presobj"),
      (call_script, "script_copy_inventory", "$temp", "trp_temp_array_a"),
      (try_for_range, ":var0", 0, 10),
        (troop_get_inventory_slot, ":var1", "trp_temp_array_a", ":var0"),
        (gt, ":var1", -1),
        (troop_add_item, "trp_temp_array_a", ":var1"),
        (troop_set_inventory_slot, "trp_temp_array_a", ":var0", -1),
      (try_end),
      (str_store_string, s21, "@Done"),
      (call_script, "script_gpu_create_game_button", "str_hub_s21", 500, 35, 1),
      (call_script, "script_gpu_create_troop_image", "$temp", 75, 420, 900, 3),
      (str_store_troop_name, s21, "$temp"),
      (call_script, "script_gpu_create_text_label", "str_hub_s21", 210, 410, 0, 2),
      (overlay_set_color, reg1, 0x0016FF),
      (call_script, "script_gpu_create_text_label", "str_hub_s21", 210, 410, 0, 2),
      (overlay_set_color, reg1, 0x0016FF),
      (troop_get_class, ":var2", "$temp"),
      (try_begin),
        (eq, ":var2", 0),
        (str_store_string, s21, "@Infantry Unit"),
      (else_try),
        (eq, ":var2", 1),
        (str_store_string, s21, "@Ranged Unit"),
      (else_try),
        (eq, ":var2", 2),
        (str_store_string, s21, "@Cavalry Unit"),
      (else_try),
        (assign, reg31, ":var2"),
        (str_store_string, s21, "@Undefined Class #{reg31}"),
      (try_end),
      (call_script, "script_gpu_create_text_label", "str_hub_s21", 210, 392, 0, 2),
      (call_script, "script_gpu_resize_object", 0, 75),
      (assign, ":var3", 345),
      (assign, ":var4", 50),
      (assign, ":var5", 25),
      (store_add, ":var6", ":var4", 30),
      (store_add, ":var7", ":var6", 80),
      (str_store_string, s21, "@Dodge Effects:"),
      (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var4", ":var3", 0, 4),
      (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var4", ":var3", 0, 4),
      (val_sub, ":var3", ":var5"),
      (troop_get_slot, ":var8", "$temp", 158),
      (val_clamp, ":var8", 0, 11),
      (troop_get_slot, ":var9", "$temp", 156),
      (val_clamp, ":var9", -4, 7),
      (ge, ":var9", 0),
      (val_mul, ":var8", ":var9"),
      (assign, reg21, ":var8"),
      (str_store_string, s21, "@Melee dodge percentage: {reg21}"),
      (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var4", ":var3", 0, 4),
      (call_script, "script_gpu_resize_object", 0, 75),
      (val_sub, ":var3", ":var5"),
      (call_script, "script_get_dodge_chance", "$temp", "itm_light_throwing_axes"),
      (str_store_string, s21, "@Throwing axe dodge percentage: {reg1}"),
      (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var4", ":var3", 0, 4),
      (call_script, "script_gpu_resize_object", 0, 75),
      (val_sub, ":var3", ":var5"),
      (call_script, "script_get_dodge_chance", "$temp", "itm_long_bow"),
      (str_store_string, s21, "@Long bow dodge percentage: {reg1}"),
      (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var4", ":var3", 0, 4),
      (call_script, "script_gpu_resize_object", 0, 75),
      (val_sub, ":var3", ":var5"),
      (call_script, "script_get_dodge_chance", "$temp", "itm_heavy_crossbow"),
      (str_store_string, s21, "@Heavy crossbow dodge percentage: {reg1}"),
      (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var4", ":var3", 0, 4),
      (call_script, "script_gpu_resize_object", 0, 75),
      (val_sub, ":var3", ":var5"),
      (call_script, "script_get_dodge_chance", "$temp", "itm_flintlock_pistol"),
      (str_store_string, s21, "@Flintlock pistol dodge percentage: {reg1}"),
      (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var4", ":var3", 0, 4),
      (call_script, "script_gpu_resize_object", 0, 75),
      (val_sub, ":var3", ":var5"),
      (call_script, "script_get_dodge_chance", "$temp", "itm_rifle_long_musket"),
      (str_store_string, s21, "@Long rifle dodge percentage: {reg1}"),
      (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var4", ":var3", 0, 4),
      (call_script, "script_gpu_resize_object", 0, 75),
      (val_sub, ":var3", ":var5"),
      (val_sub, ":var3", ":var5"),
      (str_store_string, s21, "@Abilities:"),
      (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var4", ":var3", 0, 4),
      (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var4", ":var3", 0, 4),
      (call_script, "script_ce_count_troop_abilities", "$temp"),
      (val_sub, ":var3", ":var5"),
      (call_script, "script_trees_stamp_ability_info", "$temp", 190, ":var4", ":var3"),
      (val_sub, ":var3", ":var5"),
      (call_script, "script_trees_stamp_ability_info", "$temp", 191, ":var4", ":var3"),
      (val_sub, ":var3", ":var5"),
      (call_script, "script_trees_stamp_ability_info", "$temp", 192, ":var4", ":var3"),
      (val_sub, ":var3", ":var5"),
      (call_script, "script_trees_stamp_ability_info", "$temp", 193, ":var4", ":var3"),
      (val_sub, ":var3", ":var5"),
      (call_script, "script_trees_stamp_ability_info", "$temp", 194, ":var4", ":var3"),
      (assign, ":var3", 625),
      (assign, ":var4", 430),
      (assign, ":var5", 25),
      (store_add, ":var6", ":var4", 140),
      (store_add, ":var7", ":var6", 50),
      (store_add, ":var10", ":var7", 140),
      (str_store_string, s21, "@General Information:"),
      (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var4", ":var3", 0, 4),
      (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var4", ":var3", 0, 4),
      (val_sub, ":var3", ":var5"),
      (str_store_string, s21, "@Weight:"),
      (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var4", ":var3", 0, 4),
      (call_script, "script_gpu_resize_object", 0, 75),
      (troop_get_slot, reg21, "$temp", 155),
      (str_store_string, s21, "@{reg21}"),
      (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var6", ":var3", 0, 6),
      (call_script, "script_gpu_resize_object", 0, 75),
      (str_store_string, s21, "@Armor Rating:"),
      (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var7", ":var3", 0, 4),
      (call_script, "script_gpu_resize_object", 0, 75),
      (call_script, "script_hub_troop_get_armor_rating", "$temp"),
      (str_store_string, s21, "@{reg1}"),
      (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var10", ":var3", 0, 6),
      (call_script, "script_gpu_resize_object", 0, 75),
      (val_sub, ":var3", ":var5"),
      (str_store_string, s21, "@Level:"),
      (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var4", ":var3", 0, 4),
      (call_script, "script_gpu_resize_object", 0, 75),
      (store_character_level, reg21, "$temp"),
      (str_store_string, s21, "@{reg21}"),
      (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var6", ":var3", 0, 6),
      (call_script, "script_gpu_resize_object", 0, 75),
      (str_store_string, s21, "@Melee Rating:"),
      (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var7", ":var3", 0, 4),
      (call_script, "script_gpu_resize_object", 0, 75),
      (call_script, "script_hub_troop_get_melee_rating", "$temp"),
      (str_store_string, s21, "@{reg1}"),
      (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var10", ":var3", 0, 6),
      (call_script, "script_gpu_resize_object", 0, 75),
      (val_sub, ":var3", ":var5"),
      (str_store_string, s21, "@Health:"),
      (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var4", ":var3", 0, 4),
      (call_script, "script_gpu_resize_object", 0, 75),
      (call_script, "script_get_troop_max_hp", "$temp"),
      (str_store_string, s21, "@{reg0}"),
      (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var6", ":var3", 0, 6),
      (call_script, "script_gpu_resize_object", 0, 75),
      (str_store_string, s21, "@Ranged Rating:"),
      (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var7", ":var3", 0, 4),
      (call_script, "script_gpu_resize_object", 0, 75),
      (call_script, "script_hub_troop_get_ranged_rating", "$temp"),
      (str_store_string, s21, "@{reg1}"),
      (try_begin),
        (eq, reg1, 0),
        (str_store_string, s21, "@None"),
      (try_end),
      (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var10", ":var3", 0, 6),
      (call_script, "script_gpu_resize_object", 0, 75),
      (val_sub, ":var3", ":var5"),
      (str_store_string, s21, "@Ranged:"),
      (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var4", ":var3", 0, 4),
      (call_script, "script_gpu_resize_object", 0, 75),
      (try_begin),
        (troop_is_guarantee_ranged, "$temp"),
        (str_store_string, s21, "@Yes"),
      (else_try),
        (str_store_string, s21, "@No"),
      (try_end),
      (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var6", ":var3", 0, 6),
      (call_script, "script_gpu_resize_object", 0, 75),
      (str_store_string, s21, "@Mounted:"),
      (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var7", ":var3", 0, 4),
      (call_script, "script_gpu_resize_object", 0, 75),
      (try_begin),
        (troop_is_guarantee_horse, "$temp"),
        (str_store_string, s21, "@Yes"),
      (else_try),
        (str_store_string, s21, "@No"),
      (try_end),
      (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var10", ":var3", 0, 6),
      (call_script, "script_gpu_resize_object", 0, 75),
      (val_sub, ":var3", ":var5"),
      (val_sub, ":var3", ":var5"),
      (str_store_string, s21, "@Attributes:"),
      (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var4", ":var3", 0, 4),
      (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var4", ":var3", 0, 4),
      (val_sub, ":var3", ":var5"),
      (str_store_string, s21, "@Strength:"),
      (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var4", ":var3", 0, 4),
      (call_script, "script_gpu_resize_object", 0, 75),
      (store_attribute_level, reg21, "$temp", ca_strength),
      (str_store_string, s21, "@{reg21}"),
      (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var6", ":var3", 0, 6),
      (call_script, "script_gpu_resize_object", 0, 75),
      (str_store_string, s21, "@Intelligence:"),
      (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var7", ":var3", 0, 4),
      (call_script, "script_gpu_resize_object", 0, 75),
      (store_attribute_level, reg21, "$temp", ca_intelligence),
      (str_store_string, s21, "@{reg21}"),
      (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var10", ":var3", 0, 6),
      (call_script, "script_gpu_resize_object", 0, 75),
      (val_sub, ":var3", ":var5"),
      (str_store_string, s21, "@Agility:"),
      (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var4", ":var3", 0, 4),
      (call_script, "script_gpu_resize_object", 0, 75),
      (store_attribute_level, reg21, "$temp", ca_agility),
      (str_store_string, s21, "@{reg21}"),
      (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var6", ":var3", 0, 6),
      (call_script, "script_gpu_resize_object", 0, 75),
      (str_store_string, s21, "@Charisma:"),
      (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var7", ":var3", 0, 4),
      (call_script, "script_gpu_resize_object", 0, 75),
      (store_attribute_level, reg21, "$temp", ca_charisma),
      (str_store_string, s21, "@{reg21}"),
      (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var10", ":var3", 0, 6),
      (call_script, "script_gpu_resize_object", 0, 75),
      (val_sub, ":var3", ":var5"),
      (val_sub, ":var3", ":var5"),
      (str_store_string, s21, "@Skills:"),
      (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var4", ":var3", 0, 4),
      (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var4", ":var3", 0, 4),
      (val_sub, ":var3", ":var5"),
      (str_store_string, s21, "@Power Strike:"),
      (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var4", ":var3", 0, 4),
      (call_script, "script_gpu_resize_object", 0, 75),
      (store_skill_level, reg21, 35, "$temp"),
      (str_store_string, s21, "@{reg21}"),
      (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var6", ":var3", 0, 6),
      (call_script, "script_gpu_resize_object", 0, 75),
      (str_store_string, s21, "@Ironflesh:"),
      (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var7", ":var3", 0, 4),
      (call_script, "script_gpu_resize_object", 0, 75),
      (store_skill_level, reg21, 36, "$temp"),
      (str_store_string, s21, "@{reg21}"),
      (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var10", ":var3", 0, 6),
      (call_script, "script_gpu_resize_object", 0, 75),
      (val_sub, ":var3", ":var5"),
      (str_store_string, s21, "@Power Draw:"),
      (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var4", ":var3", 0, 4),
      (call_script, "script_gpu_resize_object", 0, 75),
      (store_skill_level, reg21, 33, "$temp"),
      (str_store_string, s21, "@{reg21}"),
      (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var6", ":var3", 0, 6),
      (call_script, "script_gpu_resize_object", 0, 75),
      (str_store_string, s21, "@Shield:"),
      (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var7", ":var3", 0, 4),
      (call_script, "script_gpu_resize_object", 0, 75),
      (store_skill_level, reg21, 26, "$temp"),
      (str_store_string, s21, "@{reg21}"),
      (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var10", ":var3", 0, 6),
      (call_script, "script_gpu_resize_object", 0, 75),
      (val_sub, ":var3", ":var5"),
      (str_store_string, s21, "@Power Throw:"),
      (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var4", ":var3", 0, 4),
      (call_script, "script_gpu_resize_object", 0, 75),
      (store_skill_level, reg21, 34, "$temp"),
      (str_store_string, s21, "@{reg21}"),
      (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var6", ":var3", 0, 6),
      (call_script, "script_gpu_resize_object", 0, 75),
      (str_store_string, s21, "@Athletics:"),
      (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var7", ":var3", 0, 4),
      (call_script, "script_gpu_resize_object", 0, 75),
      (store_skill_level, reg21, 25, "$temp"),
      (str_store_string, s21, "@{reg21}"),
      (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var10", ":var3", 0, 6),
      (call_script, "script_gpu_resize_object", 0, 75),
      (val_sub, ":var3", ":var5"),
      (str_store_string, s21, "@Horse Archery:"),
      (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var4", ":var3", 0, 4),
      (call_script, "script_gpu_resize_object", 0, 75),
      (store_skill_level, reg21, 23, "$temp"),
      (str_store_string, s21, "@{reg21}"),
      (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var6", ":var3", 0, 6),
      (call_script, "script_gpu_resize_object", 0, 75),
      (str_store_string, s21, "@Riding:"),
      (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var7", ":var3", 0, 4),
      (call_script, "script_gpu_resize_object", 0, 75),
      (store_skill_level, reg21, 24, "$temp"),
      (str_store_string, s21, "@{reg21}"),
      (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var10", ":var3", 0, 6),
      (call_script, "script_gpu_resize_object", 0, 75),
      (val_sub, ":var3", ":var5"),
      (str_store_string, s21, "@Tactics:"),
      (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var4", ":var3", 0, 4),
      (call_script, "script_gpu_resize_object", 0, 75),
      (store_skill_level, reg21, 15, "$temp"),
      (str_store_string, s21, "@{reg21}"),
      (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var6", ":var3", 0, 6),
      (call_script, "script_gpu_resize_object", 0, 75),
      (str_store_string, s21, "@Weapon Master:"),
      (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var7", ":var3", 0, 4),
      (call_script, "script_gpu_resize_object", 0, 75),
      (store_skill_level, reg21, 27, "$temp"),
      (str_store_string, s21, "@{reg21}"),
      (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var10", ":var3", 0, 6),
      (call_script, "script_gpu_resize_object", 0, 75),
      (val_sub, ":var3", ":var5"),
      (val_sub, ":var3", ":var5"),
      (str_store_string, s21, "@Weapon Proficiencies:"),
      (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var4", ":var3", 0, 4),
      (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var4", ":var3", 0, 4),
      (val_sub, ":var3", ":var5"),
      (str_store_string, s21, "@One Handed:"),
      (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var4", ":var3", 0, 4),
      (call_script, "script_gpu_resize_object", 0, 75),
      (store_proficiency_level, reg21, "$temp", ca_strength),
      (str_store_string, s21, "@{reg21}"),
      (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var6", ":var3", 0, 6),
      (call_script, "script_gpu_resize_object", 0, 75),
      (str_store_string, s21, "@Archery:"),
      (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var7", ":var3", 0, 4),
      (call_script, "script_gpu_resize_object", 0, 75),
      (store_proficiency_level, reg21, "$temp", ca_charisma),
      (str_store_string, s21, "@{reg21}"),
      (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var10", ":var3", 0, 6),
      (call_script, "script_gpu_resize_object", 0, 75),
      (val_sub, ":var3", ":var5"),
      (str_store_string, s21, "@Two Handed:"),
      (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var4", ":var3", 0, 4),
      (call_script, "script_gpu_resize_object", 0, 75),
      (store_proficiency_level, reg21, "$temp", ca_agility),
      (str_store_string, s21, "@{reg21}"),
      (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var6", ":var3", 0, 6),
      (call_script, "script_gpu_resize_object", 0, 75),
      (str_store_string, s21, "@Crossbows:"),
      (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var7", ":var3", 0, 4),
      (call_script, "script_gpu_resize_object", 0, 75),
      (store_proficiency_level, reg21, "$temp", 4),
      (str_store_string, s21, "@{reg21}"),
      (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var10", ":var3", 0, 6),
      (call_script, "script_gpu_resize_object", 0, 75),
      (val_sub, ":var3", ":var5"),
      (str_store_string, s21, "@Polearms:"),
      (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var4", ":var3", 0, 4),
      (call_script, "script_gpu_resize_object", 0, 75),
      (store_proficiency_level, reg21, "$temp", ca_intelligence),
      (str_store_string, s21, "@{reg21}"),
      (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var6", ":var3", 0, 6),
      (call_script, "script_gpu_resize_object", 0, 75),
      (str_store_string, s21, "@Throwing:"),
      (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var7", ":var3", 0, 4),
      (call_script, "script_gpu_resize_object", 0, 75),
      (store_proficiency_level, reg21, "$temp", 5),
      (str_store_string, s21, "@{reg21}"),
      (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var10", ":var3", 0, 6),
      (call_script, "script_gpu_resize_object", 0, 75),
      (val_sub, ":var3", ":var5"),
      (str_store_string, s21, "@Firearms:"),
      (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var4", ":var3", 0, 4),
      (call_script, "script_gpu_resize_object", 0, 75),
      (store_proficiency_level, reg21, "$temp", 6),
      (str_store_string, s21, "@{reg21}"),
      (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var6", ":var3", 0, 6),
      (call_script, "script_gpu_resize_object", 0, 75),
      (str_store_string, s21, "@Equipment:"),
      (call_script, "script_gpu_create_text_label", "str_hub_s21", 790, 625, 0, 4),
      (call_script, "script_gpu_create_text_label", "str_hub_s21", 790, 625, 0, 4),
      (call_script, "script_gpu_container_heading", 790, 50, 160, 560, 2),
      (assign, ":var4", 0),
      (assign, ":var3", 1840),
      (assign, ":var11", 10),
      (try_for_range, ":var12", 0, 48),
        (try_for_range, ":var13", 0, 2),
          (create_mesh_overlay, reg1, "mesh_inv_slot"),
          (position_set_x, pos1, 800),
          (position_set_y, pos1, 800),
          (overlay_set_size, reg1, pos1),
          (position_set_x, pos1, ":var4"),
          (position_set_y, pos1, ":var3"),
          (overlay_set_position, reg1, pos1),
          (troop_set_slot, "trp_temp_array_a", ":var11", reg1),
          (troop_get_inventory_slot, ":var14", "trp_temp_array_a", ":var11"),
          (try_begin),
            (gt, ":var14", -1),
            (create_mesh_overlay_with_item_id, reg1, ":var14"),
            (position_set_x, pos1, 800),
            (position_set_y, pos1, 800),
            (overlay_set_size, reg1, pos1),
            (store_add, ":var15", ":var4", 40),
            (store_add, ":var16", ":var3", 40),
            (position_set_x, pos1, ":var15"),
            (position_set_y, pos1, ":var16"),
            (overlay_set_position, reg1, pos1),
            (troop_set_slot, "trp_temp_array_b", ":var11", reg1),
          (try_end),
          (val_add, ":var4", 80),
          (val_add, ":var11", 1),
        (try_end),
        (assign, ":var4", 0),
        (val_sub, ":var3", 80),
      (try_end),
      (set_container_overlay, -1),
    ]),
    (ti_on_presentation_mouse_enter_leave,
    [
      (store_trigger_param_1, ":var0"),
      (store_trigger_param_2, ":var1"),
      (try_begin),
        (eq, ":var1", 0),
        (try_for_range, ":var2", 10, 106),
          (troop_slot_eq, "trp_temp_array_a", ":var2", ":var0"),
          (troop_get_inventory_slot, ":var3", "trp_temp_array_a", ":var2"),
          (try_begin),
            (gt, ":var3", -1),
            (troop_get_slot, ":var4", "trp_temp_array_b", ":var2"),
            (overlay_get_position, 0, ":var4"),
            (show_item_details, ":var3", pos0, 100),
            (assign, "$g_current_opened_item_details", ":var2"),
          (try_end),
        (try_end),
      (else_try),
        (try_for_range, ":var2", 10, 106),
          (troop_slot_eq, "trp_temp_array_a", ":var2", ":var0"),
          (try_begin),
            (eq, "$g_current_opened_item_details", ":var2"),
            (close_item_details),
          (try_end),
        (try_end),
      (try_end),
    ]),
    (ti_on_presentation_event_state_change,
    [
      (store_trigger_param_1, ":var0"),
      (try_begin),
        (troop_slot_eq, "trp_tpe_presobj", 1, ":var0"),
        (try_begin),
          (eq, "$g_presentation_next_presentation", "prsnt_all_troops"),
          (assign, "$g_presentation_next_presentation", -1),
          (assign, "$hub_mode", 0),
          (presentation_set_duration, 0),
          (jump_to_menu, "mnu_troop_tree_switch_modes"),
        (else_try),
          (eq, "$g_presentation_next_presentation", "prsnt_all_troops2"),
          (assign, "$g_presentation_next_presentation", -1),
          (assign, "$hub_mode", 2),
          (presentation_set_duration, 0),
          (jump_to_menu, "mnu_troop_tree_switch_modes"),
        (else_try),
          (eq, "$g_presentation_next_presentation", "prsnt_all_troops3"),
          (assign, "$g_presentation_next_presentation", -1),
          (assign, "$hub_mode", 4),
          (presentation_set_duration, 0),
          (jump_to_menu, "mnu_troop_tree_switch_modes"),
        (else_try),
          (eq, "$g_presentation_next_presentation", "prsnt_all_troops4"),
          (assign, "$g_presentation_next_presentation", -1),
          (assign, "$hub_mode", 6),
          (presentation_set_duration, 0),
          (jump_to_menu, "mnu_troop_tree_switch_modes"),
        (else_try),
          (presentation_set_duration, 0),
        (try_end),
      (try_end),
    ]),
  ]),

  ("all_troops", 0, mesh_load_window,
  [
    (ti_on_presentation_load,
    [
      (presentation_set_duration, 999999),
      (set_fixed_point_multiplier, 1000),
      (assign, "$gpu_storage", "trp_tpe_presobj"),
      (assign, "$gpu_data", "trp_tpe_presobj"),
      (create_combo_label_overlay, "$vai_region_selector"),
      (position_set_x, pos1, 500),
      (position_set_y, pos1, 675),
      (overlay_set_position, "$vai_region_selector", pos1),
      (try_for_range, ":var0", "fac_player_supporters_faction", "fac_kingdoms_end"),
        (str_store_faction_name, s21, ":var0"),
        (overlay_add_item, "$vai_region_selector", "@{s21}"),
      (try_end),
      (overlay_add_item, "$vai_region_selector", "@Bandits"),
      (overlay_set_val, "$vai_region_selector", "$vai_region_value"),
      (assign, ":var1", 950),
      (assign, ":var2", 690),
      (try_begin),
        (eq, "$vai_region_value", 16),
        (str_store_string, s21, "@Faction models^by Gekokujo"),
        (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var1", ":var2", 0, 6),
        (call_script, "script_gpu_resize_object", 0, 75),
      (else_try),
        (eq, "$vai_region_value", 5),
        (str_store_string, s21, "@Faction models^by Furok"),
        (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var1", ":var2", 0, 6),
        (call_script, "script_gpu_resize_object", 0, 75),
      (else_try),
        (str_store_string, s21, "@Faction Design^by various artists"),
        (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var1", ":var2", 0, 6),
        (call_script, "script_gpu_resize_object", 0, 75),
      (try_end),
      (assign, ":var3", "trp_player"),
      (assign, ":var4", "trp_kingdom_1_pretender"),
      (try_begin),
        (assign, ":var5", 0),
        (eq, "$vai_region_value", ":var5"),
        (assign, ":var3", "trp_halfling_militia"),
        (assign, ":var4", "trp_looter"),
      (else_try),
        (assign, ":var5", 1),
        (eq, "$vai_region_value", ":var5"),
        (assign, ":var3", "trp_swadian_recruit"),
        (assign, ":var4", "trp_vaegir_recruit"),
      (else_try),
        (assign, ":var5", 2),
        (eq, "$vai_region_value", ":var5"),
        (assign, ":var3", "trp_vaegir_recruit"),
        (assign, ":var4", "trp_highelf_recruit"),
      (else_try),
        (assign, ":var5", 3),
        (eq, "$vai_region_value", ":var5"),
        (assign, ":var3", "trp_highelf_recruit"),
        (assign, ":var4", "trp_chaos_recruit"),
      (else_try),
        (assign, ":var5", 4),
        (eq, "$vai_region_value", ":var5"),
        (assign, ":var3", "trp_chaos_dwarf_slaver"),
        (assign, ":var4", "trp_chaos_dwarf_deserter"),
      (else_try),
        (assign, ":var5", 5),
        (eq, "$vai_region_value", ":var5"),
        (assign, ":var3", "trp_chaos_recruit"),
        (assign, ":var4", "trp_nord_recruit"),
      (else_try),
        (assign, ":var5", 6),
        (eq, "$vai_region_value", ":var5"),
        (assign, ":var3", "trp_rhodok_tribesman"),
        (assign, ":var4", "trp_saurus_youngblood"),
      (else_try),
        (assign, ":var5", 7),
        (eq, "$vai_region_value", ":var5"),
        (assign, ":var3", "trp_saurus_youngblood"),
        (assign, ":var4", "trp_goblin_recruit"),
      (else_try),
        (assign, ":var5", 8),
        (eq, "$vai_region_value", ":var5"),
        (assign, ":var3", "trp_goblin_recruit"),
        (assign, ":var4", "trp_sarranid_recruit"),
      (else_try),
        (assign, ":var5", 9),
        (eq, "$vai_region_value", ":var5"),
        (assign, ":var3", "trp_sarranid_recruit"),
        (assign, ":var4", "trp_orc"),
      (else_try),
        (assign, ":var5", 10),
        (eq, "$vai_region_value", ":var5"),
        (assign, ":var3", "trp_orc"),
        (assign, ":var4", "trp_bretonnian_peasant"),
      (else_try),
        (assign, ":var5", 11),
        (eq, "$vai_region_value", ":var5"),
        (assign, ":var3", "trp_bretonnian_peasant"),
        (assign, ":var4", "trp_darkelf_recruit"),
      (else_try),
        (assign, ":var5", 12),
        (eq, "$vai_region_value", ":var5"),
        (assign, ":var3", "trp_darkelf_recruit"),
        (assign, ":var4", "trp_skaven_slave"),
      (else_try),
        (assign, ":var5", 13),
        (eq, "$vai_region_value", ":var5"),
        (assign, ":var3", "trp_skaven_slave"),
        (assign, ":var4", "trp_khergit_tribesman"),
      (else_try),
        (assign, ":var5", 14),
        (eq, "$vai_region_value", ":var5"),
        (assign, ":var3", "trp_khergit_tribesman"),
        (assign, ":var4", "trp_ungor"),
      (else_try),
        (assign, ":var5", 15),
        (eq, "$vai_region_value", ":var5"),
        (assign, ":var3", "trp_ungor"),
        (assign, ":var4", "trp_doshin"),
      (else_try),
        (assign, ":var5", 16),
        (eq, "$vai_region_value", ":var5"),
        (assign, ":var3", "trp_doshin"),
        (assign, ":var4", "trp_zombie"),
      (else_try),
        (assign, ":var5", 17),
        (eq, "$vai_region_value", ":var5"),
        (assign, ":var3", "trp_zombie"),
        (assign, ":var4", "trp_woodelf_recruit"),
      (else_try),
        (assign, ":var5", 18),
        (eq, "$vai_region_value", ":var5"),
        (assign, ":var3", "trp_woodelf_recruit"),
        (assign, ":var4", "trp_halfling_militia"),
      (else_try),
        (assign, ":var5", 19),
        (eq, "$vai_region_value", ":var5"),
        (assign, ":var3", "trp_farmer"),
        (assign, ":var4", "trp_mercenary_chaos_ogre"),
      (try_end),
      (str_store_string, s21, "@Done"),
      (call_script, "script_gpu_create_game_button", "str_hub_s21", 500, 40, 1),
      (assign, ":var6", 105),
      (assign, ":var7", 70),
      (assign, ":var8", 860),
      (assign, ":var9", 500),
      (assign, ":var10", 85),
      (assign, ":var11", 65),
      (assign, ":var12", 250),
      (try_for_range, ":var13", 1, 11),
        (store_mul, ":var14", ":var13", ":var11"),
        (val_add, ":var14", 230),
        (assign, reg21, ":var13"),
        (str_store_string, s21, "@TIER {reg21}"),
        (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var14", 640, 0, 2),
        (call_script, "script_gpu_resize_object", 0, 75),
      (try_end),
      (call_script, "script_gpu_draw_line", 850, 2, 73, 620, 3289650),
      (call_script, "script_gpu_container_heading", ":var7", ":var6", ":var8", ":var9", 2),
      (assign, ":var15", 0),
      (try_for_range, ":var16", ":var3", ":var4"),
        (val_add, ":var15", 1),
      (try_end),
      (store_mul, ":var17", ":var15", ":var10"),
      (val_add, ":var17", 40),
      (assign, ":var18", 0),
      (assign, ":var19", 0),
      (store_sub, ":var20", 200, 100),
      (try_for_range, ":var16", ":var3", ":var4"),
        (lt, ":var19", ":var20"),
        (ge, ":var16", 1),
        (store_add, ":var21", ":var17", -65),
        (store_add, ":var22", ":var18", 10),
        (str_store_troop_name, s21, ":var16"),
        (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var22", ":var21", 0, 4),
        (call_script, "script_gpu_resize_object", 0, 75),
        (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var22", ":var21", 0, 4),
        (call_script, "script_gpu_resize_object", 0, 75),
        (store_add, ":var23", ":var17", -100),
        (troop_get_slot, ":var24", ":var16", 188),
        (store_mul, ":var25", ":var24", ":var11"),
        (val_add, ":var25", 125),
        (try_begin),
          (eq, "$show_autoloot_data", 1),
          (store_add, ":var26", ":var25", 18),
          (store_add, ":var23", ":var17", -100),
          (try_begin),
            (store_character_level, ":var27", ":var16"),
            (troop_get_slot, ":var28", ":var16", 188),
            (val_mul, ":var28", 4),
            (neq, ":var27", ":var28"),
            (call_script, "script_gpu_draw_line", 40, 65, ":var26", ":var23", 4294945450),
          (try_end),
        (try_end),
        (store_add, ":var29", 100, ":var19"),
        (call_script, "script_gpu_create_troop_image", ":var16", ":var25", ":var23", ":var12", ":var29"),
        (store_add, ":var30", 200, ":var19"),
        (troop_set_slot, "trp_tpe_presobj", ":var30", ":var16"),
        (assign, ":var31", 50),
        (assign, ":var32", 5),
        (try_begin),
          (eq, "$show_autoloot_data", 1),
          (store_add, ":var33", ":var25", ":var31"),
          (store_add, ":var34", ":var23", ":var32"),
          (call_script, "script_ce_count_troop_abilities", ":var16"),
          (str_store_string, s21, "@{reg1}"),
          (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var33", ":var34", 0, 2),
          (call_script, "script_gpu_resize_object", 0, 75),
          (overlay_set_color, reg1, 0x0016FF),
          (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var33", ":var34", 0, 2),
          (call_script, "script_gpu_resize_object", 0, 75),
          (overlay_set_color, reg1, 0x0016FF),
        (try_end),
        (val_add, ":var19", 1),
        (assign, ":var35", ":var16"),
        (store_add, ":var36", ":var25", ":var11"),
        (store_add, ":var37", ":var25", 51),
        (try_for_range, ":var38", 0, 6),
          (troop_get_upgrade_troop, ":var39", ":var35", 0),
          (ge, ":var39", 1),
          (store_sub, ":var40", ":var11", 32),
          (store_add, ":var41", ":var17", -65),
          (call_script, "script_gpu_draw_line", ":var40", 1, ":var37", ":var41", 3289650),
          (try_begin),
            (eq, "$show_autoloot_data", 1),
            (store_add, ":var26", ":var36", 18),
            (store_add, ":var23", ":var17", -100),
            (try_begin),
              (store_add, ":var42", ":var24", ":var38"),
              (val_add, ":var42", 1),
              (troop_get_slot, ":var43", ":var39", 188),
              (neq, ":var43", ":var42"),
              (call_script, "script_gpu_draw_line", 40, 65, ":var26", ":var23", 4294945450),
            (try_end),
          (try_end),
          (store_add, ":var26", ":var36", 0),
          (store_add, ":var29", 100, ":var19"),
          (call_script, "script_gpu_create_troop_image", ":var39", ":var26", ":var23", ":var12", ":var29"),
          (store_add, ":var30", 200, ":var19"),
          (troop_set_slot, "trp_tpe_presobj", ":var30", ":var39"),
          (try_begin),
            (eq, "$show_autoloot_data", 1),
            (store_add, ":var33", ":var26", ":var31"),
            (store_add, ":var34", ":var23", ":var32"),
            (call_script, "script_ce_count_troop_abilities", ":var39"),
            (str_store_string, s21, "@{reg1}"),
            (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var33", ":var34", 0, 2),
            (call_script, "script_gpu_resize_object", 0, 75),
            (overlay_set_color, reg1, 0x0016FF),
            (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var33", ":var34", 0, 2),
            (call_script, "script_gpu_resize_object", 0, 75),
            (overlay_set_color, reg1, 0x0016FF),
          (try_end),
          (val_add, ":var19", 1),
          (val_add, ":var36", ":var11"),
          (val_add, ":var37", ":var11"),
          (assign, ":var35", ":var39"),
        (try_end),
        (val_sub, ":var17", ":var10"),
      (try_end),
      (set_container_overlay, -1),
    ]),
    (ti_on_presentation_event_state_change,
    [
      (store_trigger_param_1, ":var0"),
      (store_trigger_param_2, ":var1"),
      (try_begin),
        (eq, ":var0", "$vai_region_selector"),
        (assign, "$vai_region_value", ":var1"),
        (store_add, "$vai_region_kingdom", "$vai_region_value", "fac_player_supporters_faction"),
        (start_presentation, "prsnt_all_troops"),
      (else_try),
        (troop_slot_eq, "trp_tpe_presobj", 1, ":var0"),
        (presentation_set_duration, 0),
        (jump_to_menu, "mnu_reference_reports"),
      (else_try),
        (try_for_range, ":var2", 100, 200),
          (troop_slot_eq, "trp_tpe_presobj", ":var2", ":var0"),
          (store_add, ":var3", 100, ":var2"),
          (troop_get_slot, "$temp", "trp_tpe_presobj", ":var3"),
          (assign, "$hub_mode", 1),
          (assign, "$g_presentation_next_presentation", "prsnt_all_troops"),
          (presentation_set_duration, 0),
          (jump_to_menu, "mnu_troop_tree_switch_modes"),
        (try_end),
      (try_end),
    ]),
  ]),

  ("all_troops2", 0, mesh_load_window,
  [
    (ti_on_presentation_load,
    [
      (presentation_set_duration, 999999),
      (set_fixed_point_multiplier, 1000),
      (assign, "$gpu_storage", "trp_tpe_presobj"),
      (assign, "$gpu_data", "trp_tpe_presobj"),
      (create_combo_label_overlay, "$vai_region_selector"),
      (position_set_x, pos1, 500),
      (position_set_y, pos1, 675),
      (overlay_set_position, "$vai_region_selector", pos1),
      (try_for_range, ":var0", "fac_player_supporters_faction", "fac_kingdoms_end"),
        (str_store_faction_name, s21, ":var0"),
        (overlay_add_item, "$vai_region_selector", "@{s21}"),
      (try_end),
      (overlay_add_item, "$vai_region_selector", "@Bandits"),
      (overlay_set_val, "$vai_region_selector", "$vai_region_value"),
      (assign, ":var1", 950),
      (assign, ":var2", 690),
      (try_begin),
        (eq, "$vai_region_value", 16),
        (str_store_string, s21, "@Faction Models^by Gekokujo"),
        (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var1", ":var2", 0, 6),
        (call_script, "script_gpu_resize_object", 0, 75),
      (else_try),
        (eq, "$vai_region_value", 5),
        (str_store_string, s21, "@Faction Models^by Furok"),
        (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var1", ":var2", 0, 6),
        (call_script, "script_gpu_resize_object", 0, 75),
      (else_try),
        (str_store_string, s21, "@Faction Models^by various artists"),
        (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var1", ":var2", 0, 6),
        (call_script, "script_gpu_resize_object", 0, 75),
      (try_end),
      (assign, ":var3", "trp_player"),
      (assign, ":var4", "trp_kingdom_1_pretender"),
      (try_begin),
        (assign, ":var5", 0),
        (eq, "$vai_region_value", ":var5"),
        (assign, ":var3", "trp_kingdom_1_lord"),
        (assign, ":var4", "trp_knight_1_1"),
      (else_try),
        (assign, ":var5", 1),
        (eq, "$vai_region_value", ":var5"),
        (assign, ":var3", "trp_knight_1_1"),
        (assign, ":var4", "trp_knight_2_1"),
      (else_try),
        (assign, ":var5", 2),
        (eq, "$vai_region_value", ":var5"),
        (assign, ":var3", "trp_knight_2_1"),
        (assign, ":var4", "trp_knight_3_1"),
      (else_try),
        (assign, ":var5", 3),
        (eq, "$vai_region_value", ":var5"),
        (assign, ":var3", "trp_knight_3_1"),
        (assign, ":var4", "trp_knight_4_1"),
      (else_try),
        (assign, ":var5", 4),
        (eq, "$vai_region_value", ":var5"),
        (assign, ":var3", "trp_knight_4_1"),
        (assign, ":var4", "trp_knight_5_1"),
      (else_try),
        (assign, ":var5", 5),
        (eq, "$vai_region_value", ":var5"),
        (assign, ":var3", "trp_knight_5_1"),
        (assign, ":var4", "trp_knight_6_1"),
      (else_try),
        (assign, ":var5", 6),
        (eq, "$vai_region_value", ":var5"),
        (assign, ":var3", "trp_knight_6_1"),
        (assign, ":var4", "trp_knight_7_1"),
      (else_try),
        (assign, ":var5", 7),
        (eq, "$vai_region_value", ":var5"),
        (assign, ":var3", "trp_knight_7_1"),
        (assign, ":var4", "trp_knight_8_1"),
      (else_try),
        (assign, ":var5", 8),
        (eq, "$vai_region_value", ":var5"),
        (assign, ":var3", "trp_knight_8_1"),
        (assign, ":var4", "trp_knight_9_1"),
      (else_try),
        (assign, ":var5", 9),
        (eq, "$vai_region_value", ":var5"),
        (assign, ":var3", "trp_knight_9_1"),
        (assign, ":var4", "trp_knight_10_1"),
      (else_try),
        (assign, ":var5", 10),
        (eq, "$vai_region_value", ":var5"),
        (assign, ":var3", "trp_knight_10_1"),
        (assign, ":var4", "trp_knight_11_1"),
      (else_try),
        (assign, ":var5", 11),
        (eq, "$vai_region_value", ":var5"),
        (assign, ":var3", "trp_knight_11_1"),
        (assign, ":var4", "trp_knight_12_1"),
      (else_try),
        (assign, ":var5", 12),
        (eq, "$vai_region_value", ":var5"),
        (assign, ":var3", "trp_knight_12_1"),
        (assign, ":var4", "trp_knight_13_1"),
      (else_try),
        (assign, ":var5", 13),
        (eq, "$vai_region_value", ":var5"),
        (assign, ":var3", "trp_knight_13_1"),
        (assign, ":var4", "trp_knight_14_1"),
      (else_try),
        (assign, ":var5", 14),
        (eq, "$vai_region_value", ":var5"),
        (assign, ":var3", "trp_knight_14_1"),
        (assign, ":var4", "trp_knight_15_1"),
      (else_try),
        (assign, ":var5", 15),
        (eq, "$vai_region_value", ":var5"),
        (assign, ":var3", "trp_knight_15_1"),
        (assign, ":var4", "trp_knight_16_1"),
      (else_try),
        (assign, ":var5", 16),
        (eq, "$vai_region_value", ":var5"),
        (assign, ":var3", "trp_knight_16_1"),
        (assign, ":var4", "trp_knight_17_1"),
      (else_try),
        (assign, ":var5", 17),
        (eq, "$vai_region_value", ":var5"),
        (assign, ":var3", "trp_knight_17_1"),
        (assign, ":var4", "trp_knight_18_1"),
      (else_try),
        (assign, ":var5", 18),
        (eq, "$vai_region_value", ":var5"),
        (assign, ":var3", "trp_knight_18_1"),
        (assign, ":var4", "trp_kingdom_1_pretender"),
      (else_try),
        (assign, ":var5", 19),
        (eq, "$vai_region_value", ":var5"),
        (assign, ":var3", "trp_farmer"),
        (assign, ":var4", "trp_mercenary_chaos_ogre"),
      (try_end),
      (str_store_string, s21, "@Done"),
      (call_script, "script_gpu_create_game_button", "str_hub_s21", 500, 40, 1),
      (assign, ":var6", 105),
      (assign, ":var7", 70),
      (assign, ":var8", 860),
      (assign, ":var9", 500),
      (assign, ":var10", 85),
      (assign, ":var11", 65),
      (assign, ":var12", 250),
      (try_for_range, ":var13", 1, 11),
        (store_mul, ":var14", ":var13", ":var11"),
        (val_add, ":var14", 230),
        (assign, reg21, ":var13"),
        (str_store_string, s21, "@TIER {reg21}"),
        (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var14", 640, 0, 2),
        (call_script, "script_gpu_resize_object", 0, 75),
      (try_end),
      (call_script, "script_gpu_draw_line", 850, 2, 73, 620, 3289650),
      (call_script, "script_gpu_container_heading", ":var7", ":var6", ":var8", ":var9", 2),
      (assign, ":var15", 0),
      (try_for_range, ":var16", ":var3", ":var4"),
        (val_add, ":var15", 1),
      (try_end),
      (store_mul, ":var17", ":var15", ":var10"),
      (val_add, ":var17", 40),
      (assign, ":var18", 0),
      (assign, ":var19", 0),
      (store_sub, ":var20", 200, 100),
      (try_for_range, ":var16", ":var3", ":var4"),
        (lt, ":var19", ":var20"),
        (ge, ":var16", 1),
        (store_add, ":var21", ":var17", -65),
        (store_add, ":var22", ":var18", 10),
        (str_store_troop_name, s21, ":var16"),
        (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var22", ":var21", 0, 4),
        (call_script, "script_gpu_resize_object", 0, 75),
        (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var22", ":var21", 0, 4),
        (call_script, "script_gpu_resize_object", 0, 75),
        (store_add, ":var23", ":var17", -100),
        (troop_get_slot, ":var24", ":var16", 188),
        (store_mul, ":var25", ":var24", ":var11"),
        (val_add, ":var25", 125),
        (try_begin),
          (eq, "$show_autoloot_data", 1),
          (store_add, ":var26", ":var25", 18),
          (store_add, ":var23", ":var17", -100),
          (try_begin),
            (store_character_level, ":var27", ":var16"),
            (troop_get_slot, ":var28", ":var16", 188),
            (val_mul, ":var28", 4),
            (neq, ":var27", ":var28"),
            (call_script, "script_gpu_draw_line", 40, 65, ":var26", ":var23", 4294945450),
          (try_end),
        (try_end),
        (store_add, ":var29", 100, ":var19"),
        (call_script, "script_gpu_create_troop_image", ":var16", ":var25", ":var23", ":var12", ":var29"),
        (store_add, ":var30", 200, ":var19"),
        (troop_set_slot, "trp_tpe_presobj", ":var30", ":var16"),
        (assign, ":var31", 50),
        (assign, ":var32", 5),
        (try_begin),
          (eq, "$show_autoloot_data", 1),
          (store_add, ":var33", ":var25", ":var31"),
          (store_add, ":var34", ":var23", ":var32"),
          (call_script, "script_ce_count_troop_abilities", ":var16"),
          (str_store_string, s21, "@{reg1}"),
          (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var33", ":var34", 0, 2),
          (call_script, "script_gpu_resize_object", 0, 75),
          (overlay_set_color, reg1, 0x0016FF),
          (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var33", ":var34", 0, 2),
          (call_script, "script_gpu_resize_object", 0, 75),
          (overlay_set_color, reg1, 0x0016FF),
        (try_end),
        (val_add, ":var19", 1),
        (assign, ":var35", ":var16"),
        (store_add, ":var36", ":var25", ":var11"),
        (store_add, ":var37", ":var25", 51),
        (try_for_range, ":var38", 0, 6),
          (troop_get_upgrade_troop, ":var39", ":var35", 0),
          (ge, ":var39", 1),
          (store_sub, ":var40", ":var11", 32),
          (store_add, ":var41", ":var17", -65),
          (call_script, "script_gpu_draw_line", ":var40", 1, ":var37", ":var41", 3289650),
          (try_begin),
            (eq, "$show_autoloot_data", 1),
            (store_add, ":var26", ":var36", 18),
            (store_add, ":var23", ":var17", -100),
            (try_begin),
              (store_add, ":var42", ":var24", ":var38"),
              (val_add, ":var42", 1),
              (troop_get_slot, ":var43", ":var39", 188),
              (neq, ":var43", ":var42"),
              (call_script, "script_gpu_draw_line", 40, 65, ":var26", ":var23", 4294945450),
            (try_end),
          (try_end),
          (store_add, ":var26", ":var36", 0),
          (store_add, ":var29", 100, ":var19"),
          (call_script, "script_gpu_create_troop_image", ":var39", ":var26", ":var23", ":var12", ":var29"),
          (store_add, ":var30", 200, ":var19"),
          (troop_set_slot, "trp_tpe_presobj", ":var30", ":var39"),
          (try_begin),
            (eq, "$show_autoloot_data", 1),
            (store_add, ":var33", ":var26", ":var31"),
            (store_add, ":var34", ":var23", ":var32"),
            (call_script, "script_ce_count_troop_abilities", ":var39"),
            (str_store_string, s21, "@{reg1}"),
            (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var33", ":var34", 0, 2),
            (call_script, "script_gpu_resize_object", 0, 75),
            (overlay_set_color, reg1, 0x0016FF),
            (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var33", ":var34", 0, 2),
            (call_script, "script_gpu_resize_object", 0, 75),
            (overlay_set_color, reg1, 0x0016FF),
          (try_end),
          (val_add, ":var19", 1),
          (val_add, ":var36", ":var11"),
          (val_add, ":var37", ":var11"),
          (assign, ":var35", ":var39"),
        (try_end),
        (val_sub, ":var17", ":var10"),
      (try_end),
      (set_container_overlay, -1),
    ]),
    (ti_on_presentation_event_state_change,
    [
      (store_trigger_param_1, ":var0"),
      (store_trigger_param_2, ":var1"),
      (try_begin),
        (eq, ":var0", "$vai_region_selector"),
        (assign, "$vai_region_value", ":var1"),
        (store_add, "$vai_region_kingdom", "$vai_region_value", "fac_player_supporters_faction"),
        (start_presentation, "prsnt_all_troops2"),
      (else_try),
        (troop_slot_eq, "trp_tpe_presobj", 1, ":var0"),
        (presentation_set_duration, 0),
        (jump_to_menu, "mnu_reference_reports"),
      (else_try),
        (try_for_range, ":var2", 100, 200),
          (troop_slot_eq, "trp_tpe_presobj", ":var2", ":var0"),
          (store_add, ":var3", 100, ":var2"),
          (troop_get_slot, "$temp", "trp_tpe_presobj", ":var3"),
          (assign, "$hub_mode", 3),
          (assign, "$g_presentation_next_presentation", "prsnt_all_troops2"),
          (presentation_set_duration, 0),
          (jump_to_menu, "mnu_troop_tree_switch_modes"),
        (try_end),
      (try_end),
    ]),
  ]),

  ("all_troops3", 0, mesh_load_window,
  [
    (ti_on_presentation_load,
    [
      (presentation_set_duration, 999999),
      (set_fixed_point_multiplier, 1000),
      (assign, "$gpu_storage", "trp_tpe_presobj"),
      (assign, "$gpu_data", "trp_tpe_presobj"),
      (create_combo_label_overlay, "$vai_region_selector"),
      (position_set_x, pos1, 500),
      (position_set_y, pos1, 675),
      (overlay_set_position, "$vai_region_selector", pos1),
      (try_for_range, ":var0", "fac_player_supporters_faction", "fac_kingdoms_end"),
        (str_store_faction_name, s21, ":var0"),
        (try_begin),
          (eq, ":var0", "fac_player_supporters_faction"),
          (str_store_string, s21, "@Player Faction"),
        (try_end),
        (overlay_add_item, "$vai_region_selector", "@{s21}"),
      (try_end),
      (overlay_add_item, "$vai_region_selector", "@Bandits"),
      (overlay_set_val, "$vai_region_selector", "$vai_region_value"),
      (assign, ":var1", 950),
      (assign, ":var2", 690),
      (try_begin),
        (eq, "$vai_region_value", 16),
        (str_store_string, s21, "@Faction Models^by Gekokujo"),
        (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var1", ":var2", 0, 6),
        (call_script, "script_gpu_resize_object", 0, 75),
      (else_try),
        (eq, "$vai_region_value", 5),
        (str_store_string, s21, "@Faction Models^by Furok"),
        (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var1", ":var2", 0, 6),
        (call_script, "script_gpu_resize_object", 0, 75),
      (else_try),
        (str_store_string, s21, "@Faction Models^by various artists"),
        (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var1", ":var2", 0, 6),
        (call_script, "script_gpu_resize_object", 0, 75),
      (try_end),
      (assign, ":var3", "trp_player"),
      (assign, ":var4", "trp_kingdom_1_pretender"),
      (try_begin),
        (assign, ":var5", 0),
        (eq, "$vai_region_value", ":var5"),
        (assign, ":var3", "trp_halfling_militia"),
        (assign, ":var4", "trp_looter"),
      (else_try),
        (assign, ":var5", 1),
        (eq, "$vai_region_value", ":var5"),
        (assign, ":var3", "trp_swadian_recruit"),
        (assign, ":var4", "trp_vaegir_recruit"),
      (else_try),
        (assign, ":var5", 2),
        (eq, "$vai_region_value", ":var5"),
        (assign, ":var3", "trp_vaegir_recruit"),
        (assign, ":var4", "trp_highelf_recruit"),
      (else_try),
        (assign, ":var5", 3),
        (eq, "$vai_region_value", ":var5"),
        (assign, ":var3", "trp_highelf_recruit"),
        (assign, ":var4", "trp_chaos_recruit"),
      (else_try),
        (assign, ":var5", 4),
        (eq, "$vai_region_value", ":var5"),
        (assign, ":var3", "trp_chaos_dwarf_slaver"),
        (assign, ":var4", "trp_chaos_dwarf_deserter"),
      (else_try),
        (assign, ":var5", 5),
        (eq, "$vai_region_value", ":var5"),
        (assign, ":var3", "trp_chaos_recruit"),
        (assign, ":var4", "trp_nord_recruit"),
      (else_try),
        (assign, ":var5", 6),
        (eq, "$vai_region_value", ":var5"),
        (assign, ":var3", "trp_rhodok_tribesman"),
        (assign, ":var4", "trp_saurus_youngblood"),
      (else_try),
        (assign, ":var5", 7),
        (eq, "$vai_region_value", ":var5"),
        (assign, ":var3", "trp_saurus_youngblood"),
        (assign, ":var4", "trp_goblin_recruit"),
      (else_try),
        (assign, ":var5", 8),
        (eq, "$vai_region_value", ":var5"),
        (assign, ":var3", "trp_goblin_recruit"),
        (assign, ":var4", "trp_sarranid_recruit"),
      (else_try),
        (assign, ":var5", 9),
        (eq, "$vai_region_value", ":var5"),
        (assign, ":var3", "trp_farmer"),
        (assign, ":var4", "trp_mercenary_chaos_ogre"),
      (else_try),
        (assign, ":var5", 10),
        (eq, "$vai_region_value", ":var5"),
        (assign, ":var3", "trp_orc"),
        (assign, ":var4", "trp_bretonnian_peasant"),
      (else_try),
        (assign, ":var5", 11),
        (eq, "$vai_region_value", ":var5"),
        (assign, ":var3", "trp_farmer"),
        (assign, ":var4", "trp_mercenary_chaos_ogre"),
      (else_try),
        (assign, ":var5", 12),
        (eq, "$vai_region_value", ":var5"),
        (assign, ":var3", "trp_mercenary_chaos_ogre"),
        (assign, ":var4", "trp_chaos_dwarf_veteran"),
      (else_try),
        (assign, ":var5", 13),
        (eq, "$vai_region_value", ":var5"),
        (assign, ":var3", "trp_chaos_dwarf_veteran"),
        (assign, ":var4", "trp_mercenaries_end"),
      (else_try),
        (assign, ":var5", 14),
        (eq, "$vai_region_value", ":var5"),
        (assign, ":var3", "trp_looter"),
        (assign, ":var4", "trp_zombie_pirate"),
      (else_try),
        (assign, ":var5", 15),
        (eq, "$vai_region_value", ":var5"),
        (assign, ":var3", "trp_zombie_pirate"),
        (assign, ":var4", "trp_refugee"),
      (else_try),
        (assign, ":var5", 16),
        (eq, "$vai_region_value", ":var5"),
        (assign, ":var3", "trp_refugee"),
        (assign, ":var4", "trp_beastman_defender"),
      (else_try),
        (assign, ":var5", 17),
        (eq, "$vai_region_value", ":var5"),
        (assign, ":var3", "trp_beastman_defender"),
        (assign, ":var4", "trp_tournament_master"),
      (else_try),
        (assign, ":var5", 18),
        (eq, "$vai_region_value", ":var5"),
        (assign, ":var3", "trp_npc1"),
        (assign, ":var4", "trp_npc39"),
      (else_try),
        (assign, ":var5", 19),
        (eq, "$vai_region_value", ":var5"),
        (assign, ":var3", "trp_npc39"),
        (assign, ":var4", "trp_kingdom_1_lord"),
      (try_end),
      (str_store_string, s21, "@Done"),
      (call_script, "script_gpu_create_game_button", "str_hub_s21", 500, 40, 1),
      (assign, ":var6", 105),
      (assign, ":var7", 70),
      (assign, ":var8", 860),
      (assign, ":var9", 500),
      (assign, ":var10", 85),
      (assign, ":var11", 65),
      (assign, ":var12", 250),
      (try_for_range, ":var13", 1, 11),
        (store_mul, ":var14", ":var13", ":var11"),
        (val_add, ":var14", 230),
        (assign, reg21, ":var13"),
        (str_store_string, s21, "@TIER {reg21}"),
        (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var14", 640, 0, 2),
        (call_script, "script_gpu_resize_object", 0, 75),
      (try_end),
      (call_script, "script_gpu_draw_line", 850, 2, 73, 620, 3289650),
      (call_script, "script_gpu_container_heading", ":var7", ":var6", ":var8", ":var9", 2),
      (assign, ":var15", 0),
      (try_for_range, ":var16", ":var3", ":var4"),
        (val_add, ":var15", 1),
      (try_end),
      (store_mul, ":var17", ":var15", ":var10"),
      (val_add, ":var17", 40),
      (assign, ":var18", 0),
      (assign, ":var19", 0),
      (store_sub, ":var20", 200, 100),
      (try_for_range, ":var16", ":var3", ":var4"),
        (lt, ":var19", ":var20"),
        (ge, ":var16", 1),
        (store_add, ":var21", ":var17", -65),
        (store_add, ":var22", ":var18", 10),
        (str_store_troop_name, s21, ":var16"),
        (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var22", ":var21", 0, 4),
        (call_script, "script_gpu_resize_object", 0, 75),
        (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var22", ":var21", 0, 4),
        (call_script, "script_gpu_resize_object", 0, 75),
        (store_add, ":var23", ":var17", -100),
        (troop_get_slot, ":var24", ":var16", 188),
        (store_mul, ":var25", ":var24", ":var11"),
        (val_add, ":var25", 125),
        (try_begin),
          (eq, "$show_autoloot_data", 1),
          (store_add, ":var26", ":var25", 18),
          (store_add, ":var23", ":var17", -100),
          (try_begin),
            (store_character_level, ":var27", ":var16"),
            (troop_get_slot, ":var28", ":var16", 188),
            (val_mul, ":var28", 4),
            (neq, ":var27", ":var28"),
            (call_script, "script_gpu_draw_line", 40, 65, ":var26", ":var23", 4294945450),
          (try_end),
        (try_end),
        (store_add, ":var29", 100, ":var19"),
        (call_script, "script_gpu_create_troop_image", ":var16", ":var25", ":var23", ":var12", ":var29"),
        (store_add, ":var30", 200, ":var19"),
        (troop_set_slot, "trp_tpe_presobj", ":var30", ":var16"),
        (assign, ":var31", 50),
        (assign, ":var32", 5),
        (try_begin),
          (eq, "$show_autoloot_data", 1),
          (store_add, ":var33", ":var25", ":var31"),
          (store_add, ":var34", ":var23", ":var32"),
          (call_script, "script_ce_count_troop_abilities", ":var16"),
          (str_store_string, s21, "@{reg1}"),
          (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var33", ":var34", 0, 2),
          (call_script, "script_gpu_resize_object", 0, 75),
          (overlay_set_color, reg1, 0x0016FF),
          (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var33", ":var34", 0, 2),
          (call_script, "script_gpu_resize_object", 0, 75),
          (overlay_set_color, reg1, 0x0016FF),
        (try_end),
        (val_add, ":var19", 1),
        (assign, ":var35", ":var16"),
        (store_add, ":var36", ":var25", ":var11"),
        (store_add, ":var37", ":var25", 51),
        (try_for_range, ":var38", 0, 6),
          (troop_get_upgrade_troop, ":var39", ":var35", 0),
          (ge, ":var39", 1),
          (store_sub, ":var40", ":var11", 32),
          (store_add, ":var41", ":var17", -65),
          (call_script, "script_gpu_draw_line", ":var40", 1, ":var37", ":var41", 3289650),
          (try_begin),
            (eq, "$show_autoloot_data", 1),
            (store_add, ":var26", ":var36", 18),
            (store_add, ":var23", ":var17", -100),
            (try_begin),
              (store_add, ":var42", ":var24", ":var38"),
              (val_add, ":var42", 1),
              (troop_get_slot, ":var43", ":var39", 188),
              (neq, ":var43", ":var42"),
              (call_script, "script_gpu_draw_line", 40, 65, ":var26", ":var23", 4294945450),
            (try_end),
          (try_end),
          (store_add, ":var26", ":var36", 0),
          (store_add, ":var29", 100, ":var19"),
          (call_script, "script_gpu_create_troop_image", ":var39", ":var26", ":var23", ":var12", ":var29"),
          (store_add, ":var30", 200, ":var19"),
          (troop_set_slot, "trp_tpe_presobj", ":var30", ":var39"),
          (try_begin),
            (eq, "$show_autoloot_data", 1),
            (store_add, ":var33", ":var26", ":var31"),
            (store_add, ":var34", ":var23", ":var32"),
            (call_script, "script_ce_count_troop_abilities", ":var39"),
            (str_store_string, s21, "@{reg1}"),
            (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var33", ":var34", 0, 2),
            (call_script, "script_gpu_resize_object", 0, 75),
            (overlay_set_color, reg1, 0x0016FF),
            (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var33", ":var34", 0, 2),
            (call_script, "script_gpu_resize_object", 0, 75),
            (overlay_set_color, reg1, 0x0016FF),
          (try_end),
          (val_add, ":var19", 1),
          (val_add, ":var36", ":var11"),
          (val_add, ":var37", ":var11"),
          (assign, ":var35", ":var39"),
        (try_end),
        (val_sub, ":var17", ":var10"),
      (try_end),
      (set_container_overlay, -1),
    ]),
    (ti_on_presentation_event_state_change,
    [
      (store_trigger_param_1, ":var0"),
      (store_trigger_param_2, ":var1"),
      (try_begin),
        (eq, ":var0", "$vai_region_selector"),
        (assign, "$vai_region_value", ":var1"),
        (store_add, "$vai_region_kingdom", "$vai_region_value", "fac_player_supporters_faction"),
        (start_presentation, "prsnt_all_troops3"),
      (else_try),
        (troop_slot_eq, "trp_tpe_presobj", 1, ":var0"),
        (presentation_set_duration, 0),
        (jump_to_menu, "mnu_reference_reports"),
      (else_try),
        (try_for_range, ":var2", 100, 200),
          (troop_slot_eq, "trp_tpe_presobj", ":var2", ":var0"),
          (store_add, ":var3", 100, ":var2"),
          (troop_get_slot, "$temp", "trp_tpe_presobj", ":var3"),
          (assign, "$hub_mode", 5),
          (assign, "$g_presentation_next_presentation", "prsnt_all_troops3"),
          (presentation_set_duration, 0),
          (jump_to_menu, "mnu_troop_tree_switch_modes"),
        (try_end),
      (try_end),
    ]),
  ]),

  ("all_troops4", 0, mesh_load_window,
  [
    (ti_on_presentation_load,
    [
      (presentation_set_duration, 999999),
      (set_fixed_point_multiplier, 1000),
      (assign, "$gpu_storage", "trp_tpe_presobj"),
      (assign, "$gpu_data", "trp_tpe_presobj"),
      (create_combo_label_overlay, "$vai_region_selector"),
      (position_set_x, pos1, 500),
      (position_set_y, pos1, 675),
      (overlay_set_position, "$vai_region_selector", pos1),
      (try_for_range, ":var0", "fac_player_supporters_faction", "fac_kingdoms_end"),
        (str_store_faction_name, s21, ":var0"),
        (overlay_add_item, "$vai_region_selector", "@{s21}"),
      (try_end),
      (overlay_add_item, "$vai_region_selector", "@Bandits"),
      (overlay_set_val, "$vai_region_selector", "$vai_region_value"),
      (assign, ":var1", 950),
      (assign, ":var2", 690),
      (try_begin),
        (eq, "$vai_region_value", 16),
        (str_store_string, s21, "@Faction Models^by Gekokujo"),
        (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var1", ":var2", 0, 6),
        (call_script, "script_gpu_resize_object", 0, 75),
      (else_try),
        (eq, "$vai_region_value", 5),
        (str_store_string, s21, "@Faction Models^by Furok"),
        (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var1", ":var2", 0, 6),
        (call_script, "script_gpu_resize_object", 0, 75),
      (else_try),
        (str_store_string, s21, "@Faction Models^by various artists"),
        (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var1", ":var2", 0, 6),
        (call_script, "script_gpu_resize_object", 0, 75),
      (try_end),
      (assign, ":var3", "trp_player"),
      (assign, ":var4", "trp_kingdom_1_pretender"),
      (try_begin),
        (assign, ":var5", 0),
        (eq, "$vai_region_value", ":var5"),
        (assign, ":var3", "trp_player"),
        (assign, ":var4", "trp_multiplayer_profile_troop_male"),
      (else_try),
        (assign, ":var5", 1),
        (eq, "$vai_region_value", ":var5"),
        (assign, ":var3", "trp_player"),
        (assign, ":var4", "trp_multiplayer_profile_troop_male"),
      (else_try),
        (assign, ":var5", 2),
        (eq, "$vai_region_value", ":var5"),
        (assign, ":var3", "trp_player"),
        (assign, ":var4", "trp_multiplayer_profile_troop_male"),
      (else_try),
        (assign, ":var5", 3),
        (eq, "$vai_region_value", ":var5"),
        (assign, ":var3", "trp_player"),
        (assign, ":var4", "trp_multiplayer_profile_troop_male"),
      (else_try),
        (assign, ":var5", 4),
        (eq, "$vai_region_value", ":var5"),
        (assign, ":var3", "trp_player"),
        (assign, ":var4", "trp_multiplayer_profile_troop_male"),
      (else_try),
        (assign, ":var5", 5),
        (eq, "$vai_region_value", ":var5"),
        (assign, ":var3", "trp_player"),
        (assign, ":var4", "trp_multiplayer_profile_troop_male"),
      (else_try),
        (assign, ":var5", 6),
        (eq, "$vai_region_value", ":var5"),
        (assign, ":var3", "trp_player"),
        (assign, ":var4", "trp_multiplayer_profile_troop_male"),
      (else_try),
        (assign, ":var5", 7),
        (eq, "$vai_region_value", ":var5"),
        (assign, ":var3", "trp_player"),
        (assign, ":var4", "trp_multiplayer_profile_troop_male"),
      (else_try),
        (assign, ":var5", 8),
        (eq, "$vai_region_value", ":var5"),
        (assign, ":var3", "trp_player"),
        (assign, ":var4", "trp_multiplayer_profile_troop_male"),
      (else_try),
        (assign, ":var5", 9),
        (eq, "$vai_region_value", ":var5"),
        (assign, ":var3", "trp_player"),
        (assign, ":var4", "trp_multiplayer_profile_troop_male"),
      (else_try),
        (assign, ":var5", 10),
        (eq, "$vai_region_value", ":var5"),
        (assign, ":var3", "trp_player"),
        (assign, ":var4", "trp_multiplayer_profile_troop_male"),
      (else_try),
        (assign, ":var5", 11),
        (eq, "$vai_region_value", ":var5"),
        (assign, ":var3", "trp_player"),
        (assign, ":var4", "trp_multiplayer_profile_troop_male"),
      (else_try),
        (assign, ":var5", 12),
        (eq, "$vai_region_value", ":var5"),
        (assign, ":var3", "trp_player"),
        (assign, ":var4", "trp_multiplayer_profile_troop_male"),
      (else_try),
        (assign, ":var5", 13),
        (eq, "$vai_region_value", ":var5"),
        (assign, ":var3", "trp_player"),
        (assign, ":var4", "trp_multiplayer_profile_troop_male"),
      (else_try),
        (assign, ":var5", 14),
        (eq, "$vai_region_value", ":var5"),
        (assign, ":var3", "trp_player"),
        (assign, ":var4", "trp_multiplayer_profile_troop_male"),
      (else_try),
        (assign, ":var5", 15),
        (eq, "$vai_region_value", ":var5"),
        (assign, ":var3", "trp_player"),
        (assign, ":var4", "trp_multiplayer_profile_troop_male"),
      (else_try),
        (assign, ":var5", 16),
        (eq, "$vai_region_value", ":var5"),
        (assign, ":var3", "trp_player"),
        (assign, ":var4", "trp_multiplayer_profile_troop_male"),
      (else_try),
        (assign, ":var5", 17),
        (eq, "$vai_region_value", ":var5"),
        (assign, ":var3", "trp_player"),
        (assign, ":var4", "trp_multiplayer_profile_troop_male"),
      (else_try),
        (assign, ":var5", 18),
        (eq, "$vai_region_value", ":var5"),
        (assign, ":var3", "trp_player"),
        (assign, ":var4", "trp_multiplayer_profile_troop_male"),
      (else_try),
        (assign, ":var5", 19),
        (eq, "$vai_region_value", ":var5"),
        (assign, ":var3", "trp_farmer"),
        (assign, ":var4", "trp_mercenary_chaos_ogre"),
      (try_end),
      (str_store_string, s21, "@Done"),
      (call_script, "script_gpu_create_game_button", "str_hub_s21", 500, 40, 1),
      (assign, ":var6", 105),
      (assign, ":var7", 70),
      (assign, ":var8", 860),
      (assign, ":var9", 500),
      (assign, ":var10", 85),
      (assign, ":var11", 65),
      (assign, ":var12", 250),
      (try_for_range, ":var13", 1, 11),
        (store_mul, ":var14", ":var13", ":var11"),
        (val_add, ":var14", 230),
        (assign, reg21, ":var13"),
        (str_store_string, s21, "@TIER {reg21}"),
        (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var14", 640, 0, 2),
        (call_script, "script_gpu_resize_object", 0, 75),
      (try_end),
      (call_script, "script_gpu_draw_line", 850, 2, 73, 620, 3289650),
      (call_script, "script_gpu_container_heading", ":var7", ":var6", ":var8", ":var9", 2),
      (assign, ":var15", 0),
      (try_for_range, ":var16", ":var3", ":var4"),
        (val_add, ":var15", 1),
      (try_end),
      (store_mul, ":var17", ":var15", ":var10"),
      (val_add, ":var17", 40),
      (assign, ":var18", 0),
      (assign, ":var19", 0),
      (store_sub, ":var20", 200, 100),
      (try_for_range, ":var16", ":var3", ":var4"),
        (lt, ":var19", ":var20"),
        (ge, ":var16", 1),
        (store_add, ":var21", ":var17", -65),
        (store_add, ":var22", ":var18", 10),
        (str_store_troop_name, s21, ":var16"),
        (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var22", ":var21", 0, 4),
        (call_script, "script_gpu_resize_object", 0, 75),
        (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var22", ":var21", 0, 4),
        (call_script, "script_gpu_resize_object", 0, 75),
        (store_add, ":var23", ":var17", -100),
        (troop_get_slot, ":var24", ":var16", 188),
        (store_mul, ":var25", ":var24", ":var11"),
        (val_add, ":var25", 125),
        (try_begin),
          (eq, "$show_autoloot_data", 1),
          (store_add, ":var26", ":var25", 18),
          (store_add, ":var23", ":var17", -100),
          (try_begin),
            (store_character_level, ":var27", ":var16"),
            (troop_get_slot, ":var28", ":var16", 188),
            (val_mul, ":var28", 4),
            (neq, ":var27", ":var28"),
            (call_script, "script_gpu_draw_line", 40, 65, ":var26", ":var23", 4294945450),
          (try_end),
        (try_end),
        (store_add, ":var29", 100, ":var19"),
        (call_script, "script_gpu_create_troop_image", ":var16", ":var25", ":var23", ":var12", ":var29"),
        (store_add, ":var30", 200, ":var19"),
        (troop_set_slot, "trp_tpe_presobj", ":var30", ":var16"),
        (assign, ":var31", 50),
        (assign, ":var32", 5),
        (try_begin),
          (eq, "$show_autoloot_data", 1),
          (store_add, ":var33", ":var25", ":var31"),
          (store_add, ":var34", ":var23", ":var32"),
          (call_script, "script_ce_count_troop_abilities", ":var16"),
          (str_store_string, s21, "@{reg1}"),
          (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var33", ":var34", 0, 2),
          (call_script, "script_gpu_resize_object", 0, 75),
          (overlay_set_color, reg1, 0x0016FF),
          (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var33", ":var34", 0, 2),
          (call_script, "script_gpu_resize_object", 0, 75),
          (overlay_set_color, reg1, 0x0016FF),
        (try_end),
        (val_add, ":var19", 1),
        (assign, ":var35", ":var16"),
        (store_add, ":var36", ":var25", ":var11"),
        (store_add, ":var37", ":var25", 51),
        (try_for_range, ":var38", 0, 6),
          (troop_get_upgrade_troop, ":var39", ":var35", 0),
          (ge, ":var39", 1),
          (store_sub, ":var40", ":var11", 32),
          (store_add, ":var41", ":var17", -65),
          (call_script, "script_gpu_draw_line", ":var40", 1, ":var37", ":var41", 3289650),
          (try_begin),
            (eq, "$show_autoloot_data", 1),
            (store_add, ":var26", ":var36", 18),
            (store_add, ":var23", ":var17", -100),
            (try_begin),
              (store_add, ":var42", ":var24", ":var38"),
              (val_add, ":var42", 1),
              (troop_get_slot, ":var43", ":var39", 188),
              (neq, ":var43", ":var42"),
              (call_script, "script_gpu_draw_line", 40, 65, ":var26", ":var23", 4294945450),
            (try_end),
          (try_end),
          (store_add, ":var26", ":var36", 0),
          (store_add, ":var29", 100, ":var19"),
          (call_script, "script_gpu_create_troop_image", ":var39", ":var26", ":var23", ":var12", ":var29"),
          (store_add, ":var30", 200, ":var19"),
          (troop_set_slot, "trp_tpe_presobj", ":var30", ":var39"),
          (try_begin),
            (eq, "$show_autoloot_data", 1),
            (store_add, ":var33", ":var26", ":var31"),
            (store_add, ":var34", ":var23", ":var32"),
            (call_script, "script_ce_count_troop_abilities", ":var39"),
            (str_store_string, s21, "@{reg1}"),
            (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var33", ":var34", 0, 2),
            (call_script, "script_gpu_resize_object", 0, 75),
            (overlay_set_color, reg1, 0x0016FF),
            (call_script, "script_gpu_create_text_label", "str_hub_s21", ":var33", ":var34", 0, 2),
            (call_script, "script_gpu_resize_object", 0, 75),
            (overlay_set_color, reg1, 0x0016FF),
          (try_end),
          (val_add, ":var19", 1),
          (val_add, ":var36", ":var11"),
          (val_add, ":var37", ":var11"),
          (assign, ":var35", ":var39"),
        (try_end),
        (val_sub, ":var17", ":var10"),
      (try_end),
      (set_container_overlay, -1),
    ]),
    (ti_on_presentation_event_state_change,
    [
      (store_trigger_param_1, ":var0"),
      (store_trigger_param_2, ":var1"),
      (try_begin),
        (eq, ":var0", "$vai_region_selector"),
        (assign, "$vai_region_value", ":var1"),
        (store_add, "$vai_region_kingdom", "$vai_region_value", "fac_player_supporters_faction"),
        (start_presentation, "prsnt_all_troops4"),
      (else_try),
        (troop_slot_eq, "trp_tpe_presobj", 1, ":var0"),
        (presentation_set_duration, 0),
        (jump_to_menu, "mnu_reference_reports"),
      (else_try),
        (try_for_range, ":var2", 100, 200),
          (troop_slot_eq, "trp_tpe_presobj", ":var2", ":var0"),
          (store_add, ":var3", 100, ":var2"),
          (troop_get_slot, "$temp", "trp_tpe_presobj", ":var3"),
          (assign, "$hub_mode", 7),
          (assign, "$g_presentation_next_presentation", "prsnt_all_troops4"),
          (presentation_set_duration, 0),
          (jump_to_menu, "mnu_troop_tree_switch_modes"),
        (try_end),
      (try_end),
    ]),
  ]),

  ("mod_option", 0, mesh_load_window,
  [
    (ti_on_presentation_load,
    [
      (presentation_set_duration, 999999),
      (set_fixed_point_multiplier, 1000),
      (try_for_range, ":var0", 0, 25),
        (troop_set_slot, "trp_temp_array_a", ":var0", -1),
      (try_end),
      (str_clear, s0),
      (create_text_overlay, reg5, s0, tf_scrollable),
      (position_set_x, pos1, 50),
      (position_set_y, pos1, 50),
      (overlay_set_position, reg5, pos1),
      (position_set_x, pos1, 550),
      (position_set_y, pos1, 630),
      (overlay_set_area_size, reg5, pos1),
      (set_container_overlay, reg5),
      (troop_set_slot, "trp_temp_array_a", 0, reg5),
      (position_set_x, pos1, 0),
      (store_div, ":var1", 25, 3),
      (val_mul, ":var1", 2),
      (store_add, ":var2", 1200, ":var1"),
      (store_sub, ":var3", 1200, ":var1"),
      (create_mesh_overlay, reg1, "mesh_white_plane"),
      (position_set_x, pos1, 27500),
      (position_set_y, pos1, 1600),
      (overlay_set_size, reg1, pos1),
      (position_set_x, pos1, 0),
      (position_set_y, pos1, ":var3"),
      (overlay_set_position, reg1, pos1),
      (overlay_set_color, reg1, 0x170500),
      (create_mesh_overlay, reg1, "mesh_white_plane"),
      (position_set_x, pos1, 27500),
      (position_set_y, pos1, 100),
      (overlay_set_size, reg1, pos1),
      (position_set_x, pos1, 0),
      (position_set_y, pos1, ":var2"),
      (overlay_set_position, reg1, pos1),
      (overlay_set_color, reg1, 0x000000),
      (position_set_x, pos1, 0),
      (create_text_overlay, reg0, "@Warsword Conquest Options", tf_center_justify|tf_vertical_align_center),
      (position_set_x, pos1, 275),
      (position_set_y, pos1, 1200),
      (overlay_set_position, reg0, pos1),
      (overlay_set_color, reg0, 0xFFFFFF),
      (create_text_overlay, reg0, "@Warsword Conquest Options", tf_center_justify|tf_vertical_align_center),
      (position_set_x, pos1, 275),
      (position_set_y, pos1, 1200),
      (overlay_set_position, reg0, pos1),
      (overlay_set_color, reg0, 0xFFFFFF),
      (store_sub, ":var2", 1200, ":var1"),
      (create_mesh_overlay, reg1, "mesh_white_plane"),
      (position_set_x, pos1, 27500),
      (position_set_y, pos1, 100),
      (overlay_set_size, reg1, pos1),
      (position_set_x, pos1, 0),
      (position_set_y, pos1, ":var2"),
      (overlay_set_position, reg1, pos1),
      (overlay_set_color, reg1, 0x000000),
      (position_set_x, pos1, 0),
      (create_text_overlay, reg0, "@Cheat enable", tf_vertical_align_center),
      (position_set_y, pos1, 1150),
      (overlay_set_position, reg0, pos1),
      (position_set_x, pos1, 416),
      (create_check_box_overlay, reg5, "mesh_checkbox_off", "mesh_checkbox_on"),
      (position_set_y, pos1, 1141),
      (overlay_set_position, reg5, pos1),
      (troop_set_slot, "trp_temp_array_a", 1, reg5),
      (assign, reg1, "$cheat_mode"),
      (overlay_set_val, reg5, reg1),
      (position_set_x, pos1, 1000),
      (position_set_y, pos1, 1000),
      (overlay_set_size, reg5, pos1),
      (position_set_x, pos1, 0),
      (create_text_overlay, reg0, "@Auto-Loot disable", tf_vertical_align_center),
      (position_set_y, pos1, 1100),
      (overlay_set_position, reg0, pos1),
      (position_set_x, pos1, 416),
      (create_check_box_overlay, reg5, "mesh_checkbox_off", "mesh_checkbox_on"),
      (position_set_y, pos1, 1091),
      (overlay_set_position, reg5, pos1),
      (troop_set_slot, "trp_temp_array_a", 2, reg5),
      (assign, reg1, "$g_autoloot_enable"),
      (overlay_set_val, reg5, reg1),
      (position_set_x, pos1, 1000),
      (position_set_y, pos1, 1000),
      (overlay_set_size, reg5, pos1),
      (store_div, ":var1", 25, 3),
      (val_mul, ":var1", 2),
      (store_add, ":var2", 1050, ":var1"),
      (store_sub, ":var3", 1050, ":var1"),
      (create_mesh_overlay, reg1, "mesh_white_plane"),
      (position_set_x, pos1, 27500),
      (position_set_y, pos1, 1600),
      (overlay_set_size, reg1, pos1),
      (position_set_x, pos1, 0),
      (position_set_y, pos1, ":var3"),
      (overlay_set_position, reg1, pos1),
      (overlay_set_color, reg1, 0x170500),
      (create_mesh_overlay, reg1, "mesh_white_plane"),
      (position_set_x, pos1, 27500),
      (position_set_y, pos1, 100),
      (overlay_set_size, reg1, pos1),
      (position_set_x, pos1, 0),
      (position_set_y, pos1, ":var2"),
      (overlay_set_position, reg1, pos1),
      (overlay_set_color, reg1, 0x000000),
      (position_set_x, pos1, 0),
      (create_text_overlay, reg0, "@Battle Options", tf_center_justify|tf_vertical_align_center),
      (position_set_x, pos1, 275),
      (position_set_y, pos1, 1050),
      (overlay_set_position, reg0, pos1),
      (overlay_set_color, reg0, 0xFFFFFF),
      (create_text_overlay, reg0, "@Battle Options", tf_center_justify|tf_vertical_align_center),
      (position_set_x, pos1, 275),
      (position_set_y, pos1, 1050),
      (overlay_set_position, reg0, pos1),
      (overlay_set_color, reg0, 0xFFFFFF),
      (store_sub, ":var2", 1050, ":var1"),
      (create_mesh_overlay, reg1, "mesh_white_plane"),
      (position_set_x, pos1, 27500),
      (position_set_y, pos1, 100),
      (overlay_set_size, reg1, pos1),
      (position_set_x, pos1, 0),
      (position_set_y, pos1, ":var2"),
      (overlay_set_position, reg1, pos1),
      (overlay_set_color, reg1, 0x000000),
      (position_set_x, pos1, 0),
      (create_text_overlay, reg0, "@Charge On Death:", tf_vertical_align_center),
      (position_set_y, pos1, 1000),
      (overlay_set_position, reg0, pos1),
      (position_set_x, pos1, 416),
      (create_check_box_overlay, reg5, "mesh_checkbox_off", "mesh_checkbox_on"),
      (position_set_y, pos1, 991),
      (overlay_set_position, reg5, pos1),
      (troop_set_slot, "trp_temp_array_a", 3, reg5),
      (assign, reg1, "$g_dplmc_charge_when_dead"),
      (overlay_set_val, reg5, reg1),
      (position_set_x, pos1, 1000),
      (position_set_y, pos1, 1000),
      (overlay_set_size, reg5, pos1),
      (position_set_x, pos1, 0),
      (create_text_overlay, reg0, "@Prefer large battles:", tf_vertical_align_center),
      (position_set_y, pos1, 950),
      (overlay_set_position, reg0, pos1),
      (position_set_x, pos1, 416),
      (create_check_box_overlay, reg5, "mesh_checkbox_off", "mesh_checkbox_on"),
      (position_set_y, pos1, 941),
      (overlay_set_position, reg5, pos1),
      (troop_set_slot, "trp_temp_array_a", 4, reg5),
      (troop_get_slot, ":var4", "trp_multiplayer_end", 45),
      (assign, reg1, ":var4"),
      (overlay_set_val, reg5, reg1),
      (position_set_x, pos1, 1000),
      (position_set_y, pos1, 1000),
      (overlay_set_size, reg5, pos1),
      (store_div, ":var1", 25, 3),
      (val_mul, ":var1", 2),
      (store_add, ":var2", 900, ":var1"),
      (store_sub, ":var3", 900, ":var1"),
      (create_mesh_overlay, reg1, "mesh_white_plane"),
      (position_set_x, pos1, 27500),
      (position_set_y, pos1, 1600),
      (overlay_set_size, reg1, pos1),
      (position_set_x, pos1, 0),
      (position_set_y, pos1, ":var3"),
      (overlay_set_position, reg1, pos1),
      (overlay_set_color, reg1, 0x170500),
      (create_mesh_overlay, reg1, "mesh_white_plane"),
      (position_set_x, pos1, 27500),
      (position_set_y, pos1, 100),
      (overlay_set_size, reg1, pos1),
      (position_set_x, pos1, 0),
      (position_set_y, pos1, ":var2"),
      (overlay_set_position, reg1, pos1),
      (overlay_set_color, reg1, 0x000000),
      (position_set_x, pos1, 0),
      (create_text_overlay, reg0, "@Over-world Options", tf_center_justify|tf_vertical_align_center),
      (position_set_x, pos1, 275),
      (position_set_y, pos1, 900),
      (overlay_set_position, reg0, pos1),
      (overlay_set_color, reg0, 0xFFFFFF),
      (create_text_overlay, reg0, "@Over-world Options", tf_center_justify|tf_vertical_align_center),
      (position_set_x, pos1, 275),
      (position_set_y, pos1, 900),
      (overlay_set_position, reg0, pos1),
      (overlay_set_color, reg0, 0xFFFFFF),
      (store_sub, ":var2", 900, ":var1"),
      (create_mesh_overlay, reg1, "mesh_white_plane"),
      (position_set_x, pos1, 27500),
      (position_set_y, pos1, 100),
      (overlay_set_size, reg1, pos1),
      (position_set_x, pos1, 0),
      (position_set_y, pos1, ":var2"),
      (overlay_set_position, reg1, pos1),
      (overlay_set_color, reg1, 0x000000),
      (position_set_x, pos1, 0),
      (create_text_overlay, reg0, "@Wait Time Multiplier:", tf_vertical_align_center),
      (position_set_y, pos1, 850),
      (overlay_set_position, reg0, pos1),
      (position_set_x, pos1, 393),
      (create_number_box_overlay, reg5, 1, 5),
      (position_set_y, pos1, 836),
      (overlay_set_position, reg5, pos1),
      (position_set_x, pos1, 1000),
      (position_set_y, pos1, 1000),
      (overlay_set_size, reg5, pos1),
      (troop_set_slot, "trp_temp_array_a", 5, reg5),
      (assign, reg1, "$g_warsword_wait_multiplier"),
      (overlay_set_val, reg5, reg1),
      (store_div, ":var1", 25, 3),
      (val_mul, ":var1", 2),
      (store_add, ":var2", 800, ":var1"),
      (store_sub, ":var3", 800, ":var1"),
      (create_mesh_overlay, reg1, "mesh_white_plane"),
      (position_set_x, pos1, 27500),
      (position_set_y, pos1, 1600),
      (overlay_set_size, reg1, pos1),
      (position_set_x, pos1, 0),
      (position_set_y, pos1, ":var3"),
      (overlay_set_position, reg1, pos1),
      (overlay_set_color, reg1, 0x170500),
      (create_mesh_overlay, reg1, "mesh_white_plane"),
      (position_set_x, pos1, 27500),
      (position_set_y, pos1, 100),
      (overlay_set_size, reg1, pos1),
      (position_set_x, pos1, 0),
      (position_set_y, pos1, ":var2"),
      (overlay_set_position, reg1, pos1),
      (overlay_set_color, reg1, 0x000000),
      (position_set_x, pos1, 0),
      (create_text_overlay, reg0, "@Diplomacy Options", tf_center_justify|tf_vertical_align_center),
      (position_set_x, pos1, 275),
      (position_set_y, pos1, 800),
      (overlay_set_position, reg0, pos1),
      (overlay_set_color, reg0, 0xFFFFFF),
      (create_text_overlay, reg0, "@Diplomacy Options", tf_center_justify|tf_vertical_align_center),
      (position_set_x, pos1, 275),
      (position_set_y, pos1, 800),
      (overlay_set_position, reg0, pos1),
      (overlay_set_color, reg0, 0xFFFFFF),
      (store_sub, ":var2", 800, ":var1"),
      (create_mesh_overlay, reg1, "mesh_white_plane"),
      (position_set_x, pos1, 27500),
      (position_set_y, pos1, 100),
      (overlay_set_size, reg1, pos1),
      (position_set_x, pos1, 0),
      (position_set_y, pos1, ":var2"),
      (overlay_set_position, reg1, pos1),
      (overlay_set_color, reg1, 0x000000),
      (position_set_x, pos1, 0),
      (create_text_overlay, reg0, "@Horse speed limitation:", tf_vertical_align_center),
      (position_set_y, pos1, 750),
      (overlay_set_position, reg0, pos1),
      (position_set_x, pos1, 416),
      (create_check_box_overlay, reg5, "mesh_checkbox_off", "mesh_checkbox_on"),
      (position_set_y, pos1, 741),
      (overlay_set_position, reg5, pos1),
      (troop_set_slot, "trp_temp_array_a", 6, reg5),
      (assign, reg1, "$g_dplmc_horse_speed"),
      (overlay_set_val, reg5, reg1),
      (position_set_x, pos1, 1000),
      (position_set_y, pos1, 1000),
      (overlay_set_size, reg5, pos1),
      (position_set_x, pos1, 0),
      (create_text_overlay, reg0, "@Terrain advantage in Autocalc battles:", tf_vertical_align_center),
      (position_set_y, pos1, 700),
      (overlay_set_position, reg0, pos1),
      (position_set_x, pos1, 416),
      (create_check_box_overlay, reg5, "mesh_checkbox_off", "mesh_checkbox_on"),
      (position_set_y, pos1, 691),
      (overlay_set_position, reg5, pos1),
      (troop_set_slot, "trp_temp_array_a", 7, reg5),
      (store_add, reg1, "$g_dplmc_terrain_advantage", 1),
      (overlay_set_val, reg5, reg1),
      (position_set_x, pos1, 1000),
      (position_set_y, pos1, 1000),
      (overlay_set_size, reg5, pos1),
      (position_set_x, pos1, 0),
      (create_text_overlay, reg0, "@Lords returning from exile:", tf_vertical_align_center),
      (position_set_y, pos1, 650),
      (overlay_set_position, reg0, pos1),
      (position_set_x, pos1, 458),
      (create_combo_button_overlay, reg5),
      (position_set_y, pos1, 639),
      (overlay_set_position, reg5, pos1),
      (position_set_x, pos1, 700),
      (position_set_y, pos1, 800),
      (overlay_set_size, reg5, pos1),
      (troop_set_slot, "trp_temp_array_a", 8, reg5),
      (store_add, reg1, "$g_dplmc_lord_recycling", 1),
      (overlay_add_item, reg5, "@- Disabled -"),
      (overlay_add_item, reg5, "@Enabled"),
      (overlay_add_item, reg5, "@Frequent"),
      (overlay_set_val, reg5, reg1),
      (position_set_x, pos1, 0),
      (create_text_overlay, reg0, "@Diplomacy AI changes:", tf_vertical_align_center),
      (position_set_y, pos1, 600),
      (overlay_set_position, reg0, pos1),
      (position_set_x, pos1, 458),
      (create_combo_button_overlay, reg5),
      (position_set_y, pos1, 589),
      (overlay_set_position, reg5, pos1),
      (position_set_x, pos1, 700),
      (position_set_y, pos1, 800),
      (overlay_set_size, reg5, pos1),
      (troop_set_slot, "trp_temp_array_a", 9, reg5),
      (store_add, reg1, "$g_dplmc_ai_changes", 1),
      (overlay_add_item, reg5, "@- Disabled -"),
      (overlay_add_item, reg5, "@Low"),
      (overlay_add_item, reg5, "@Medium"),
      (overlay_add_item, reg5, "@High/Experimental"),
      (overlay_set_val, reg5, reg1),
      (position_set_x, pos1, 0),
      (create_text_overlay, reg0, "@Diplomacy economic changes:", tf_vertical_align_center),
      (position_set_y, pos1, 550),
      (overlay_set_position, reg0, pos1),
      (position_set_x, pos1, 458),
      (create_combo_button_overlay, reg5),
      (position_set_y, pos1, 539),
      (overlay_set_position, reg5, pos1),
      (position_set_x, pos1, 700),
      (position_set_y, pos1, 800),
      (overlay_set_size, reg5, pos1),
      (troop_set_slot, "trp_temp_array_a", 10, reg5),
      (store_add, reg1, "$g_dplmc_gold_changes", 1),
      (overlay_add_item, reg5, "@- Disabled -"),
      (overlay_add_item, reg5, "@Low"),
      (overlay_add_item, reg5, "@Medium"),
      (overlay_add_item, reg5, "@High/Experimental"),
      (overlay_set_val, reg5, reg1),
      (position_set_x, pos1, 0),
      (create_text_overlay, reg0, "@Anti-woman prejudice level:", tf_vertical_align_center),
      (position_set_y, pos1, 500),
      (overlay_set_position, reg0, pos1),
      (position_set_x, pos1, 458),
      (create_combo_button_overlay, reg5),
      (position_set_y, pos1, 489),
      (overlay_set_position, reg5, pos1),
      (position_set_x, pos1, 700),
      (position_set_y, pos1, 800),
      (overlay_set_size, reg5, pos1),
      (troop_set_slot, "trp_temp_array_a", 11, reg5),
      (try_begin),
        (this_or_next|eq, "$g_disable_condescending_comments", 2),
        (eq, "$g_disable_condescending_comments", 3),
        (assign, reg1, 0),
      (else_try),
        (this_or_next|eq, "$g_disable_condescending_comments", -1),
        (eq, "$g_disable_condescending_comments", -2),
        (assign, reg1, 2),
      (else_try),
        (assign, reg1, 1),
      (try_end),
      (overlay_add_item, reg5, "@- Disabled -"),
      (overlay_add_item, reg5, "@Default"),
      (overlay_add_item, reg5, "@High"),
      (overlay_set_val, reg5, reg1),
      (store_div, ":var1", 25, 3),
      (val_mul, ":var1", 2),
      (store_add, ":var2", 450, ":var1"),
      (store_sub, ":var3", 450, ":var1"),
      (create_mesh_overlay, reg1, "mesh_white_plane"),
      (position_set_x, pos1, 27500),
      (position_set_y, pos1, 1600),
      (overlay_set_size, reg1, pos1),
      (position_set_x, pos1, 0),
      (position_set_y, pos1, ":var3"),
      (overlay_set_position, reg1, pos1),
      (overlay_set_color, reg1, 0x170500),
      (create_mesh_overlay, reg1, "mesh_white_plane"),
      (position_set_x, pos1, 27500),
      (position_set_y, pos1, 100),
      (overlay_set_size, reg1, pos1),
      (position_set_x, pos1, 0),
      (position_set_y, pos1, ":var2"),
      (overlay_set_position, reg1, pos1),
      (overlay_set_color, reg1, 0x000000),
      (position_set_x, pos1, 0),
      (create_text_overlay, reg0, "@Formations Options", tf_center_justify|tf_vertical_align_center),
      (position_set_x, pos1, 275),
      (position_set_y, pos1, 450),
      (overlay_set_position, reg0, pos1),
      (overlay_set_color, reg0, 0xFFFFFF),
      (create_text_overlay, reg0, "@Formations Options", tf_center_justify|tf_vertical_align_center),
      (position_set_x, pos1, 275),
      (position_set_y, pos1, 450),
      (overlay_set_position, reg0, pos1),
      (overlay_set_color, reg0, 0xFFFFFF),
      (store_sub, ":var2", 450, ":var1"),
      (create_mesh_overlay, reg1, "mesh_white_plane"),
      (position_set_x, pos1, 27500),
      (position_set_y, pos1, 100),
      (overlay_set_size, reg1, pos1),
      (position_set_x, pos1, 0),
      (position_set_y, pos1, ":var2"),
      (overlay_set_position, reg1, pos1),
      (overlay_set_color, reg1, 0x000000),
      (position_set_x, pos1, 0),
      (create_text_overlay, reg0, "@Disable Mod Formations:", tf_vertical_align_center),
      (position_set_y, pos1, 400),
      (overlay_set_position, reg0, pos1),
      (position_set_x, pos1, 416),
      (create_check_box_overlay, reg5, "mesh_checkbox_off", "mesh_checkbox_on"),
      (position_set_y, pos1, 391),
      (overlay_set_position, reg5, pos1),
      (troop_set_slot, "trp_temp_array_a", 12, reg5),
      (assign, reg1, "$formation_off"),
      (overlay_set_val, reg5, reg1),
      (position_set_x, pos1, 1000),
      (position_set_y, pos1, 1000),
      (overlay_set_size, reg5, pos1),
      (position_set_x, pos1, 0),
      (create_text_overlay, reg0, "@Allow Formation Rotation:", tf_vertical_align_center),
      (position_set_y, pos1, 350),
      (overlay_set_position, reg0, pos1),
      (position_set_x, pos1, 416),
      (create_check_box_overlay, reg5, "mesh_checkbox_off", "mesh_checkbox_on"),
      (position_set_y, pos1, 341),
      (overlay_set_position, reg5, pos1),
      (troop_set_slot, "trp_temp_array_a", 13, reg5),
      (assign, reg1, "$formation_autorotate"),
      (overlay_set_val, reg5, reg1),
      (position_set_x, pos1, 1000),
      (position_set_y, pos1, 1000),
      (overlay_set_size, reg5, pos1),
      (position_set_x, pos1, 0),
      (create_text_overlay, reg0, "@Scale AI vs. Battle Size:", tf_vertical_align_center),
      (position_set_y, pos1, 300),
      (overlay_set_position, reg0, pos1),
      (position_set_x, pos1, 416),
      (create_check_box_overlay, reg5, "mesh_checkbox_off", "mesh_checkbox_on"),
      (position_set_y, pos1, 291),
      (overlay_set_position, reg5, pos1),
      (troop_set_slot, "trp_temp_array_a", 14, reg5),
      (assign, reg1, "$formation_no_nearest_agent"),
      (overlay_set_val, reg5, reg1),
      (position_set_x, pos1, 1000),
      (position_set_y, pos1, 1000),
      (overlay_set_size, reg5, pos1),
      (position_set_x, pos1, 0),
      (create_text_overlay, reg0, "@AI Defense Stance Blocked:", tf_vertical_align_center),
      (position_set_y, pos1, 250),
      (overlay_set_position, reg0, pos1),
      (position_set_x, pos1, 416),
      (create_check_box_overlay, reg5, "mesh_checkbox_off", "mesh_checkbox_on"),
      (position_set_y, pos1, 241),
      (overlay_set_position, reg5, pos1),
      (troop_set_slot, "trp_temp_array_a", 15, reg5),
      (assign, reg1, "$formation_AI_no_defense"),
      (overlay_set_val, reg5, reg1),
      (position_set_x, pos1, 1000),
      (position_set_y, pos1, 1000),
      (overlay_set_size, reg5, pos1),
      (position_set_x, pos1, 0),
      (create_text_overlay, reg0, "@Put Player in Division:", tf_vertical_align_center),
      (position_set_y, pos1, 200),
      (overlay_set_position, reg0, pos1),
      (position_set_x, pos1, 393),
      (create_number_box_overlay, reg5, 0, 10),
      (position_set_y, pos1, 186),
      (overlay_set_position, reg5, pos1),
      (position_set_x, pos1, 1000),
      (position_set_y, pos1, 1000),
      (overlay_set_size, reg5, pos1),
      (troop_set_slot, "trp_temp_array_a", 16, reg5),
      (assign, reg1, "$formation_player_in_division"),
      (overlay_set_val, reg5, reg1),
      (store_div, ":var1", 25, 3),
      (val_mul, ":var1", 2),
      (store_add, ":var2", 150, ":var1"),
      (store_sub, ":var3", 150, ":var1"),
      (create_mesh_overlay, reg1, "mesh_white_plane"),
      (position_set_x, pos1, 27500),
      (position_set_y, pos1, 1600),
      (overlay_set_size, reg1, pos1),
      (position_set_x, pos1, 0),
      (position_set_y, pos1, ":var3"),
      (overlay_set_position, reg1, pos1),
      (overlay_set_color, reg1, 0x170500),
      (create_mesh_overlay, reg1, "mesh_white_plane"),
      (position_set_x, pos1, 27500),
      (position_set_y, pos1, 100),
      (overlay_set_size, reg1, pos1),
      (position_set_x, pos1, 0),
      (position_set_y, pos1, ":var2"),
      (overlay_set_position, reg1, pos1),
      (overlay_set_color, reg1, 0x000000),
      (position_set_x, pos1, 0),
      (create_text_overlay, reg0, "@Tester Options", tf_center_justify|tf_vertical_align_center),
      (position_set_x, pos1, 275),
      (position_set_y, pos1, 150),
      (overlay_set_position, reg0, pos1),
      (overlay_set_color, reg0, 0xFFFFFF),
      (create_text_overlay, reg0, "@Tester Options", tf_center_justify|tf_vertical_align_center),
      (position_set_x, pos1, 275),
      (position_set_y, pos1, 150),
      (overlay_set_position, reg0, pos1),
      (overlay_set_color, reg0, 0xFFFFFF),
      (store_sub, ":var2", 150, ":var1"),
      (create_mesh_overlay, reg1, "mesh_white_plane"),
      (position_set_x, pos1, 27500),
      (position_set_y, pos1, 100),
      (overlay_set_size, reg1, pos1),
      (position_set_x, pos1, 0),
      (position_set_y, pos1, ":var2"),
      (overlay_set_position, reg1, pos1),
      (overlay_set_color, reg1, 0x000000),
      (position_set_x, pos1, 0),
      (create_text_overlay, reg0, "@Combat Abilities Enable", tf_vertical_align_center),
      (position_set_y, pos1, 100),
      (overlay_set_position, reg0, pos1),
      (position_set_x, pos1, 416),
      (create_check_box_overlay, reg5, "mesh_checkbox_off", "mesh_checkbox_on"),
      (position_set_y, pos1, 91),
      (overlay_set_position, reg5, pos1),
      (troop_set_slot, "trp_temp_array_a", 17, reg5),
      (assign, reg1, "$combat_damage"),
      (overlay_set_val, reg5, reg1),
      (position_set_x, pos1, 1000),
      (position_set_y, pos1, 1000),
      (overlay_set_size, reg5, pos1),
      (position_set_x, pos1, 0),
      (create_text_overlay, reg0, "@Enable Party Spawns:", tf_vertical_align_center),
      (position_set_y, pos1, 50),
      (overlay_set_position, reg0, pos1),
      (position_set_x, pos1, 416),
      (create_check_box_overlay, reg5, "mesh_checkbox_off", "mesh_checkbox_on"),
      (position_set_y, pos1, 41),
      (overlay_set_position, reg5, pos1),
      (troop_set_slot, "trp_temp_array_a", 18, reg5),
      (assign, reg1, "$g_party_spawns_on"),
      (overlay_set_val, reg5, reg1),
      (position_set_x, pos1, 1000),
      (position_set_y, pos1, 1000),
      (overlay_set_size, reg5, pos1),
      (set_container_overlay, -1),
      (create_text_overlay, reg5, "@Warsword^Options", tf_center_justify),
      (position_set_x, pos1, 800),
      (position_set_y, pos1, 600),
      (overlay_set_position, reg5, pos1),
      (position_set_x, pos1, 2000),
      (position_set_y, pos1, 2000),
      (overlay_set_size, reg5, pos1),
      (create_text_overlay, reg5, "@Warsword^Options", tf_center_justify),
      (position_set_x, pos1, 800),
      (position_set_y, pos1, 600),
      (overlay_set_position, reg5, pos1),
      (position_set_x, pos1, 2000),
      (position_set_y, pos1, 2000),
      (overlay_set_size, reg5, pos1),
      (create_text_overlay, "$g_presentation_obj_name_kingdom_2", s0, tf_double_space|tf_scrollable),
      (position_set_x, pos1, 650),
      (position_set_y, pos1, 150),
      (overlay_set_position, "$g_presentation_obj_name_kingdom_2", pos1),
      (position_set_x, pos1, 800),
      (position_set_y, pos1, 800),
      (overlay_set_size, "$g_presentation_obj_name_kingdom_2", pos1),
      (position_set_x, pos1, 300),
      (position_set_y, pos1, 400),
      (overlay_set_area_size, "$g_presentation_obj_name_kingdom_2", pos1),
      (create_game_button_overlay, "$g_presentation_obj_name_kingdom_1", "@Done"),
      (position_set_x, pos1, 880),
      (position_set_y, pos1, 25),
      (overlay_set_position, "$g_presentation_obj_name_kingdom_1", pos1),
      (position_set_x, pos1, 720),
      (create_game_button_overlay, reg5, "@Faction Colors", 16),
      (overlay_set_position, reg5, pos1),
    ]),
    (ti_on_presentation_event_state_change,
    [
      (store_trigger_param_1, ":var0"),
      (store_trigger_param_2, ":var1"),
      (try_begin),
        (neq, 1, 1),
      (else_try),
        (troop_slot_eq, "trp_temp_array_a", 1, ":var0"),
        (assign, reg1, ":var1"),
        (assign, "$cheat_mode", reg1),
      (else_try),
        (troop_slot_eq, "trp_temp_array_a", 2, ":var0"),
        (assign, reg1, ":var1"),
        (assign, "$g_autoloot_enable", reg1),
      (else_try),
        (troop_slot_eq, "trp_temp_array_a", 3, ":var0"),
        (assign, reg1, ":var1"),
        (assign, "$g_dplmc_charge_when_dead", reg1),
        (assign, ":var1", reg1),
        (party_set_slot, "p_main_party", 86, ":var1"),
      (else_try),
        (troop_slot_eq, "trp_temp_array_a", 4, ":var0"),
        (assign, reg1, ":var1"),
        (assign, ":var1", reg1),
        (troop_set_slot, "trp_multiplayer_end", 45, ":var1"),
      (else_try),
        (troop_slot_eq, "trp_temp_array_a", 5, ":var0"),
        (assign, reg1, ":var1"),
        (assign, "$g_warsword_wait_multiplier", reg1),
      (else_try),
        (troop_slot_eq, "trp_temp_array_a", 6, ":var0"),
        (assign, reg1, ":var1"),
        (assign, "$g_dplmc_horse_speed", reg1),
      (else_try),
        (troop_slot_eq, "trp_temp_array_a", 7, ":var0"),
        (assign, reg1, ":var1"),
        (store_sub, "$g_dplmc_terrain_advantage", reg1, 1),
      (else_try),
        (troop_slot_eq, "trp_temp_array_a", 8, ":var0"),
        (assign, reg1, ":var1"),
        (store_sub, "$g_dplmc_lord_recycling", reg1, 1),
      (else_try),
        (troop_slot_eq, "trp_temp_array_a", 9, ":var0"),
        (assign, reg1, ":var1"),
        (store_sub, "$g_dplmc_ai_changes", reg1, 1),
      (else_try),
        (troop_slot_eq, "trp_temp_array_a", 10, ":var0"),
        (assign, reg1, ":var1"),
        (store_sub, "$g_dplmc_gold_changes", reg1, 1),
      (else_try),
        (troop_slot_eq, "trp_temp_array_a", 11, ":var0"),
        (assign, reg1, ":var1"),
        (try_begin),
          (eq, reg1, 0),
          (assign, "$g_disable_condescending_comments", 2),
        (else_try),
          (eq, reg1, 2),
          (assign, "$g_disable_condescending_comments", -2),
        (else_try),
          (assign, "$g_disable_condescending_comments", 0),
        (try_end),
      (else_try),
        (troop_slot_eq, "trp_temp_array_a", 12, ":var0"),
        (assign, reg1, ":var1"),
        (assign, "$formation_off", reg1),
      (else_try),
        (troop_slot_eq, "trp_temp_array_a", 13, ":var0"),
        (assign, reg1, ":var1"),
        (assign, "$formation_autorotate", reg1),
      (else_try),
        (troop_slot_eq, "trp_temp_array_a", 14, ":var0"),
        (assign, reg1, ":var1"),
        (assign, "$formation_no_nearest_agent", reg1),
      (else_try),
        (troop_slot_eq, "trp_temp_array_a", 15, ":var0"),
        (assign, reg1, ":var1"),
        (assign, "$formation_AI_no_defense", reg1),
      (else_try),
        (troop_slot_eq, "trp_temp_array_a", 16, ":var0"),
        (assign, reg1, ":var1"),
        (assign, "$formation_player_in_division", reg1),
      (else_try),
        (troop_slot_eq, "trp_temp_array_a", 17, ":var0"),
        (assign, reg1, ":var1"),
        (assign, "$combat_damage", reg1),
      (else_try),
        (troop_slot_eq, "trp_temp_array_a", 18, ":var0"),
        (assign, reg1, ":var1"),
        (assign, "$g_party_spawns_on", reg1),
      (else_try),
        (eq, ":var0", "$g_presentation_obj_name_kingdom_1"),
        (presentation_set_duration, 0),
        (try_begin),
          (eq, "$g_is_quick_battle", 1),
          (assign, "$g_is_quick_battle", 0),
          (start_presentation, "prsnt_game_custom_battle_designer"),
        (try_end),
      (else_try),
        (store_add, ":var2", "$g_presentation_obj_name_kingdom_1", 1),
        (eq, ":var0", ":var2"),
        (try_begin),
          (eq, "$g_is_quick_battle", 1),
          (presentation_set_duration, 0),
        (try_end),
        (start_presentation, "prsnt_change_all_factions_color"),
      (try_end),
    ]),
    (ti_on_presentation_mouse_enter_leave,
    [
      (store_trigger_param_1, ":var0"),
      (store_trigger_param_2, ":var1"),
      (try_begin),
        (eq, ":var1", 1),
      (else_try),
        (eq, ":var1", 0),
        (try_begin),
          (neq, 1, 1),
        (else_try),
          (troop_get_slot, reg5, "trp_temp_array_a", 1),
          (val_sub, reg5, 1),
          (this_or_next|eq, ":var0", reg5),
          (troop_slot_eq, "trp_temp_array_a", 1, ":var0"),
          (overlay_set_text, "$g_presentation_obj_name_kingdom_2", "@If Enabled, Cheat menu display and feedback is on.^^Default = Disabled"),
        (else_try),
          (troop_get_slot, reg5, "trp_temp_array_a", 2),
          (val_sub, reg5, 1),
          (this_or_next|eq, ":var0", reg5),
          (troop_slot_eq, "trp_temp_array_a", 2, ":var0"),
          (overlay_set_text, "$g_presentation_obj_name_kingdom_2", "@If DISABLED, Auto-Loot is ON.^^Default = Disabled"),
        (else_try),
          (troop_get_slot, reg5, "trp_temp_array_a", 3),
          (val_sub, reg5, 1),
          (this_or_next|eq, ":var0", reg5),
          (troop_slot_eq, "trp_temp_array_a", 3, ":var0"),
          (overlay_set_text, "$g_presentation_obj_name_kingdom_2", "@If Enabled, your units will break formation and charge when you die.^^ Synchronizes Diplomacy and PBOD charge options^^Default = Enabled"),
        (else_try),
          (troop_get_slot, reg5, "trp_temp_array_a", 4),
          (val_sub, reg5, 1),
          (this_or_next|eq, ":var0", reg5),
          (troop_slot_eq, "trp_temp_array_a", 4, ":var0"),
          (overlay_set_text, "$g_presentation_obj_name_kingdom_2", "@reserved for future use, does nothing now.^^Default = Disabled"),
        (else_try),
          (troop_get_slot, reg5, "trp_temp_array_a", 5),
          (val_sub, reg5, 1),
          (this_or_next|eq, ":var0", reg5),
          (troop_slot_eq, "trp_temp_array_a", 5, ":var0"),
          (overlay_set_text, "$g_presentation_obj_name_kingdom_2", "@This sets the time multiplier while resting and waiting.^^Default = 3"),
        (else_try),
          (troop_get_slot, reg5, "trp_temp_array_a", 6),
          (val_sub, reg5, 1),
          (this_or_next|eq, ":var0", reg5),
          (troop_slot_eq, "trp_temp_array_a", 6, ":var0"),
          (overlay_set_text, "$g_presentation_obj_name_kingdom_2", "@When enabled, this causes horses to travel slower as they take damage."),
        (else_try),
          (troop_get_slot, reg5, "trp_temp_array_a", 7),
          (val_sub, reg5, 1),
          (this_or_next|eq, ":var0", reg5),
          (troop_slot_eq, "trp_temp_array_a", 7, ":var0"),
          (overlay_set_text, "$g_presentation_obj_name_kingdom_2", "@Ticked, autocalculated battles also understand magic and cleric casters. Unticked, as in Native and auto-battles are only based on party size and troop levels."),
        (else_try),
          (troop_get_slot, reg5, "trp_temp_array_a", 8),
          (val_sub, reg5, 1),
          (this_or_next|eq, ":var0", reg5),
          (troop_slot_eq, "trp_temp_array_a", 8, ":var0"),
          (overlay_set_text, "$g_presentation_obj_name_kingdom_2", "@Allows exiled lords to be pardoned after a time and rejoin a faction to prevent 'lord-drain' in the late game. ^^Must Enable to avoid problems"),
        (else_try),
          (troop_get_slot, reg5, "trp_temp_array_a", 9),
          (val_sub, reg5, 1),
          (this_or_next|eq, ":var0", reg5),
          (troop_slot_eq, "trp_temp_array_a", 9, ":var0"),
          (overlay_set_text, "$g_presentation_obj_name_kingdom_2", "@Low:^^ - Center points for fief allocation are calculated (villages 1 / castles 2 / towns 3) instead of (villages 1 / castles 1 / towns 2).^^ - For qst rescue prisoner and qst offer gift, the relatives that can be a target of the quest have been extended to include uncles and aunts and in-laws.^^ - Alterations to script calculate troop score for center (these changes currently are only relevant during claimant quests).^^ - When picking a new faction, lords are more likely to return to their original faction (except when that's the faction they're being exiled from), if the ordinary conditions for rejoining are met.  A lord's decision may also be influenced by his relations with other lords in the various factions, instead of just his relations with the faction leaders.^^Medium:^^ - Some changes for lord relation gains/losses when fiefs are allocated.^^ - Kings overrule lords slightly less frequently on faction issues.^^ - In deciding who to support for a fief, minor parameter changes for certain personalities. Some lords will still give priority to fiefless lords or to the lord who conquered the center if they have a slightly negative relation (normally the cutoff is 0 for all personalities).^^ - When a lord can't find any good candidates for a fief under the normal rules, instead of automatically supporting himself he uses a weighted scoring scheme.^^ - In various places where 'average renown * 3/2' appears, an alternate calculation is sometimes used.^^High:^^ - The 'renown factor' when an NPC lord or the player courts and NPC lady is adjusted by the prestige of the lady's guardian.^^ - When a faction has fiefless lords and no free fiefs left, under some circumstances the king will redistribute a village he owns.^^"),
        (else_try),
          (troop_get_slot, reg5, "trp_temp_array_a", 10),
          (val_sub, reg5, 1),
          (this_or_next|eq, ":var0", reg5),
          (troop_slot_eq, "trp_temp_array_a", 10, ":var0"),
          (overlay_set_text, "$g_presentation_obj_name_kingdom_2", "@Low:^^ - Caravan trade benefits both the source and the destination^^ - When the player surrenders, there is a chance his personal equipment will not be looted, based on who accepted the surrender and the difficulty setting. (This is meant to address a gameplay issue. In the first 700 days or so, there is no possible benefit to surrendering rather than fighting to the last man.) Also, a bug that made it possible for books etc. to be looted was corrected.^^ - AI caravans take into consideration distance when choosing their next destination and will be slightly more like to visit their own faction. This strategy is mixed with the Native one, so the trade pattern will differ but not wildly.^^ - Scale town merchant gold by prosperity (up to a maximum 40% change).^^ - Food prices increase in towns that have been under siege for at least 48 hours.^^ - In towns the trade penalty script has been tweaked to make it more efficient to sell goods to merchants specializing in them.^^Medium:^^ - Food consumption increases in towns as prosperity increases.^^   Consumption also increases with garrison sizes.^^ - Lords' looting skill affects how much gold they take from the player when they defeat him.^^ - Lords' leadership skill modifies their troop wage costs the same way it does for the player.^^ - The player can lose gold when his fiefs are looted, like lords.^^ - The same way that lord party sizes increase as the player progresses, mercenary party sizes also increase to maintain their relevance. (The rate is the same as for lords: a 1.25% increase per level.)^^ - If the player has a kingdom of his own, his spouse will receive part of the bonus that ordinarily would be due a liege.  The extent of this bonus depends on the number of fiefs the players holds. This bonus is non-cumulative with the marshall bonus.^^ - Attrition is inflicted on NPC-owned centers if they can't pay wages, but only above a certain threshold.^^ - Strangers cannot acquire enterprises (enforced at 1 instead of at 0, so you have to do something).^^High: - The total amount of weekly bonus gold awarded to kings in Calradia   remains constant: as kings go into exile, their bonuses are divided among the remaining kings.^^ - If lord's run a personal gold surplus after party wages, the extra is divided among the lord and his garrisons budgets (each castle and town has its own pool of funds to pay for soldiers) on the basis of whether the lord is low on gold or any of his fortresses are. (If none are low   on gold, the lord takes everything, like before.)^^ - The honor loss from an offense depends in part on the player's honor   at the time.  The purer the reputation, the greater the effect of a single disagrace.^^ - Raiding change: village gold lost is removed from uncollected taxes before the balance (if any) is removed from the lord.^^ - Cash for prisoners"),
        (else_try),
          (troop_get_slot, reg5, "trp_temp_array_a", 11),
          (val_sub, reg5, 1),
          (this_or_next|eq, ":var0", reg5),
          (troop_slot_eq, "trp_temp_array_a", 11, ":var0"),
          (overlay_set_text, "$g_presentation_obj_name_kingdom_2", "@Disabled levels the playing-field for female player characters. Default as in Native. High increases the sexism/anti-woman prejudice of the medieval setting for female player characters."),
        (else_try),
          (troop_get_slot, reg5, "trp_temp_array_a", 12),
          (val_sub, reg5, 1),
          (this_or_next|eq, ":var0", reg5),
          (troop_slot_eq, "trp_temp_array_a", 12, ":var0"),
          (overlay_set_text, "$g_presentation_obj_name_kingdom_2", "@If checked this disables the formation mod.^^Default = Disabled"),
        (else_try),
          (troop_get_slot, reg5, "trp_temp_array_a", 13),
          (val_sub, reg5, 1),
          (this_or_next|eq, ":var0", reg5),
          (troop_slot_eq, "trp_temp_array_a", 13, ":var0"),
          (overlay_set_text, "$g_presentation_obj_name_kingdom_2", "@If enabled, this allows your formations to pivot to face the center of the enemy's party.^^Default = Enabled"),
        (else_try),
          (troop_get_slot, reg5, "trp_temp_array_a", 14),
          (val_sub, reg5, 1),
          (this_or_next|eq, ":var0", reg5),
          (troop_slot_eq, "trp_temp_array_a", 14, ":var0"),
          (overlay_set_text, "$g_presentation_obj_name_kingdom_2", "@If enabled, reduces the intelligence of the AI when in larger battles to help improve performance.^^Default = Enabled"),
        (else_try),
          (troop_get_slot, reg5, "trp_temp_array_a", 15),
          (val_sub, reg5, 1),
          (this_or_next|eq, ":var0", reg5),
          (troop_slot_eq, "trp_temp_array_a", 15, ":var0"),
          (overlay_set_text, "$g_presentation_obj_name_kingdom_2", "@If enabled, prevents the AI from taking up a defensive stance leading to prolonged waiting periods.^^Default = Enabled"),
        (else_try),
          (troop_get_slot, reg5, "trp_temp_array_a", 16),
          (val_sub, reg5, 1),
          (this_or_next|eq, ":var0", reg5),
          (troop_slot_eq, "trp_temp_array_a", 16, ":var0"),
          (overlay_set_text, "$g_presentation_obj_name_kingdom_2", "@This sets which division the player is made a part of.^^Default = 9"),
        (else_try),
          (troop_get_slot, reg5, "trp_temp_array_a", 17),
          (val_sub, reg5, 1),
          (this_or_next|eq, ":var0", reg5),
          (troop_slot_eq, "trp_temp_array_a", 17, ":var0"),
          (overlay_set_text, "$g_presentation_obj_name_kingdom_2", "@If Enabled, combat abilities (would be) ON^^Default = ENABLED"),
        (else_try),
          (troop_get_slot, reg5, "trp_temp_array_a", 18),
          (val_sub, reg5, 1),
          (this_or_next|eq, ":var0", reg5),
          (troop_slot_eq, "trp_temp_array_a", 18, ":var0"),
          (overlay_set_text, "$g_presentation_obj_name_kingdom_2", "@When ON, Bandit lairs, bandit parties, kingdom parties, and traders can spawn."),
        (else_try),
        (try_end),
      (try_end),
    ]),
  ]),

]